<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    Column Loading Options
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
        <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="../../index.html" />
        <link rel="up" title="ORM Querying Guide" href="index.html" />
        <link rel="next" title="Relationship Loading Techniques" href="relationships.html" />
        <link rel="prev" title="ORM-Enabled INSERT, UPDATE, and DELETE statements" href="dml.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.31</span>


        | Release Date: June 18, 2024

    </div>

    <h1><a href="../../index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../../index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="../index.html" title="SQLAlchemy ORM">SQLAlchemy ORM</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="../quickstart.html">ORM Quick Start</a></span></li>
<li><span class="link-container"><a class="reference external" href="../mapper_config.html">ORM Mapped Class Configuration</a></span></li>
<li><span class="link-container"><a class="reference external" href="../relationships.html">Relationship Configuration</a></span></li>
<li><span class="link-container"><a class="reference external" href="index.html">ORM Querying Guide</a></span><ul>
<li><span class="link-container"><a class="reference external" href="select.html">Writing SELECT statements for ORM Mapped Classes</a></span></li>
<li><span class="link-container"><a class="reference external" href="inheritance.html">Writing SELECT statements for Inheritance Mappings</a></span></li>
<li><span class="link-container"><a class="reference external" href="dml.html">ORM-Enabled INSERT, UPDATE, and DELETE statements</a></span></li>
<li class="selected"><span class="link-container"><strong>Column Loading Options</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#limiting-which-columns-load-with-column-deferral">Limiting which Columns Load with Column Deferral</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#using-load-only-to-reduce-loaded-columns">Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> to reduce loaded columns</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#using-load-only-with-multiple-entities">Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> with multiple entities</a></span></li>
<li><span class="link-container"><a class="reference external" href="#using-load-only-on-related-objects-and-collections">Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> on related objects and collections</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#using-defer-to-omit-specific-columns">Using <code class="docutils literal notranslate"><span class="pre">defer()</span></code> to omit specific columns</a></span></li>
<li><span class="link-container"><a class="reference external" href="#using-raiseload-to-prevent-deferred-column-loads">Using raiseload to prevent deferred column loads</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#configuring-column-deferral-on-mappings">Configuring Column Deferral on Mappings</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#using-deferred-for-imperative-mappers-mapped-sql-expressions">Using <code class="docutils literal notranslate"><span class="pre">deferred()</span></code> for imperative mappers, mapped SQL expressions</a></span></li>
<li><span class="link-container"><a class="reference external" href="#using-undefer-to-eagerly-load-deferred-columns">Using <code class="docutils literal notranslate"><span class="pre">undefer()</span></code> to “eagerly” load deferred columns</a></span></li>
<li><span class="link-container"><a class="reference external" href="#loading-deferred-columns-in-groups">Loading deferred columns in groups</a></span></li>
<li><span class="link-container"><a class="reference external" href="#undeferring-by-group-with-undefer-group">Undeferring by group with <code class="docutils literal notranslate"><span class="pre">undefer_group()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#undeferring-on-wildcards">Undeferring on wildcards</a></span></li>
<li><span class="link-container"><a class="reference external" href="#configuring-mapper-level-raiseload-behavior">Configuring mapper-level “raiseload” behavior</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#loading-arbitrary-sql-expressions-onto-objects">Loading Arbitrary SQL Expressions onto Objects</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#using-with-expression-with-unions-other-subqueries">Using <code class="docutils literal notranslate"><span class="pre">with_expression()</span></code> with UNIONs, other subqueries</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#column-loading-api">Column Loading API</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.defer"><code class="docutils literal notranslate"><span class="pre">defer()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.deferred"><code class="docutils literal notranslate"><span class="pre">deferred()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.query_expression"><code class="docutils literal notranslate"><span class="pre">query_expression()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.load_only"><code class="docutils literal notranslate"><span class="pre">load_only()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.undefer"><code class="docutils literal notranslate"><span class="pre">undefer()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.undefer_group"><code class="docutils literal notranslate"><span class="pre">undefer_group()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.with_expression"><code class="docutils literal notranslate"><span class="pre">with_expression()</span></code></a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="relationships.html">Relationship Loading Techniques</a></span></li>
<li><span class="link-container"><a class="reference external" href="api.html">ORM API Features for Querying</a></span></li>
<li><span class="link-container"><a class="reference external" href="query.html">Legacy Query API</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="../session.html">Using the Session</a></span></li>
<li><span class="link-container"><a class="reference external" href="../extending.html">Events and Internals</a></span></li>
<li><span class="link-container"><a class="reference external" href="../extensions/index.html">ORM Extensions</a></span></li>
<li><span class="link-container"><a class="reference external" href="../examples.html">ORM Examples</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>
                <li><b>Previous:</b>
                <a href="dml.html" title="previous chapter">ORM-Enabled INSERT, UPDATE, and DELETE statements</a></li>
                <li><b>Next:</b>
                <a href="relationships.html" title="next chapter">Relationship Loading Techniques</a></li>

            <li><b>Up:</b> <a href="../../index.html">Home</a></li>
                    <ul><li><a href="../index.html" title="SQLAlchemy ORM">SQLAlchemy ORM</a></li>
                    <ul><li><a href="index.html" title="ORM Querying Guide">ORM Querying Guide</a></li>
                </ul>
                </ul>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#column-loading-options">Column Loading Options</a><ul>
<li><a class="reference internal" href="#limiting-which-columns-load-with-column-deferral">Limiting which Columns Load with Column Deferral</a><ul>
<li><a class="reference internal" href="#using-load-only-to-reduce-loaded-columns">Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> to reduce loaded columns</a><ul>
<li><a class="reference internal" href="#using-load-only-with-multiple-entities">Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> with multiple entities</a></li>
<li><a class="reference internal" href="#using-load-only-on-related-objects-and-collections">Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> on related objects and collections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-defer-to-omit-specific-columns">Using <code class="docutils literal notranslate"><span class="pre">defer()</span></code> to omit specific columns</a></li>
<li><a class="reference internal" href="#using-raiseload-to-prevent-deferred-column-loads">Using raiseload to prevent deferred column loads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-column-deferral-on-mappings">Configuring Column Deferral on Mappings</a><ul>
<li><a class="reference internal" href="#using-deferred-for-imperative-mappers-mapped-sql-expressions">Using <code class="docutils literal notranslate"><span class="pre">deferred()</span></code> for imperative mappers, mapped SQL expressions</a></li>
<li><a class="reference internal" href="#using-undefer-to-eagerly-load-deferred-columns">Using <code class="docutils literal notranslate"><span class="pre">undefer()</span></code> to “eagerly” load deferred columns</a></li>
<li><a class="reference internal" href="#loading-deferred-columns-in-groups">Loading deferred columns in groups</a></li>
<li><a class="reference internal" href="#undeferring-by-group-with-undefer-group">Undeferring by group with <code class="docutils literal notranslate"><span class="pre">undefer_group()</span></code></a></li>
<li><a class="reference internal" href="#undeferring-on-wildcards">Undeferring on wildcards</a></li>
<li><a class="reference internal" href="#configuring-mapper-level-raiseload-behavior">Configuring mapper-level “raiseload” behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#loading-arbitrary-sql-expressions-onto-objects">Loading Arbitrary SQL Expressions onto Objects</a><ul>
<li><a class="reference internal" href="#using-with-expression-with-unions-other-subqueries">Using <code class="docutils literal notranslate"><span class="pre">with_expression()</span></code> with UNIONs, other subqueries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#column-loading-api">Column Loading API</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.defer"><code class="docutils literal notranslate"><span class="pre">defer()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.deferred"><code class="docutils literal notranslate"><span class="pre">deferred()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.query_expression"><code class="docutils literal notranslate"><span class="pre">query_expression()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.load_only"><code class="docutils literal notranslate"><span class="pre">load_only()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.undefer"><code class="docutils literal notranslate"><span class="pre">undefer()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.undefer_group"><code class="docutils literal notranslate"><span class="pre">undefer_group()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.with_expression"><code class="docutils literal notranslate"><span class="pre">with_expression()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar orm-queryguide-columns" >
        
<aside class="topic">
<p class="topic-title">ORM Querying Guide</p>
<p>This page is part of the <a class="reference internal" href="index.html"><span class="doc">ORM Querying Guide</span></a>.</p>
<p>Previous: <a class="reference internal" href="dml.html"><span class="doc">ORM-Enabled INSERT, UPDATE, and DELETE statements</span></a>   |   Next: <a class="reference internal" href="relationships.html"><span class="doc">Relationship Loading Techniques</span></a></p>
</aside>
<section id="column-loading-options">
<span id="loading-columns"></span><h1>Column Loading Options<a class="headerlink" href="#column-loading-options" title="Link to this heading">¶</a></h1>
<div class="admonition-about-this-document admonition">
<p class="admonition-title">About this Document</p>
<p>This section presents additional options regarding the loading of
columns.  The mappings used include columns that would store
large string values for which we may want to limit when they
are loaded.</p>
<p><a class="reference internal" href="_deferred_setup.html"><span class="doc">View the ORM setup for this page</span></a>.  Some
of the examples below will redefine the <code class="docutils literal notranslate"><span class="pre">Book</span></code> mapper to modify
some of the column definitions.</p>
</div>
<section id="limiting-which-columns-load-with-column-deferral">
<span id="orm-queryguide-column-deferral"></span><h2>Limiting which Columns Load with Column Deferral<a class="headerlink" href="#limiting-which-columns-load-with-column-deferral" title="Link to this heading">¶</a></h2>
<p><strong>Column deferral</strong> refers to ORM mapped columns that are omitted from a SELECT
statement when objects of that type are queried. The general rationale here is
performance, in cases where tables have seldom-used columns with potentially
large data values, as fully loading these columns on every query may be
time and/or memory intensive. SQLAlchemy ORM offers a variety of ways to
control the loading of columns when entities are loaded.</p>
<p>Most examples in this section are illustrating <strong>ORM loader options</strong>. These
are small constructs that are passed to the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.options" title="sqlalchemy.sql.expression.Select.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.options()</span></code></a> method
of the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> object, which are then consumed by the ORM
when the object is compiled into a SQL string.</p>
<section id="using-load-only-to-reduce-loaded-columns">
<span id="orm-queryguide-load-only"></span><h3>Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> to reduce loaded columns<a class="headerlink" href="#using-load-only-to-reduce-loaded-columns" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> loader option is the most expedient option to use
when loading objects where it is known that only a small handful of columns will
be accessed. This option accepts a variable number of class-bound attribute
objects indicating those column-mapped attributes that should be loaded, where
all other column-mapped attributes outside of the primary key will not be part
of the columns fetched . In the example below, the <code class="docutils literal notranslate"><span class="pre">Book</span></code> class contains
columns <code class="docutils literal notranslate"><span class="pre">.title</span></code>, <code class="docutils literal notranslate"><span class="pre">.summary</span></code> and <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code>. Using
<a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> we can instruct the ORM to only load the
<code class="docutils literal notranslate"><span class="pre">.title</span></code> and <code class="docutils literal notranslate"><span class="pre">.summary</span></code> columns up front:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">load_only</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">Book</span><span class="o">.</span><span class="n">summary</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">books</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
<span class="go">...     print(f&quot;{book.title}  {book.summary}&quot;)</span>
<span class="go">100 Years of Krabby Patties  some long summary</span>
<span class="go">Sea Catch 22  another long summary</span>
<span class="go">The Sea Grapes of Wrath  yet another summary</span>
<span class="go">A Nut Like No Other  some long summary</span>
<span class="go">Geodesic Domes: A Retrospective  another long summary</span>
<span class="go">Rocketry for Squirrels  yet another summary</span></pre></div>
</div>
<p>Above, the SELECT statement has omitted the <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> column and
included only <code class="docutils literal notranslate"><span class="pre">.title</span></code> and <code class="docutils literal notranslate"><span class="pre">.summary</span></code>, as well as the primary key column
<code class="docutils literal notranslate"><span class="pre">.id</span></code>; the ORM will typically always fetch the primary key columns as these
are required to establish the identity for the row.</p>
<p>Once loaded, the object will normally have <a class="reference internal" href="../../glossary.html#term-lazy-loading"><span class="xref std std-term">lazy loading</span></a> behavior
applied to the remaining unloaded attributes, meaning that when any are first
accessed, a SQL statement will be emitted within the current transaction in
order to load the value.  Below, accessing <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> emits a SELECT
statement to load its value:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cover_photo</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>Lazy loads are always emitted using the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> to which the
object is in the <a class="reference internal" href="../../glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a> state.  If the object is <a class="reference internal" href="../../glossary.html#term-detached"><span class="xref std std-term">detached</span></a>
from any <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>, the operation fails, raising an exception.</p>
<p>As an alternative to lazy loading on access, deferred columns may also be
configured to raise an informative exception when accessed, regardless of their
attachment state.  When using the <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> construct, this
may be indicated using the <a class="reference internal" href="#sqlalchemy.orm.load_only.params.raiseload" title="sqlalchemy.orm.load_only"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">load_only.raiseload</span></code></a> parameter.
See the section <a class="reference internal" href="#orm-queryguide-deferred-raiseload"><span class="std std-ref">Using raiseload to prevent deferred column loads</span></a> for
background and examples.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>as noted elsewhere, lazy loading is not available when using
<a class="reference internal" href="../extensions/asyncio.html"><span class="std std-ref">Asynchronous I/O (asyncio)</span></a>.</p>
</div>
<section id="using-load-only-with-multiple-entities">
<h4>Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> with multiple entities<a class="headerlink" href="#using-load-only-with-multiple-entities" title="Link to this heading">¶</a></h4>
<p><a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> limits itself to the single entity that is referred
towards in its list of attributes (passing a list of attributes that span more
than a single entity is currently disallowed). In the example below, the given
<a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> option applies only to the <code class="docutils literal notranslate"><span class="pre">Book</span></code> entity. The <code class="docutils literal notranslate"><span class="pre">User</span></code>
entity that’s also selected is not affected; within the resulting SELECT
statement, all columns for <code class="docutils literal notranslate"><span class="pre">user_account</span></code> are present, whereas only
<code class="docutils literal notranslate"><span class="pre">book.id</span></code> and <code class="docutils literal notranslate"><span class="pre">book.title</span></code> are present for the <code class="docutils literal notranslate"><span class="pre">book</span></code> table:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span>
<span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
</div></pre></div>
</div>
<p>If we wanted to apply <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> options to both <code class="docutils literal notranslate"><span class="pre">User</span></code> and
<code class="docutils literal notranslate"><span class="pre">Book</span></code>, we would make use of two separate options:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User, Book)</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .options(load_only(User.name), load_only(Book.title))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
</div></pre></div>
</div>
</section>
<section id="using-load-only-on-related-objects-and-collections">
<span id="orm-queryguide-load-only-related"></span><h4>Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> on related objects and collections<a class="headerlink" href="#using-load-only-on-related-objects-and-collections" title="Link to this heading">¶</a></h4>
<p>When using <a class="reference internal" href="relationships.html"><span class="std std-ref">relationship loaders</span></a> to control the
loading of related objects, the
<a class="reference internal" href="relationships.html#sqlalchemy.orm.Load.load_only" title="sqlalchemy.orm.Load.load_only"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.load_only()</span></code></a> method of any relationship loader may be used
to apply <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> rules to columns on the sub-entity.  In the example below,
<a class="reference internal" href="relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> is used to load the related <code class="docutils literal notranslate"><span class="pre">books</span></code> collection
on each <code class="docutils literal notranslate"><span class="pre">User</span></code> object.   By applying <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load.load_only" title="sqlalchemy.orm.Load.load_only"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.load_only()</span></code></a> to the resulting
option object, when objects are loaded for the relationship, the
SELECT emitted will only refer to the <code class="docutils literal notranslate"><span class="pre">title</span></code> column
in addition to primary key column:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">selectinload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">books</span><span class="p">)</span><span class="o">.</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;{user.fullname}   {[b.title for b in user.books]}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</div><span class="go">Spongebob Squarepants   [&#39;100 Years of Krabby Patties&#39;, &#39;Sea Catch 22&#39;, &#39;The Sea Grapes of Wrath&#39;]</span>
<span class="go">Sandy Cheeks   [&#39;A Nut Like No Other&#39;, &#39;Geodesic Domes: A Retrospective&#39;, &#39;Rocketry for Squirrels&#39;]</span></pre></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> may also be applied to sub-entities without needing
to state the style of loading to use for the relationship itself.  If we didn’t
want to change the default loading style of <code class="docutils literal notranslate"><span class="pre">User.books</span></code> but still apply
load only rules to <code class="docutils literal notranslate"><span class="pre">Book</span></code>, we would link using the <a class="reference internal" href="relationships.html#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a>
option, which in this case will retain the default relationship loading
style of <code class="docutils literal notranslate"><span class="pre">&quot;lazy&quot;</span></code>, and applying our custom <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> rule to
the SELECT statement emitted for each <code class="docutils literal notranslate"><span class="pre">User.books</span></code> collection:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">defaultload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defaultload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">books</span><span class="p">)</span><span class="o">.</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;{user.fullname}   {[b.title for b in user.books]}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</div><span class="go">Spongebob Squarepants   [&#39;100 Years of Krabby Patties&#39;, &#39;Sea Catch 22&#39;, &#39;The Sea Grapes of Wrath&#39;]</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="go">Sandy Cheeks   [&#39;A Nut Like No Other&#39;, &#39;Geodesic Domes: A Retrospective&#39;, &#39;Rocketry for Squirrels&#39;]</span></pre></div>
</div>
</section>
</section>
<section id="using-defer-to-omit-specific-columns">
<span id="orm-queryguide-defer"></span><h3>Using <code class="docutils literal notranslate"><span class="pre">defer()</span></code> to omit specific columns<a class="headerlink" href="#using-defer-to-omit-specific-columns" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> loader option is a more fine grained alternative to
<a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a>, which allows a single specific column to be marked as
“dont load”.  In the example below, <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> is applied directly to the
<code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> column, leaving the behavior of all other columns
unchanged:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">defer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">owner_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defer</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">cover_photo</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">books</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
<span class="go">...     print(f&quot;{book.title}: {book.summary}&quot;)</span>
<span class="go">A Nut Like No Other: some long summary</span>
<span class="go">Geodesic Domes: A Retrospective: another long summary</span>
<span class="go">Rocketry for Squirrels: yet another summary</span></pre></div>
</div>
<p>As is the case with <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a>, unloaded columns by default
will load themselves when accessed using <a class="reference internal" href="../../glossary.html#term-lazy-loading"><span class="xref std std-term">lazy loading</span></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cover_photo</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>Multiple <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> options may be used in one statement in order to
mark several columns as deferred.</p>
<p>As is the case with <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a>, the <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> option
also includes the ability to have a deferred attribute raise an exception on
access rather than lazy loading.  This is illustrated in the section
<a class="reference internal" href="#orm-queryguide-deferred-raiseload"><span class="std std-ref">Using raiseload to prevent deferred column loads</span></a>.</p>
</section>
<section id="using-raiseload-to-prevent-deferred-column-loads">
<span id="orm-queryguide-deferred-raiseload"></span><h3>Using raiseload to prevent deferred column loads<a class="headerlink" href="#using-raiseload-to-prevent-deferred-column-loads" title="Link to this heading">¶</a></h3>
<p>When using the <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> or <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> loader options,
attributes marked as deferred on an object have the default behavior that when
first accessed, a SELECT statement will be emitted within the current
transaction in order to load their value. It is often necessary to prevent this
load from occurring, and instead raise an exception when the attribute is
accessed, indicating that the need to query the database for this column was
not expected. A typical scenario is an operation where objects are loaded with
all the columns that are known to be required for the operation to proceed,
which are then passed onto a view layer. Any further SQL operations that emit
within the view layer should be caught, so that the up-front loading operation
can be adjusted to accommodate for that additional data up front, rather than
incurring additional lazy loading.</p>
<p>For this use case the <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> options
include a boolean parameter <a class="reference internal" href="#sqlalchemy.orm.defer.params.raiseload" title="sqlalchemy.orm.defer"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">defer.raiseload</span></code></a>, which when set to
<code class="docutils literal notranslate"><span class="pre">True</span></code> will cause the affected attributes to raise on access.  In the
example below, the deferred column <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> will disallow attribute
access:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book).options(defer(Book.cover_photo, raiseload=True)).where(Book.id == 4)</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: &#39;Book.cover_photo&#39; is not available due to raiseload=True</span></pre></div>
</div>
<p>When using <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> to name a specific set of non-deferred
columns, <code class="docutils literal notranslate"><span class="pre">raiseload</span></code> behavior may be applied to the remaining columns
using the <a class="reference internal" href="#sqlalchemy.orm.load_only.params.raiseload" title="sqlalchemy.orm.load_only"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">load_only.raiseload</span></code></a> parameter, which will be applied
to all deferred attributes:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">expunge_all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book).options(load_only(Book.title, raiseload=True)).where(Book.id == 5)</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: &#39;Book.summary&#39; is not available due to raiseload=True</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not yet possible to mix <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a>
options which refer to the same entity together in one statement in order
to change the <code class="docutils literal notranslate"><span class="pre">raiseload</span></code> behavior of certain attributes; currently,
doing so will produce undefined loading behavior of attributes.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.defer.params.raiseload" title="sqlalchemy.orm.defer"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">defer.raiseload</span></code></a> feature is the column-level version
of the same “raiseload” feature that’s available for relationships.
For “raiseload” with relationships, see
<a class="reference internal" href="relationships.html#prevent-lazy-with-raiseload"><span class="std std-ref">Preventing unwanted lazy loads using raiseload</span></a> in the
<a class="reference internal" href="relationships.html"><span class="std std-ref">Relationship Loading Techniques</span></a> section of this guide.</p>
</div>
</section>
</section>
<section id="configuring-column-deferral-on-mappings">
<span id="orm-queryguide-deferred-declarative"></span><h2>Configuring Column Deferral on Mappings<a class="headerlink" href="#configuring-column-deferral-on-mappings" title="Link to this heading">¶</a></h2>
<p>The functionality of <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> is available as a default behavior for
mapped columns, as may be appropriate for columns that should not be loaded
unconditionally on every query. To configure, use the
<a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred</span></code></a> parameter of
<a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>. The example below illustrates a mapping for
<code class="docutils literal notranslate"><span class="pre">Book</span></code> which applies default column deferral to the <code class="docutils literal notranslate"><span class="pre">summary</span></code> and
<code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> columns:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;book&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     owner_id: Mapped[int] = mapped_column(ForeignKey(&quot;user_account.id&quot;))</span>
<span class="go">...     title: Mapped[str]</span>
<span class="go">...     summary: Mapped[str] = mapped_column(Text, deferred=True)</span>
<span class="go">...     cover_photo: Mapped[bytes] = mapped_column(LargeBinary, deferred=True)</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;Book(id={self.id!r}, title={self.title!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Using the above mapping, queries against <code class="docutils literal notranslate"><span class="pre">Book</span></code> will automatically not
include the <code class="docutils literal notranslate"><span class="pre">summary</span></code> and <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> columns:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>As is the case with all deferral, the default behavior when deferred attributes
on the loaded object are first accessed is that they will <a class="reference internal" href="../../glossary.html#term-lazy-load"><span class="xref std std-term">lazy load</span></a>
their value:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>As is the case with the <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a>
loader options, mapper level deferral also includes an option for <code class="docutils literal notranslate"><span class="pre">raiseload</span></code>
behavior to occur, rather than lazy loading, when no other options are
present in a statement.  This allows a mapping where certain columns
will not load by default and will also never load lazily without explicit
directives used in a statement.   See the section
<a class="reference internal" href="#orm-queryguide-mapper-deferred-raiseload"><span class="std std-ref">Configuring mapper-level “raiseload” behavior</span></a> for background on how to
configure and use this behavior.</p>
<section id="using-deferred-for-imperative-mappers-mapped-sql-expressions">
<span id="orm-queryguide-deferred-imperative"></span><h3>Using <code class="docutils literal notranslate"><span class="pre">deferred()</span></code> for imperative mappers, mapped SQL expressions<a class="headerlink" href="#using-deferred-for-imperative-mappers-mapped-sql-expressions" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> function is the earlier, more general purpose
“deferred column” mapping directive that precedes the introduction of the
<a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct in SQLAlchemy.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> is used when configuring ORM mappers, and accepts
arbitrary SQL expressions or
<a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects. As such it’s suitable to be used with
non-declarative <a class="reference internal" href="../mapping_styles.html#orm-imperative-mapping"><span class="std std-ref">imperative mappings</span></a>, passing it
to the <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.registry.map_imperatively.params.properties" title="sqlalchemy.orm.registry.map_imperatively"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">map_imperatively.properties</span></code></a> dictionary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Blob</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Text</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">registry</span>

<span class="n">mapper_registry</span> <span class="o">=</span> <span class="n">registry</span><span class="p">()</span>

<span class="n">book_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;book&quot;</span><span class="p">,</span>
    <span class="n">mapper_registry</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">Text</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;cover_image&quot;</span><span class="p">,</span> <span class="n">Blob</span><span class="p">),</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Book</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="n">mapper_registry</span><span class="o">.</span><span class="n">map_imperatively</span><span class="p">(</span>
    <span class="n">Book</span><span class="p">,</span>
    <span class="n">book_table</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">deferred</span><span class="p">(</span><span class="n">book_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="s2">&quot;cover_image&quot;</span><span class="p">:</span> <span class="n">deferred</span><span class="p">(</span><span class="n">book_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cover_image</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> may also be used in place of <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>
when mapped SQL expressions should be loaded on a deferred basis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">deferred</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">firstname</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span>
    <span class="n">lastname</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span>
    <span class="n">fullname</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">deferred</span><span class="p">(</span><span class="n">firstname</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">lastname</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../mapped_sql_expr.html#mapper-column-property-sql-expressions"><span class="std std-ref">Using column_property</span></a> - in the section
<a class="reference internal" href="../mapped_sql_expr.html#mapper-sql-expressions"><span class="std std-ref">SQL Expressions as Mapped Attributes</span></a></p>
<p><a class="reference internal" href="../declarative_tables.html#orm-imperative-table-column-options"><span class="std std-ref">Applying Load, Persistence and Mapping Options for Imperative Table Columns</span></a> - in the section
<a class="reference internal" href="../declarative_tables.html"><span class="std std-ref">Table Configuration with Declarative</span></a></p>
</div>
</section>
<section id="using-undefer-to-eagerly-load-deferred-columns">
<h3>Using <code class="docutils literal notranslate"><span class="pre">undefer()</span></code> to “eagerly” load deferred columns<a class="headerlink" href="#using-undefer-to-eagerly-load-deferred-columns" title="Link to this heading">¶</a></h3>
<p>With columns configured on mappings to defer by default, the
<a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> option will cause any column that is normally deferred
to be undeferred, that is, to load up front with all the other columns
of the mapping.   For example we may apply <a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> to the
<code class="docutils literal notranslate"><span class="pre">Book.summary</span></code> column, which is indicated in the previous mapping
as deferred:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">undefer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">undefer</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">summary</span><span class="p">)))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Book.summary</span></code> column was now eagerly loaded, and may be accessed without
additional SQL being emitted:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
<span class="go">another long summary</span></pre></div>
</div>
</section>
<section id="loading-deferred-columns-in-groups">
<span id="orm-queryguide-deferred-group"></span><h3>Loading deferred columns in groups<a class="headerlink" href="#loading-deferred-columns-in-groups" title="Link to this heading">¶</a></h3>
<p>Normally when a column is mapped with <code class="docutils literal notranslate"><span class="pre">mapped_column(deferred=True)</span></code>, when
the deferred attribute is accessed on an object, SQL will be emitted to load
only that specific column and no others, even if the mapping has other columns
that are also marked as deferred. In the common case that the deferred
attribute is part of a group of attributes that should all load at once, rather
than emitting SQL for each attribute individually, the
<a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred_group" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred_group</span></code></a> parameter may be used, which
accepts an arbitrary string which will define a common group of columns to be
undeferred:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;book&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     owner_id: Mapped[int] = mapped_column(ForeignKey(&quot;user_account.id&quot;))</span>
<span class="go">...     title: Mapped[str]</span>
<span class="go">...     summary: Mapped[str] = mapped_column(</span>
<span class="go">...         Text, deferred=True, deferred_group=&quot;book_attrs&quot;</span>
<span class="go">...     )</span>
<span class="go">...     cover_photo: Mapped[bytes] = mapped_column(</span>
<span class="go">...         LargeBinary, deferred=True, deferred_group=&quot;book_attrs&quot;</span>
<span class="go">...     )</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;Book(id={self.id!r}, title={self.title!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Using the above mapping, accessing either <code class="docutils literal notranslate"><span class="pre">summary</span></code> or <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code>
will load both columns at once using just one SELECT statement:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
</section>
<section id="undeferring-by-group-with-undefer-group">
<h3>Undeferring by group with <code class="docutils literal notranslate"><span class="pre">undefer_group()</span></code><a class="headerlink" href="#undeferring-by-group-with-undefer-group" title="Link to this heading">¶</a></h3>
<p>If deferred columns are configured with <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred_group" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred_group</span></code></a>
as introduced in the preceding section, the
entire group may be indicated to load eagerly using the <a class="reference internal" href="#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a>
option, passing the string name of the group to be eagerly loaded:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">undefer_group</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book).where(Book.id == 2).options(undefer_group(&quot;book_attrs&quot;))</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">summary</span></code> and <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> are available without additional loads:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">summary</span></pre></div>
</div>
</section>
<section id="undeferring-on-wildcards">
<h3>Undeferring on wildcards<a class="headerlink" href="#undeferring-on-wildcards" title="Link to this heading">¶</a></h3>
<p>Most ORM loader options accept a wildcard expression, indicated by
<code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code>, which indicates that the option should be applied to all relevant
attributes.   If a mapping has a series of deferred columns, all such
columns can be undeferred at once, without using a group name, by indicating
a wildcard:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">undefer</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
</div></pre></div>
</div>
</section>
<section id="configuring-mapper-level-raiseload-behavior">
<span id="orm-queryguide-mapper-deferred-raiseload"></span><h3>Configuring mapper-level “raiseload” behavior<a class="headerlink" href="#configuring-mapper-level-raiseload-behavior" title="Link to this heading">¶</a></h3>
<p>The “raiseload” behavior first introduced at <a class="reference internal" href="#orm-queryguide-deferred-raiseload"><span class="std std-ref">Using raiseload to prevent deferred column loads</span></a> may
also be applied as a default mapper-level behavior, using the
<a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred_raiseload" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred_raiseload</span></code></a> parameter of
<a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>.  When using this parameter, the affected columns
will raise on access in all cases unless explicitly “undeferred” using
<a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> or <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> at query time:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;book&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     owner_id: Mapped[int] = mapped_column(ForeignKey(&quot;user_account.id&quot;))</span>
<span class="go">...     title: Mapped[str]</span>
<span class="go">...     summary: Mapped[str] = mapped_column(Text, deferred=True, deferred_raiseload=True)</span>
<span class="go">...     cover_photo: Mapped[bytes] = mapped_column(</span>
<span class="go">...         LargeBinary, deferred=True, deferred_raiseload=True</span>
<span class="go">...     )</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;Book(id={self.id!r}, title={self.title!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Using the above mapping, the <code class="docutils literal notranslate"><span class="pre">.summary</span></code> and <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> columns are
by default not loadable:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: &#39;Book.summary&#39; is not available due to raiseload=True</span></pre></div>
</div>
<p>Only by overriding their behavior at query time, typically using
<a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> or <a class="reference internal" href="#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a>, or less commonly
<a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a>, may the attributes be loaded.  The example below applies
<code class="docutils literal notranslate"><span class="pre">undefer('*')</span></code> to undefer all attributes, also making use of
<a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">Populate Existing</span></a> to refresh the already-loaded object’s loader options:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book)</span>
<span class="go">...     .where(Book.id == 2)</span>
<span class="go">...     .options(undefer(&quot;*&quot;))</span>
<span class="go">...     .execution_options(populate_existing=True)</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<span class="go">&#39;another long summary&#39;</span></pre></div>
</div>
</section>
</section>
<section id="loading-arbitrary-sql-expressions-onto-objects">
<span id="orm-queryguide-with-expression"></span><h2>Loading Arbitrary SQL Expressions onto Objects<a class="headerlink" href="#loading-arbitrary-sql-expressions-onto-objects" title="Link to this heading">¶</a></h2>
<p>As discussed <a class="reference internal" href="select.html#orm-queryguide-select-columns"><span class="std std-ref">Selecting ORM Entities and Attributes</span></a> and elsewhere,
the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct may be used to load arbitrary SQL expressions
in a result set.  Such as if we wanted to issue a query that loads
<code class="docutils literal notranslate"><span class="pre">User</span></code> objects, but also includes a count of how many books
each <code class="docutils literal notranslate"><span class="pre">User</span></code> owned, we could use <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code> to add a “count”
column to a query which includes a JOIN to <code class="docutils literal notranslate"><span class="pre">Book</span></code> as well as a GROUP BY
owner id.  This will yield <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects that each contain two
entries, one for <code class="docutils literal notranslate"><span class="pre">User</span></code> and one for <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">owner_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">book_count</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;Username: {user.name}  Number of books: {book_count}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span>
<span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_1</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="go">Username: spongebob  Number of books: 3</span>
<span class="go">Username: sandy  Number of books: 3</span></pre></div>
</div>
<p>In the above example, the <code class="docutils literal notranslate"><span class="pre">User</span></code> entity and the “book count” SQL expression
are returned separately. However, a popular use case is to produce a query that
will yield <code class="docutils literal notranslate"><span class="pre">User</span></code> objects alone, which can be iterated for example using
<a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a>, where the result of the <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code>
SQL expression is applied <em>dynamically</em> to each <code class="docutils literal notranslate"><span class="pre">User</span></code> entity. The end result
would be similar to the case where an arbitrary SQL expression were mapped to
the class using <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>, except that the SQL expression
can be modified at query time. For this use case SQLAlchemy provides the
<a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> loader option, which when combined with the mapper
level <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> directive may produce this result.</p>
<p>To apply <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> to a query, the mapped class must have
pre-configured an ORM mapped attribute using the <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a>
directive; this directive will produce an attribute on the mapped
class that is suitable for receiving query-time SQL expressions.  Below
we add a new attribute <code class="docutils literal notranslate"><span class="pre">User.book_count</span></code> to <code class="docutils literal notranslate"><span class="pre">User</span></code>.  This ORM mapped attribute
is read-only and has no default value; accessing it on a loaded instance will
normally produce <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">query_expression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;user_account&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     name: Mapped[str]</span>
<span class="go">...     fullname: Mapped[Optional[str]]</span>
<span class="go">...     book_count: Mapped[int] = query_expression()</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;User(id={self.id!r}, name={self.name!r}, fullname={self.fullname!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">User.book_count</span></code> attribute configured in our mapping, we may populate
it with data from a SQL expression using the
<a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> loader option to apply a custom SQL expression
to each <code class="docutils literal notranslate"><span class="pre">User</span></code> object as it’s loaded:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">with_expression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .group_by(Book.owner_id)</span>
<span class="go">...     .options(with_expression(User.book_count, func.count(Book.id)))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;Username: {user.name}  Number of books: {user.book_count}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_1</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
<span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="go">Username: spongebob  Number of books: 3</span>
<span class="go">Username: sandy  Number of books: 3</span></pre></div>
</div>
<p>Above, we moved our <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code> expression out of the columns
argument of the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct and into the <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a>
loader option.  The ORM then considers this to be a special column load
option that’s applied dynamically to the statement.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> mapping has these caveats:</p>
<ul>
<li><p>On an object where <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> were not used to populate
the attribute, the attribute on an object instance will have the value
<code class="docutils literal notranslate"><span class="pre">None</span></code>, unless on the mapping the <a class="reference internal" href="#sqlalchemy.orm.query_expression.params.default_expr" title="sqlalchemy.orm.query_expression"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">query_expression.default_expr</span></code></a>
parameter is set to a default SQL expression.</p></li>
<li><p>The <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> value <strong>does not populate on an object that is
already loaded</strong>, unless <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">Populate Existing</span></a> is used.
The example below will <strong>not work</strong>, as the <code class="docutils literal notranslate"><span class="pre">A</span></code> object
is already loaded:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the first A</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># load the same A with an option; expression will **not** be applied</span>
<span class="c1"># to the already-loaded object</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">some_expr</span><span class="p">)))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
<p>To ensure the attribute is re-loaded on an existing object, use the
<a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">Populate Existing</span></a> execution option to ensure
all columns are re-populated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">some_expr</span><span class="p">))</span>
    <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
</li>
<li><p>The <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> SQL expression <strong>is lost when the object is
expired</strong>.  Once the object is expired, either via <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expire" title="sqlalchemy.orm.Session.expire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code></a>
or via the expire_on_commit behavior of <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.commit" title="sqlalchemy.orm.Session.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code></a>, the SQL
expression and its value is no longer associated with the attribute and will
return <code class="docutils literal notranslate"><span class="pre">None</span></code> on subsequent access.</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a>, as an object loading option, only takes effect
on the <strong>outermost part
of a query</strong> and only for a query against a full entity, and not for arbitrary
column selects, within subqueries, or the elements of a compound
statement such as a UNION.  See the next
section <a class="reference internal" href="#orm-queryguide-with-expression-unions"><span class="std std-ref">Using with_expression() with UNIONs, other subqueries</span></a> for an example.</p></li>
<li><p>The mapped attribute <strong>cannot</strong> be applied to other parts of the
query, such as the WHERE clause, the ORDER BY clause, and make use of the
ad-hoc expression; that is, this won’t work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># can&#39;t refer to A.expr elsewhere in the query</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">A.expr</span></code> expression will resolve to NULL in the above WHERE clause
and ORDER BY clause. To use the expression throughout the query, assign to a
variable and use that:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># assign desired expression up front, then refer to that in</span>
<span class="c1"># the query</span>
<span class="n">a_expr</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">y</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">a_expr</span><span class="p">))</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">a_expr</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">a_expr</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> option is a special option used to
apply SQL expressions to mapped classes dynamically at query time.
For ordinary fixed SQL expressions configured on mappers,
see the section <a class="reference internal" href="../mapped_sql_expr.html#mapper-sql-expressions"><span class="std std-ref">SQL Expressions as Mapped Attributes</span></a>.</p>
</div>
<section id="using-with-expression-with-unions-other-subqueries">
<span id="orm-queryguide-with-expression-unions"></span><h3>Using <code class="docutils literal notranslate"><span class="pre">with_expression()</span></code> with UNIONs, other subqueries<a class="headerlink" href="#using-with-expression-with-unions-other-subqueries" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> construct is an ORM loader option, and as
such may only be applied to the outermost level of a SELECT statement which
is to load a particular ORM entity.   It does not have any effect if used
inside of a <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> that will then be used as a subquery or
as an element within a compound statement such as a UNION.</p>
<p>In order to use arbitrary SQL expressions in subqueries, normal Core-style
means of adding expressions should be used. To assemble a subquery-derived
expression onto the ORM entity’s <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> attributes,
<a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> is used at the top layer of ORM object loading,
referencing the SQL expression within the subquery.</p>
<p>In the example below, two <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> constructs are used against
the ORM entity <code class="docutils literal notranslate"><span class="pre">A</span></code> with an additional SQL expression labeled in
<code class="docutils literal notranslate"><span class="pre">expr</span></code>, and combined using <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.union_all" title="sqlalchemy.sql.expression.union_all"><code class="xref py py-func docutils literal notranslate"><span class="pre">union_all()</span></code></a>.  Then, at the topmost
layer, the <code class="docutils literal notranslate"><span class="pre">A</span></code> entity is SELECTed from this UNION, using the
querying technique described at <a class="reference internal" href="select.html#orm-queryguide-unions"><span class="std std-ref">Selecting Entities from UNIONs and other set operations</span></a>, adding an
option with <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> to extract this SQL expression
onto newly loaded instances of <code class="docutils literal notranslate"><span class="pre">A</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">union_all</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User, func.count(Book.id).label(&quot;book_count&quot;))</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .where(User.name == &quot;spongebob&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User, func.count(Book.id).label(&quot;book_count&quot;))</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .where(User.name == &quot;sandy&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">union_stmt</span> <span class="o">=</span> <span class="n">union_all</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orm_stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .from_statement(union_stmt)</span>
<span class="go">...     .options(with_expression(User.book_count, union_stmt.selected_columns.book_count))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">orm_stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;Username: {user.name}  Number of books: {user.book_count}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sandy&#39;</span><span class="p">)</span>
</div><span class="go">Username: spongebob  Number of books: 3</span>
<span class="go">Username: sandy  Number of books: 3</span></pre></div>
</div>
</section>
</section>
<section id="column-loading-api">
<h2>Column Loading API<a class="headerlink" href="#column-loading-api" title="Link to this heading">¶</a></h2>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.defer"><span class="sig-name descname">defer</span></a>(key, *addl_attrs, [raiseload])</p></td>
<td><p>Indicate that the given column-oriented attribute should be
deferred, e.g. not loaded until accessed.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.deferred"><span class="sig-name descname">deferred</span></a>(column, *additional_columns, [group, raiseload, comparator_factory, init, repr, default, default_factory, compare, kw_only, active_history, expire_on_flush, info, doc])</p></td>
<td><p>Indicate a column-based mapped attribute that by default will
not load unless accessed.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.load_only"><span class="sig-name descname">load_only</span></a>(*attrs, [raiseload])</p></td>
<td><p>Indicate that for a particular entity, only the given list
of column-based attribute names should be loaded; all others will be
deferred.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.query_expression"><span class="sig-name descname">query_expression</span></a>([default_expr], *, [repr, compare, expire_on_flush, info, doc])</p></td>
<td><p>Indicate an attribute that populates from a query-time SQL expression.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.undefer"><span class="sig-name descname">undefer</span></a>(key, *addl_attrs)</p></td>
<td><p>Indicate that the given column-oriented attribute should be
undeferred, e.g. specified within the SELECT statement of the entity
as a whole.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.undefer_group"><span class="sig-name descname">undefer_group</span></a>(name)</p></td>
<td><p>Indicate that columns within the given deferred group name should be
undeferred.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.with_expression"><span class="sig-name descname">with_expression</span></a>(key, expression)</p></td>
<td><p>Apply an ad-hoc SQL expression to a “deferred expression”
attribute.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.defer">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">defer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">addl_attrs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raiseload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.defer" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given column-oriented attribute should be
deferred, e.g. not loaded until accessed.</p>
<p>This function is part of the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>e.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">from sqlalchemy.orm import defer</span>

<span class="go">session.query(MyClass).options(</span>
<span class="go">    defer(MyClass.attribute_one),</span>
<span class="go">    defer(MyClass.attribute_two)</span>
<span class="go">)</span></pre></div>
</div>
<p>To specify a deferred load of an attribute on a related class,
the path can be specified one token at a time, specifying the loading
style for each link along the chain.  To leave the loading style
for a link unchanged, use <a class="reference internal" href="relationships.html#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">session.query(MyClass).options(</span>
<span class="go">    defaultload(MyClass.someattr).defer(RelatedClass.some_column)</span>
<span class="go">)</span></pre></div>
</div>
<p>Multiple deferral options related to a relationship can be bundled
at once using <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load.options" title="sqlalchemy.orm.Load.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.options()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">select(MyClass).options(</span>
<span class="go">    defaultload(MyClass.someattr).options(</span>
<span class="go">        defer(RelatedClass.some_column),</span>
<span class="go">        defer(RelatedClass.some_other_column),</span>
<span class="go">        defer(RelatedClass.another_column)</span>
<span class="go">    )</span>
<span class="go">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.defer.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.defer.params.key">¶</a> – Attribute to be deferred.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.defer.params.raiseload"></span><strong>raiseload</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.defer.params.raiseload">¶</a> – raise <a class="reference internal" href="../../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> rather than
lazy loading a value when the deferred attribute is accessed. Used
to prevent unwanted SQL from being emitted.</p></li>
</ul>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#orm-queryguide-column-deferral"><span class="std std-ref">Limiting which Columns Load with Column Deferral</span></a> - in the
<a class="reference internal" href="index.html"><span class="std std-ref">ORM Querying Guide</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.deferred">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">deferred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ORMColumnExprArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">additional_columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ORMColumnExprArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raiseload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">comparator_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator" title="sqlalchemy.orm.PropComparator"><span class="pre">PropComparator</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compare</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kw_only</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">active_history</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expire_on_flush</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">info</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_InfoType</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../internals.html#sqlalchemy.orm.MappedSQLExpression" title="sqlalchemy.orm.MappedSQLExpression"><span class="pre">MappedSQLExpression</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.deferred" title="Link to this definition">¶</a></dt>
<dd><p>Indicate a column-based mapped attribute that by default will
not load unless accessed.</p>
<p>When using <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>, the same functionality as
that of <a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> construct is provided by using the
<a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred</span></code></a> parameter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.deferred.params.*columns"></span><strong>*columns</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.deferred.params.*columns">¶</a> – columns to be mapped.  This is typically a single
<a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object,
however a collection is supported in order
to support multiple columns mapped under the same attribute.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.deferred.params.raiseload"></span><strong>raiseload</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.deferred.params.raiseload">¶</a> – <p>boolean, if True, indicates an exception should be raised
if the load operation is to take place.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<p>Additional arguments are the same as that of <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#orm-queryguide-deferred-imperative"><span class="std std-ref">Using deferred() for imperative mappers, mapped SQL expressions</span></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.query_expression">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">query_expression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">default_expr:</span> <span class="pre">_ORMColumnExprArgument[_T]</span> <span class="pre">=</span> <span class="pre">&lt;sqlalchemy.sql.elements.Null</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repr:</span> <span class="pre">Union[_NoArg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bool]</span> <span class="pre">=</span> <span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compare:</span> <span class="pre">Union[_NoArg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bool]</span> <span class="pre">=</span> <span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expire_on_flush:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">info:</span> <span class="pre">Optional[_InfoType]</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doc:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../internals.html#sqlalchemy.orm.MappedSQLExpression" title="sqlalchemy.orm.MappedSQLExpression"><span class="pre">MappedSQLExpression</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.query_expression" title="Link to this definition">¶</a></dt>
<dd><p>Indicate an attribute that populates from a query-time SQL expression.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.query_expression.params.default_expr"></span><strong>default_expr</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.query_expression.params.default_expr">¶</a> – Optional SQL expression object that will be used in
all cases if not assigned later with <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a>.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.2.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#orm-queryguide-with-expression"><span class="std std-ref">Loading Arbitrary SQL Expressions onto Objects</span></a> - background and usage examples</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.load_only">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">load_only</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">attrs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raiseload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.load_only" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that for a particular entity, only the given list
of column-based attribute names should be loaded; all others will be
deferred.</p>
<p>This function is part of the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>Example - given a class <code class="docutils literal notranslate"><span class="pre">User</span></code>, load only the <code class="docutils literal notranslate"><span class="pre">name</span></code> and
<code class="docutils literal notranslate"><span class="pre">fullname</span></code> attributes:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">session.query(User).options(load_only(User.name, User.fullname))</span></pre></div>
</div>
<p>Example - given a relationship <code class="docutils literal notranslate"><span class="pre">User.addresses</span> <span class="pre">-&gt;</span> <span class="pre">Address</span></code>, specify
subquery loading for the <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> collection, but on each
<code class="docutils literal notranslate"><span class="pre">Address</span></code> object load only the <code class="docutils literal notranslate"><span class="pre">email_address</span></code> attribute:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">session.query(User).options(</span>
<span class="go">    subqueryload(User.addresses).load_only(Address.email_address)</span>
<span class="go">)</span></pre></div>
</div>
<p>For a statement that has multiple entities,
the lead entity can be
specifically referred to using the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> constructor:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">stmt = (</span>
<span class="go">    select(User, Address)</span>
<span class="go">    .join(User.addresses)</span>
<span class="go">    .options(</span>
<span class="go">        Load(User).load_only(User.name, User.fullname),</span>
<span class="go">        Load(Address).load_only(Address.email_address),</span>
<span class="go">    )</span>
<span class="go">)</span></pre></div>
</div>
<p>When used together with the
<a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">populate_existing</span></a>
execution option only the attributes listed will be refreshed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.load_only.params.*attrs"></span><strong>*attrs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.load_only.params.*attrs">¶</a> – Attributes to be loaded, all others will be deferred.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.load_only.params.raiseload"></span><strong>raiseload</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.load_only.params.raiseload">¶</a> – <p>raise <a class="reference internal" href="../../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> rather than
lazy loading a value when a deferred attribute is accessed. Used
to prevent unwanted SQL from being emitted.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#orm-queryguide-column-deferral"><span class="std std-ref">Limiting which Columns Load with Column Deferral</span></a> - in the
<a class="reference internal" href="index.html"><span class="std std-ref">ORM Querying Guide</span></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.load_only.params.*attrs"></span><strong>*attrs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.load_only.params.*attrs">¶</a> – Attributes to be loaded, all others will be deferred.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.load_only.params.raiseload"></span><strong>raiseload</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.load_only.params.raiseload">¶</a> – <p>raise <a class="reference internal" href="../../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> rather than
lazy loading a value when a deferred attribute is accessed. Used
to prevent unwanted SQL from being emitted.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.undefer">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">undefer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">addl_attrs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.undefer" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given column-oriented attribute should be
undeferred, e.g. specified within the SELECT statement of the entity
as a whole.</p>
<p>The column being undeferred is typically set up on the mapping as a
<a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> attribute.</p>
<p>This function is part of the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>Examples:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go"># undefer two columns</span>
<span class="go">session.query(MyClass).options(</span>
<span class="go">    undefer(MyClass.col1), undefer(MyClass.col2)</span>
<span class="go">)</span>

<span class="go"># undefer all columns specific to a single class using Load + *</span>
<span class="go">session.query(MyClass, MyOtherClass).options(</span>
<span class="go">    Load(MyClass).undefer(&quot;*&quot;)</span>
<span class="go">)</span>

<span class="go"># undefer a column on a related object</span>
<span class="go">select(MyClass).options(</span>
<span class="go">    defaultload(MyClass.items).undefer(MyClass.text)</span>
<span class="go">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.undefer.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.undefer.params.key">¶</a> – Attribute to be undeferred.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#orm-queryguide-column-deferral"><span class="std std-ref">Limiting which Columns Load with Column Deferral</span></a> - in the
<a class="reference internal" href="index.html"><span class="std std-ref">ORM Querying Guide</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.undefer_group">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">undefer_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.undefer_group" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that columns within the given deferred group name should be
undeferred.</p>
<p>The columns being undeferred are set up on the mapping as
<a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> attributes and include a “group” name.</p>
<p>E.g:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">session.query(MyClass).options(undefer_group(&quot;large_attrs&quot;))</span></pre></div>
</div>
<p>To undefer a group of attributes on a related entity, the path can be
spelled out using relationship loader options, such as
<a class="reference internal" href="relationships.html#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">select(MyClass).options(</span>
<span class="go">    defaultload(&quot;someattr&quot;).undefer_group(&quot;large_attrs&quot;)</span>
<span class="go">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#orm-queryguide-column-deferral"><span class="std std-ref">Limiting which Columns Load with Column Deferral</span></a> - in the
<a class="reference internal" href="index.html"><span class="std std-ref">ORM Querying Guide</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.with_expression">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">with_expression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_AttrType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expression</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ColumnExpressionArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.with_expression" title="Link to this definition">¶</a></dt>
<dd><p>Apply an ad-hoc SQL expression to a “deferred expression”
attribute.</p>
<p>This option is used in conjunction with the
<a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> mapper-level construct that indicates an
attribute which should be the target of an ad-hoc SQL expression.</p>
<p>E.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">stmt = select(SomeClass).options(</span>
<span class="go">    with_expression(SomeClass.x_y_expr, SomeClass.x + SomeClass.y)</span>
<span class="go">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.2.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.with_expression.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_expression.params.key">¶</a> – Attribute to be populated</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_expression.params.expr"></span><strong>expr</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_expression.params.expr">¶</a> – SQL expression to be applied to the attribute.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#orm-queryguide-with-expression"><span class="std std-ref">Loading Arbitrary SQL Expressions onto Objects</span></a> - background and usage
examples</p>
</div>
</dd></dl>

</section>
</section>
<aside class="topic">
<p class="topic-title">ORM Querying Guide</p>
<p>Next Query Guide Section: <a class="reference internal" href="relationships.html"><span class="doc">Relationship Loading Techniques</span></a></p>
</aside>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="dml.html" title="previous chapter">ORM-Enabled INSERT, UPDATE, and DELETE statements</a>
        Next:
        <a href="relationships.html" title="next chapter">Relationship Loading Techniques</a>

    <div id="docs-copyright">
        &copy; <a href="../../copyright.html">Copyright</a> 2007-2024, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.2.6.

    Documentation last generated: Mon Aug  5 19:31:00 2024 JST

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      document.documentElement.dataset.content_root = '../../';

    </script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../../_static/init.js"></script>


    </body>
</html>


