<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    2.0 Changelog
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="../index.html" />
        <link rel="up" title="Changes and Migration" href="index.html" />
        <link rel="next" title="1.4 Changelog" href="changelog_14.html" />
        <link rel="prev" title="What’s New in SQLAlchemy 2.0?" href="whatsnew_20.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.31</span>


        | Release Date: June 18, 2024

    </div>

    <h1><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="Changes and Migration">Changes and Migration</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></span></li>
<li><span class="link-container"><a class="reference external" href="whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></span></li>
<li class="selected"><span class="link-container"><strong>2.0 Changelog</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32">2.0.32</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-general">general</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-examples">examples</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-mypy">mypy</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-sqlite">sqlite</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.32-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.31">2.0.31</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.31-general">general</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.31-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.31-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.31-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.31-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.31-mysql">mysql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.30">2.0.30</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.30-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.30-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.30-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.30-misc">misc</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.29">2.0.29</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.29-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.29-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.29-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.29-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.29-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.29-tests">tests</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.28">2.0.28</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.28-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.28-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.28-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.28-tests">tests</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.27">2.0.27</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.27-postgresql">postgresql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.26">2.0.26</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.26-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.26-examples">examples</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.26-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.26-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.26-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.26-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.26-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.26-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.25">2.0.25</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.25-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.25-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.25-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.25-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.25-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24">2.0.24</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.24-tests">tests</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.23">2.0.23</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.23-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.23-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.23-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.23-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.23-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.23-mariadb">mariadb</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.23-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.23-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.22">2.0.22</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.22-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.22-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.22-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.22-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.22-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.22-mariadb">mariadb</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.22-mssql">mssql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.21">2.0.21</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.21-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.21-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.21-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.21-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.21-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.21-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.21-misc">misc</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.20">2.0.20</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.20-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.20-examples">examples</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.20-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.20-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.20-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.20-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.20-mysql">mysql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.19">2.0.19</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.19-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.19-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.19-postgresql">postgresql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.18">2.0.18</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.18-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.18-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.18-extensions">extensions</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.18-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.18-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.18-mariadb">mariadb</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.18-mssql">mssql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.17">2.0.17</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.17-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.17-orm-declarative">orm declarative</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.17-extensions">extensions</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.17-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.17-postgresql">postgresql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.16">2.0.16</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.16-platform">platform</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.16-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.16-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.16-postgresql">postgresql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.15">2.0.15</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.15-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.15-postgresql">postgresql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.14">2.0.14</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.14-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.14-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.14-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.14-tests">tests</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.13">2.0.13</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.13-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.13-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.13-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.13-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.13-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.13-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.13-oracle">oracle</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.13-misc">misc</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.12">2.0.12</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.12-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.12-mysql">mysql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.11">2.0.11</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.11-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.11-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.11-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.11-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.11-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.11-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.11-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.10">2.0.10</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.10-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.10-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.10-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.10-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.10-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.10-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.9">2.0.9</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.9-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.9-mariadb">mariadb</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.9-mssql">mssql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.8">2.0.8</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.8-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.8-examples">examples</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.8-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.8-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.8-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.8-misc">misc</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.7">2.0.7</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.7-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.7-postgresql">postgresql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.6">2.0.6</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.6-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.6-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.6-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.6-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1">2.0.5.post1</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-orm-declarative">orm declarative</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-sqlite">sqlite</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.5.post1-misc">misc</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.4">2.0.4</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.4-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.4-orm-declarative">orm declarative</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.4-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.4-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.4-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.3">2.0.3</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.3-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.3-typing">typing</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.2">2.0.2</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.2-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.2-orm-declarative">orm declarative</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.2-examples">examples</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.2-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.2-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.2-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.2-sqlite">sqlite</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.1">2.0.1</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.1-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.1-orm-declarative">orm declarative</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.1-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.1-typing">typing</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0">2.0.0</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0-orm-extensions">orm extensions</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0-mssql">mssql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc3">2.0.0rc3</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc3-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc3-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc3-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc3-mypy">mypy</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc3-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc3-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc2">2.0.0rc2</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc2-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc2-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc2-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc2-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc2-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1">2.0.0rc1</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-general">general</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-sqlite">sqlite</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-oracle">oracle</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0rc1-tests">tests</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4">2.0.0b4</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4-orm-extensions">orm extensions</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4-oracle">oracle</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b4-tests">tests</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b3">2.0.0b3</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b3-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b3-orm-declarative">orm declarative</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b3-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b3-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b3-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b3-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b3-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b3-oracle">oracle</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2">2.0.0b2</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-orm-declarative">orm declarative</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-mssql">mssql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1">2.0.0b1</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-general">general</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-platform">platform</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-mariadb">mariadb</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-sqlite">sqlite</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-oracle">oracle</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-misc">misc</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="changelog_14.html">1.4 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_13.html">1.3 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_12.html">1.2 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_11.html">1.1 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_10.html">1.0 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_09.html">0.9 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_08.html">0.8 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_07.html">0.7 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_06.html">0.6 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_05.html">0.5 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_04.html">0.4 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_03.html">0.3 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_02.html">0.2 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_01.html">0.1 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_14.html">What’s New in SQLAlchemy 1.4?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_13.html">What’s New in SQLAlchemy 1.3?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_12.html">What’s New in SQLAlchemy 1.2?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_11.html">What’s New in SQLAlchemy 1.1?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_10.html">What’s New in SQLAlchemy 1.0?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_09.html">What’s New in SQLAlchemy 0.9?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_08.html">What’s New in SQLAlchemy 0.8?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_07.html">What’s New in SQLAlchemy 0.7?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_06.html">What’s New in SQLAlchemy 0.6?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html">What’s new in SQLAlchemy 0.5?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_04.html">What’s new in SQLAlchemy 0.4?</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>
                <li><b>Previous:</b>
                <a href="whatsnew_20.html" title="previous chapter">What’s New in SQLAlchemy 2.0?</a></li>
                <li><b>Next:</b>
                <a href="changelog_14.html" title="next chapter">1.4 Changelog</a></li>

            <li><b>Up:</b> <a href="../index.html">Home</a></li>
                    <ul><li><a href="index.html" title="Changes and Migration">Changes and Migration</a></li>
                </ul>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#changelog">2.0 Changelog</a><ul>
<li><a class="reference internal" href="#change-2.0.32">2.0.32</a><ul>
<li><a class="reference internal" href="#change-2.0.32-general">general</a></li>
<li><a class="reference internal" href="#change-2.0.32-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.32-examples">examples</a></li>
<li><a class="reference internal" href="#change-2.0.32-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.32-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.32-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.0.32-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.32-mypy">mypy</a></li>
<li><a class="reference internal" href="#change-2.0.32-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.32-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.32-sqlite">sqlite</a></li>
<li><a class="reference internal" href="#change-2.0.32-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.32-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.31">2.0.31</a><ul>
<li><a class="reference internal" href="#change-2.0.31-general">general</a></li>
<li><a class="reference internal" href="#change-2.0.31-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.31-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.31-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.31-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.0.31-mysql">mysql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.30">2.0.30</a><ul>
<li><a class="reference internal" href="#change-2.0.30-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.30-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.30-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.30-misc">misc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.29">2.0.29</a><ul>
<li><a class="reference internal" href="#change-2.0.29-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.29-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.29-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.29-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.29-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.29-tests">tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.28">2.0.28</a><ul>
<li><a class="reference internal" href="#change-2.0.28-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.28-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.28-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.28-tests">tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.27">2.0.27</a><ul>
<li><a class="reference internal" href="#change-2.0.27-postgresql">postgresql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.26">2.0.26</a><ul>
<li><a class="reference internal" href="#change-2.0.26-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.26-examples">examples</a></li>
<li><a class="reference internal" href="#change-2.0.26-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.26-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.26-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.26-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.26-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.26-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.25">2.0.25</a><ul>
<li><a class="reference internal" href="#change-2.0.25-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.25-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.25-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.25-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.25-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.24">2.0.24</a><ul>
<li><a class="reference internal" href="#change-2.0.24-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.24-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.24-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.24-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.0.24-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.24-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.24-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.24-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.24-tests">tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.23">2.0.23</a><ul>
<li><a class="reference internal" href="#change-2.0.23-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.23-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.23-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.23-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.23-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.23-mariadb">mariadb</a></li>
<li><a class="reference internal" href="#change-2.0.23-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.23-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.22">2.0.22</a><ul>
<li><a class="reference internal" href="#change-2.0.22-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.22-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.22-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.22-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.22-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.22-mariadb">mariadb</a></li>
<li><a class="reference internal" href="#change-2.0.22-mssql">mssql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.21">2.0.21</a><ul>
<li><a class="reference internal" href="#change-2.0.21-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.21-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.21-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.21-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.0.21-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.21-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.21-misc">misc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.20">2.0.20</a><ul>
<li><a class="reference internal" href="#change-2.0.20-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.20-examples">examples</a></li>
<li><a class="reference internal" href="#change-2.0.20-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.20-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.20-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.20-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.20-mysql">mysql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.19">2.0.19</a><ul>
<li><a class="reference internal" href="#change-2.0.19-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.19-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.19-postgresql">postgresql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.18">2.0.18</a><ul>
<li><a class="reference internal" href="#change-2.0.18-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.18-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.18-extensions">extensions</a></li>
<li><a class="reference internal" href="#change-2.0.18-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.18-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.18-mariadb">mariadb</a></li>
<li><a class="reference internal" href="#change-2.0.18-mssql">mssql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.17">2.0.17</a><ul>
<li><a class="reference internal" href="#change-2.0.17-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.17-orm-declarative">orm declarative</a></li>
<li><a class="reference internal" href="#change-2.0.17-extensions">extensions</a></li>
<li><a class="reference internal" href="#change-2.0.17-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.17-postgresql">postgresql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.16">2.0.16</a><ul>
<li><a class="reference internal" href="#change-2.0.16-platform">platform</a></li>
<li><a class="reference internal" href="#change-2.0.16-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.16-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.16-postgresql">postgresql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.15">2.0.15</a><ul>
<li><a class="reference internal" href="#change-2.0.15-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.15-postgresql">postgresql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.14">2.0.14</a><ul>
<li><a class="reference internal" href="#change-2.0.14-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.14-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.14-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.14-tests">tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.13">2.0.13</a><ul>
<li><a class="reference internal" href="#change-2.0.13-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.13-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.13-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.0.13-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.13-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.13-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.13-oracle">oracle</a></li>
<li><a class="reference internal" href="#change-2.0.13-misc">misc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.12">2.0.12</a><ul>
<li><a class="reference internal" href="#change-2.0.12-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.12-mysql">mysql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.11">2.0.11</a><ul>
<li><a class="reference internal" href="#change-2.0.11-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.11-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.11-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.11-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.11-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.11-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.11-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.10">2.0.10</a><ul>
<li><a class="reference internal" href="#change-2.0.10-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.10-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.10-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.10-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.10-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.10-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.9">2.0.9</a><ul>
<li><a class="reference internal" href="#change-2.0.9-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.9-mariadb">mariadb</a></li>
<li><a class="reference internal" href="#change-2.0.9-mssql">mssql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.8">2.0.8</a><ul>
<li><a class="reference internal" href="#change-2.0.8-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.8-examples">examples</a></li>
<li><a class="reference internal" href="#change-2.0.8-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.8-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.8-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.8-misc">misc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.7">2.0.7</a><ul>
<li><a class="reference internal" href="#change-2.0.7-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.7-postgresql">postgresql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.6">2.0.6</a><ul>
<li><a class="reference internal" href="#change-2.0.6-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.6-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.6-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.6-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.5.post1">2.0.5.post1</a><ul>
<li><a class="reference internal" href="#change-2.0.5.post1-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-orm-declarative">orm declarative</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-sqlite">sqlite</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.5.post1-misc">misc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.4">2.0.4</a><ul>
<li><a class="reference internal" href="#change-2.0.4-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.4-orm-declarative">orm declarative</a></li>
<li><a class="reference internal" href="#change-2.0.4-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.4-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.4-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.3">2.0.3</a><ul>
<li><a class="reference internal" href="#change-2.0.3-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.3-typing">typing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.2">2.0.2</a><ul>
<li><a class="reference internal" href="#change-2.0.2-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.2-orm-declarative">orm declarative</a></li>
<li><a class="reference internal" href="#change-2.0.2-examples">examples</a></li>
<li><a class="reference internal" href="#change-2.0.2-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.2-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.2-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.2-sqlite">sqlite</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.1">2.0.1</a><ul>
<li><a class="reference internal" href="#change-2.0.1-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.1-orm-declarative">orm declarative</a></li>
<li><a class="reference internal" href="#change-2.0.1-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.1-typing">typing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.0">2.0.0</a><ul>
<li><a class="reference internal" href="#change-2.0.0-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0-orm-extensions">orm extensions</a></li>
<li><a class="reference internal" href="#change-2.0.0-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.0-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.0-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.0-mssql">mssql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.0rc3">2.0.0rc3</a><ul>
<li><a class="reference internal" href="#change-2.0.0rc3-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0rc3-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.0rc3-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0rc3-mypy">mypy</a></li>
<li><a class="reference internal" href="#change-2.0.0rc3-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.0rc3-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.0rc2">2.0.0rc2</a><ul>
<li><a class="reference internal" href="#change-2.0.0rc2-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0rc2-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0rc2-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.0rc2-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.0rc2-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.0rc1">2.0.0rc1</a><ul>
<li><a class="reference internal" href="#change-2.0.0rc1-general">general</a></li>
<li><a class="reference internal" href="#change-2.0.0rc1-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0rc1-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.0rc1-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.0rc1-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0rc1-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.0.0rc1-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.0rc1-sqlite">sqlite</a></li>
<li><a class="reference internal" href="#change-2.0.0rc1-oracle">oracle</a></li>
<li><a class="reference internal" href="#change-2.0.0rc1-tests">tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.0b4">2.0.0b4</a><ul>
<li><a class="reference internal" href="#change-2.0.0b4-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0b4-orm-extensions">orm extensions</a></li>
<li><a class="reference internal" href="#change-2.0.0b4-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.0b4-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.0.0b4-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0b4-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.0b4-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.0b4-oracle">oracle</a></li>
<li><a class="reference internal" href="#change-2.0.0b4-tests">tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.0b3">2.0.0b3</a><ul>
<li><a class="reference internal" href="#change-2.0.0b3-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0b3-orm-declarative">orm declarative</a></li>
<li><a class="reference internal" href="#change-2.0.0b3-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.0b3-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.0b3-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0b3-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.0b3-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.0b3-oracle">oracle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.0b2">2.0.0b2</a><ul>
<li><a class="reference internal" href="#change-2.0.0b2-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0b2-orm-declarative">orm declarative</a></li>
<li><a class="reference internal" href="#change-2.0.0b2-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.0b2-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0b2-mssql">mssql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.0b1">2.0.0b1</a><ul>
<li><a class="reference internal" href="#change-2.0.0b1-general">general</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-platform">platform</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-mariadb">mariadb</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-sqlite">sqlite</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-oracle">oracle</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-misc">misc</a></li>
</ul>
</li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar changelog-changelog_20" >
        
<section id="changelog">
<h1>2.0 Changelog<a class="headerlink" href="#changelog" title="Link to this heading">¶</a></h1>
<section id="change-2.0.32">
<h2 class="release-version">2.0.32<a class="headerlink" href="#change-2.0.32" title="Link to this heading">¶</a></h2>
no release date<section id="change-2.0.32-general">
<h3>general<a class="headerlink" href="#change-2.0.32-general" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-0"><span class="target" id="change-fe3e695e16fb3a4fb097432e22f09ea6"><strong>[general] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-fe3e695e16fb3a4fb097432e22f09ea6">¶</a></span><p>Restored legacy class names removed from
<code class="docutils literal notranslate"><span class="pre">sqlalalchemy.orm.collections.*</span></code>, including
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.MappedCollection" title="sqlalchemy.orm.MappedCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedCollection</span></code></a>, <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.mapped_collection" title="sqlalchemy.orm.mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_collection()</span></code></a>,
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_mapped_collection" title="sqlalchemy.orm.column_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_mapped_collection()</span></code></a>,
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_mapped_collection" title="sqlalchemy.orm.attribute_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_mapped_collection()</span></code></a>. Pull request courtesy Takashi
Kajinami.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11435">#11435</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-orm">
<h3>orm<a class="headerlink" href="#change-2.0.32-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-1"><span class="target" id="change-4ced942e306343aa5397b5bfe18874d4"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4ced942e306343aa5397b5bfe18874d4">¶</a></span><p>The <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased.params.name" title="sqlalchemy.orm.aliased"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aliased.name</span></code></a> parameter to <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> may now
be combined with the <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased.params.flat" title="sqlalchemy.orm.aliased"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aliased.flat</span></code></a> parameter, producing
per-table names based on a name-prefixed naming convention.  Pull request
courtesy Eric Atkin.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11575">#11575</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.32-2"><span class="target" id="change-7ce5bcedfa5650f64c31002c30824c0b"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7ce5bcedfa5650f64c31002c30824c0b">¶</a></span><p>Fixed regression going back to 1.4 where accessing a collection using the
“dynamic” strategy on a transient object and attempting to query would
raise an internal error rather than the expected <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.NoResultFound" title="sqlalchemy.exc.NoResultFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">NoResultFound</span></code></a>
that occurred in 1.3.</p>
<p>This change is also <strong>backported</strong> to: 1.4.53</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11562">#11562</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.32-3"><span class="target" id="change-b69b693ee92def65e550596e24507b90"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b69b693ee92def65e550596e24507b90">¶</a></span><p>Fixed regression appearing in 2.0.21 caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10279">#10279</a> where using
a <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a> or <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a> against an ORM class that is
the base of an inheritance hierarchy, while also specifying that subclasses
should be loaded polymorphically, would leak the polymorphic joins into the
UPDATE or DELETE statement as well creating incorrect SQL.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11625">#11625</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.32-4"><span class="target" id="change-1a7662f25dc7f4439720a51a6f97ea26"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1a7662f25dc7f4439720a51a6f97ea26">¶</a></span><p>Fixed issue where using the <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.enable_eagerloads" title="sqlalchemy.orm.Query.enable_eagerloads"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.enable_eagerloads()</span></code></a> and
<a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.yield_per" title="sqlalchemy.orm.Query.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.yield_per()</span></code></a> methods at the same time, in order to disable
eager loading that’s configured on the mapper directly, would be silently
ignored, leading to errors or unexpected eager population of attributes.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10834">#10834</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.32-5"><span class="target" id="change-047b2b45ce5c1f9f34a071c742d60e9b"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-047b2b45ce5c1f9f34a071c742d60e9b">¶</a></span><p>Fixed regression from version 1.4 in
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.bulk_insert_mappings" title="sqlalchemy.orm.Session.bulk_insert_mappings"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bulk_insert_mappings()</span></code></a> where using the
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.bulk_insert_mappings.params.return_defaults" title="sqlalchemy.orm.Session.bulk_insert_mappings"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.bulk_insert_mappings.return_defaults</span></code></a> parameter
would not populate the passed in dictionaries with newly generated primary
key values.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11661">#11661</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.32-6"><span class="target" id="change-57b581c55fa5986459c04022a281a65c"><strong>[orm]</strong> <a class="changelog-reference headerlink reference internal" href="#change-57b581c55fa5986459c04022a281a65c">¶</a></span><p>Added a warning noting when an
<code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.engine_connect()</span></code> event may be leaving
a transaction open, which can alter the behavior of a
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> using such an engine as bind.
On SQLAlchemy 2.1 <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.join_transaction_mode" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.join_transaction_mode</span></code></a> will
instead be ignored in all cases when the session bind is
an <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11163">#11163</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-examples">
<h3>examples<a class="headerlink" href="#change-2.0.32-examples" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-7"><span class="target" id="change-5ea3d945f1657974e5830e993af63940"><strong>[examples] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5ea3d945f1657974e5830e993af63940">¶</a></span><p>Fixed issue in history_meta example where the “version” column in the
versioned table needs to default to the most recent version number in the
history table on INSERT, to suit the use case of a table where rows are
deleted, and can then be replaced by new rows that re-use the same primary
key identity.  This fix adds an additonal SELECT query per INSERT in the
main table, which may be inefficient; for cases where primary keys are not
re-used, the default function may be omitted.  Patch courtesy  Philipp H.
v. Loewenfeld.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10267">#10267</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-engine">
<h3>engine<a class="headerlink" href="#change-2.0.32-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-8"><span class="target" id="change-29ec8968875e80d9a9db4f49585d4966"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-29ec8968875e80d9a9db4f49585d4966">¶</a></span><p>Fixed issue in “insertmanyvalues” feature where a particular call to
<code class="docutils literal notranslate"><span class="pre">cursor.fetchall()</span></code> were not wrapped in SQLAlchemy’s exception wrapper,
which apparently can raise a database exception during fetch when using
pyodbc.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11532">#11532</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-sql">
<h3>sql<a class="headerlink" href="#change-2.0.32-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-9"><span class="target" id="change-0193714c952aabeb9c52f868a08a6c2a"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0193714c952aabeb9c52f868a08a6c2a">¶</a></span><p>Follow up of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11471">#11471</a> to fix caching issue where using the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">CompoundSelectState.add_cte()</span></code> method of the
<code class="xref py py-class docutils literal notranslate"><span class="pre">CompoundSelectState</span></code> construct would not set a correct cache key
which distinguished between different CTE expressions. Also added tests
that would detect issues similar to the one fixed in <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11544">#11544</a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11471">#11471</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.32-10"><span class="target" id="change-f8d478c881100f5e71a47d471026e532"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f8d478c881100f5e71a47d471026e532">¶</a></span><p>Fixed bug where the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.nulls_first()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.nulls_last()</span></code> modifiers would not be treated the same way
as <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.desc()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.asc()</span></code> when determining
if an ORDER BY should be against a label name already in the statement. All
four modifiers are now treated the same within ORDER BY.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11592">#11592</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-schema">
<h3>schema<a class="headerlink" href="#change-2.0.32-schema" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-11"><span class="target" id="change-2d3197f29586b59fe80ae8d56d1bb196"><strong>[schema] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2d3197f29586b59fe80ae8d56d1bb196">¶</a></span><p>Fixed additional issues in the event system triggered by unpickling of a
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> datatype, continuing from <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11365">#11365</a> and
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11360">#11360</a>,  where dynamically generated elements of the event
structure would not be present when unpickling in a new process.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11530">#11530</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-typing">
<h3>typing<a class="headerlink" href="#change-2.0.32-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-12"><span class="target" id="change-e8fea2f7b73f94096a59a8f07d096aff"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e8fea2f7b73f94096a59a8f07d096aff">¶</a></span><p>Fixed internal typing issues to establish compatibility with mypy 1.11.0.
Note that this does not include issues which have arisen with the
deprecated mypy plugin used by SQLAlchemy 1.4-style code; see the addiional
change note for this plugin indicating revised compatibility.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-mypy">
<h3>mypy<a class="headerlink" href="#change-2.0.32-mypy" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-13"><span class="target" id="change-422a001a8cb4f81784647346a3b39d92"><strong>[mypy] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-422a001a8cb4f81784647346a3b39d92">¶</a></span><p>The deprecated mypy plugin is no longer fully functional with the latest
series of mypy 1.11.0, as changes in the mypy interpreter are no longer
compatible with the approach used by the plugin.  If code is dependent on
the mypy plugin with sqlalchemy2-stubs, it’s recommended to pin mypy to be
below the 1.11.0 series.    Seek upgrading to the 2.0 series of SQLAlchemy
and migrating to the modern type annotations.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/extensions/mypy.html"><span class="std std-ref">Mypy  / Pep-484 Support for ORM Mappings</span></a></p>
</div>
<p>This change is also <strong>backported</strong> to: 1.4.53</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.32-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-14"><span class="target" id="change-e267be62d99f258f75eeb3e5a1a177c9"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e267be62d99f258f75eeb3e5a1a177c9">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.collate" title="sqlalchemy.sql.expression.collate"><code class="xref py py-func docutils literal notranslate"><span class="pre">collate()</span></code></a> construct, which explicitly sets
a collation for a given expression, would maintain collation settings for
the underlying type object from the expression, causing SQL expressions to
have both collations stated at once when used in further expressions for
specific dialects that render explicit type casts, such as that of asyncpg.
The <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.collate" title="sqlalchemy.sql.expression.collate"><code class="xref py py-func docutils literal notranslate"><span class="pre">collate()</span></code></a> construct now assigns its own type to explicitly
include the new collation, assuming it’s a string type.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11576">#11576</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.32-15"><span class="target" id="change-70d857943e41dc42e57f0ac8a1afa0be"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-70d857943e41dc42e57f0ac8a1afa0be">¶</a></span><p>It is now considered a pool-invalidating disconnect event when psycopg2
throws an “SSL SYSCALL error: Success” error message, which can occur when
the SSL connection to Postgres is terminated abnormally.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11522">#11522</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.32-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-16"><span class="target" id="change-aa5a261989657a6500ba113c7b5e2307"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-aa5a261989657a6500ba113c7b5e2307">¶</a></span><p>Fixed issue in MySQL dialect where ENUM values that contained percent signs
were not properly escaped for the driver.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11479">#11479</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-sqlite">
<h3>sqlite<a class="headerlink" href="#change-2.0.32-sqlite" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-17"><span class="target" id="change-764a9c85f335dd2efa8102a4718ca21b"><strong>[sqlite] [bug] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-764a9c85f335dd2efa8102a4718ca21b">¶</a></span><p>Fixed reflection of computed column in SQLite to properly account
for complex expressions.</p>
<p>This change is also <strong>backported</strong> to: 1.4.53</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11582">#11582</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.32-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-18"><span class="target" id="change-c34275c6922a215b2b535b9b7cf571a4"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c34275c6922a215b2b535b9b7cf571a4">¶</a></span><p>Fixed issue where SQL Server drivers don’t support bound parameters when
rendering the “frame specification” for a window function, e.g. “ROWS
BETWEEN”, etc.</p>
<p>This change is also <strong>backported</strong> to: 1.4.53</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11514">#11514</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.32-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.32-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.32-19"><span class="target" id="change-60701f74e6d9e4751f642539a5baaf63"><strong>[oracle] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-60701f74e6d9e4751f642539a5baaf63">¶</a></span><p>Implemented two-phase transactions for the oracledb dialect. Historically,
this feature never worked with the cx_Oracle dialect, however recent
improvements to the oracledb successor now allow this to be possible.  The
two phase transaction API is available at the Core level via the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.begin_twophase" title="sqlalchemy.engine.Connection.begin_twophase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_twophase()</span></code></a> method.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11480">#11480</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.32-20"><span class="target" id="change-17a98bebca6a4a50f68ad72fe1c7fdfd"><strong>[oracle] [bug] [sqlite]</strong> <a class="changelog-reference headerlink reference internal" href="#change-17a98bebca6a4a50f68ad72fe1c7fdfd">¶</a></span><p>Implemented bitwise operators for Oracle which was previously
non-functional due to a non-standard syntax used by this database.
Oracle’s support for bitwise “or” and “xor” starts with server version 21.
Additionally repaired the implementation of “xor” for SQLite.</p>
<p>As part of this change, the dialect compliance test suite has been enhanced
to include support for server-side bitwise tests; third party dialect
authors should refer to new “supports_bitwise” methods in the
requirements.py file to enable these tests.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11663">#11663</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.31">
<h2 class="release-version">2.0.31<a class="headerlink" href="#change-2.0.31" title="Link to this heading">¶</a></h2>
Released: June 18, 2024<section id="change-2.0.31-general">
<h3>general<a class="headerlink" href="#change-2.0.31-general" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.31-0"><span class="target" id="change-e1c5577cb0315d68906117e78cedaef8"><strong>[general] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e1c5577cb0315d68906117e78cedaef8">¶</a></span><p>Set up full Python 3.13 support to the extent currently possible, repairing
issues within internal language helpers as well as the serializer extension
module.</p>
<p>For version 1.4, this also modernizes the “extras” names in setup.cfg
to use dashes and not underscores for two-word names.  Underscore names
are still present to accommodate potential compatibility issues.</p>
<p>This change is also <strong>backported</strong> to: 1.4.53</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11417">#11417</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.31-1"><span class="target" id="change-e1c5577cb0315d68906117e78cedaef8"><strong>[general] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e1c5577cb0315d68906117e78cedaef8">¶</a></span><p>Set up full Python 3.13 support to the extent currently possible, repairing
issues within internal language helpers as well as the serializer extension
module.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11417">#11417</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.31-orm">
<h3>orm<a class="headerlink" href="#change-2.0.31-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.31-2"><span class="target" id="change-ea06c681404dc30495f60018f306c39c"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ea06c681404dc30495f60018f306c39c">¶</a></span><p>Added missing parameter <a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.with_polymorphic.params.name" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">with_polymorphic.name</span></code></a> that
allows specifying the name of returned <code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11361">#11361</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.31-3"><span class="target" id="change-25fde295ce62eee083615c20fc4715c9"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-25fde295ce62eee083615c20fc4715c9">¶</a></span><p>Fixed issue where a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> collection would not be
serializable, if an <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> or <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Boolean" title="sqlalchemy.types.Boolean"><code class="xref py py-class docutils literal notranslate"><span class="pre">Boolean</span></code></a> datatype were
present which had been adapted. This specific scenario in turn could occur
when using the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> or <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Boolean" title="sqlalchemy.types.Boolean"><code class="xref py py-class docutils literal notranslate"><span class="pre">Boolean</span></code></a> within ORM Annotated
Declarative form where type objects frequently get copied.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11365">#11365</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.31-4"><span class="target" id="change-0ab3b6680c90af6be864b0d6d57f2748"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0ab3b6680c90af6be864b0d6d57f2748">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> and
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> loader options would fail to take effect when
made against an inherited subclass that itself included a subclass-specific
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.with_polymorphic" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.with_polymorphic</span></code></a> setting.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11446">#11446</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.31-5"><span class="target" id="change-8b98cae34609d28118e8033775e3b7d9"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8b98cae34609d28118e8033775e3b7d9">¶</a></span><p>Fixed very old issue involving the <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.joinedload.params.innerjoin" title="sqlalchemy.orm.joinedload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">joinedload.innerjoin</span></code></a>
parameter where making use of this parameter mixed into a query that also
included joined eager loads along a self-referential or other cyclical
relationship, along with complicating factors like inner joins added for
secondary tables and such, would have the chance of splicing a particular
inner join to the wrong part of the query.  Additional state has been added
to the internal method that does this splice to make a better decision as
to where splicing should proceed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11449">#11449</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.31-6"><span class="target" id="change-0090410b3adf3b02864528f0255144f7"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0090410b3adf3b02864528f0255144f7">¶</a></span><p>Fixed bug in ORM Declarative where the <code class="docutils literal notranslate"><span class="pre">__table__</span></code> directive could not be
declared as a class function with <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr" title="sqlalchemy.orm.declared_attr"><code class="xref py py-func docutils literal notranslate"><span class="pre">declared_attr()</span></code></a> on a
superclass, including an <code class="docutils literal notranslate"><span class="pre">__abstract__</span></code> class as well as coming from the
declarative base itself.  This was a regression since 1.4 where this was
working, and there were apparently no tests for this particular use case.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11509">#11509</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.31-engine">
<h3>engine<a class="headerlink" href="#change-2.0.31-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.31-7"><span class="target" id="change-6eb1ab724576e2f4ce2398928671c44a"><strong>[engine] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6eb1ab724576e2f4ce2398928671c44a">¶</a></span><p>Modified the internal representation used for adapting asyncio calls to
greenlets to allow for duck-typed compatibility with third party libraries
that implement SQLAlchemy’s “greenlet-to-asyncio” pattern directly.
Running code within a greenlet that features the attribute
<code class="docutils literal notranslate"><span class="pre">__sqlalchemy_greenlet_provider__</span> <span class="pre">=</span> <span class="pre">True</span></code> will allow calls to
<code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.util.await_only()</span></code> directly.</p>
<p>This change is also <strong>backported</strong> to: 1.4.53</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.31-sql">
<h3>sql<a class="headerlink" href="#change-2.0.31-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.31-8"><span class="target" id="change-4db4e7ddb0b761f6681c7a921ccf3bfd"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4db4e7ddb0b761f6681c7a921ccf3bfd">¶</a></span><p>Fixed caching issue where using the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TextualSelect.add_cte" title="sqlalchemy.sql.expression.TextualSelect.add_cte"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TextualSelect.add_cte()</span></code></a> method
of the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TextualSelect" title="sqlalchemy.sql.expression.TextualSelect"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextualSelect</span></code></a> construct would not set a correct cache key
which distinguished between different CTE expressions.</p>
<p>This change is also <strong>backported</strong> to: 1.4.53</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11471">#11471</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.31-9"><span class="target" id="change-56df104da2183a0365711ef9deda2b77"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-56df104da2183a0365711ef9deda2b77">¶</a></span><p>Fixed issue when serializing an <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.over" title="sqlalchemy.sql.expression.over"><code class="xref py py-func docutils literal notranslate"><span class="pre">over()</span></code></a> clause with
unbounded range or rows.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11422">#11422</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.31-10"><span class="target" id="change-61315c0d954b475b048d1ce848eabb2d"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-61315c0d954b475b048d1ce848eabb2d">¶</a></span><p>Added missing methods <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.FunctionFilter.within_group" title="sqlalchemy.sql.expression.FunctionFilter.within_group"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionFilter.within_group()</span></code></a>
and <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.WithinGroup.filter" title="sqlalchemy.sql.expression.WithinGroup.filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WithinGroup.filter()</span></code></a></p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11423">#11423</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.31-11"><span class="target" id="change-8cc7eea8a05278831084a99033a0369c"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8cc7eea8a05278831084a99033a0369c">¶</a></span><p>Fixed bug in <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.FunctionFilter.filter" title="sqlalchemy.sql.expression.FunctionFilter.filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionFilter.filter()</span></code></a> that would mutate
the existing function in-place. It now behaves like the rest of the
SQLAlchemy API, returning a new instance instead of mutating the
original one.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11426">#11426</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.31-schema">
<h3>schema<a class="headerlink" href="#change-2.0.31-schema" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.31-12"><span class="target" id="change-79c7d056efcfbe3bd13095537549b7ed"><strong>[schema] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-79c7d056efcfbe3bd13095537549b7ed">¶</a></span><p>Added <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.insert_default" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.insert_default</span></code></a> as an alias of
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.default" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.default</span></code></a> for compatibility with
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11374">#11374</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.31-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.31-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.31-13"><span class="target" id="change-ab648de44965c5350c400beaa9ac6433"><strong>[mysql] [usecase] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ab648de44965c5350c400beaa9ac6433">¶</a></span><p>Added missing foreign key reflection option <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">DEFAULT</span></code>
in the MySQL and MariaDB dialects.
Pull request courtesy of Quentin Roche.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11285">#11285</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.30">
<h2 class="release-version">2.0.30<a class="headerlink" href="#change-2.0.30" title="Link to this heading">¶</a></h2>
Released: May 5, 2024<section id="change-2.0.30-orm">
<h3>orm<a class="headerlink" href="#change-2.0.30-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.30-0"><span class="target" id="change-cc0d1900555895ecbede2f420ad10ee5"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-cc0d1900555895ecbede2f420ad10ee5">¶</a></span><p>Added new attribute <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.is_from_statement" title="sqlalchemy.orm.ORMExecuteState.is_from_statement"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.is_from_statement</span></code></a> to
detect statements created using <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.from_statement" title="sqlalchemy.sql.expression.Select.from_statement"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.from_statement()</span></code></a>, and
enhanced <code class="docutils literal notranslate"><span class="pre">FromStatement</span></code> to set <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.is_select" title="sqlalchemy.orm.ORMExecuteState.is_select"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.is_select</span></code></a>,
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.is_insert" title="sqlalchemy.orm.ORMExecuteState.is_insert"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.is_insert</span></code></a>,
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.is_update" title="sqlalchemy.orm.ORMExecuteState.is_update"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.is_update</span></code></a>, and
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.is_delete" title="sqlalchemy.orm.ORMExecuteState.is_delete"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.is_delete</span></code></a> according to the element that is
sent to the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.from_statement" title="sqlalchemy.sql.expression.Select.from_statement"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.from_statement()</span></code></a> method itself.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11220">#11220</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.30-1"><span class="target" id="change-62310e3400b953a0b8979a5d54c75a7e"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-62310e3400b953a0b8979a5d54c75a7e">¶</a></span><p>Fixed issue in  <a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> loader option where
attributes defined with <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-func docutils literal notranslate"><span class="pre">composite()</span></code></a> on a superclass would cause
an internal exception on load.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11291">#11291</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.30-2"><span class="target" id="change-2673a5e46e1dd84f3f96b5d572ade65e"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2673a5e46e1dd84f3f96b5d572ade65e">¶</a></span><p>Fixed regression from 1.4 where using <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a> in
conjunction with a non-propagating loader like <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a>
would nonetheless propagate the <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> to a lazy load
operation, causing incorrect queries as this option is only intended to
come from an original load.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11292">#11292</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.30-3"><span class="target" id="change-c989eee5e5272b0f869b2a91da69555d"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c989eee5e5272b0f869b2a91da69555d">¶</a></span><p>Fixed issue in ORM Annotated Declarative where typing issue where literals
defined using <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0695/"><strong>PEP 695</strong></a> type aliases would not work with inference of
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> datatypes. Pull request courtesy of Alc-Alc.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11305">#11305</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.30-4"><span class="target" id="change-baa7245067ca9e9771f3e97030530e9c"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-baa7245067ca9e9771f3e97030530e9c">¶</a></span><p>Fixed issue in <a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> loader option where the
SELECT emitted would only accommodate for the child-most class among the
result rows that were returned, leading intermediary-class attributes to be
unloaded if there were no concrete instances of that intermediary-class
present in the result.   This issue only presented itself for multi-level
inheritance hierarchies.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11327">#11327</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.30-5"><span class="target" id="change-4ec579a309a3410a0558a6112d4e95b5"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4ec579a309a3410a0558a6112d4e95b5">¶</a></span><p>Fixed issue in <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.bulk_save_objects" title="sqlalchemy.orm.Session.bulk_save_objects"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bulk_save_objects()</span></code></a> where the form of the
identity key produced when using <code class="docutils literal notranslate"><span class="pre">return_defaults=True</span></code> would be
incorrect. This could lead to an errors during pickling as well as identity
map mismatches.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11332">#11332</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.30-6"><span class="target" id="change-4e8a37cb1d73821f844ed50b6fb00a67"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4e8a37cb1d73821f844ed50b6fb00a67">¶</a></span><p>Fixed issue where attribute key names in <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a> would not be
correct when using ORM enabled <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-class docutils literal notranslate"><span class="pre">select</span></code></a> vs.
<a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>, when the statement contained duplicate column names.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11347">#11347</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.30-engine">
<h3>engine<a class="headerlink" href="#change-2.0.30-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.30-7"><span class="target" id="change-371c19b65f8fd416f7adf5c7e00da2c0"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-371c19b65f8fd416f7adf5c7e00da2c0">¶</a></span><p>Fixed issue in the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.logging_token" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.logging_token</span></code></a> option,
where changing the value of <code class="docutils literal notranslate"><span class="pre">logging_token</span></code> on a connection that has
already logged messages would not be updated to reflect the new logging
token.  This in particular prevented the use of
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.connection" title="sqlalchemy.orm.Session.connection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.connection()</span></code></a> to change the option on the connection,
since the BEGIN logging message would already have been emitted.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11210">#11210</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.30-8"><span class="target" id="change-bbf85e32ea74a48ee25b2d2ba676865b"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bbf85e32ea74a48ee25b2d2ba676865b">¶</a></span><p>Fixed issue in cursor handling which affected handling of duplicate
<code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code> or similar objcts in the columns clause of
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>, both in combination with arbitary <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a>
clauses in the SELECT list, as well as when attempting to retrieve
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.mappings" title="sqlalchemy.engine.Result.mappings"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.mappings()</span></code></a> for the object, which would lead to an
internal error.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11306">#11306</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.30-typing">
<h3>typing<a class="headerlink" href="#change-2.0.30-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.30-9"><span class="target" id="change-82ae91ba3dfc07a8dd2b4f9719547cdf"><strong>[typing] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-82ae91ba3dfc07a8dd2b4f9719547cdf">¶</a></span><p>Fixed typing regression caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11055">#11055</a> in version 2.0.29 that
added <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> to the asyncio <code class="docutils literal notranslate"><span class="pre">run_sync()</span></code> methods, where using
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncConnection.run_sync" title="sqlalchemy.ext.asyncio.AsyncConnection.run_sync"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AsyncConnection.run_sync()</span></code></a> with
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.reflect" title="sqlalchemy.schema.MetaData.reflect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.reflect()</span></code></a> would fail on mypy due to a mypy issue.
Pull request courtesy of Francisco R. Del Roio.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11200">#11200</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.30-10"><span class="target" id="change-0be9bb7bbed51e4275628265dd2bd0b4"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0be9bb7bbed51e4275628265dd2bd0b4">¶</a></span><p>Fixed issue in typing for <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a> where creating a nested
<a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a> structure were not allowed.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.30-misc">
<h3>misc<a class="headerlink" href="#change-2.0.30-misc" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.30-11"><span class="target" id="change-360223989ccc44b4fe6de5eb10e17982"><strong>[bug] [test]</strong> <a class="changelog-reference headerlink reference internal" href="#change-360223989ccc44b4fe6de5eb10e17982">¶</a></span><p>Ensure the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> variable is properly initialized when
using <code class="docutils literal notranslate"><span class="pre">subprocess.run</span></code> in the tests.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11268">#11268</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.30-12"><span class="target" id="change-6bc22bc95406f716118332489b757f89"><strong>[bug] [installation]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6bc22bc95406f716118332489b757f89">¶</a></span><p>Fixed an internal class that was testing for unexpected attributes to work
correctly under upcoming Python 3.13.   Pull request courtesy Edgar
Ramírez-Mondragón.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11334">#11334</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.29">
<h2 class="release-version">2.0.29<a class="headerlink" href="#change-2.0.29" title="Link to this heading">¶</a></h2>
Released: March 23, 2024<section id="change-2.0.29-orm">
<h3>orm<a class="headerlink" href="#change-2.0.29-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.29-0"><span class="target" id="change-30c9414594a8202b803b619b8348bb26"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-30c9414594a8202b803b619b8348bb26">¶</a></span><p>Added support for the <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0695/"><strong>PEP 695</strong></a> <code class="docutils literal notranslate"><span class="pre">TypeAliasType</span></code> construct as well as the
python 3.12 native <code class="docutils literal notranslate"><span class="pre">type</span></code> keyword to work with ORM Annotated Declarative
form when using these constructs to link to a <span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0593/"><strong>PEP 593</strong></a> <code class="docutils literal notranslate"><span class="pre">Annotated</span></code>
container, allowing the resolution of the <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> to proceed when
these constructs are used in a <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> typing container.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11130">#11130</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.29-1"><span class="target" id="change-60fff72d6d75095eb36d191d3c4436ca"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-60fff72d6d75095eb36d191d3c4436ca">¶</a></span><p>Fixed Declarative issue where typing a relationship using
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Relationship" title="sqlalchemy.orm.Relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">Relationship</span></code></a> rather than <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> would
inadvertently pull in the “dynamic” relationship loader strategy for that
attribute.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10611">#10611</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.29-2"><span class="target" id="change-dc1459a5b4396468efa407e1a6c31820"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-dc1459a5b4396468efa407e1a6c31820">¶</a></span><p>Fixed issue in ORM annotated declarative where using
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> with an <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.index" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.index</span></code></a>
or <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.unique" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.unique</span></code></a> setting of False would be
overridden by an incoming <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> element that featured that
parameter set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, even though the immediate
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> element is more specific and should take
precedence.  The logic to reconcile the booleans has been enhanced to
accommodate a local value of <code class="docutils literal notranslate"><span class="pre">False</span></code> as still taking precedence over an
incoming <code class="docutils literal notranslate"><span class="pre">True</span></code> value from the annotated element.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11091">#11091</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.29-3"><span class="target" id="change-07210cda847ff367632a1eac3f1f00c1"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-07210cda847ff367632a1eac3f1f00c1">¶</a></span><p>Fixed regression from version 2.0.28 caused by the fix for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11085">#11085</a>
where the newer method of adjusting post-cache bound parameter values would
interefere with the implementation for the <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> loader
option, which has some more legacy patterns in use internally, when
the additional loader criteria feature were used with this loader option.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11173">#11173</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.29-engine">
<h3>engine<a class="headerlink" href="#change-2.0.29-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.29-4"><span class="target" id="change-1a3e71af360737fc910868261a2103ea"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1a3e71af360737fc910868261a2103ea">¶</a></span><p>Fixed issue in <a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">“Insert Many Values” Behavior for INSERT statements</span></a> feature where using a primary
key column with an “inline execute” default generator such as an explicit
<a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> with an explcit schema name, while at the same time
using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.schema_translate_map" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.schema_translate_map</span></code></a>
feature would fail to render the sequence or the parameters properly,
leading to errors.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11157">#11157</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.29-5"><span class="target" id="change-f92559b6d8fa1c0df693fd2475531402"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f92559b6d8fa1c0df693fd2475531402">¶</a></span><p>Made a change to the adjustment made in version 2.0.10 for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9618">#9618</a>,
which added the behavior of reconciling RETURNING rows from a bulk INSERT
to the parameters that were passed to it.  This behavior included a
comparison of already-DB-converted bound parameter values against returned
row values that was not always “symmetrical” for SQL column types such as
UUIDs, depending on specifics of how different DBAPIs receive such values
versus how they return them, necessitating the need for additional
“sentinel value resolver” methods on these column types.  Unfortunately
this broke third party column types such as UUID/GUID types in libraries
like SQLModel which did not implement this special method, raising an error
“Can’t match sentinel values in result set to parameter sets”.  Rather than
attempt to further explain and document this implementation detail of the
“insertmanyvalues” feature including a public version of the new
method, the approach is intead revised to no longer need this extra
conversion step, and the logic that does the comparison now works on the
pre-converted bound parameter value compared to the post-result-processed
value, which should always be of a matching datatype.  In the unusual case
that a custom SQL column type that also happens to be used in a “sentinel”
column for bulk INSERT is not receiving and returning the same value type,
the “Can’t match” error will be raised, however the mitigation is
straightforward in that the same Python datatype should be passed as that
returned.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11160">#11160</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.29-sql">
<h3>sql<a class="headerlink" href="#change-2.0.29-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.29-6"><span class="target" id="change-ba90b01339954fa41ac9fb247ab99d33"><strong>[sql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ba90b01339954fa41ac9fb247ab99d33">¶</a></span><p>Fixed regression from the 1.4 series where the refactor of the
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a> method introduced at
<a class="reference internal" href="whatsnew_20.html#change-6980"><span class="std std-ref">“with_variant()” clones the original TypeEngine rather than changing the type</span></a> failed to accommodate for the <code class="docutils literal notranslate"><span class="pre">.copy()</span></code> method, which
will lose the variant mappings that are set up. This becomes an issue for
the very specific case of a “schema” type, which includes types such as
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> and <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>, when they are then used in the context
of an ORM Declarative mapping with mixins where copying of types comes into
play.  The variant mapping is now copied as well.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11176">#11176</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.29-typing">
<h3>typing<a class="headerlink" href="#change-2.0.29-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.29-7"><span class="target" id="change-ad09c1e946dd6a6e35293014dded6a90"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ad09c1e946dd6a6e35293014dded6a90">¶</a></span><p>Fixed typing issue allowing asyncio <code class="docutils literal notranslate"><span class="pre">run_sync()</span></code> methods to correctly
type the parameters according to the callable that was passed, making use
of <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0612/"><strong>PEP 612</strong></a> <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> variables.  Pull request courtesy Francisco R.
Del Roio.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11055">#11055</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.29-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.29-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.29-8"><span class="target" id="change-75521417cdb86a4daa7bc37b98803a6e"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-75521417cdb86a4daa7bc37b98803a6e">¶</a></span><p>The PostgreSQL dialect now returns <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.DOMAIN" title="sqlalchemy.dialects.postgresql.DOMAIN"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOMAIN</span></code></a> instances
when reflecting a column that has a domain as type. Previously, the domain
data type was returned instead. As part of this change, the domain
reflection was improved to also return the collation of the text types.
Pull request courtesy of Thomas Stephenson.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10693">#10693</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.29-tests">
<h3>tests<a class="headerlink" href="#change-2.0.29-tests" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.29-9"><span class="target" id="change-587c75db7723fed2bcb6a2b2924b8f56"><strong>[tests] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-587c75db7723fed2bcb6a2b2924b8f56">¶</a></span><p>Backported to SQLAlchemy 2.0 an improvement to the test suite with regards
to how asyncio related tests are run, now using the newer Python 3.11
<code class="docutils literal notranslate"><span class="pre">asyncio.Runner</span></code> or a backported equivalent, rather than relying on the
previous implementation based on <code class="docutils literal notranslate"><span class="pre">asyncio.get_running_loop()</span></code>.  This
should hopefully prevent issues with large suite runs on CPU loaded
hardware where the event loop seems to become corrupted, leading to
cascading failures.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11187">#11187</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.28">
<h2 class="release-version">2.0.28<a class="headerlink" href="#change-2.0.28" title="Link to this heading">¶</a></h2>
Released: March 4, 2024<section id="change-2.0.28-orm">
<h3>orm<a class="headerlink" href="#change-2.0.28-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.28-0"><span class="target" id="change-ac3f7e555f345c82b2b07b34069c7489"><strong>[orm] [performance] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ac3f7e555f345c82b2b07b34069c7489">¶</a></span><p>Adjusted the fix made in <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10570">#10570</a>, released in 2.0.23, where new
logic was added to reconcile possibly changing bound parameter values
across cache key generations used within the <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a>
construct.  The new logic changes the approach by which the new bound
parameter values are associated with the statement, avoiding the need to
deep-copy the statement which can result in a significant performance
penalty for very deep / complex SQL constructs.  The new approach no longer
requires this deep-copy step.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11085">#11085</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.28-1"><span class="target" id="change-ca93d357e1ca5e34cc36df2518a3264f"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ca93d357e1ca5e34cc36df2518a3264f">¶</a></span><p>Fixed regression caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9779">#9779</a> where using the “secondary” table
in a relationship <code class="docutils literal notranslate"><span class="pre">and_()</span></code> expression would fail to be aliased to match
how the “secondary” table normally renders within a
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> expression, leading to an invalid query.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11010">#11010</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.28-engine">
<h3>engine<a class="headerlink" href="#change-2.0.28-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.28-2"><span class="target" id="change-b606388dd30614a5fe35a7de2b6c8c6f"><strong>[engine] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b606388dd30614a5fe35a7de2b6c8c6f">¶</a></span><p>Added new core execution option
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.preserve_rowcount" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.preserve_rowcount</span></code></a>. When
set, the <code class="docutils literal notranslate"><span class="pre">cursor.rowcount</span></code> attribute from the DBAPI cursor will be
unconditionally memoized at statement execution time, so that whatever
value the DBAPI offers for any kind of statement will be available using
the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a> attribute from the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>.  This allows the rowcount to be accessed for
statements such as INSERT and SELECT, to the degree supported by the DBAPI
in use. The <a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">“Insert Many Values” Behavior for INSERT statements</span></a> also supports this option and
will ensure <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a> is correctly set for a
bulk INSERT of rows when set.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10974">#10974</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.28-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.28-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.28-3"><span class="target" id="change-713c91bc681cc8c8126a2423d00817e9"><strong>[asyncio] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-713c91bc681cc8c8126a2423d00817e9">¶</a></span><p>An error is raised if a <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> or other non-asyncio pool class
is passed to <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a>.  This engine only
accepts asyncio-compatible pool classes including
<a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.AsyncAdaptedQueuePool" title="sqlalchemy.pool.AsyncAdaptedQueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncAdaptedQueuePool</span></code></a>. Other pool classes such as
<a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a> are compatible with both synchronous and asynchronous
engines as they do not perform any locking.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/pooling.html#pool-api"><span class="std std-ref">API Documentation - Available Pool Implementations</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8771">#8771</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.28-tests">
<h3>tests<a class="headerlink" href="#change-2.0.28-tests" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.28-4"><span class="target" id="change-bd0d51b29a41e947cf2fb2c177026783"><strong>[tests] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bd0d51b29a41e947cf2fb2c177026783">¶</a></span><p>pytest support in the tox.ini file has been updated to support pytest 8.1.</p>
<p></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.27">
<h2 class="release-version">2.0.27<a class="headerlink" href="#change-2.0.27" title="Link to this heading">¶</a></h2>
Released: February 13, 2024<section id="change-2.0.27-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.27-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.27-0"><span class="target" id="change-933408c4aeed311afcf27ef39cee1a43"><strong>[postgresql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-933408c4aeed311afcf27ef39cee1a43">¶</a></span><p>Fixed regression caused by just-released fix for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10863">#10863</a> where an
invalid exception class were added to the “except” block, which does not
get exercised unless such a catch actually happens.   A mock-style test has
been added to ensure this catch is exercised in unit tests.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11005">#11005</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.26">
<h2 class="release-version">2.0.26<a class="headerlink" href="#change-2.0.26" title="Link to this heading">¶</a></h2>
Released: February 11, 2024<section id="change-2.0.26-orm">
<h3>orm<a class="headerlink" href="#change-2.0.26-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.26-0"><span class="target" id="change-36967abe523edc7f16ac6505ebfe41b5"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-36967abe523edc7f16ac6505ebfe41b5">¶</a></span><p>Replaced the “loader depth is excessively deep” warning with a shorter
message added to the caching badge within SQL logging, for those statements
where the ORM disabled the cache due to a too-deep chain of loader options.
The condition which this warning highlights is difficult to resolve and is
generally just a limitation in the ORM’s application of SQL caching. A
future feature may include the ability to tune the threshold where caching
is disabled, but for now the warning will no longer be a nuisance.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10896">#10896</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-1"><span class="target" id="change-201284c25f2e38780dea051d55335516"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-201284c25f2e38780dea051d55335516">¶</a></span><p>Fixed issue where it was not possible to use a type (such as an enum)
within a <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> container type if that type were declared
locally within the class body.  The scope of locals used for the eval now
includes that of the class body itself.  In addition, the expression within
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> may also refer to the class name itself, if used as a
string or with future annotations mode.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10899">#10899</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-2"><span class="target" id="change-1e3765ea5bdadf1d23d8753d0598ae3a"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1e3765ea5bdadf1d23d8753d0598ae3a">¶</a></span><p>Fixed issue where using <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.delete" title="sqlalchemy.orm.Session.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.delete()</span></code></a> along with the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.version_id_col" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.version_id_col</span></code></a> feature would fail to use the
correct version identifier in the case that an additional UPDATE were
emitted against the target object as a result of the use of
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.post_update" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.post_update</span></code></a> on the object.  The issue is
similar to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10800">#10800</a> just fixed in version 2.0.25 for the case of
updates alone.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10967">#10967</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-3"><span class="target" id="change-c7c607e671ba9b1ed5a9358512cc9514"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c7c607e671ba9b1ed5a9358512cc9514">¶</a></span><p>Fixed issue where an assertion within the implementation for
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> would raise if a SQL expression that was not
cacheable were used; this was a 2.0 regression since 1.4.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10990">#10990</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.26-examples">
<h3>examples<a class="headerlink" href="#change-2.0.26-examples" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.26-4"><span class="target" id="change-941c3a01a365c731bd24f7c436c758f7"><strong>[examples] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-941c3a01a365c731bd24f7c436c758f7">¶</a></span><p>Fixed regression in history_meta example where the use of
<code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.to_metadata()</span></code> to make a copy of the history table
would also copy indexes (which is a good thing), but causing naming
conflicts indexes regardless of naming scheme used for those indexes. A
“_history” suffix is now added to these indexes in the same way as is
achieved for the table name.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10920">#10920</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-5"><span class="target" id="change-13dbd9e7bec3d4076db82bcb792761d7"><strong>[examples] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-13dbd9e7bec3d4076db82bcb792761d7">¶</a></span><p>Fixed the performance example scripts in examples/performance to mostly
work with the Oracle database, by adding the <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity" title="sqlalchemy.schema.Identity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Identity</span></code></a> construct
to all the tables and allowing primary generation to occur on this backend.
A few of the “raw DBAPI” cases still are not compatible with Oracle.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.26-sql">
<h3>sql<a class="headerlink" href="#change-2.0.26-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.26-6"><span class="target" id="change-855945129628690066553f3929848bec"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-855945129628690066553f3929848bec">¶</a></span><p>Fixed issues in <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.case" title="sqlalchemy.sql.expression.case"><code class="xref py py-func docutils literal notranslate"><span class="pre">case()</span></code></a> where the logic for determining the
type of the expression could result in <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.NullType" title="sqlalchemy.types.NullType"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullType</span></code></a> if the last
element in the “whens” had no type, or in other cases where the type
could resolve to <code class="docutils literal notranslate"><span class="pre">None</span></code>.  The logic has been updated to scan all
given expressions so that the first non-null type is used, as well as
to always ensure a type is present.  Pull request courtesy David Evans.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10843">#10843</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.26-typing">
<h3>typing<a class="headerlink" href="#change-2.0.26-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.26-7"><span class="target" id="change-c7423cc95fa3891a519a09221e6f6713"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c7423cc95fa3891a519a09221e6f6713">¶</a></span><p>Fixed the type signature for the <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.checkin" title="sqlalchemy.events.PoolEvents.checkin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.checkin()</span></code></a> event to
indicate that the given <a class="reference internal" href="../core/internals.html#sqlalchemy.engine.interfaces.DBAPIConnection" title="sqlalchemy.engine.interfaces.DBAPIConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBAPIConnection</span></code></a> argument may be <code class="docutils literal notranslate"><span class="pre">None</span></code>
in the case where the connection has been invalidated.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.26-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.26-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.26-8"><span class="target" id="change-6b0b67795117e60e3c298b1848b738b4"><strong>[postgresql] [usecase] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6b0b67795117e60e3c298b1848b738b4">¶</a></span><p>Added support for reflection of PostgreSQL CHECK constraints marked with
“NO INHERIT”, setting the key <code class="docutils literal notranslate"><span class="pre">no_inherit=True</span></code> in the reflected data.
Pull request courtesy Ellis Valentiner.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10777">#10777</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-9"><span class="target" id="change-ecb797470b0414654e90c3a462d218ce"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ecb797470b0414654e90c3a462d218ce">¶</a></span><p>Support the <code class="docutils literal notranslate"><span class="pre">USING</span> <span class="pre">&lt;method&gt;</span></code> option for PostgreSQL <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> to
specify the access method to use to store the contents for the new table.
Pull request courtesy Edgar Ramírez-Mondragón.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-table-options"><span class="std std-ref">PostgreSQL Table Options</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10904">#10904</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-10"><span class="target" id="change-ee23b26c6c19861d770380c1766d1f8e"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ee23b26c6c19861d770380c1766d1f8e">¶</a></span><p>Correctly type PostgreSQL RANGE and MULTIRANGE types as <code class="docutils literal notranslate"><span class="pre">Range[T]</span></code>
and <code class="docutils literal notranslate"><span class="pre">Sequence[Range[T]]</span></code>.
Introduced utility sequence <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> to allow better
interoperability of MULTIRANGE types.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9736">#9736</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-11"><span class="target" id="change-385b90e7d39a86fc7187c6b4debae560"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-385b90e7d39a86fc7187c6b4debae560">¶</a></span><p>Differentiate between INT4 and INT8 ranges and multi-ranges types when
inferring the database type from a <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> or
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> instance, preferring INT4 if the values
fit into it.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-12"><span class="target" id="change-ae3d6c9472c5671817d1a84917782c7f"><strong>[postgresql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ae3d6c9472c5671817d1a84917782c7f">¶</a></span><p>Fixed regression in the asyncpg dialect caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10717">#10717</a> in
release 2.0.24 where the change that now attempts to gracefully close the
asyncpg connection before terminating would not fall back to
<code class="docutils literal notranslate"><span class="pre">terminate()</span></code> for other potential connection-related exceptions other
than a timeout error, not taking into account cases where the graceful
<code class="docutils literal notranslate"><span class="pre">.close()</span></code> attempt fails for other reasons such as connection errors.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10863">#10863</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-13"><span class="target" id="change-4639ec87eaf921c2112a417fd59b027a"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4639ec87eaf921c2112a417fd59b027a">¶</a></span><p>Fixed an issue regarding the use of the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype with the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid.params.as_uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Uuid.as_uuid</span></code></a> parameter set to False, when using PostgreSQL
dialects. ORM-optimized INSERT statements (e.g. the “insertmanyvalues”
feature) would not correctly align primary key UUID values for bulk INSERT
statements, resulting in errors.  Similar issues were fixed for the
pymssql driver as well.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.26-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.26-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.26-14"><span class="target" id="change-e9b3a27905ca224e86fc63abcfea0b12"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e9b3a27905ca224e86fc63abcfea0b12">¶</a></span><p>Fixed issue where NULL/NOT NULL would not be properly reflected from a
MySQL column that also specified the VIRTUAL or STORED directives.  Pull
request courtesy Georg Wicke-Arndt.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10850">#10850</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.26-15"><span class="target" id="change-b23ae75c6c4dda23b33d32871f7698af"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b23ae75c6c4dda23b33d32871f7698af">¶</a></span><p>Fixed issue in asyncio dialects asyncmy and aiomysql, where their
<code class="docutils literal notranslate"><span class="pre">.close()</span></code> method is apparently not a graceful close.  replace with
non-standard <code class="docutils literal notranslate"><span class="pre">.ensure_closed()</span></code> method that’s awaitable and move
<code class="docutils literal notranslate"><span class="pre">.close()</span></code> to the so-called “terminate” case.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10893">#10893</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.26-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.26-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.26-16"><span class="target" id="change-5dbd76de9548d8fd535bfc268abe7f32"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5dbd76de9548d8fd535bfc268abe7f32">¶</a></span><p>Fixed an issue regarding the use of the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype with the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid.params.as_uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Uuid.as_uuid</span></code></a> parameter set to False, when using the pymssql
dialect. ORM-optimized INSERT statements (e.g. the “insertmanyvalues”
feature) would not correctly align primary key UUID values for bulk INSERT
statements, resulting in errors.  Similar issues were fixed for the
PostgreSQL drivers as well.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.26-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.26-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.26-17"><span class="target" id="change-2f52e064b693a9bdcdced00a0086ec1c"><strong>[oracle] [performance] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2f52e064b693a9bdcdced00a0086ec1c">¶</a></span><p>Changed the default arraysize of the Oracle dialects so that the value set
by the driver is used, that is 100 at the time of writing for both
cx_oracle and oracledb. Previously the value was set to 50 by default. The
setting of 50 could cause significant performance regressions compared to
when using cx_oracle/oracledb alone to fetch many hundreds of rows over
slower networks.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10877">#10877</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.25">
<h2 class="release-version">2.0.25<a class="headerlink" href="#change-2.0.25" title="Link to this heading">¶</a></h2>
Released: January 2, 2024<section id="change-2.0.25-orm">
<h3>orm<a class="headerlink" href="#change-2.0.25-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.25-0"><span class="target" id="change-4c50e13c830a2ac0a7d964dc88437110"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4c50e13c830a2ac0a7d964dc88437110">¶</a></span><p>Added preliminary support for Python 3.12 pep-695 type alias structures,
when resolving custom type maps for ORM Annotated Declarative mappings.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10807">#10807</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.25-1"><span class="target" id="change-f2451585cb644a60ceffbc1078e311e3"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f2451585cb644a60ceffbc1078e311e3">¶</a></span><p>Fixed issue where when making use of the
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.post_update" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.post_update</span></code></a> feature at the same time as using
a mapper version_id_col could lead to a situation where the second UPDATE
statement emitted by the post-update feature would fail to make use of the
correct version identifier, assuming an UPDATE was already emitted in that
flush which had already bumped the version counter.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10800">#10800</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.25-2"><span class="target" id="change-e6f5085a1923dc4f23763b24c77e6fec"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e6f5085a1923dc4f23763b24c77e6fec">¶</a></span><p>Fixed issue where ORM Annotated Declarative would mis-interpret the left
hand side of a relationship without any collection specified as
uselist=True if the left type were given as a class and not a string,
without using future-style annotations.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10815">#10815</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.25-sql">
<h3>sql<a class="headerlink" href="#change-2.0.25-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.25-3"><span class="target" id="change-d9c18d892fcc552ada9058303a9047f6"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d9c18d892fcc552ada9058303a9047f6">¶</a></span><p>Improved compilation of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.any_" title="sqlalchemy.sql.expression.any_"><code class="xref py py-func docutils literal notranslate"><span class="pre">any_()</span></code></a> / <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.all_" title="sqlalchemy.sql.expression.all_"><code class="xref py py-func docutils literal notranslate"><span class="pre">all_()</span></code></a> in the
context of a negation of boolean comparison, will now render <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">(expr)</span></code>
rather than reversing the equality operator to not equals, allowing
finer-grained control of negations for these non-typical operators.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10817">#10817</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.25-typing">
<h3>typing<a class="headerlink" href="#change-2.0.25-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.25-4"><span class="target" id="change-ae9b1e96d6f9bbe1087506e93be53b35"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ae9b1e96d6f9bbe1087506e93be53b35">¶</a></span><p>Fixed regressions caused by typing added to the <code class="docutils literal notranslate"><span class="pre">sqlalchemy.sql.functions</span></code>
module in version 2.0.24, as part of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6810">#6810</a>:</p>
<ul>
<li><p>Further enhancements to pep-484 typing to allow SQL functions from
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.func</span></code></a> derived elements to work more effectively with ORM-mapped
attributes (<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10801">#10801</a>)</p></li>
<li><p>Fixed the argument types passed to functions so that literal expressions
like strings and ints are again interpreted correctly (<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10818">#10818</a>)</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10801">#10801</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10818">#10818</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.25-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.25-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.25-5"><span class="target" id="change-2a2c674ad0084f6c434f166c22388687"><strong>[asyncio] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2a2c674ad0084f6c434f166c22388687">¶</a></span><p>Fixed critical issue in asyncio version of the connection pool where
calling <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncEngine.dispose" title="sqlalchemy.ext.asyncio.AsyncEngine.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AsyncEngine.dispose()</span></code></a> would produce a new connection
pool that did not fully re-establish the use of asyncio-compatible mutexes,
leading to the use of a plain <code class="docutils literal notranslate"><span class="pre">threading.Lock()</span></code> which would then cause
deadlocks in an asyncio context when using concurrency features like
<code class="docutils literal notranslate"><span class="pre">asyncio.gather()</span></code>.</p>
<p>This change is also <strong>backported</strong> to: 1.4.51</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10813">#10813</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.25-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.25-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.25-6"><span class="target" id="change-4a4d0b203333d1e0e1e8185b58632bcc"><strong>[oracle] [asyncio]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4a4d0b203333d1e0e1e8185b58632bcc">¶</a></span><p>Added support for <a class="reference internal" href="../dialects/oracle.html#oracledb"><span class="std std-ref">python-oracledb</span></a> in asyncio mode, using the newly released
version of the <code class="docutils literal notranslate"><span class="pre">oracledb</span></code> DBAPI that includes asyncio support. For the
2.0 series, this is a preview release, where the current implementation
does not yet have include support for
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncConnection.stream" title="sqlalchemy.ext.asyncio.AsyncConnection.stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AsyncConnection.stream()</span></code></a>. Improved support is planned for
the 2.1 release of SQLAlchemy.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10679">#10679</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.24">
<h2 class="release-version">2.0.24<a class="headerlink" href="#change-2.0.24" title="Link to this heading">¶</a></h2>
Released: December 28, 2023<section id="change-2.0.24-orm">
<h3>orm<a class="headerlink" href="#change-2.0.24-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.24-0"><span class="target" id="change-ca0578c4ba775923d95336a09f587cb8"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ca0578c4ba775923d95336a09f587cb8">¶</a></span><p>Improved a fix first implemented for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/3208">#3208</a> released in version
0.9.8, where the registry of classes used internally by declarative could
be subject to a race condition in the case where individual mapped classes
are being garbage collected at the same time while new mapped classes are
being constructed, as can happen in some test suite configurations or
dynamic class creation environments.   In addition to the weakref check
already added, the list of items being iterated is also copied first to
avoid “list changed while iterating” errors.  Pull request courtesy Yilei
Yang.</p>
<p>This change is also <strong>backported</strong> to: 1.4.51</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10782">#10782</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.24-1"><span class="target" id="change-6c7bfe85d6e00ea3547f85d8a6759e94"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6c7bfe85d6e00ea3547f85d8a6759e94">¶</a></span><p>Fixed issue where use of <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.foreign" title="sqlalchemy.orm.foreign"><code class="xref py py-func docutils literal notranslate"><span class="pre">foreign()</span></code></a> annotation on a
non-initialized <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct would produce an
expression without a type, which was then not updated at initialization
time of the actual column, leading to issues such as relationships not
determining <code class="docutils literal notranslate"><span class="pre">use_get</span></code> appropriately.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10597">#10597</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.24-2"><span class="target" id="change-506446a33cb705d50548aa33b33a4cbb"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-506446a33cb705d50548aa33b33a4cbb">¶</a></span><p>Improved the error message produced when the unit of work process sets the
value of a primary key column to NULL due to a related object with a
dependency rule on that column being deleted, to include not just the
destination object and column name but also the source column from which
the NULL value is originating.  Pull request courtesy Jan Vollmer.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10668">#10668</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.24-3"><span class="target" id="change-fd89b37d0b3eb6bb85fd795659a318fe"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-fd89b37d0b3eb6bb85fd795659a318fe">¶</a></span><p>Modified the <code class="docutils literal notranslate"><span class="pre">__init_subclass__()</span></code> method used by
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a>, <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase" title="sqlalchemy.orm.DeclarativeBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeBase</span></code></a> and
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.DeclarativeBaseNoMeta" title="sqlalchemy.orm.DeclarativeBaseNoMeta"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeBaseNoMeta</span></code></a> to accept arbitrary <code class="docutils literal notranslate"><span class="pre">**kw</span></code> and to
propagate them to the <code class="docutils literal notranslate"><span class="pre">super()</span></code> call, allowing greater flexibility in
arranging custom superclasses and mixins which make use of
<code class="docutils literal notranslate"><span class="pre">__init_subclass__()</span></code> keyword arguments.  Pull request courtesy Michael
Oliver.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10732">#10732</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.24-4"><span class="target" id="change-d70108166c01074ee4a09c329ab54a6d"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d70108166c01074ee4a09c329ab54a6d">¶</a></span><p>Ensured the use case of <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a> objects used in the
<code class="docutils literal notranslate"><span class="pre">returning()</span></code> portion of ORM-enabled INSERT, UPDATE and DELETE statements
is tested and works fully.   This was never explicitly implemented or
tested previously and did not work correctly in the 1.4 series; in the 2.0
series, ORM UPDATE/DELETE with WHERE criteria was missing an implementation
method preventing <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a> objects from working.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10776">#10776</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.24-5"><span class="target" id="change-34e17d3f51c2eaf563dedfea4bfccb16"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-34e17d3f51c2eaf563dedfea4bfccb16">¶</a></span><p>Fixed 2.0 regression in <a class="reference internal" href="../orm/extensions/mutable.html#sqlalchemy.ext.mutable.MutableList" title="sqlalchemy.ext.mutable.MutableList"><code class="xref py py-class docutils literal notranslate"><span class="pre">MutableList</span></code></a> where a routine that detects
sequences would not correctly filter out string or bytes instances, making
it impossible to assign a string value to a specific index (while
non-sequence values would work fine).</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10784">#10784</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.24-engine">
<h3>engine<a class="headerlink" href="#change-2.0.24-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.24-6"><span class="target" id="change-0787ecf036baeff0a8f6a06e9ed2d453"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0787ecf036baeff0a8f6a06e9ed2d453">¶</a></span><p>Fixed URL-encoding of the username and password components of
<a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL" title="sqlalchemy.engine.URL"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> objects when converting them to string using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL.render_as_string" title="sqlalchemy.engine.URL.render_as_string"><code class="xref py py-meth docutils literal notranslate"><span class="pre">URL.render_as_string()</span></code></a> method, by using Python standard
library <code class="docutils literal notranslate"><span class="pre">urllib.parse.quote</span></code> while allowing for plus signs and spaces to
remain unchanged as supported by SQLAlchemy’s non-standard URL parsing,
rather than the legacy home-grown routine from many years ago. Pull request
courtesy of Xavier NUNN.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10662">#10662</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.24-sql">
<h3>sql<a class="headerlink" href="#change-2.0.24-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.24-7"><span class="target" id="change-d44e042a1de8ac9300ddfe656ef67ed1"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d44e042a1de8ac9300ddfe656ef67ed1">¶</a></span><p>Fixed issue in stringify for SQL elements, where a specific dialect is not
passed,  where a dialect-specific element such as the PostgreSQL “on
conflict do update” construct is encountered and then fails to provide for
a stringify dialect with the appropriate state to render the construct,
leading to internal errors.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10753">#10753</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.24-8"><span class="target" id="change-f08563be577c75a641e7304405139bcd"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f08563be577c75a641e7304405139bcd">¶</a></span><p>Fixed issue where stringifying or compiling a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.CTE" title="sqlalchemy.sql.expression.CTE"><code class="xref py py-class docutils literal notranslate"><span class="pre">CTE</span></code></a> that was
against a DML construct such as an <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> construct would fail
to stringify, due to a mis-detection that the statement overall is an
INSERT, leading to internal errors.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.24-schema">
<h3>schema<a class="headerlink" href="#change-2.0.24-schema" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.24-9"><span class="target" id="change-02b69147c6a204ca8e705a7befd16fb5"><strong>[schema] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-02b69147c6a204ca8e705a7befd16fb5">¶</a></span><p>Fixed issue where error reporting for unexpected schema item when creating
objects like <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> would incorrectly handle an argument
that was itself passed as a tuple, leading to a formatting error.  The
error message has been modernized to use f-strings.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10654">#10654</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.24-typing">
<h3>typing<a class="headerlink" href="#change-2.0.24-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.24-10"><span class="target" id="change-89d60fe5f50a4bacf7bc77fd54299caa"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-89d60fe5f50a4bacf7bc77fd54299caa">¶</a></span><p>Completed pep-484 typing for the <code class="docutils literal notranslate"><span class="pre">sqlalchemy.sql.functions</span></code> module.
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> constructs made against <code class="docutils literal notranslate"><span class="pre">func</span></code> elements should now
have filled-in return types.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6810">#6810</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.24-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.24-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.24-11"><span class="target" id="change-fd215f812a57a9d04660c6b55e6073ee"><strong>[asyncio] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-fd215f812a57a9d04660c6b55e6073ee">¶</a></span><p>The <code class="docutils literal notranslate"><span class="pre">async_fallback</span></code> dialect argument is now deprecated, and will be
removed in SQLAlchemy 2.1.   This flag has not been used for SQLAlchemy’s
test suite for some time.   asyncio dialects can still run in a synchronous
style by running code within a greenlet using <code class="xref py py-func docutils literal notranslate"><span class="pre">greenlet_spawn()</span></code>.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.24-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.24-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.24-12"><span class="target" id="change-a341c2ea781fd173472d29c868cc0ee0"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a341c2ea781fd173472d29c868cc0ee0">¶</a></span><p>Adjusted the asyncpg dialect such that when the <code class="docutils literal notranslate"><span class="pre">terminate()</span></code> method is
used to discard an invalidated connection, the dialect will first attempt
to gracefully close the connection using <code class="docutils literal notranslate"><span class="pre">.close()</span></code> with a timeout, if
the operation is proceeding within an async event loop context only. This
allows the asyncpg driver to attend to finalizing a <code class="docutils literal notranslate"><span class="pre">TimeoutError</span></code>
including being able to close a long-running query server side, which
otherwise can keep running after the program has exited.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10717">#10717</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.24-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.24-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.24-13"><span class="target" id="change-51cc28cad62dc3af9c5c6e84fa8820a8"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-51cc28cad62dc3af9c5c6e84fa8820a8">¶</a></span><p>Fixed regression introduced by the fix in ticket <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10492">#10492</a> when using
pool pre-ping with PyMySQL version older than 1.0.</p>
<p>This change is also <strong>backported</strong> to: 1.4.51</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10650">#10650</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.24-tests">
<h3>tests<a class="headerlink" href="#change-2.0.24-tests" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.24-14"><span class="target" id="change-e65f5932702335fc0960be6cef7d49c4"><strong>[tests] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e65f5932702335fc0960be6cef7d49c4">¶</a></span><p>Improvements to the test suite to further harden its ability to run
when Python <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> is not installed.   There is now a tox
target that includes the token “nogreenlet” that will run the suite
with greenlet not installed (note that it still temporarily installs
greenlet as part of the tox config, however).</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10747">#10747</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.23">
<h2 class="release-version">2.0.23<a class="headerlink" href="#change-2.0.23" title="Link to this heading">¶</a></h2>
Released: November 2, 2023<section id="change-2.0.23-orm">
<h3>orm<a class="headerlink" href="#change-2.0.23-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.23-0"><span class="target" id="change-b99d728e2a2fc2b3b65a1c2ce2c6643c"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b99d728e2a2fc2b3b65a1c2ce2c6643c">¶</a></span><p>Implemented the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.bulk_insert_mappings.params.render_nulls" title="sqlalchemy.orm.Session.bulk_insert_mappings"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.bulk_insert_mappings.render_nulls</span></code></a>
parameter for new style bulk ORM inserts, allowing <code class="docutils literal notranslate"><span class="pre">render_nulls=True</span></code> as
an execution option.   This allows for bulk ORM inserts with a mixture of
<code class="docutils literal notranslate"><span class="pre">None</span></code> values in the parameter dictionaries to use a single batch of rows
for a given set of dicationary keys, rather than breaking up into batches
that omit the NULL columns from each INSERT.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/queryguide/dml.html#orm-queryguide-insert-null-params"><span class="std std-ref">Sending NULL values in ORM bulk INSERT statements</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10575">#10575</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-1"><span class="target" id="change-f04d0250b8587f166c0966d09dfc7f1a"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f04d0250b8587f166c0966d09dfc7f1a">¶</a></span><p>Fixed issue where the <code class="docutils literal notranslate"><span class="pre">__allow_unmapped__</span></code> directive failed to allow for
legacy <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> / <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> mappings that nonetheless had
annotations such as <code class="docutils literal notranslate"><span class="pre">Any</span></code> or a specific type without <code class="docutils literal notranslate"><span class="pre">Mapped[]</span></code> as
their type, without errors related to locating the attribute name.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10516">#10516</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-2"><span class="target" id="change-b2d65eb1d5e22d5fc13a1893af0a8dc7"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b2d65eb1d5e22d5fc13a1893af0a8dc7">¶</a></span><p>Fixed caching bug where using the <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> construct in
conjunction with loader options <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a>,
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> would fail to substitute bound parameter values
correctly on subsequent caching runs.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10570">#10570</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-3"><span class="target" id="change-c8c35a2bc1e612f800f3ac8c9575943e"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c8c35a2bc1e612f800f3ac8c9575943e">¶</a></span><p>Fixed bug in ORM annotated declarative where using a <code class="docutils literal notranslate"><span class="pre">ClassVar</span></code> that
nonetheless referred in some way to an ORM mapped class name would fail to
be interpreted as a <code class="docutils literal notranslate"><span class="pre">ClassVar</span></code> that’s not mapped.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10472">#10472</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.23-sql">
<h3>sql<a class="headerlink" href="#change-2.0.23-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.23-4"><span class="target" id="change-b7f7bc8166065c30b3e44c5e5b635545"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b7f7bc8166065c30b3e44c5e5b635545">¶</a></span><p>Implemented “literal value processing” for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Interval" title="sqlalchemy.types.Interval"><code class="xref py py-class docutils literal notranslate"><span class="pre">Interval</span></code></a> datatype
for both the PostgreSQL and Oracle dialects, allowing literal rendering of
interval values.  Pull request courtesy Indivar Mishra.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9737">#9737</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-5"><span class="target" id="change-556a737a1ae2858d152232025250d3dc"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-556a737a1ae2858d152232025250d3dc">¶</a></span><p>Fixed issue where using the same bound parameter more than once with
<code class="docutils literal notranslate"><span class="pre">literal_execute=True</span></code> in some combinations with other literal rendering
parameters would cause the wrong values to render due to an iteration
issue.</p>
<p>This change is also <strong>backported</strong> to: 1.4.50</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10142">#10142</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-6"><span class="target" id="change-1e3eec06aef007a36960489511c713cf"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1e3eec06aef007a36960489511c713cf">¶</a></span><p>Added compiler-level None/NULL handling for the “literal processors” of all
datatypes that include literal processing, that is, where a value is
rendered inline within a SQL statement rather than as a bound parameter,
for all those types that do not feature explicit “null value” handling.
Previously this behavior was undefined and inconsistent.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10535">#10535</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-7"><span class="target" id="change-f736e6371b932107db80eb08ddde6be6"><strong>[sql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f736e6371b932107db80eb08ddde6be6">¶</a></span><p>Removed unused placeholder method <code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.compare_against_backend()</span></code>
This method was used by very old versions of Alembic.
See <a class="reference external" href="https://github.com/sqlalchemy/alembic/issues/1293">https://github.com/sqlalchemy/alembic/issues/1293</a> for details.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.23-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.23-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.23-8"><span class="target" id="change-e48d46db9adbed8f26189396467e6658"><strong>[asyncio] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e48d46db9adbed8f26189396467e6658">¶</a></span><p>Fixed bug with method <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession.close_all" title="sqlalchemy.ext.asyncio.AsyncSession.close_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AsyncSession.close_all()</span></code></a>
that was not working correctly.
Also added function <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.close_all_sessions" title="sqlalchemy.ext.asyncio.close_all_sessions"><code class="xref py py-func docutils literal notranslate"><span class="pre">close_all_sessions()</span></code></a> that’s
the equivalent of <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.close_all_sessions" title="sqlalchemy.orm.close_all_sessions"><code class="xref py py-func docutils literal notranslate"><span class="pre">close_all_sessions()</span></code></a>.
Pull request courtesy of Bryan不可思议.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10421">#10421</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.23-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.23-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.23-9"><span class="target" id="change-68b1ef608e120ac50832ee895b733075"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-68b1ef608e120ac50832ee895b733075">¶</a></span><p>Fixed 2.0 regression caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7744">#7744</a> where chains of expressions
involving PostgreSQL JSON operators combined with other operators such as
string concatenation would lose correct parenthesization, due to an
implementation detail specific to the PostgreSQL dialect.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10479">#10479</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-10"><span class="target" id="change-fd3edce684503a17444ab2672e3a1b00"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-fd3edce684503a17444ab2672e3a1b00">¶</a></span><p>Fixed SQL handling for “insertmanyvalues” when using the
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.BIT" title="sqlalchemy.dialects.postgresql.BIT"><code class="xref py py-class docutils literal notranslate"><span class="pre">BIT</span></code></a> datatype with the asyncpg backend.  The
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.BIT" title="sqlalchemy.dialects.postgresql.BIT"><code class="xref py py-class docutils literal notranslate"><span class="pre">BIT</span></code></a> on asyncpg apparently requires the use of an
asyncpg-specific <code class="docutils literal notranslate"><span class="pre">BitString</span></code> type which is currently exposed when using
this DBAPI, making it incompatible with other PostgreSQL DBAPIs that all
work with plain bitstrings here.  A future fix in version 2.1 will
normalize this datatype across all PG backends.   Pull request courtesy
Sören Oldag.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10532">#10532</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.23-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.23-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.23-11"><span class="target" id="change-253ce01edb07ab7169b7798469eed0bc"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-253ce01edb07ab7169b7798469eed0bc">¶</a></span><p>Repaired a new incompatibility in the MySQL “pre-ping” routine where the
<code class="docutils literal notranslate"><span class="pre">False</span></code> argument passed to <code class="docutils literal notranslate"><span class="pre">connection.ping()</span></code>, which is intended to
disable an unwanted “automatic reconnect” feature,  is being deprecated in
MySQL drivers and backends, and is producing warnings for some versions of
MySQL’s native client drivers.  It’s removed for mysqlclient, whereas for
PyMySQL and drivers based on PyMySQL, the parameter will be deprecated and
removed at some point, so API introspection is used to future proof against
these various stages of removal.</p>
<p>This change is also <strong>backported</strong> to: 1.4.50</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10492">#10492</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.23-mariadb">
<h3>mariadb<a class="headerlink" href="#change-2.0.23-mariadb" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.23-12"><span class="target" id="change-5378c0004d0098176c9fcd15d27c9cee"><strong>[mariadb] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5378c0004d0098176c9fcd15d27c9cee">¶</a></span><p>Adjusted the MySQL / MariaDB dialects to default a generated column to NULL
when using MariaDB, if <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.nullable" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.nullable</span></code></a> was not
specified with an explicit <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> value, as MariaDB does not
support the “NOT NULL” phrase with a generated column.  Pull request
courtesy Indivar.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10056">#10056</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-13"><span class="target" id="change-41aa5823c02ec903c24350affd3d4888"><strong>[mariadb] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-41aa5823c02ec903c24350affd3d4888">¶</a></span><p>Established a workaround for what seems to be an intrinsic issue across
MySQL/MariaDB drivers where a RETURNING result for DELETE DML which returns
no rows using SQLAlchemy’s “empty IN” criteria fails to provide a
cursor.description, which then yields result that returns no rows,
leading to regressions for the ORM that in the 2.0 series uses RETURNING
for bulk DELETE statements for the “synchronize session” feature. To
resolve, when the specific case of “no description when RETURNING was
given” is detected, an “empty result” with a correct cursor description is
generated and used in place of the non-working cursor.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10505">#10505</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.23-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.23-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.23-14"><span class="target" id="change-6d923d6ee3032db64235cfb43933bca0"><strong>[mssql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6d923d6ee3032db64235cfb43933bca0">¶</a></span><p>Added support for the <code class="docutils literal notranslate"><span class="pre">aioodbc</span></code> driver implemented for SQL Server,
which builds on top of the pyodbc and general aio* dialect architecture.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/mssql.html#mssql-aioodbc"><span class="std std-ref">aioodbc</span></a> - in the SQL Server dialect documentation.</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6521">#6521</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-15"><span class="target" id="change-42af5196fc324a7954408fa45e63950a"><strong>[mssql] [bug] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-42af5196fc324a7954408fa45e63950a">¶</a></span><p>Fixed issue where identity column reflection would fail
for a bigint column with a large identity start value
(more than 18 digits).</p>
<p>This change is also <strong>backported</strong> to: 1.4.50</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10504">#10504</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.23-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.23-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.23-16"><span class="target" id="change-f34da0c6dc51fa9907ec89dede0c8fc2"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f34da0c6dc51fa9907ec89dede0c8fc2">¶</a></span><p>Fixed issue in <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Interval" title="sqlalchemy.types.Interval"><code class="xref py py-class docutils literal notranslate"><span class="pre">Interval</span></code></a> datatype where the Oracle implementation
was not being used for DDL generation, leading to the <code class="docutils literal notranslate"><span class="pre">day_precision</span></code> and
<code class="docutils literal notranslate"><span class="pre">second_precision</span></code> parameters to be ignored, despite being supported by
this dialect.  Pull request courtesy Indivar.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10509">#10509</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.23-17"><span class="target" id="change-e68b88b18aded016a6195963074d7f30"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e68b88b18aded016a6195963074d7f30">¶</a></span><p>Fixed issue where the cx_Oracle dialect claimed to support a lower
cx_Oracle version (7.x) than was actually supported in practice within the
2.0 series of SQLAlchemy. The dialect imports symbols that are only in
cx_Oracle 8 or higher, so runtime dialect checks as well as setup.cfg
requirements have been updated to reflect this compatibility.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10470">#10470</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.22">
<h2 class="release-version">2.0.22<a class="headerlink" href="#change-2.0.22" title="Link to this heading">¶</a></h2>
Released: October 12, 2023<section id="change-2.0.22-orm">
<h3>orm<a class="headerlink" href="#change-2.0.22-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.22-0"><span class="target" id="change-0d51e82a2a804c30a98a274257fe7b13"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0d51e82a2a804c30a98a274257fe7b13">¶</a></span><p>Added method <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get_one" title="sqlalchemy.orm.Session.get_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get_one()</span></code></a> that behaves like
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get" title="sqlalchemy.orm.Session.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code></a> but raises an exception instead of returning
<code class="docutils literal notranslate"><span class="pre">None</span></code> if no instance was found with the provided primary key.
Pull request courtesy of Carlos Sousa.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10202">#10202</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-1"><span class="target" id="change-de8f28111c93863a3f3ce31bd52cfb18"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-de8f28111c93863a3f3ce31bd52cfb18">¶</a></span><p>Added an option to permanently close sessions.
Set to <code class="docutils literal notranslate"><span class="pre">False</span></code> the new parameter <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.close_resets_only" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.close_resets_only</span></code></a>
will prevent a <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> from performing any other
operation after <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.close" title="sqlalchemy.orm.Session.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code></a> has been called.</p>
<p>Added new method <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.reset" title="sqlalchemy.orm.Session.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.reset()</span></code></a> that will reset a <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
to its initial state. This is an alias of <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.close" title="sqlalchemy.orm.Session.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code></a>,
unless <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.close_resets_only" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.close_resets_only</span></code></a> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7787">#7787</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-2"><span class="target" id="change-9f941495d2f0d18e6aeb7a05ce2b9604"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9f941495d2f0d18e6aeb7a05ce2b9604">¶</a></span><p>Fixed a wide range of <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> parameters that were not
being transferred when using the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> object inside
of a pep-593 <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> object, including
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.sort_order" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.sort_order</span></code></a>,
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred</span></code></a>,
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.autoincrement" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.autoincrement</span></code></a>,
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.system" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.system</span></code></a>, <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.info" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.info</span></code></a>
etc.</p>
<p>Additionally, it remains not supported to have dataclass arguments, such as
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.kw_only" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.kw_only</span></code></a>,
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default_factory" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default_factory</span></code></a> etc. indicated within the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> received by <code class="docutils literal notranslate"><span class="pre">Annotated</span></code>, as this is not
supported with pep-681 Dataclass Transforms.  A warning is now emitted when
these parameters are used within <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> in this way (and they
continue to be ignored).</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10046">#10046</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10369">#10369</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-3"><span class="target" id="change-7b41053846856c86a6e4beb53b529184"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7b41053846856c86a6e4beb53b529184">¶</a></span><p>Fixed issue where calling <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> with a new-style
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> query in the ORM, where one or more columns yields values
that are of “unknown hashability”, typically when using JSON functions like
<code class="docutils literal notranslate"><span class="pre">func.json_build_object()</span></code> without providing a type, would fail
internally when the returned values were not actually hashable. The
behavior is repaired to test the objects as they are received for
hashability in this case, raising an informative error message if not. Note
that for values of “known unhashability”, such as when the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> or <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> types are used directly, an
informative error message was already raised.</p>
<p>The “hashabiltiy testing” fix here is applied to legacy <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> as
well, however in the legacy case, <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> is used for
nearly all queries, so no new warning is emitted here; the legacy behavior
of falling back to using <code class="docutils literal notranslate"><span class="pre">id()</span></code> in this case is maintained, with the
improvement that an unknown type that turns out to be hashable will now be
uniqufied, whereas previously it would not.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10459">#10459</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-4"><span class="target" id="change-ab6a656926d4ab3045c514883abb3408"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ab6a656926d4ab3045c514883abb3408">¶</a></span><p>Fixed regression in recently revised “insertmanyvalues” feature (likely
issue <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9618">#9618</a>) where the ORM would inadvertently attempt to
interpret a non-RETURNING result as one with RETURNING, in the case where
the <code class="docutils literal notranslate"><span class="pre">implicit_returning=False</span></code> parameter were applied to the mapped
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>, indicating that “insertmanyvalues” cannot be used if the
primary key values are not provided.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10453">#10453</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-5"><span class="target" id="change-92eac831200a28bc16907304e32abeac"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-92eac831200a28bc16907304e32abeac">¶</a></span><p>Fixed bug where ORM <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> would not apply
itself to a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> where the ON clause were given as a
plain SQL comparison, rather than as a relationship target or similar.</p>
<p><strong>update</strong> - this was found to also fix an issue where
single-inheritance criteria would not be correctly applied to a
subclass entity that only appeared in the <code class="docutils literal notranslate"><span class="pre">select_from()</span></code> list,
see <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11412">#11412</a></p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10365">#10365</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11412">#11412</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-6"><span class="target" id="change-d3927a161b53053bf2a1dbe23a5cd7d6"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d3927a161b53053bf2a1dbe23a5cd7d6">¶</a></span><p>Fixed issue where <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> symbols like <a class="reference internal" href="../orm/large_collections.html#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a>
and <a class="reference internal" href="../orm/large_collections.html#sqlalchemy.orm.DynamicMapped" title="sqlalchemy.orm.DynamicMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicMapped</span></code></a> could not be correctly resolved when referenced
as an element of a sub-module in the given annotation, assuming
string-based or “future annotations” style annotations.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10412">#10412</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-7"><span class="target" id="change-b405569c606eb3e962db1e2eb853bd7e"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b405569c606eb3e962db1e2eb853bd7e">¶</a></span><p>Fixed issue with <code class="docutils literal notranslate"><span class="pre">__allow_unmapped__</span></code> declarative option
where types that were declared using collection types such as
<code class="docutils literal notranslate"><span class="pre">list[SomeClass]</span></code> vs. the typing construct <code class="docutils literal notranslate"><span class="pre">List[SomeClass]</span></code>
would fail to be recognized correctly.  Pull request courtesy
Pascal Corpet.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10385">#10385</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.22-engine">
<h3>engine<a class="headerlink" href="#change-2.0.22-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.22-8"><span class="target" id="change-1cd178a86b0085a87985fbf236c9aff3"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1cd178a86b0085a87985fbf236c9aff3">¶</a></span><p>Fixed issue within some dialects where the dialect could incorrectly return
an empty result set for an INSERT statement that does not actually return
rows at all, due to artfacts from pre- or post-fetching the primary key of
the row or rows still being present.  Affected dialects included asyncpg,
all mssql dialects.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-9"><span class="target" id="change-76aec33da146543ae5c0a9c6b8c1179a"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-76aec33da146543ae5c0a9c6b8c1179a">¶</a></span><p>Fixed issue where under some garbage collection / exception scenarios the
connection pool’s cleanup routine would raise an error due to an unexpected
set of state, which can be reproduced under specific conditions.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10414">#10414</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.22-sql">
<h3>sql<a class="headerlink" href="#change-2.0.22-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.22-10"><span class="target" id="change-462c0454b89e4c3acee069b0593fa5fa"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-462c0454b89e4c3acee069b0593fa5fa">¶</a></span><p>Fixed issue where referring to a FROM entry in the SET clause of an UPDATE
statement would not include it in the FROM clause of the UPDATE statement,
if that entry were nowhere else in the statement; this occurs currently for
CTEs that were added using <code class="xref py py-meth docutils literal notranslate"><span class="pre">Update.add_cte()</span></code> to provide the desired
CTE at the top of the statement.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10408">#10408</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-11"><span class="target" id="change-53b18df0c420b9db30b1601dfa88ae4a"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-53b18df0c420b9db30b1601dfa88ae4a">¶</a></span><p>Fixed 2.0 regression where the <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DDL" title="sqlalchemy.schema.DDL"><code class="xref py py-class docutils literal notranslate"><span class="pre">DDL</span></code></a> construct would no longer
<code class="docutils literal notranslate"><span class="pre">__repr__()</span></code> due to the removed <code class="docutils literal notranslate"><span class="pre">on</span></code> attribute not being accommodated.
Pull request courtesy Iuri de Silvio.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10443">#10443</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.22-typing">
<h3>typing<a class="headerlink" href="#change-2.0.22-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.22-12"><span class="target" id="change-8c34efc72ec2948bd00b850c19d207f9"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8c34efc72ec2948bd00b850c19d207f9">¶</a></span><p>Fixed typing issue where the argument list passed to <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Values" title="sqlalchemy.sql.expression.Values"><code class="xref py py-class docutils literal notranslate"><span class="pre">Values</span></code></a> was
too-restrictively tied to <code class="docutils literal notranslate"><span class="pre">List</span></code> rather than <code class="docutils literal notranslate"><span class="pre">Sequence</span></code>.  Pull request
courtesy Iuri de Silvio.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10451">#10451</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-13"><span class="target" id="change-7e0b09bd668b31e247e7ce2877dbb97a"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7e0b09bd668b31e247e7ce2877dbb97a">¶</a></span><p>Updates to the codebase to support Mypy 1.6.0.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.22-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.22-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.22-14"><span class="target" id="change-317ac886436ab244e9757ba729f66369"><strong>[asyncio] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-317ac886436ab244e9757ba729f66369">¶</a></span><p>Fixed the <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession.get.params.execution_options" title="sqlalchemy.ext.asyncio.AsyncSession.get"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AsyncSession.get.execution_options</span></code></a> parameter
which was not being propagated to the underlying <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> and
was instead being ignored.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.22-mariadb">
<h3>mariadb<a class="headerlink" href="#change-2.0.22-mariadb" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.22-15"><span class="target" id="change-e06e9836c81056ac6e05d35078bdda09"><strong>[mariadb] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e06e9836c81056ac6e05d35078bdda09">¶</a></span><p>Modified the mariadb-connector driver to pre-load the <code class="docutils literal notranslate"><span class="pre">cursor.rowcount</span></code>
value for all queries, to suit tools such as Pandas that hardcode to
calling <code class="xref py py-attr docutils literal notranslate"><span class="pre">Result.rowcount</span></code> in this way. SQLAlchemy normally pre-loads
<code class="docutils literal notranslate"><span class="pre">cursor.rowcount</span></code> only for UPDATE/DELETE statements and otherwise passes
through to the DBAPI where it can return -1 if no value is available.
However, mariadb-connector does not support invoking <code class="docutils literal notranslate"><span class="pre">cursor.rowcount</span></code>
after the cursor itself is closed, raising an error instead.  Generic test
support has been added to ensure all backends support the allowing
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Result.rowcount</span></code> to succceed (that is, returning an integer
value with -1 for “not available”) after the result is closed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10396">#10396</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.22-16"><span class="target" id="change-83eab40b1ad8b98d79002a6c1016fd1e"><strong>[mariadb] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-83eab40b1ad8b98d79002a6c1016fd1e">¶</a></span><p>Additional fixes for the mariadb-connector dialect to support UUID data
values in the result in INSERT..RETURNING statements.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.22-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.22-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.22-17"><span class="target" id="change-f586779aa46755dbd9235df627eadcd8"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f586779aa46755dbd9235df627eadcd8">¶</a></span><p>Fixed bug where the rule that prevents ORDER BY from emitting within
subqueries on SQL Server was not being disabled in the case where the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">select.fetch()</span></code> method were used to limit rows in conjunction with
WITH TIES or PERCENT, preventing valid subqueries with TOP / ORDER BY from
being used.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10458">#10458</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.21">
<h2 class="release-version">2.0.21<a class="headerlink" href="#change-2.0.21" title="Link to this heading">¶</a></h2>
Released: September 18, 2023<section id="change-2.0.21-orm">
<h3>orm<a class="headerlink" href="#change-2.0.21-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.21-0"><span class="target" id="change-c5e3d4e142304d1f25c493cf3a89c60c"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c5e3d4e142304d1f25c493cf3a89c60c">¶</a></span><p>Adjusted the ORM’s interpretation of the “target” entity used within
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> and <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.expression.Delete"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delete</span></code></a> to not interfere with the target
“from” object passed to the statement, such as when passing an ORM-mapped
<a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-class docutils literal notranslate"><span class="pre">aliased</span></code></a> construct that should be maintained within a phrase
like “UPDATE FROM”.  Cases like ORM session synchonize using “SELECT”
statements such as with MySQL/ MariaDB will still have issues with
UPDATE/DELETE of this form so it’s best to disable synchonize_session when
using DML statements of this type.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10279">#10279</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-1"><span class="target" id="change-7af71cfde495c6920b24202d60c90787"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7af71cfde495c6920b24202d60c90787">¶</a></span><p>Added new capability to the <a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> loader option
which allows other loader options to be bundled as siblings, referring to
one of its subclasses, within the sub-options of parent loader option.
Previously, this pattern was only supported if the
<a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> were at the top level of the options for
the query.   See new documentation section for example.</p>
<p>As part of this change, improved the behavior of the
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.Load.selectin_polymorphic" title="sqlalchemy.orm.Load.selectin_polymorphic"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.selectin_polymorphic()</span></code></a> method / loader strategy so that the
subclass load does not load most already-loaded columns from the parent
table, when the option is used against a class that is already being
relationship-loaded.  Previously, the logic to load only the subclass
columns worked only for a top level class load.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/queryguide/inheritance.html#polymorphic-selectin-as-loader-option-target-plus-opts"><span class="std std-ref">Applying loader options when selectin_polymorphic is itself a sub-option</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10348">#10348</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.21-engine">
<h3>engine<a class="headerlink" href="#change-2.0.21-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.21-2"><span class="target" id="change-36d9c1d98921e9c85dddddcff86603c3"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-36d9c1d98921e9c85dddddcff86603c3">¶</a></span><p>Fixed a series of reflection issues affecting the PostgreSQL,
MySQL/MariaDB, and SQLite dialects when reflecting foreign key constraints
where the target column contained parenthesis in one or both of the table
name or column name.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10275">#10275</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.21-sql">
<h3>sql<a class="headerlink" href="#change-2.0.21-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.21-3"><span class="target" id="change-62beba8c425edfdc521784f88c37b460"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-62beba8c425edfdc521784f88c37b460">¶</a></span><p>Adjusted the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> datatype to accept an argument of
<code class="docutils literal notranslate"><span class="pre">None</span></code> for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.length" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.length</span></code></a> parameter, resulting in a
VARCHAR or other textual type with no length in the resulting DDL. This
allows for new elements of any length to be added to the type after it
exists in the schema.  Pull request courtesy Eugene Toder.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10269">#10269</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-4"><span class="target" id="change-364623c918c39464eaf963b5f0acb65d"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-364623c918c39464eaf963b5f0acb65d">¶</a></span><p>Added new generic SQL function <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.aggregate_strings" title="sqlalchemy.sql.functions.aggregate_strings"><code class="xref py py-class docutils literal notranslate"><span class="pre">aggregate_strings</span></code></a>, which
accepts a SQL expression and a decimeter, concatenating strings on multiple
rows into a single aggregate value. The function is compiled on a
per-backend basis, into functions such as <code class="docutils literal notranslate"><span class="pre">group_concat(),</span></code>
<code class="docutils literal notranslate"><span class="pre">string_agg()</span></code>, or <code class="docutils literal notranslate"><span class="pre">LISTAGG()</span></code>.
Pull request courtesy Joshua Morris.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9873">#9873</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-5"><span class="target" id="change-d0cb22a33d1649442e7f3daa85cd0337"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d0cb22a33d1649442e7f3daa85cd0337">¶</a></span><p>Adjusted the operator precedence for the string concatenation operator to
be equal to that of string matching operators, such as
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.like" title="sqlalchemy.sql.expression.ColumnElement.like"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.like()</span></code></a>, <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.regexp_match" title="sqlalchemy.sql.expression.ColumnElement.regexp_match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.regexp_match()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.match" title="sqlalchemy.sql.expression.ColumnElement.match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.match()</span></code></a>, etc., as well as plain <code class="docutils literal notranslate"><span class="pre">==</span></code> which has the
same precedence as string comparison operators, so that parenthesis will be
applied to a string concatenation expression that follows a string match
operator. This provides for backends such as PostgreSQL where the “regexp
match” operator is apparently of higher precedence than the string
concatenation operator.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9610">#9610</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-6"><span class="target" id="change-1a06a50b57cfdf66fe3b8ee686f55887"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1a06a50b57cfdf66fe3b8ee686f55887">¶</a></span><p>Qualified the use of <code class="docutils literal notranslate"><span class="pre">hashlib.md5()</span></code> within the DDL compiler, which is
used to generate deterministic four-character suffixes for long index and
constraint names in DDL statements, to include the Python 3.9+
<code class="docutils literal notranslate"><span class="pre">usedforsecurity=False</span></code> parameter so that Python interpreters built for
restricted environments such as FIPS do not consider this call to be
related to security concerns.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10342">#10342</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-7"><span class="target" id="change-414232b2b2e0cbc53a37a694a461b7f3"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-414232b2b2e0cbc53a37a694a461b7f3">¶</a></span><p>The <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Values" title="sqlalchemy.sql.expression.Values"><code class="xref py py-class docutils literal notranslate"><span class="pre">Values</span></code></a> construct will now automatically create a proxy (i.e.
a copy) of a <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-class docutils literal notranslate"><span class="pre">column</span></code></a> if the column were already associated
with an existing FROM clause.  This allows that an expression like
<code class="docutils literal notranslate"><span class="pre">values_obj.c.colname</span></code> will produce the correct FROM clause even in the
case that <code class="docutils literal notranslate"><span class="pre">colname</span></code> was passed as a <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-class docutils literal notranslate"><span class="pre">column</span></code></a> that was already
used with a previous <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Values" title="sqlalchemy.sql.expression.Values"><code class="xref py py-class docutils literal notranslate"><span class="pre">Values</span></code></a> or other table construct.
Originally this was considered to be a candidate for an error condition,
however it’s likely this pattern is already in widespread use so it’s
now added to support.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10280">#10280</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.21-schema">
<h3>schema<a class="headerlink" href="#change-2.0.21-schema" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.21-8"><span class="target" id="change-a9e378547983fd7ccde1a8c43fc5d16f"><strong>[schema] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a9e378547983fd7ccde1a8c43fc5d16f">¶</a></span><p>Modified the rendering of the Oracle only <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity.params.order" title="sqlalchemy.schema.Identity"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Identity.order</span></code></a>
parameter that’s part of both <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> and <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity" title="sqlalchemy.schema.Identity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Identity</span></code></a> to
only take place for the Oracle backend, and not other backends such as that
of PostgreSQL.  A future release will rename the
<a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity.params.order" title="sqlalchemy.schema.Identity"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Identity.order</span></code></a>, <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence.params.order" title="sqlalchemy.schema.Sequence"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Sequence.order</span></code></a>  and
<a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity.params.on_null" title="sqlalchemy.schema.Identity"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Identity.on_null</span></code></a> parameters to Oracle-specific names,
deprecating the old names, these parameters only apply to Oracle.</p>
<p>This change is also <strong>backported</strong> to: 1.4.50</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10207">#10207</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.21-typing">
<h3>typing<a class="headerlink" href="#change-2.0.21-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.21-9"><span class="target" id="change-4912ee2ba5731476579dbb664755253a"><strong>[typing] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4912ee2ba5731476579dbb664755253a">¶</a></span><p>Made the contained type for <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> covariant; this is to allow
greater flexibility for end-user typing scenarios, such as the use of
protocols to represent particular mapped class structures that are passed
to other functions. As part of this change, the contained type was also
made covariant for dependent and related types such as
<code class="xref py py-class docutils literal notranslate"><span class="pre">SQLORMOperations</span></code>, <a class="reference internal" href="../orm/large_collections.html#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a>, and
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.SQLColumnExpression" title="sqlalchemy.sql.expression.SQLColumnExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLColumnExpression</span></code></a>. Pull request courtesy Roméo Després.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10288">#10288</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-10"><span class="target" id="change-c6fa439ae9245acd2ac09ec0cf3c1f64"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c6fa439ae9245acd2ac09ec0cf3c1f64">¶</a></span><p>Fixed regression introduced in 2.0.20 via <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9600">#9600</a> fix which
attempted to add more formal typing to
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.params.naming_convention" title="sqlalchemy.schema.MetaData"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">MetaData.naming_convention</span></code></a>. This change prevented basic
naming convention dictionaries from passing typing and has been adjusted so
that a plain dictionary of strings for keys as well as dictionaries that
use constraint types as keys or a mix of both, are again accepted.</p>
<p>As part of this change, lesser used forms of the naming convention
dictionary are also typed, including that it currently allows for
<code class="docutils literal notranslate"><span class="pre">Constraint</span></code> type objects as keys as well.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10264">#10264</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9284">#9284</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-11"><span class="target" id="change-0b347b661804f935f5b3b5ffb3c5dea5"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0b347b661804f935f5b3b5ffb3c5dea5">¶</a></span><p>Fixed the type annotation for <code class="docutils literal notranslate"><span class="pre">__class_getitem__()</span></code> as applied to the
<code class="docutils literal notranslate"><span class="pre">Visitable</span></code> class at the base of expression constructs to accept <code class="docutils literal notranslate"><span class="pre">Any</span></code>
for a key, rather than <code class="docutils literal notranslate"><span class="pre">str</span></code>, which helps with some IDEs such as PyCharm
when attempting to write typing annotations for SQL constructs which
include generic selectors.  Pull request courtesy Jordan Macdonald.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9878">#9878</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-12"><span class="target" id="change-e7820aee209ca3fec2ffe7b44fe464bf"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e7820aee209ca3fec2ffe7b44fe464bf">¶</a></span><p>Repaired the core “SQL element” class <code class="docutils literal notranslate"><span class="pre">SQLCoreOperations</span></code> to support the
<code class="docutils literal notranslate"><span class="pre">__hash__()</span></code> method from a typing perspective, as objects like
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> and ORM <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.InstrumentedAttribute" title="sqlalchemy.orm.InstrumentedAttribute"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstrumentedAttribute</span></code></a> are hashable and
are used as dictionary keys in the public API for the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a>
and <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> constructs.  Previously, type checkers were not
aware the root SQL element was hashable.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10353">#10353</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-13"><span class="target" id="change-a2d2b0174d5393b84171228c7f20978f"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a2d2b0174d5393b84171228c7f20978f">¶</a></span><p>Fixed typing issue with <code class="xref py py-meth docutils literal notranslate"><span class="pre">Existing.select_from()</span></code> that
prevented its use with ORM classes.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10337">#10337</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.21-14"><span class="target" id="change-c478c099f09ee71774604551dd7ae402"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c478c099f09ee71774604551dd7ae402">¶</a></span><p>Update type annotations for ORM loading options, restricting them to accept
only <cite>“*”</cite> instead of any string for string arguments.  Pull request
courtesy Janek Nouvertné.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10131">#10131</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.21-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.21-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.21-15"><span class="target" id="change-4b90706ad509dee23bd62cf1d9f23e04"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4b90706ad509dee23bd62cf1d9f23e04">¶</a></span><p>Fixed regression which appeared in 2.0 due to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8491">#8491</a> where the
revised “ping” used for PostgreSQL dialects when the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.pool_pre_ping" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_pre_ping</span></code></a> parameter is in use would
interfere with the use of asyncpg with PGBouncer “transaction” mode, as the
multiple PostgreSQL commands emitted by asnycpg could be broken out among
multiple connections leading to errors, due to the lack of any transaction
around this newly revised “ping”.   The ping is now invoked within a
transaction, in the same way that is implicit with all other backends that
are based on the pep-249 DBAPI; this guarantees that the series of PG
commands sent by asyncpg for this command are invoked on the same backend
connection without it jumping to a different connection mid-command.  The
transaction is not used if the asyncpg dialect is used in “AUTOCOMMIT”
mode, which remains incompatible with pgbouncer transaction mode.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10226">#10226</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.21-misc">
<h3>misc<a class="headerlink" href="#change-2.0.21-misc" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.21-16"><span class="target" id="change-e5e7ae1cb77e9343e23ca1cd7ad5814e"><strong>[bug] [setup]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e5e7ae1cb77e9343e23ca1cd7ad5814e">¶</a></span><p>Fixed very old issue where the full extent of SQLAlchemy modules, including
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.testing.fixtures</span></code>, could not be imported outside of a pytest
run. This suits inspection utilities such as <code class="docutils literal notranslate"><span class="pre">pkgutil</span></code> that attempt to
import all installed modules in all packages.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10321">#10321</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.20">
<h2 class="release-version">2.0.20<a class="headerlink" href="#change-2.0.20" title="Link to this heading">¶</a></h2>
Released: August 15, 2023<section id="change-2.0.20-orm">
<h3>orm<a class="headerlink" href="#change-2.0.20-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.20-0"><span class="target" id="change-5bd46c826e822836092dc9725bfebca1"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5bd46c826e822836092dc9725bfebca1">¶</a></span><p>Implemented the “RETURNING ‘*’” use case for ORM enabled DML statements.
This will render in as many cases as possible and return the unfiltered
result set, however is not supported for multi-parameter “ORM bulk INSERT”
statements that have specific column rendering requirements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10192">#10192</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-1"><span class="target" id="change-f440a498db7174ab48d778a2b5d4fa32"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f440a498db7174ab48d778a2b5d4fa32">¶</a></span><p>Fixed fundamental issue which prevented some forms of ORM “annotations”
from taking place for subqueries which made use of <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a>
against a relationship target.  These annotations are used whenever a
subquery is used in special situations such as within
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.PropComparator.and_" title="sqlalchemy.orm.PropComparator.and_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.and_()</span></code></a> and other ORM-specific scenarios.</p>
<p>This change is also <strong>backported</strong> to: 1.4.50</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10223">#10223</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-2"><span class="target" id="change-e9f68156d5dd58b841da9821db29fafe"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e9f68156d5dd58b841da9821db29fafe">¶</a></span><p>Fixed issue where the ORM’s generation of a SELECT from a joined
inheritance model with same-named columns in superclass and subclass would
somehow not send the correct list of column names to the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.CTE" title="sqlalchemy.sql.expression.CTE"><code class="xref py py-class docutils literal notranslate"><span class="pre">CTE</span></code></a>
construct, when the RECURSIVE column list were generated.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10169">#10169</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-3"><span class="target" id="change-7e8f8a4bc76d0aec1d5b5a31fb79e693"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7e8f8a4bc76d0aec1d5b5a31fb79e693">¶</a></span><p>Fixed fairly major issue where execution options passed to
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a>, as well as execution options local to the ORM
executed statement itself, would not be propagated along to eager loaders
such as that of <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a>, <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a>, and
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlalchemy.orm.subqueryload()</span></code></a>, making it impossible to do things such as
disabling the cache for a single statement or using
<code class="docutils literal notranslate"><span class="pre">schema_translate_map</span></code> for a single statement, as well as the use of
user-custom execution options.   A change has been made where <strong>all</strong>
user-facing execution options present for <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> will
be propagated along to additional loaders.</p>
<p>As part of this change, the warning for “excessively deep” eager loaders
leading to caching being disabled can be silenced on a per-statement
basis by sending <code class="docutils literal notranslate"><span class="pre">execution_options={&quot;compiled_cache&quot;:</span> <span class="pre">None}</span></code> to
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a>, which will disable caching for the full
series of statements within that scope.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10231">#10231</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-4"><span class="target" id="change-ed92420c779e3fb0e4d2d838a0381e87"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ed92420c779e3fb0e4d2d838a0381e87">¶</a></span><p>Fixed issue where internal cloning used by the ORM for expressions like
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code> to produce correlated EXISTS
constructs would interfere with the “cartesian product warning” feature of
the SQL compiler, leading the SQL compiler to warn when all elements of the
statement were correctly joined.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10124">#10124</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-5"><span class="target" id="change-a0f7cc7424b35990fc56876da2f33e94"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a0f7cc7424b35990fc56876da2f33e94">¶</a></span><p>Fixed issue where the <code class="docutils literal notranslate"><span class="pre">lazy=&quot;immediateload&quot;</span></code> loader strategy would place
an internal loading token into the ORM mapped attribute under circumstances
where the load should not occur, such as in a recursive self-referential
load.   As part of this change, the <code class="docutils literal notranslate"><span class="pre">lazy=&quot;immediateload&quot;</span></code> strategy now
honors the <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.join_depth" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.join_depth</span></code></a> parameter for
self-referential eager loads in the same way as that of other eager
loaders, where leaving it unset or set at zero will lead to a
self-referential immediateload not occurring, setting it to a value of one
or greater will immediateload up until that given depth.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10139">#10139</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-6"><span class="target" id="change-4e55032acee1ff2c10a7b8beefccce3a"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4e55032acee1ff2c10a7b8beefccce3a">¶</a></span><p>Fixed issue where dictionary-based collections such as
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_keyed_dict" title="sqlalchemy.orm.attribute_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_keyed_dict()</span></code></a> did not fully pickle/unpickle correctly,
leading to issues when attempting to mutate such a collection after
unpickling.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10175">#10175</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-7"><span class="target" id="change-92716d3c4101d838ec4b760cf6b0c6e6"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-92716d3c4101d838ec4b760cf6b0c6e6">¶</a></span><p>Fixed issue where chaining <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> or other wildcard use of
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> from another eager loader using a <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a>
against a joined inheritance subclass would fail to take effect for columns
local to the superclass.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10125">#10125</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-8"><span class="target" id="change-8f7db3c515f48840b1abf9b489fc3dfd"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8f7db3c515f48840b1abf9b489fc3dfd">¶</a></span><p>Fixed issue where an ORM-enabled <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct would not
render any CTEs added only via the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.add_cte" title="sqlalchemy.sql.expression.Select.add_cte"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.add_cte()</span></code></a> method that
were not otherwise referenced in the statement.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10167">#10167</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.20-examples">
<h3>examples<a class="headerlink" href="#change-2.0.20-examples" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.20-9"><span class="target" id="change-9182b7d68fea83641f30eb27024f3914"><strong>[examples] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9182b7d68fea83641f30eb27024f3914">¶</a></span><p>The dogpile_caching examples have been updated for 2.0 style queries.
Within the “caching query” logic itself there is one conditional added to
differentiate between <code class="docutils literal notranslate"><span class="pre">Query</span></code> and <code class="docutils literal notranslate"><span class="pre">select()</span></code> when performing an
invalidation operation.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.20-engine">
<h3>engine<a class="headerlink" href="#change-2.0.20-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.20-10"><span class="target" id="change-5246e93b986ad9d084cbc29d3e1e7c7a"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5246e93b986ad9d084cbc29d3e1e7c7a">¶</a></span><p>Fixed critical issue where setting
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code></a> to <code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code> (as opposed
to using the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a> method) would fail to
restore “autocommit” to a pooled connection if an alternate isolation level
were temporarily selected using
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10147">#10147</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.20-sql">
<h3>sql<a class="headerlink" href="#change-2.0.20-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.20-11"><span class="target" id="change-aabce3c94039ffda48aefaf8ee4b90c0"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-aabce3c94039ffda48aefaf8ee4b90c0">¶</a></span><p>Fixed issue where unpickling of a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> or other
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnElement</span></code></a> would fail to restore the correct “comparator”
object, which is used to generate SQL expressions specific to the type
object.</p>
<p>This change is also <strong>backported</strong> to: 1.4.50</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10213">#10213</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.20-typing">
<h3>typing<a class="headerlink" href="#change-2.0.20-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.20-12"><span class="target" id="change-2c09b04320953f54a223ad0d14d16794"><strong>[typing] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2c09b04320953f54a223ad0d14d16794">¶</a></span><p>Added new typing only utility functions <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.Nullable" title="sqlalchemy.Nullable"><code class="xref py py-func docutils literal notranslate"><span class="pre">Nullable()</span></code></a> and
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.NotNullable" title="sqlalchemy.NotNullable"><code class="xref py py-func docutils literal notranslate"><span class="pre">NotNullable()</span></code></a> to type a column or ORM class as, respectively,
nullable or not nullable.
These function are no-op at runtime, returning the input unchanged.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10173">#10173</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-13"><span class="target" id="change-d98f2a34630677a4e23134ad33529f53"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d98f2a34630677a4e23134ad33529f53">¶</a></span><p>Typing improvements:</p>
<ul>
<li><p><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> is returned for some forms of
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> where DML without RETURNING is used</p></li>
<li><p>fixed type for <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.with_for_update.params.of" title="sqlalchemy.orm.Query.with_for_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Query.with_for_update.of</span></code></a> parameter within
<a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.with_for_update" title="sqlalchemy.orm.Query.with_for_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.with_for_update()</span></code></a></p></li>
<li><p>improvements to <code class="docutils literal notranslate"><span class="pre">_DMLColumnArgument</span></code> type used by some DML methods to
pass column expressions</p></li>
<li><p>Add overload to <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.literal" title="sqlalchemy.sql.expression.literal"><code class="xref py py-func docutils literal notranslate"><span class="pre">literal()</span></code></a> so that it is inferred that the
return type is <code class="docutils literal notranslate"><span class="pre">BindParameter[NullType]</span></code> where
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.literal.params.type_" title="sqlalchemy.sql.expression.literal"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">literal.type_</span></code></a> param is None</p></li>
<li><p>Add overloads to <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.op" title="sqlalchemy.sql.expression.ColumnElement.op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.op()</span></code></a> so that the inferred
type when <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.op.params.return_type" title="sqlalchemy.sql.expression.ColumnElement.op"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ColumnElement.op.return_type</span></code></a> is not provided
is <code class="docutils literal notranslate"><span class="pre">Callable[[Any],</span> <span class="pre">BinaryExpression[Any]]</span></code></p></li>
<li><p>Add missing overload to <code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.__add__()</span></code></p></li>
</ul>
<p>Pull request courtesy Mehdi Gmira.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9185">#9185</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.20-14"><span class="target" id="change-7482f0d08f0d13d76b6d873867f6714b"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7482f0d08f0d13d76b6d873867f6714b">¶</a></span><p>Fixed issue in <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> and <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a>
methods such as <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.connection" title="sqlalchemy.orm.Session.connection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.connection()</span></code></a> where the
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.connection.params.execution_options" title="sqlalchemy.orm.Session.connection"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.connection.execution_options</span></code></a> parameter were
hardcoded to an internal type that is not user-facing.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10182">#10182</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.20-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.20-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.20-15"><span class="target" id="change-1faf7968e8c55cc939c067441dfff987"><strong>[asyncio] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1faf7968e8c55cc939c067441dfff987">¶</a></span><p>Added new methods <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncConnection.aclose" title="sqlalchemy.ext.asyncio.AsyncConnection.aclose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AsyncConnection.aclose()</span></code></a> as a synonym for
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncConnection.close" title="sqlalchemy.ext.asyncio.AsyncConnection.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AsyncConnection.close()</span></code></a> and
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession.aclose" title="sqlalchemy.ext.asyncio.AsyncSession.aclose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AsyncSession.aclose()</span></code></a> as a synonym for
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession.close" title="sqlalchemy.ext.asyncio.AsyncSession.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AsyncSession.close()</span></code></a> to the
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncConnection" title="sqlalchemy.ext.asyncio.AsyncConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncConnection</span></code></a> and <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a>
objects, to provide compatibility with Python standard library
<code class="docutils literal notranslate"><span class="pre">&#64;contextlib.aclosing</span></code> construct. Pull request courtesy Grigoriev Semyon.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9698">#9698</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.20-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.20-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.20-16"><span class="target" id="change-6872d9d6e8b46bc98b7f5fa18f28ae43"><strong>[mysql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6872d9d6e8b46bc98b7f5fa18f28ae43">¶</a></span><p>Updated aiomysql dialect since the dialect appears to be maintained again.
Re-added to the ci testing using version 0.2.0.</p>
<p>This change is also <strong>backported</strong> to: 1.4.50</p>
<p></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.19">
<h2 class="release-version">2.0.19<a class="headerlink" href="#change-2.0.19" title="Link to this heading">¶</a></h2>
Released: July 15, 2023<section id="change-2.0.19-orm">
<h3>orm<a class="headerlink" href="#change-2.0.19-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.19-0"><span class="target" id="change-8b879f8fea83183413b8d268faab72a2"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8b879f8fea83183413b8d268faab72a2">¶</a></span><p>Fixed issue where setting a relationship collection directly, where an
object in the new collection were already present, would not trigger a
cascade event for that object, leading to it not being added to the
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> if it were not already present.  This is similar in
nature to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6471">#6471</a> and is a more apparent issue due to the removal of
<code class="docutils literal notranslate"><span class="pre">cascade_backrefs</span></code> in the 2.0 series.  The
<a class="reference internal" href="../orm/events.html#sqlalchemy.orm.AttributeEvents.append_wo_mutation" title="sqlalchemy.orm.AttributeEvents.append_wo_mutation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.append_wo_mutation()</span></code></a> event added as part of
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6471">#6471</a> is now also emitted for existing members of a collection
that are present in a bulk set of that same collection.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10089">#10089</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.19-1"><span class="target" id="change-53740fe9731bbe0f3bb71e3453df07d3"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-53740fe9731bbe0f3bb71e3453df07d3">¶</a></span><p>Fixed issue where objects that were associated with an unloaded collection
via backref, but were not merged into the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> due to the
removal of <code class="docutils literal notranslate"><span class="pre">cascade_backrefs</span></code> in the 2.0 series, would not emit a warning
that these objects were not being included in a flush, even though they
were pending members of the collection; in other such cases, a warning is
emitted when a collection being flushed contains non-attached objects which
will be essentially discarded.  The addition of the warning for
backref-pending collection members establishes greater consistency with
collections that may be present or non-present and possibly flushed or not
flushed at different times based on different relationship loading
strategies.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10090">#10090</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.19-2"><span class="target" id="change-ba8df6a227bb961900a4b55b2fc0f714"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ba8df6a227bb961900a4b55b2fc0f714">¶</a></span><p>Fixed additional regression caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9805">#9805</a> where more aggressive
propagation of the “ORM” flag on statements could lead to an internal
attribute error when embedding an ORM <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> construct that
nonetheless contained no ORM entities within a Core SQL statement, in this
case ORM-enabled UPDATE and DELETE statements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10098">#10098</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.19-engine">
<h3>engine<a class="headerlink" href="#change-2.0.19-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.19-3"><span class="target" id="change-801784234240fc9d4879723c412e74e2"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-801784234240fc9d4879723c412e74e2">¶</a></span><p>Renamed <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row.t" title="sqlalchemy.engine.Row.t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row.t</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row.tuple" title="sqlalchemy.engine.Row.tuple"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row.tuple()</span></code></a> to
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row._t" title="sqlalchemy.engine.Row._t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._t</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row._tuple" title="sqlalchemy.engine.Row._tuple"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row._tuple()</span></code></a>; this is to suit the
policy that all methods and pre-defined attributes on <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> should
be in the style of Python standard library <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> where all fixed
names have a leading underscore, to avoid name conflicts with existing
column names.   The previous method/attribute is now deprecated and will
emit a deprecation warning.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10093">#10093</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.19-4"><span class="target" id="change-5c914dcd8d73db1e4163428bae0a55d8"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5c914dcd8d73db1e4163428bae0a55d8">¶</a></span><p>Added detection for non-string, non-<a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL" title="sqlalchemy.engine.URL"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> objects to the
<a class="reference internal" href="../core/engines.html#sqlalchemy.engine.make_url" title="sqlalchemy.engine.make_url"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_url()</span></code></a> function, allowing <code class="docutils literal notranslate"><span class="pre">ArgumentError</span></code> to be thrown
immediately, rather than causing failures later on.  Special logic ensures
that mock forms of <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL" title="sqlalchemy.engine.URL"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> are allowed through.  Pull request
courtesy Grigoriev Semyon.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10079">#10079</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.19-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.19-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.19-5"><span class="target" id="change-8c143a4a584c05e36e8b3c62aaab83c7"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8c143a4a584c05e36e8b3c62aaab83c7">¶</a></span><p>Fixed regression caused by improvements to PostgreSQL URL parsing in
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10004">#10004</a> where “host” query string arguments that had colons in
them, to support various third party proxy servers and/or dialects, would
not parse correctly as these were evaluted as <code class="docutils literal notranslate"><span class="pre">host:port</span></code> combinations.
Parsing has been updated to consider a colon as indicating a <code class="docutils literal notranslate"><span class="pre">host:port</span></code>
value only if the hostname contains only alphanumeric characters with dots
or dashes only (e.g. no slashes), followed by exactly one colon followed by
an all-integer token of zero or more integers.  In all other cases, the
full string is taken as a host.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10069">#10069</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.19-6"><span class="target" id="change-44980e8b6d4af169ffcb51f4ae971936"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-44980e8b6d4af169ffcb51f4ae971936">¶</a></span><p>Fixed issue where comparisons to the <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.CITEXT" title="sqlalchemy.dialects.postgresql.CITEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">CITEXT</span></code></a> datatype
would cast the right side to <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code>, leading to the right side not
being interpreted as a <code class="docutils literal notranslate"><span class="pre">CITEXT</span></code> datatype, for the asyncpg, psycopg3 and
pg80000 dialects.   This led to the <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.CITEXT" title="sqlalchemy.dialects.postgresql.CITEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">CITEXT</span></code></a> type being
essentially unusable for practical use; this is now fixed and the test
suite has been corrected to properly assert that expressions are rendered
correctly.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10096">#10096</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.18">
<h2 class="release-version">2.0.18<a class="headerlink" href="#change-2.0.18" title="Link to this heading">¶</a></h2>
Released: July 5, 2023<section id="change-2.0.18-engine">
<h3>engine<a class="headerlink" href="#change-2.0.18-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.18-0"><span class="target" id="change-296162b458f257b81f5790f5f62ffb82"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-296162b458f257b81f5790f5f62ffb82">¶</a></span><p>Adjusted the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.schema_translate_map" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.schema_translate_map</span></code></a> feature
such that <strong>all</strong> schema names in the statement are now tokenized,
regardless of whether or not a specific name is in the immediate schema
translate map given, and to fallback to substituting the original name when
the key is not in the actual schema translate map at execution time.  These
two changes allow for repeated use of a compiled object with schema
schema_translate_maps that include or dont include various keys on each
run, allowing cached SQL constructs to continue to function at runtime when
schema translate maps with different sets of keys are used each time. In
addition, added detection of schema_translate_map dictionaries which gain
or lose a <code class="docutils literal notranslate"><span class="pre">None</span></code> key across calls for the same statement, which affects
compilation of the statement and is not compatible with caching; an
exception is raised for these scenarios.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10025">#10025</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.18-sql">
<h3>sql<a class="headerlink" href="#change-2.0.18-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.18-1"><span class="target" id="change-a333af78a9da4929ab23fb62fd8fc3f7"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a333af78a9da4929ab23fb62fd8fc3f7">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.regexp_match" title="sqlalchemy.sql.expression.ColumnOperators.regexp_match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.regexp_match()</span></code></a>
when using “flags” would not produce a “stable” cache key, that
is, the cache key would keep changing each time causing cache pollution.
The same issue existed for <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.regexp_replace" title="sqlalchemy.sql.expression.ColumnOperators.regexp_replace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.regexp_replace()</span></code></a>
with both the flags and the actual replacement expression.
The flags are now represented as fixed modifier strings rendered as
safestrings rather than bound parameters, and the replacement
expression is established within the primary portion of the “binary”
element so that it generates an appropriate cache key.</p>
<p>Note that as part of this change, the
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.regexp_match.params.flags" title="sqlalchemy.sql.expression.ColumnOperators.regexp_match"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ColumnOperators.regexp_match.flags</span></code></a> and
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.regexp_replace.params.flags" title="sqlalchemy.sql.expression.ColumnOperators.regexp_replace"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ColumnOperators.regexp_replace.flags</span></code></a> have been modified to
render as literal strings only, whereas previously they were rendered as
full SQL expressions, typically bound parameters.   These parameters should
always be passed as plain Python strings and not as SQL expression
constructs; it’s not expected that SQL expression constructs were used in
practice for this parameter, so this is a backwards-incompatible change.</p>
<p>The change also modifies the internal structure of the expression
generated, for <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.regexp_replace" title="sqlalchemy.sql.expression.ColumnOperators.regexp_replace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.regexp_replace()</span></code></a> with or without
flags, and for <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.regexp_match" title="sqlalchemy.sql.expression.ColumnOperators.regexp_match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.regexp_match()</span></code></a> with flags. Third
party dialects which may have implemented regexp implementations of their
own (no such dialects could be located in a search, so impact is expected
to be low) would need to adjust the traversal of the structure to
accommodate.</p>
<p>This change is also <strong>backported</strong> to: 1.4.49</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10042">#10042</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.18-2"><span class="target" id="change-0d152d7699417e246bcf507c5f6220ca"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0d152d7699417e246bcf507c5f6220ca">¶</a></span><p>Fixed issue in mostly-internal <a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.expression.CacheKey" title="sqlalchemy.sql.expression.CacheKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheKey</span></code></a> construct where the
<code class="docutils literal notranslate"><span class="pre">__ne__()</span></code> operator were not properly implemented, leading to nonsensical
results when comparing <a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.expression.CacheKey" title="sqlalchemy.sql.expression.CacheKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheKey</span></code></a> instances to each other.</p>
<p>This change is also <strong>backported</strong> to: 1.4.49</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.18-extensions">
<h3>extensions<a class="headerlink" href="#change-2.0.18-extensions" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.18-3"><span class="target" id="change-2f4ce84f375c955c0cfdb27f2be9546e"><strong>[extensions] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2f4ce84f375c955c0cfdb27f2be9546e">¶</a></span><p>Added new option to <a class="reference internal" href="../orm/extensions/associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal notranslate"><span class="pre">association_proxy()</span></code></a>
<a class="reference internal" href="../orm/extensions/associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy.params.create_on_none_assignment" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">association_proxy.create_on_none_assignment</span></code></a>; when an
association proxy which refers to a scalar relationship is assigned the
value <code class="docutils literal notranslate"><span class="pre">None</span></code>, and the referenced object is not present, a new object is
created via the creator.  This was apparently an undefined behavior in the
1.2 series that was silently removed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10013">#10013</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.18-typing">
<h3>typing<a class="headerlink" href="#change-2.0.18-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.18-4"><span class="target" id="change-cf985e658ee66306f732eb7d38391f2b"><strong>[typing] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-cf985e658ee66306f732eb7d38391f2b">¶</a></span><p>Improved typing when using standalone operator functions from
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.sql.operators</span></code> such as <code class="docutils literal notranslate"><span class="pre">sqlalchemy.sql.operators.eq</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10054">#10054</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.18-5"><span class="target" id="change-f401c82ab13500cb00ba5334ab7adf0e"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f401c82ab13500cb00ba5334ab7adf0e">¶</a></span><p>Fixed some of the typing within the <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> construct to
correctly accept a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object that’s been aliased with
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.alias" title="sqlalchemy.schema.Table.alias"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Table.alias()</span></code></a>, as well as general support for <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a>
objects to be passed as the “selectable” argument, since this is all
supported.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10061">#10061</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.18-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.18-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.18-6"><span class="target" id="change-be79373fa7edd1cac9cdbd16cf977137"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-be79373fa7edd1cac9cdbd16cf977137">¶</a></span><p>Added multi-host support for the asyncpg dialect.  General improvements and
error checking added to the PostgreSQL URL routines for the “multihost” use
case added as well.  Pull request courtesy Ilia Dmitriev.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#asyncpg-multihost"><span class="std std-ref">Multihost Connections</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10004">#10004</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.18-7"><span class="target" id="change-b6df37336f5a6a321e8d4f250b8319f1"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b6df37336f5a6a321e8d4f250b8319f1">¶</a></span><p>Added new parameter <code class="docutils literal notranslate"><span class="pre">native_inet_types=False</span></code> to all PostgreSQL
dialects, which indicates converters used by the DBAPI to
convert rows from PostgreSQL <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal notranslate"><span class="pre">INET</span></code></a> and <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIDR</span></code></a> columns
into Python <code class="docutils literal notranslate"><span class="pre">ipaddress</span></code> datatypes should be disabled, returning strings
instead.  This allows code written to work with strings for these datatypes
to be migrated to asyncpg, psycopg, or pg8000 without code changes
other than adding this parameter to the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>
or <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a> function call.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-network-datatypes"><span class="std std-ref">Network Data Types</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9945">#9945</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.18-mariadb">
<h3>mariadb<a class="headerlink" href="#change-2.0.18-mariadb" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.18-8"><span class="target" id="change-6bbbc95a628b1c3195e588b97009b1d3"><strong>[mariadb] [usecase] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6bbbc95a628b1c3195e588b97009b1d3">¶</a></span><p>Allowed reflecting <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UUID" title="sqlalchemy.types.UUID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUID</span></code></a> columns from MariaDB. This allows
Alembic to properly detect the type of such columns in existing MariaDB
databases.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10028">#10028</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.18-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.18-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.18-9"><span class="target" id="change-06a8b994daacb6ff642029798d42f868"><strong>[mssql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-06a8b994daacb6ff642029798d42f868">¶</a></span><p>Added support for creation and reflection of COLUMNSTORE
indexes in MSSQL dialect. Can be specified on indexes
specifying <code class="docutils literal notranslate"><span class="pre">mssql_columnstore=True</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7340">#7340</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.18-10"><span class="target" id="change-69771c0d801778725819f319131907da"><strong>[mssql] [bug] [sql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-69771c0d801778725819f319131907da">¶</a></span><p>Fixed issue where performing <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Cast" title="sqlalchemy.sql.expression.Cast"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cast</span></code></a> to a string type with an
explicit collation would render the COLLATE clause inside the CAST
function, which resulted in a syntax error.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9932">#9932</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.17">
<h2 class="release-version">2.0.17<a class="headerlink" href="#change-2.0.17" title="Link to this heading">¶</a></h2>
Released: June 23, 2023<section id="change-2.0.17-orm">
<h3>orm<a class="headerlink" href="#change-2.0.17-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.17-0"><span class="target" id="change-cc019b5f8eafce3b303c817ee763f60d"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-cc019b5f8eafce3b303c817ee763f60d">¶</a></span><p>Fixed regression in the 2.0 series where a query that used
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a> with <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> or
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> would raise an <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>. Pull request
courtesy of Matthew Martin.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9870">#9870</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.17-1"><span class="target" id="change-58a8a49e11fa3b4f642a3164007132c8"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-58a8a49e11fa3b4f642a3164007132c8">¶</a></span><p>Fixed issue in ORM Annotated Declarative which prevented a
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr" title="sqlalchemy.orm.declared_attr"><code class="xref py py-class docutils literal notranslate"><span class="pre">declared_attr</span></code></a> from being used on a mixin which did not return
a <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> datatype, and instead returned a supplemental ORM
datatype such as <a class="reference internal" href="../orm/extensions/associationproxy.html#sqlalchemy.ext.associationproxy.AssociationProxy" title="sqlalchemy.ext.associationproxy.AssociationProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">AssociationProxy</span></code></a>.  The Declarative runtime would
erroneously try to interpret this annotation as needing to be
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> and raise an error.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9957">#9957</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.17-2"><span class="target" id="change-d75f161329ba4662bde2c687f574ae5d"><strong>[orm] [bug] [typing]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d75f161329ba4662bde2c687f574ae5d">¶</a></span><p>Fixed typing issue where using the <a class="reference internal" href="../orm/extensions/associationproxy.html#sqlalchemy.ext.associationproxy.AssociationProxy" title="sqlalchemy.ext.associationproxy.AssociationProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">AssociationProxy</span></code></a> return type
from a <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr" title="sqlalchemy.orm.declared_attr"><code class="xref py py-class docutils literal notranslate"><span class="pre">declared_attr</span></code></a> function was disallowed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9957">#9957</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.17-3"><span class="target" id="change-7370ec624179747e15d7b8997037b005"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7370ec624179747e15d7b8997037b005">¶</a></span><p>Fixed regression introduced in 2.0.16 by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9879">#9879</a> where passing a
callable to the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> parameter of
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-class docutils literal notranslate"><span class="pre">mapped_column</span></code></a> while also setting <code class="docutils literal notranslate"><span class="pre">init=False</span></code> would
interpret this value as a Dataclass default value which would be assigned
directly to new instances of the object directly, bypassing the default
generator taking place as the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.default" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.default</span></code></a>
value generator on the underlying <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>.  This condition
is now detected so that the previous behavior is maintained, however a
deprecation warning for this ambiguous use is emitted; to populate the
default generator for a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>, the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.insert_default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.insert_default</span></code></a> parameter should be used,
which disambiguates from the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a>
parameter whose name is fixed as per pep-681.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9936">#9936</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.17-4"><span class="target" id="change-9af931caabb5c7d3eb281d1fa45a00f2"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9af931caabb5c7d3eb281d1fa45a00f2">¶</a></span><p>Additional hardening and documentation for the ORM <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
“state change” system, which detects concurrent use of
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> and <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a> objects; an
additional check is added within the process to acquire connections from
the underlying engine, which is a critical section with regards to internal
connection management.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9973">#9973</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.17-5"><span class="target" id="change-02036825c93942b8ed1195fec343e240"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-02036825c93942b8ed1195fec343e240">¶</a></span><p>Fixed issue in ORM loader strategy logic which further allows for long
chains of <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> loader options across complex
inheriting polymorphic / aliased / of_type() relationship chains to take
proper effect in queries.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10006">#10006</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.17-6"><span class="target" id="change-9b0d53ac42b5ee9a4f7bd8e1f9885cc1"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9b0d53ac42b5ee9a4f7bd8e1f9885cc1">¶</a></span><p>Fixed issue in support for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> datatype in the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a> first added as part of
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8859">#8859</a> where using a custom <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> with fixed configuration
in the map would fail to transfer the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.name" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.name</span></code></a> parameter,
which among other issues would prevent PostgreSQL enums from working if the
enum values were passed as individual values.  Logic has been updated so
that “name” is transferred over, but also that the default <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a>
which is against the plain Python <cite>enum.Enum</cite> class or other “empty” enum
won’t set a hardcoded name of <code class="docutils literal notranslate"><span class="pre">&quot;enum&quot;</span></code> either.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9963">#9963</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.17-orm-declarative">
<h3>orm declarative<a class="headerlink" href="#change-2.0.17-orm-declarative" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.17-7"><span class="target" id="change-4bf9bcc968c1b222b75ee10af8fe6ee2"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4bf9bcc968c1b222b75ee10af8fe6ee2">¶</a></span><p>A warning is emitted when an ORM <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> and other
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.MapperProperty" title="sqlalchemy.orm.MapperProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">MapperProperty</span></code></a> objects are assigned to two different class
attributes at once; only one of the attributes will be mapped.  A warning
for this condition was already in place for <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> and
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-class docutils literal notranslate"><span class="pre">mapped_column</span></code></a> objects.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/3532">#3532</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.17-extensions">
<h3>extensions<a class="headerlink" href="#change-2.0.17-extensions" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.17-8"><span class="target" id="change-d6f9f70da3ff5b65b58e06ecdf8570c3"><strong>[extensions] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d6f9f70da3ff5b65b58e06ecdf8570c3">¶</a></span><p>Fixed issue in mypy plugin for use with mypy 1.4.</p>
<p>This change is also <strong>backported</strong> to: 1.4.49</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.17-typing">
<h3>typing<a class="headerlink" href="#change-2.0.17-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.17-9"><span class="target" id="change-5c8fa7f5749c67951dfb350ce0a5d1eb"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5c8fa7f5749c67951dfb350ce0a5d1eb">¶</a></span><p>Fixed typing issue which prevented <a class="reference internal" href="../orm/large_collections.html#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a> and
<a class="reference internal" href="../orm/large_collections.html#sqlalchemy.orm.DynamicMapped" title="sqlalchemy.orm.DynamicMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicMapped</span></code></a> attributes from being used fully within ORM
queries.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9985">#9985</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.17-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.17-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.17-10"><span class="target" id="change-c477ede7a8a3d264f6196ec4540d9ddd"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c477ede7a8a3d264f6196ec4540d9ddd">¶</a></span><p>The pg8000 dialect now supports RANGE and MULTIRANGE datatypes, using the
existing RANGE API described at <a class="reference internal" href="../dialects/postgresql.html#postgresql-ranges"><span class="std std-ref">Range and Multirange Types</span></a>.  Range and
multirange types are supported in the pg8000 driver from version 1.29.8.
Pull request courtesy Tony Locke.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9965">#9965</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.16">
<h2 class="release-version">2.0.16<a class="headerlink" href="#change-2.0.16" title="Link to this heading">¶</a></h2>
Released: June 10, 2023<section id="change-2.0.16-platform">
<h3>platform<a class="headerlink" href="#change-2.0.16-platform" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.16-0"><span class="target" id="change-7b36b074ab9657f1248b249f4d407bf5"><strong>[platform] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7b36b074ab9657f1248b249f4d407bf5">¶</a></span><p>Compatibility improvements allowing the complete test suite to pass
on Python 3.12.0b1.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.16-orm">
<h3>orm<a class="headerlink" href="#change-2.0.16-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.16-1"><span class="target" id="change-7aa57018c6a715e5af0aaf31f9656d22"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7aa57018c6a715e5af0aaf31f9656d22">¶</a></span><p>Improved <a class="reference internal" href="../orm/extensions/declarative/index.html#sqlalchemy.ext.declarative.DeferredReflection.prepare" title="sqlalchemy.ext.declarative.DeferredReflection.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DeferredReflection.prepare()</span></code></a> to accept arbitrary <code class="docutils literal notranslate"><span class="pre">**kw</span></code>
arguments that are passed to <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.reflect" title="sqlalchemy.schema.MetaData.reflect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.reflect()</span></code></a>, allowing use
cases such as reflection of views as well as dialect-specific arguments to
be passed. Additionally, modernized the
<a class="reference internal" href="../orm/extensions/declarative/index.html#sqlalchemy.ext.declarative.DeferredReflection.prepare.params.bind" title="sqlalchemy.ext.declarative.DeferredReflection.prepare"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">DeferredReflection.prepare.bind</span></code></a> argument so that either an
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> or <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> are accepted as the “bind”
argument.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9828">#9828</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-2"><span class="target" id="change-da9198b14308793cdcfde52048afa854"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-da9198b14308793cdcfde52048afa854">¶</a></span><p>Fixed issue where <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.DeclarativeBaseNoMeta" title="sqlalchemy.orm.DeclarativeBaseNoMeta"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeBaseNoMeta</span></code></a> declarative base class
would not function with non-mapped mixins or abstract classes, raising an
<code class="docutils literal notranslate"><span class="pre">AttributeError</span></code> instead.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9862">#9862</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-3"><span class="target" id="change-35db66f6cf86661004425081bc992353"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-35db66f6cf86661004425081bc992353">¶</a></span><p>Fixed regression in the 2.0 series where the default value of
<a class="reference internal" href="../orm/mapped_attributes.html#sqlalchemy.orm.validates.params.include_backrefs" title="sqlalchemy.orm.validates"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">validates.include_backrefs</span></code></a> got changed to <code class="docutils literal notranslate"><span class="pre">False</span></code> for
the <a class="reference internal" href="../orm/mapped_attributes.html#sqlalchemy.orm.validates" title="sqlalchemy.orm.validates"><code class="xref py py-func docutils literal notranslate"><span class="pre">validates()</span></code></a> function. This default is now restored to
<code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9820">#9820</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-4"><span class="target" id="change-c264254623b927295964ff2060254107"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c264254623b927295964ff2060254107">¶</a></span><p>Fixed bug in new feature which allows a WHERE clause to be used in
conjunction with <a class="reference internal" href="../orm/queryguide/dml.html#orm-queryguide-bulk-update"><span class="std std-ref">ORM Bulk UPDATE by Primary Key</span></a>, added in version 2.0.11
as part of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9583">#9583</a>, where sending dictionaries that did not include
the primary key values for each row would run through the bulk process and
include “pk=NULL” for the rows, silently failing.   An exception is now
raised if primary key values for bulk UPDATE are not supplied.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9917">#9917</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-5"><span class="target" id="change-3336302f3006debcdcf4147dd9dd25b3"><strong>[orm] [bug] [dataclasses]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3336302f3006debcdcf4147dd9dd25b3">¶</a></span><p>Fixed an issue where generating dataclasses fields that specified a
<code class="docutils literal notranslate"><span class="pre">default</span></code> value and set <code class="docutils literal notranslate"><span class="pre">init=False</span></code> would not work.
The dataclasses behavior in this case is to set the default
value on the class, that’s not compatible with the descriptors used
by SQLAlchemy. To support this case the default is transformed to
a <code class="docutils literal notranslate"><span class="pre">default_factory</span></code> when generating the dataclass.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9879">#9879</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-6"><span class="target" id="change-f640d2f03f41faae36f0744f5c73e4d5"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f640d2f03f41faae36f0744f5c73e4d5">¶</a></span><p>A deprecation warning is emitted whenever a property is added to a
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> where an ORM mapped property were already configured,
or an attribute is already present on the class. Previously, there was a
non-deprecation warning for this case that did not emit consistently. The
logic for this warning has been improved so that it detects end-user
replacement of attribute while not having false positives for internal
Declarative and other cases where replacement of descriptors with new ones
is expected.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9841">#9841</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-7"><span class="target" id="change-09da07a25afdd2ac2c7aaea17abcc83c"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-09da07a25afdd2ac2c7aaea17abcc83c">¶</a></span><p>Improved the argument chacking on the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.map_imperatively.params.local_table" title="sqlalchemy.orm.registry.map_imperatively"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">map_imperatively.local_table</span></code></a> parameter of the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.map_imperatively" title="sqlalchemy.orm.registry.map_imperatively"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.map_imperatively()</span></code></a> method, ensuring only a
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> or other <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a> is passed, and not an
existing mapped class, which would lead to undefined behavior as the object
were further interpreted for a new mapping.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9869">#9869</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-8"><span class="target" id="change-4f39b08ec90f7255c85d3708dba2e7cc"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4f39b08ec90f7255c85d3708dba2e7cc">¶</a></span><p>The <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.InstanceState.unloaded_expirable" title="sqlalchemy.orm.InstanceState.unloaded_expirable"><code class="xref py py-attr docutils literal notranslate"><span class="pre">InstanceState.unloaded_expirable</span></code></a> attribute is a synonym
for <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.InstanceState.unloaded" title="sqlalchemy.orm.InstanceState.unloaded"><code class="xref py py-attr docutils literal notranslate"><span class="pre">InstanceState.unloaded</span></code></a>, and is now deprecated; this
attribute was always implementation-specific and should not have been
public.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9913">#9913</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.16-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.16-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.16-9"><span class="target" id="change-d76f4825cf197b39f281dae265ac52e7"><strong>[asyncio] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d76f4825cf197b39f281dae265ac52e7">¶</a></span><p>Added new <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine.params.async_creator" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_async_engine.async_creator</span></code></a> parameter
to <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a>, which accomplishes the same purpose as the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.creator" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.creator</span></code></a> parameter of <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>.
This is a no-argument callable that provides a new asyncio connection,
using the asyncio database driver directly. The
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a> function will wrap the driver-level connection
in the appropriate structures. Pull request courtesy of Jack Wotherspoon.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8215">#8215</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.16-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.16-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.16-10"><span class="target" id="change-82a77c5e5b24cc0a470ef8454a880418"><strong>[postgresql] [usecase] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-82a77c5e5b24cc0a470ef8454a880418">¶</a></span><p>Cast <code class="docutils literal notranslate"><span class="pre">NAME</span></code> columns to <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> when using <code class="docutils literal notranslate"><span class="pre">ARRAY_AGG</span></code> in PostgreSQL
reflection. This seems to improve compatibility with some PostgreSQL
derivatives that may not support aggregations on the <code class="docutils literal notranslate"><span class="pre">NAME</span></code> type.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9838">#9838</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-11"><span class="target" id="change-6bd79169e3bcb714eea3cb26790045d7"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6bd79169e3bcb714eea3cb26790045d7">¶</a></span><p>Unified the custom PostgreSQL operator definitions, since they are
shared among multiple different data types.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9041">#9041</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-12"><span class="target" id="change-c8c2c310c3706da1880c4764ba049fb8"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c8c2c310c3706da1880c4764ba049fb8">¶</a></span><p>Added support for PostgreSQL 10 <code class="docutils literal notranslate"><span class="pre">NULLS</span> <span class="pre">NOT</span> <span class="pre">DISTINCT</span></code> feature of
unique indexes and unique constraint using the dialect option
<code class="docutils literal notranslate"><span class="pre">postgresql_nulls_not_distinct</span></code>.
Updated the reflection logic to also correctly take this option
into account.
Pull request courtesy of Pavel Siarchenia.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8240">#8240</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-13"><span class="target" id="change-4f39aa0df717f91a8290cf24a4c0dfa9"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4f39aa0df717f91a8290cf24a4c0dfa9">¶</a></span><p>Use proper precedence on PostgreSQL specific operators, such as <code class="docutils literal notranslate"><span class="pre">&#64;&gt;</span></code>.
Previously the precedence was wrong, leading to wrong parenthesis when
rendering against and <code class="docutils literal notranslate"><span class="pre">ANY</span></code> or <code class="docutils literal notranslate"><span class="pre">ALL</span></code> construct.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9836">#9836</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.16-14"><span class="target" id="change-b482e13905da86b97d95549cf152fbd8"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b482e13905da86b97d95549cf152fbd8">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.like.params.escape" title="sqlalchemy.sql.expression.ColumnOperators.like"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ColumnOperators.like.escape</span></code></a> and similar
parameters did not allow an empty string as an argument that would be
passed through as the “escape” character; this is a supported syntax by
PostgreSQL.  Pull requset courtesy Martin Caslavsky.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9907">#9907</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.15">
<h2 class="release-version">2.0.15<a class="headerlink" href="#change-2.0.15" title="Link to this heading">¶</a></h2>
Released: May 19, 2023<section id="change-2.0.15-orm">
<h3>orm<a class="headerlink" href="#change-2.0.15-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.15-0"><span class="target" id="change-a0e402b407e6cf70f6bc4a874688cb38"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a0e402b407e6cf70f6bc4a874688cb38">¶</a></span><p>As more projects are using new-style “2.0” ORM querying, it’s becoming
apparent that the conditional nature of “autoflush”, being based on whether
or not the given statement refers to ORM entities, is becoming more of a
key behavior. Up until now, the “ORM” flag for a statement has been loosely
based around whether or not the statement returns rows that correspond to
ORM entities or columns; the original purpose of the “ORM” flag was to
enable ORM-entity fetching rules which apply post-processing to Core result
sets as well as ORM loader strategies to the statement.  For statements
that don’t build on rows that contain ORM entities, the “ORM” flag was
considered to be mostly unnecessary.</p>
<p>It still may be the case that “autoflush” would be better taking effect for
<em>all</em> usage of <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> and related methods, even for
purely Core SQL constructs. However, this still could impact legacy cases
where this is not expected and may be more of a 2.1 thing. For now however,
the rules for the “ORM-flag” have been opened up so that a statement that
includes ORM entities or attributes anywhere within, including in the WHERE
/ ORDER BY / GROUP BY clause alone, within scalar subqueries, etc. will
enable this flag.  This will cause “autoflush” to occur for such statements
and also be visible via the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.is_orm_statement" title="sqlalchemy.orm.ORMExecuteState.is_orm_statement"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.is_orm_statement</span></code></a>
event-level attribute.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9805">#9805</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.15-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.15-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.15-1"><span class="target" id="change-b26c92bcdf427d4a0b7b1654b7631da1"><strong>[postgresql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b26c92bcdf427d4a0b7b1654b7631da1">¶</a></span><p>Repaired the base <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype for the PostgreSQL dialect to
make full use of the PG-specific <code class="docutils literal notranslate"><span class="pre">UUID</span></code> dialect-specific datatype when
“native_uuid” is selected, so that PG driver behaviors are included. This
issue became apparent due to the insertmanyvalues improvement made as part
of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9618">#9618</a>, where in a similar manner as that of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9739">#9739</a>, the
asyncpg driver is very sensitive to datatype casts being present or not,
and the PostgreSQL driver-specific native <code class="docutils literal notranslate"><span class="pre">UUID</span></code> datatype must be invoked
when this generic type is used so that these casts take place.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9808">#9808</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.14">
<h2 class="release-version">2.0.14<a class="headerlink" href="#change-2.0.14" title="Link to this heading">¶</a></h2>
Released: May 18, 2023<section id="change-2.0.14-orm">
<h3>orm<a class="headerlink" href="#change-2.0.14-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.14-0"><span class="target" id="change-5e08ae0771def4e03e5213c56f412cf6"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5e08ae0771def4e03e5213c56f412cf6">¶</a></span><p>Modified the <code class="docutils literal notranslate"><span class="pre">JoinedLoader</span></code> implementation to use a simpler approach in
one particular area where it previously used a cached structure that would
be shared among threads. The rationale is to avoid a potential race
condition which is suspected of being the cause of a particular crash
that’s been reported multiple times. The cached structure in question is
still ultimately “cached” via the compiled SQL cache, so a performance
degradation is not anticipated.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9777">#9777</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.14-1"><span class="target" id="change-6ebe34597f88a29fb3d988892406d59d"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6ebe34597f88a29fb3d988892406d59d">¶</a></span><p>Fixed regression where use of <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a> or <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a>
within a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.CTE" title="sqlalchemy.sql.expression.CTE"><code class="xref py py-class docutils literal notranslate"><span class="pre">CTE</span></code></a> construct, then used in a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>,
would raise a <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.CompileError" title="sqlalchemy.exc.CompileError"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompileError</span></code></a> as a result of ORM related rules for
performing ORM-level update/delete statements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9767">#9767</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.14-2"><span class="target" id="change-3d9985560b1a5df3e89aec846d009aaf"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3d9985560b1a5df3e89aec846d009aaf">¶</a></span><p>Fixed issue in new ORM Annotated Declarative where using a
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> (or other column-level constraint) inside of
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> which is then copied out to models via pep-593
<code class="docutils literal notranslate"><span class="pre">Annotated</span></code> would apply duplicates of each constraint to the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> as produced in the target <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>,
leading to incorrect CREATE TABLE DDL as well as migration directives under
Alembic.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9766">#9766</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.14-3"><span class="target" id="change-d47db8e406d96b4d4662288e2d814b6e"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d47db8e406d96b4d4662288e2d814b6e">¶</a></span><p>Fixed issue where using additional relationship criteria with the
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> loader option, where the additional criteria itself
contained correlated subqueries that referred to the joined entities and
therefore also required “adaption” to aliased entities, would be excluded
from this adaption, producing the wrong ON clause for the joinedload.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9779">#9779</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.14-sql">
<h3>sql<a class="headerlink" href="#change-2.0.14-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.14-4"><span class="target" id="change-43519e25ee7fddbbfb8e00a66c38ce16"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-43519e25ee7fddbbfb8e00a66c38ce16">¶</a></span><p>Generalized the MSSQL <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.try_cast" title="sqlalchemy.sql.expression.try_cast"><code class="xref py py-func docutils literal notranslate"><span class="pre">try_cast()</span></code></a> function into the
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.</span></code> import namespace so that it may be implemented by third
party dialects as well. Within SQLAlchemy, the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.try_cast" title="sqlalchemy.sql.expression.try_cast"><code class="xref py py-func docutils literal notranslate"><span class="pre">try_cast()</span></code></a>
function remains a SQL Server-only construct that will raise
<a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.CompileError" title="sqlalchemy.exc.CompileError"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompileError</span></code></a> if used with backends that don’t support it.</p>
<p><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.try_cast" title="sqlalchemy.sql.expression.try_cast"><code class="xref py py-func docutils literal notranslate"><span class="pre">try_cast()</span></code></a> implements a CAST where un-castable conversions are
returned as NULL, instead of raising an error. Theoretically, the construct
could be implemented by third party dialects for Google BigQuery, DuckDB,
and Snowflake, and possibly others.</p>
<p>Pull request courtesy Nick Crews.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9752">#9752</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.14-5"><span class="target" id="change-f8496b7be3af81c55ac0912540d85449"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f8496b7be3af81c55ac0912540d85449">¶</a></span><p>Fixed issue in <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.values" title="sqlalchemy.sql.expression.values"><code class="xref py py-func docutils literal notranslate"><span class="pre">values()</span></code></a> construct where an internal compilation
error would occur if the construct were used inside of a scalar subquery.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9772">#9772</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.14-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.14-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.14-6"><span class="target" id="change-31d410923cca5fcd21ec4de07c76cbd6"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-31d410923cca5fcd21ec4de07c76cbd6">¶</a></span><p>Fixed apparently very old issue where the
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM.params.create_type" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ENUM.create_type</span></code></a> parameter, when set to its
non-default of <code class="docutils literal notranslate"><span class="pre">False</span></code>, would not be propagated when the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> which it’s a part of were copied, as is common when
using ORM Declarative mixins.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9773">#9773</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.14-tests">
<h3>tests<a class="headerlink" href="#change-2.0.14-tests" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.14-7"><span class="target" id="change-93a2e6d0de59df7b6e2a6bb4e0b0a1d2"><strong>[tests] [bug] [pypy]</strong> <a class="changelog-reference headerlink reference internal" href="#change-93a2e6d0de59df7b6e2a6bb4e0b0a1d2">¶</a></span><p>Fixed test that relied on the <code class="docutils literal notranslate"><span class="pre">sys.getsizeof()</span></code> function to not run on
pypy, where this function appears to have different behavior than it does
on cpython.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9789">#9789</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.13">
<h2 class="release-version">2.0.13<a class="headerlink" href="#change-2.0.13" title="Link to this heading">¶</a></h2>
Released: May 10, 2023<section id="change-2.0.13-orm">
<h3>orm<a class="headerlink" href="#change-2.0.13-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.13-0"><span class="target" id="change-96b48d80a204851b2455fc42f3049af1"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-96b48d80a204851b2455fc42f3049af1">¶</a></span><p>Fixed issue where ORM Annotated Declarative would not resolve forward
references correctly in all cases; in particular, when using
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code> in combination with Pydantic
dataclasses.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9717">#9717</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.13-1"><span class="target" id="change-d7e8bd246ef301dd23b9066eaedfe528"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d7e8bd246ef301dd23b9066eaedfe528">¶</a></span><p>Fixed issue in new <a class="reference internal" href="../orm/queryguide/dml.html#orm-queryguide-upsert-returning"><span class="std std-ref">Using RETURNING with upsert statements</span></a> feature where the
<code class="docutils literal notranslate"><span class="pre">populate_existing</span></code> execution option was not being propagated to the
loading option, preventing existing attributes from being refreshed
in-place.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9746">#9746</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.13-2"><span class="target" id="change-2eba74fd09eb79ff2e4cef5cfcff4605"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2eba74fd09eb79ff2e4cef5cfcff4605">¶</a></span><p>Fixed loader strategy pathing issues where eager loaders such as
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> / <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> would fail to traverse
fully for many-levels deep following a load that had a
<a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> or similar construct as an interim member.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9715">#9715</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.13-3"><span class="target" id="change-5b6a0ac0ec8e3630c41141cf6c7779ca"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5b6a0ac0ec8e3630c41141cf6c7779ca">¶</a></span><p>Fixed issue in <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct where the correct
warning for “column X named directly multiple times” would not be emitted
when ORM mapped attributes referred to the same <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>, if
the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct were involved, raising an internal
assertion instead.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9630">#9630</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.13-sql">
<h3>sql<a class="headerlink" href="#change-2.0.13-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.13-4"><span class="target" id="change-4c7c67f6c54ffb79df65049a3545f071"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4c7c67f6c54ffb79df65049a3545f071">¶</a></span><p>Implemented the “cartesian product warning” for UPDATE and DELETE
statements, those which include multiple tables that are not correlated
together in some way.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9721">#9721</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.13-5"><span class="target" id="change-e6d43c202125f3e0d008711bb8130864"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e6d43c202125f3e0d008711bb8130864">¶</a></span><p>Fixed the base class for dialect-specific float/double types; Oracle
<a class="reference internal" href="../dialects/oracle.html#sqlalchemy.dialects.oracle.BINARY_DOUBLE" title="sqlalchemy.dialects.oracle.BINARY_DOUBLE"><code class="xref py py-class docutils literal notranslate"><span class="pre">BINARY_DOUBLE</span></code></a> now subclasses <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a>,
and internal types for <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> for asyncpg and pg8000 now
correctly subclass <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a>.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.13-6"><span class="target" id="change-5dee8f0e8bd2b1280c24237e552c9374"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5dee8f0e8bd2b1280c24237e552c9374">¶</a></span><p>Fixed issue where <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a> construct that included multiple
tables and no VALUES clause would raise with an internal error. Current
behavior for <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> with no values is to generate a SQL
UPDATE statement with an empty “set” clause, so this has been made
consistent for this specific sub-case.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.13-schema">
<h3>schema<a class="headerlink" href="#change-2.0.13-schema" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.13-7"><span class="target" id="change-04c73bfefd3c83673f8d42f5f0eb2d8c"><strong>[schema] [performance]</strong> <a class="changelog-reference headerlink reference internal" href="#change-04c73bfefd3c83673f8d42f5f0eb2d8c">¶</a></span><p>Improved how table columns are added, avoiding unnecessary allocations,
significantly speeding up the creation of many table, like when reflecting
entire schemas.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9597">#9597</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.13-typing">
<h3>typing<a class="headerlink" href="#change-2.0.13-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.13-8"><span class="target" id="change-3f545302640c33ea6026d550c3320b24"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3f545302640c33ea6026d550c3320b24">¶</a></span><p>Fixed typing for the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get.params.with_for_update" title="sqlalchemy.orm.Session.get"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.get.with_for_update</span></code></a> parameter
of <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get" title="sqlalchemy.orm.Session.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code></a> and <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></a> (as well as
corresponding methods on <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a>) to accept boolean
<code class="docutils literal notranslate"><span class="pre">True</span></code> and all other argument forms accepted by the parameter at runtime.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9762">#9762</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.13-9"><span class="target" id="change-d95e9cb3942049f6075354f45ded5cbe"><strong>[typing] [sql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d95e9cb3942049f6075354f45ded5cbe">¶</a></span><p>Added type <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnExpressionArgument" title="sqlalchemy.sql.expression.ColumnExpressionArgument"><code class="xref py py-data docutils literal notranslate"><span class="pre">ColumnExpressionArgument</span></code></a> as a public-facing type
that indicates column-oriented arguments which are passed to SQLAlchemy
constructs, such as <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.where" title="sqlalchemy.sql.expression.Select.where"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.where()</span></code></a>, <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.and_" title="sqlalchemy.sql.expression.and_"><code class="xref py py-func docutils literal notranslate"><span class="pre">and_()</span></code></a> and
others. This may be used to add typing to end-user functions which call
these methods.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9656">#9656</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.13-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.13-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.13-10"><span class="target" id="change-b4e840b0a637f1dbb35b6f6447e0c137"><strong>[asyncio] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b4e840b0a637f1dbb35b6f6447e0c137">¶</a></span><p>Added a new helper mixin <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncAttrs" title="sqlalchemy.ext.asyncio.AsyncAttrs"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncAttrs</span></code></a> that seeks to improve
the use of lazy-loader and other expired or deferred ORM attributes with
asyncio, providing a simple attribute accessor that provides an <code class="docutils literal notranslate"><span class="pre">await</span></code>
interface to any ORM attribute, whether or not it needs to emit SQL.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncAttrs" title="sqlalchemy.ext.asyncio.AsyncAttrs"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncAttrs</span></code></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9731">#9731</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.13-11"><span class="target" id="change-4d68fa91eb37fbb6909af4ce3361fb75"><strong>[asyncio] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4d68fa91eb37fbb6909af4ce3361fb75">¶</a></span><p>Fixed issue in semi-private <code class="docutils literal notranslate"><span class="pre">await_only()</span></code> and <code class="docutils literal notranslate"><span class="pre">await_fallback()</span></code>
concurrency functions where the given awaitable would remain un-awaited if
the function threw a <code class="docutils literal notranslate"><span class="pre">GreenletError</span></code>, which could cause “was not awaited”
warnings later on if the program continued. In this case, the given
awaitable is now cancelled before the exception is thrown.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.13-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.13-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.13-12"><span class="target" id="change-497905ce657600af45f73debade97361"><strong>[postgresql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-497905ce657600af45f73debade97361">¶</a></span><p>Fixed another regression due to the “insertmanyvalues” change in 2.0.10 as
part of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9618">#9618</a>, in a similar way as regression <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9701">#9701</a>, where
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a> datatypes also need additional casts on when using the
asyncpg driver specifically in order to work with the new bulk INSERT
format.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9739">#9739</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.13-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.13-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.13-13"><span class="target" id="change-50bd88390f01945bac803c8eb75e3263"><strong>[oracle] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-50bd88390f01945bac803c8eb75e3263">¶</a></span><p>Added reflection support in the Oracle dialect to expression based indexes
and the ordering direction of index expressions.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9597">#9597</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.13-misc">
<h3>misc<a class="headerlink" href="#change-2.0.13-misc" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.13-14"><span class="target" id="change-5b063c599024e97a60aff44b0449f024"><strong>[bug] [ext]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5b063c599024e97a60aff44b0449f024">¶</a></span><p>Fixed issue in <a class="reference internal" href="../orm/extensions/mutable.html#sqlalchemy.ext.mutable.Mutable" title="sqlalchemy.ext.mutable.Mutable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mutable</span></code></a> where event registration for ORM
mapped attributes would be called repeatedly for mapped inheritance
subclasses, leading to duplicate events being invoked in inheritance
hierarchies.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9676">#9676</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.12">
<h2 class="release-version">2.0.12<a class="headerlink" href="#change-2.0.12" title="Link to this heading">¶</a></h2>
Released: April 30, 2023<section id="change-2.0.12-orm">
<h3>orm<a class="headerlink" href="#change-2.0.12-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.12-0"><span class="target" id="change-979455974c62ad2b7563167b663a5b8d"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-979455974c62ad2b7563167b663a5b8d">¶</a></span><p>Fixed critical caching issue where the combination of
<a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> and <a class="reference internal" href="../orm/extensions/hybrid.html#sqlalchemy.ext.hybrid.hybrid_property" title="sqlalchemy.ext.hybrid.hybrid_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">hybrid_property()</span></code></a> expression
compositions would cause a cache key mismatch, leading to cache keys that
held onto the actual <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> object while also not matching
that of equivalent constructs, filling up the cache.</p>
<p>This change is also <strong>backported</strong> to: 1.4.48</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9728">#9728</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.12-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.12-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.12-1"><span class="target" id="change-1cc35efd50101c9e01bcd722c08077c8"><strong>[mysql] [bug] [mariadb]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1cc35efd50101c9e01bcd722c08077c8">¶</a></span><p>Fixed issues regarding reflection of comments for <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
and <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects, where the comments contained control
characters such as newlines. Additional testing support for these
characters as well as extended Unicode characters in table and column
comments (the latter of which aren’t supported by MySQL/MariaDB) added to
testing overall.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9722">#9722</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.11">
<h2 class="release-version">2.0.11<a class="headerlink" href="#change-2.0.11" title="Link to this heading">¶</a></h2>
Released: April 26, 2023<section id="change-2.0.11-orm">
<h3>orm<a class="headerlink" href="#change-2.0.11-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.11-0"><span class="target" id="change-28bbdefa27057dbcd0d8c94d17591211"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-28bbdefa27057dbcd0d8c94d17591211">¶</a></span><p>The <a class="reference internal" href="../orm/queryguide/dml.html#orm-expression-update-delete"><span class="std std-ref">ORM bulk INSERT and UPDATE</span></a>
features now add these capabilities:</p>
<ul>
<li><p>The requirement that extra parameters aren’t passed when using ORM
INSERT using the “orm” dml_strategy setting is lifted.</p></li>
<li><p>The requirement that additional WHERE criteria is not passed when using
ORM UPDATE using the “bulk” dml_strategy setting is lifted.  Note that
in this case, the check for expected row count is turned off.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9583">#9583</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9595">#9595</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.11-1"><span class="target" id="change-debf2599b0593b9ed277813214f07c13"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-debf2599b0593b9ed277813214f07c13">¶</a></span><p>Fixed 2.0 regression where use of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal notranslate"><span class="pre">bindparam()</span></code></a> inside of
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> would fail to be interpreted correctly when
executing the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> statement using the ORM
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>, due to the new
<a class="reference internal" href="../orm/queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM-enabled insert feature</span></a> not
implementing this use case.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9583">#9583</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9595">#9595</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.11-engine">
<h3>engine<a class="headerlink" href="#change-2.0.11-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.11-2"><span class="target" id="change-f124a0f8ece09bb4d0a63f1330713190"><strong>[engine] [performance]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f124a0f8ece09bb4d0a63f1330713190">¶</a></span><p>A series of performance enhancements to <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">__getattr__</span></code> performance of the row’s “named tuple” interface has
been improved; within this change, the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
implementation has been streamlined, removing constructs and logic
that were specific to the 1.4 and prior series of SQLAlchemy.
As part of this change, the serialization format of <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
has been modified slightly, however rows which were pickled with previous
SQLAlchemy 2.0 releases will be recognized within the new format.
Pull request courtesy J. Nick Koston.</p></li>
<li><p>Improved row processing performance for “binary” datatypes by making the
“bytes” handler conditional on a per driver basis.  As a result, the
“bytes” result handler has been removed for nearly all drivers other than
psycopg2, all of which in modern forms support returning Python “bytes”
directly.  Pull request courtesy J. Nick Koston.</p></li>
<li><p>Additional refactorings inside of <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> to improve
performance by Federico Caselli.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9678">#9678</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9680">#9680</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.11-3"><span class="target" id="change-0e6782c5f012447961232edc44263cbe"><strong>[engine] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0e6782c5f012447961232edc44263cbe">¶</a></span><p>Fixed regression which prevented the <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL.normalized_query" title="sqlalchemy.engine.URL.normalized_query"><code class="xref py py-attr docutils literal notranslate"><span class="pre">URL.normalized_query</span></code></a>
attribute of <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL" title="sqlalchemy.engine.URL"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> from functioning.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9682">#9682</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.11-sql">
<h3>sql<a class="headerlink" href="#change-2.0.11-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.11-4"><span class="target" id="change-13b3b5cf18dbabf4a32fb3609fe5db20"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-13b3b5cf18dbabf4a32fb3609fe5db20">¶</a></span><p>Added support for slice access with <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a>, e.g.
<code class="docutils literal notranslate"><span class="pre">table.c[0:5]</span></code>, <code class="docutils literal notranslate"><span class="pre">subquery.c[:-1]</span></code> etc. Slice access returns a sub
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a> in the same way as passing a tuple of keys. This
is a natural continuation of the key-tuple access added for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8285">#8285</a>,
where it appears to be an oversight that the slice access use case was
omitted.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8285">#8285</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.11-typing">
<h3>typing<a class="headerlink" href="#change-2.0.11-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.11-5"><span class="target" id="change-f268b00128b625d342e57d368752e654"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f268b00128b625d342e57d368752e654">¶</a></span><p>Improved typing of <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> to indicate that it
support also <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> as index objects, not only
string names. Pull request courtesy Andy Freeland.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9644">#9644</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.11-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.11-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.11-6"><span class="target" id="change-a1b69de69dab04cfcf264eed9a58fbd0"><strong>[postgresql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a1b69de69dab04cfcf264eed9a58fbd0">¶</a></span><p>Fixed critical regression caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9618">#9618</a>, which modified the
architecture of the <a class="reference internal" href="../glossary.html#term-insertmanyvalues"><span class="xref std std-term">insertmanyvalues</span></a> feature for 2.0.10, which
caused floating point values to lose all decimal places when being inserted
using the insertmanyvalues feature with either the psycopg2 or psycopg
drivers.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9701">#9701</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.11-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.11-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.11-7"><span class="target" id="change-c446d42e31df733e3d263dad32e3d505"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c446d42e31df733e3d263dad32e3d505">¶</a></span><p>Implemented the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a> type for SQL Server, where it
will render <code class="docutils literal notranslate"><span class="pre">DOUBLE</span> <span class="pre">PRECISION</span></code> at DDL time.  This is implemented using
a new MSSQL datatype <a class="reference internal" href="../dialects/mssql.html#sqlalchemy.dialects.mssql.DOUBLE_PRECISION" title="sqlalchemy.dialects.mssql.DOUBLE_PRECISION"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOUBLE_PRECISION</span></code></a> which also may
be used directly.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.11-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.11-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.11-8"><span class="target" id="change-987a3e79b184a6efc03cd50dd121c7d7"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-987a3e79b184a6efc03cd50dd121c7d7">¶</a></span><p>Fixed issue in Oracle dialects where <code class="docutils literal notranslate"><span class="pre">Decimal</span></code> returning types such as
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a> would return floating point values, rather than
<code class="docutils literal notranslate"><span class="pre">Decimal</span></code> objects, when these columns were used in the
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.returning" title="sqlalchemy.sql.expression.Insert.returning"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.returning()</span></code></a> clause to return INSERTed values.</p>
<p></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.10">
<h2 class="release-version">2.0.10<a class="headerlink" href="#change-2.0.10" title="Link to this heading">¶</a></h2>
Released: April 21, 2023<section id="change-2.0.10-orm">
<h3>orm<a class="headerlink" href="#change-2.0.10-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.10-0"><span class="target" id="change-7ba8d181d5287137da207ad5dd47def4"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7ba8d181d5287137da207ad5dd47def4">¶</a></span><p>Fixed bug where various ORM-specific getters such as
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.is_column_load" title="sqlalchemy.orm.ORMExecuteState.is_column_load"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.is_column_load</span></code></a>,
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.is_relationship_load" title="sqlalchemy.orm.ORMExecuteState.is_relationship_load"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.is_relationship_load</span></code></a>,
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.loader_strategy_path" title="sqlalchemy.orm.ORMExecuteState.loader_strategy_path"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.loader_strategy_path</span></code></a> etc. would throw an
<code class="docutils literal notranslate"><span class="pre">AttributeError</span></code> if the SQL statement itself were a “compound select”
such as a UNION.</p>
<p>This change is also <strong>backported</strong> to: 1.4.48</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9634">#9634</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-1"><span class="target" id="change-268e1ba891a155f1336d3e7a72b28df8"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-268e1ba891a155f1336d3e7a72b28df8">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr.directive" title="sqlalchemy.orm.declared_attr.directive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">declared_attr.directive()</span></code></a> modifier was not
correctly honored for subclasses when applied to the <code class="docutils literal notranslate"><span class="pre">__mapper_args__</span></code>
special method name, as opposed to direct use of
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr" title="sqlalchemy.orm.declared_attr"><code class="xref py py-class docutils literal notranslate"><span class="pre">declared_attr</span></code></a>. The two constructs should have identical
runtime behaviors.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9625">#9625</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-2"><span class="target" id="change-096d194c62580e17c61e8ac01206eec2"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-096d194c62580e17c61e8ac01206eec2">¶</a></span><p>Made an improvement to the <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> loader option
to allow it to be indicated in the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Executable.options" title="sqlalchemy.sql.expression.Executable.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.options()</span></code></a> method of a
top-level statement that is not itself an ORM statement. Examples include
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> that’s embedded in compound statements such as
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.union" title="sqlalchemy.sql.expression.union"><code class="xref py py-func docutils literal notranslate"><span class="pre">union()</span></code></a>, within an <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.from_select" title="sqlalchemy.sql.expression.Insert.from_select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.from_select()</span></code></a> construct, as
well as within CTE expressions that are not ORM related at the top level.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9635">#9635</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-3"><span class="target" id="change-970abe3bc13afa6558dcb6dbe873399e"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-970abe3bc13afa6558dcb6dbe873399e">¶</a></span><p>Fixed bug in ORM bulk insert feature where additional unnecessary columns
would be rendered in the INSERT statement if RETURNING of individual columns
were requested.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9685">#9685</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-4"><span class="target" id="change-e3eb494ad205a182d575052b5fedc865"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e3eb494ad205a182d575052b5fedc865">¶</a></span><p>Fixed bug in ORM Declarative Dataclasses where the
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> and <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>
constructs, which are documented as read-only constructs in the context of
a Declarative mapping, could not be used with a
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> class without adding <code class="docutils literal notranslate"><span class="pre">init=False</span></code>, which
in the case of <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> was not possible as no
<code class="docutils literal notranslate"><span class="pre">init</span></code> parameter was included. These constructs have been modified from a
dataclass perspective to be assumed to be “read only”, setting
<code class="docutils literal notranslate"><span class="pre">init=False</span></code> by default and no longer including them in the pep-681
constructor. The dataclass parameters for <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>
<code class="docutils literal notranslate"><span class="pre">init</span></code>, <code class="docutils literal notranslate"><span class="pre">default</span></code>, <code class="docutils literal notranslate"><span class="pre">default_factory</span></code>, <code class="docutils literal notranslate"><span class="pre">kw_only</span></code> are now deprecated;
these fields don’t apply to <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a> as used in a
Declarative dataclasses configuration where the construct would be
read-only. Also added read-specific parameter
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression.params.compare" title="sqlalchemy.orm.query_expression"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">query_expression.compare</span></code></a> to
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a>; <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression.params.repr" title="sqlalchemy.orm.query_expression"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">query_expression.repr</span></code></a>
was already present.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9628">#9628</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-5"><span class="target" id="change-ed1b472a587877624396cbe119a271a8"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ed1b472a587877624396cbe119a271a8">¶</a></span><p>Added missing <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.active_history" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.active_history</span></code></a> parameter
to <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.10-engine">
<h3>engine<a class="headerlink" href="#change-2.0.10-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.10-6"><span class="target" id="change-686ddf4c860cbbfcc99d4e80fa8a4d9a"><strong>[engine] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-686ddf4c860cbbfcc99d4e80fa8a4d9a">¶</a></span><p>Added <a class="reference internal" href="../core/engines.html#sqlalchemy.create_pool_from_url" title="sqlalchemy.create_pool_from_url"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_pool_from_url()</span></code></a> and
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_pool_from_url" title="sqlalchemy.ext.asyncio.create_async_pool_from_url"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_pool_from_url()</span></code></a> to create
a <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> instance from an input url passed as string
or <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9613">#9613</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-7"><span class="target" id="change-d31d59ce83faf9c31b77aa69d2838bd4"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d31d59ce83faf9c31b77aa69d2838bd4">¶</a></span><p>Repaired a major shortcoming which was identified in the
<a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">“Insert Many Values” Behavior for INSERT statements</span></a> performance optimization feature first
introduced in the 2.0 series. This was a continuation of the change in
2.0.9 which disabled the SQL Server version of the feature due to a
reliance in the ORM on apparent row ordering that is not guaranteed to take
place. The fix applies new logic to all “insertmanyvalues” operations,
which takes effect when a new parameter
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.returning.params.sort_by_parameter_order" title="sqlalchemy.sql.expression.Insert.returning"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.returning.sort_by_parameter_order</span></code></a> on the
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.returning" title="sqlalchemy.sql.expression.Insert.returning"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.returning()</span></code></a> or <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.UpdateBase.return_defaults" title="sqlalchemy.sql.expression.UpdateBase.return_defaults"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UpdateBase.return_defaults()</span></code></a>
methods, that through a combination of alternate SQL forms, direct
correspondence of client side parameters, and in some cases downgrading to
running row-at-a-time, will apply sorting to each batch of returned rows
using correspondence to primary key or other unique values in each row
which can be correlated to the input data.</p>
<p>Performance impact is expected to be minimal as nearly all common primary
key scenarios are suitable for parameter-ordered batching to be
achieved for all backends other than SQLite, while “row-at-a-time”
mode operates with a bare minimum of Python overhead compared to the very
heavyweight approaches used in the 1.x series. For SQLite, there is no
difference in performance when “row-at-a-time” mode is used.</p>
<p>It’s anticipated that with an efficient “row-at-a-time” INSERT with
RETURNING batching capability, the “insertmanyvalues” feature can be later
be more easily generalized to third party backends that include RETURNING
support but not necessarily easy ways to guarantee a correspondence
with parameter order.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/connections.html#engine-insertmanyvalues-returning-order"><span class="std std-ref">Correlating RETURNING rows to parameter sets</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9603">#9603</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9618">#9618</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.10-typing">
<h3>typing<a class="headerlink" href="#change-2.0.10-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.10-8"><span class="target" id="change-407f8a4fa2eb9b8171aed56b5be43956"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-407f8a4fa2eb9b8171aed56b5be43956">¶</a></span><p>Added typing information for recently added operators
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.icontains" title="sqlalchemy.sql.expression.ColumnOperators.icontains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.icontains()</span></code></a>, <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.istartswith" title="sqlalchemy.sql.expression.ColumnOperators.istartswith"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.istartswith()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.iendswith" title="sqlalchemy.sql.expression.ColumnOperators.iendswith"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.iendswith()</span></code></a>, and bitwise operators
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.bitwise_and" title="sqlalchemy.sql.expression.ColumnOperators.bitwise_and"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.bitwise_and()</span></code></a>, <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.bitwise_or" title="sqlalchemy.sql.expression.ColumnOperators.bitwise_or"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.bitwise_or()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.bitwise_xor" title="sqlalchemy.sql.expression.ColumnOperators.bitwise_xor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.bitwise_xor()</span></code></a>, <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.bitwise_not" title="sqlalchemy.sql.expression.ColumnOperators.bitwise_not"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.bitwise_not()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.bitwise_lshift" title="sqlalchemy.sql.expression.ColumnOperators.bitwise_lshift"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.bitwise_lshift()</span></code></a>
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.bitwise_rshift" title="sqlalchemy.sql.expression.ColumnOperators.bitwise_rshift"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.bitwise_rshift()</span></code></a>. Pull request courtesy Martijn
Pieters.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9650">#9650</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-9"><span class="target" id="change-f4f543b4263bfb6c723b15e713e8f343"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f4f543b4263bfb6c723b15e713e8f343">¶</a></span><p>Updates to the codebase to pass typing with Mypy 1.2.0.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-10"><span class="target" id="change-508aacca5e72f826b2148ca4c19c57ce"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-508aacca5e72f826b2148ca4c19c57ce">¶</a></span><p>Fixed typing issue where <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.PropComparator.and_" title="sqlalchemy.orm.PropComparator.and_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.and_()</span></code></a> expressions would
not be correctly typed inside of loader options such as
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9669">#9669</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.10-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.10-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.10-11"><span class="target" id="change-ccef8dfb60ebad11647e3ee94790a47e"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ccef8dfb60ebad11647e3ee94790a47e">¶</a></span><p>Added <code class="docutils literal notranslate"><span class="pre">prepared_statement_name_func</span></code> connection argument option in the
asyncpg dialect. This option allows passing a callable used to customize
the name of the prepared statement that will be created by the driver
when executing queries.  Pull request courtesy Pavel Sirotkin.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#asyncpg-prepared-statement-name"><span class="std std-ref">Prepared Statement Name with PGBouncer</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9608">#9608</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-12"><span class="target" id="change-a50f6dc2146c6af3e21966a817161a6f"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a50f6dc2146c6af3e21966a817161a6f">¶</a></span><p>Add missing <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range.intersection" title="sqlalchemy.dialects.postgresql.Range.intersection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Range.intersection()</span></code></a> method.
Pull request courtesy Yurii Karabas.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9509">#9509</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-13"><span class="target" id="change-c0665b45142889686859b9d494350c8f"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c0665b45142889686859b9d494350c8f">¶</a></span><p>Restored the <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM.params.name" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ENUM.name</span></code></a> parameter as optional in the
signature for <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>, as this is chosen automatically
from a given pep-435 <code class="docutils literal notranslate"><span class="pre">Enum</span></code> type.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9611">#9611</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-14"><span class="target" id="change-375540e5e5513fe4f2298f29eb4dea4e"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-375540e5e5513fe4f2298f29eb4dea4e">¶</a></span><p>Fixed issue where the comparison for <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> against a
plain string would cast that right-hand side type as VARCHAR, which due to
more explicit casting added to dialects such as asyncpg would produce a
PostgreSQL type mismatch error.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9621">#9621</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.10-15"><span class="target" id="change-19ff03dd0123e03cc18ee0fa30d47248"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-19ff03dd0123e03cc18ee0fa30d47248">¶</a></span><p>Fixed issue that prevented reflection of expression based indexes
with long expressions in PostgreSQL. The expression where erroneously
truncated to the identifier length (that’s 63 bytes by default).</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9615">#9615</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.10-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.10-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.10-16"><span class="target" id="change-2229fa18e8776606e676b0c0b9b14287"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2229fa18e8776606e676b0c0b9b14287">¶</a></span><p>Restored the <a class="reference internal" href="../glossary.html#term-insertmanyvalues"><span class="xref std std-term">insertmanyvalues</span></a> feature for Microsoft SQL Server.
This feature was disabled in version 2.0.9 due to an apparent reliance
on the ordering of RETURNING that is not guaranteed.   The architecture of
the “insertmanyvalues” feature has been reworked to accommodate for
specific organizations of INSERT statements and result row handling that
can guarantee the correspondence of returned rows to input records.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/connections.html#engine-insertmanyvalues-returning-order"><span class="std std-ref">Correlating RETURNING rows to parameter sets</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9603">#9603</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9618">#9618</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.10-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.10-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.10-17"><span class="target" id="change-754f21199c88075f737565c937e7daf5"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-754f21199c88075f737565c937e7daf5">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype could not be used in
an INSERT..RETURNING clause with the Oracle dialect.</p>
<p></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.9">
<h2 class="release-version">2.0.9<a class="headerlink" href="#change-2.0.9" title="Link to this heading">¶</a></h2>
Released: April 5, 2023<section id="change-2.0.9-orm">
<h3>orm<a class="headerlink" href="#change-2.0.9-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.9-0"><span class="target" id="change-05f8562923d2430950b4cdbfc453f950"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-05f8562923d2430950b4cdbfc453f950">¶</a></span><p>Fixed endless loop which could occur when using “relationship to aliased
class” feature and also indicating a recursive eager loader such as
<code class="docutils literal notranslate"><span class="pre">lazy=&quot;selectinload&quot;</span></code> in the loader, in combination with another eager
loader on the opposite side. The check for cycles has been fixed to include
aliased class relationships.</p>
<p>This change is also <strong>backported</strong> to: 1.4.48</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9590">#9590</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.9-mariadb">
<h3>mariadb<a class="headerlink" href="#change-2.0.9-mariadb" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.9-1"><span class="target" id="change-a90eb193dbf3a49887df74d88c9f33cc"><strong>[mariadb] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a90eb193dbf3a49887df74d88c9f33cc">¶</a></span><p>Added <code class="docutils literal notranslate"><span class="pre">row_number</span></code> as reserved word in MariaDb.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9588">#9588</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.9-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.9-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.9-2"><span class="target" id="change-13affe081c314001fad78de544523c6d"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-13affe081c314001fad78de544523c6d">¶</a></span><p>The SQLAlchemy “insertmanyvalues” feature which allows fast INSERT of
many rows while also supporting RETURNING is temporarily disabled for
SQL Server. As the unit of work currently relies upon this feature such
that it matches existing ORM objects to returned primary key
identities, this particular use pattern does not work with SQL Server
in all cases as the order of rows returned by “OUTPUT inserted” may not
always match the order in which the tuples were sent, leading to
the ORM making the wrong decisions about these objects in subsequent
operations.</p>
<p>The feature will be re-enabled in an upcoming release and will again
take effect for multi-row INSERT statements, however the unit-of-work’s
use of the feature will be disabled, possibly for all dialects, unless
ORM-mapped tables also include a “sentinel” column so that the
returned rows can be referenced back to the original data passed in.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9603">#9603</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.9-3"><span class="target" id="change-c64e482334afde692c878a7dc97d7b07"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c64e482334afde692c878a7dc97d7b07">¶</a></span><p>Changed the bulk INSERT strategy used for SQL Server “executemany” with
pyodbc when <code class="docutils literal notranslate"><span class="pre">fast_executemany</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> by using
<code class="docutils literal notranslate"><span class="pre">fast_executemany</span></code> / <code class="docutils literal notranslate"><span class="pre">cursor.executemany()</span></code> for bulk INSERT that does
not include RETURNING, restoring the same behavior as was used in
SQLAlchemy 1.4 when this parameter is set.</p>
<p>New performance details from end users have shown that <code class="docutils literal notranslate"><span class="pre">fast_executemany</span></code>
is still much faster for very large datasets as it uses ODBC commands that
can receive all rows in a single round trip, allowing for much larger
datasizes than the batches that can be sent by “insertmanyvalues”
as was implemented for SQL Server.</p>
<p>While this change was made such that “insertmanyvalues” continued to be
used for INSERT that includes RETURNING, as well as if <code class="docutils literal notranslate"><span class="pre">fast_executemany</span></code>
were not set, due to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9603">#9603</a>, the “insertmanyvalues” strategy has
been disabled for SQL Server across the board in any case.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9586">#9586</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.8">
<h2 class="release-version">2.0.8<a class="headerlink" href="#change-2.0.8" title="Link to this heading">¶</a></h2>
Released: March 31, 2023<section id="change-2.0.8-orm">
<h3>orm<a class="headerlink" href="#change-2.0.8-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.8-0"><span class="target" id="change-417e3bf2bb7a4982e3eb19fdd47ed475"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-417e3bf2bb7a4982e3eb19fdd47ed475">¶</a></span><p>Exceptions such as <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> and <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> raised by Python
dataclasses when making use of the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> mixin
class or <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.mapped_as_dataclass" title="sqlalchemy.orm.registry.mapped_as_dataclass"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.mapped_as_dataclass()</span></code></a> decorator are now
wrapped within an <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> wrapper along with
informative context about the error message, referring to the Python
dataclasses documentation as the authoritative source of background
information on the cause of the exception.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../errors.html#error-dcte"><span class="std std-ref">Python dataclasses error encountered when creating dataclass for &lt;classname&gt;</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9563">#9563</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.8-1"><span class="target" id="change-89a26cf613a7cbff269df6d5e85077e8"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-89a26cf613a7cbff269df6d5e85077e8">¶</a></span><p>Fixed issue in ORM Annotated Declarative where using a recursive type (e.g.
using a nested Dict type) would result in a recursion overflow in the ORM’s
annotation resolution logic, even if this datatype were not necessary to
map the column.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9553">#9553</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.8-2"><span class="target" id="change-92f19a423da7b2c83b6ed8b8bd879b10"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-92f19a423da7b2c83b6ed8b8bd879b10">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct would raise an
internal error if used on a Declarative mixin and included the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred</span></code></a> parameter.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9550">#9550</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.8-3"><span class="target" id="change-f15501d1a2ffae4bd6ed917cff79012d"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f15501d1a2ffae4bd6ed917cff79012d">¶</a></span><p>Expanded the warning emitted when a plain <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-func docutils literal notranslate"><span class="pre">column()</span></code></a> object is
present in a Declarative mapping to include any arbitrary SQL expression
that is not declared within an appropriate property type such as
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>, <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a>, etc. These attributes
are otherwise not mapped at all and remain unchanged within the class
dictionary. As it seems likely that such an expression is usually not
what’s intended, this case now warns for all such otherwise ignored
expressions, rather than just the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-func docutils literal notranslate"><span class="pre">column()</span></code></a> case.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9537">#9537</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.8-4"><span class="target" id="change-43a87858791a74309725298cac9a0f64"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-43a87858791a74309725298cac9a0f64">¶</a></span><p>Fixed regression where accessing the expression value of a hybrid property
on a class that was either unmapped or not-yet-mapped (such as calling upon
it within a <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr" title="sqlalchemy.orm.declared_attr"><code class="xref py py-func docutils literal notranslate"><span class="pre">declared_attr()</span></code></a> method) would raise an internal
error, as an internal fetch for the parent class’ mapper would fail and an
instruction for this failure to be ignored were inadvertently removed in
2.0.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9519">#9519</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.8-5"><span class="target" id="change-12141acfaa3a0559a954d39de39f1159"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-12141acfaa3a0559a954d39de39f1159">¶</a></span><p>Fields that are declared on Declarative Mixins and then combined with
classes that make use of <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a>, where those mixin
fields are not themselves part of a dataclass, now emit a deprecation
warning as these fields will be ignored in a future release, as Python
dataclasses behavior is to ignore these fields. Type checkers will not see
these fields under pep-681.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../errors.html#error-dcmx"><span class="std std-ref">When transforming &lt;cls&gt; to a dataclass, attribute(s) originate from superclass &lt;cls&gt; which is not a dataclass.</span></a> - background on rationale</p>
<p><a class="reference internal" href="../orm/dataclasses.html#orm-declarative-dc-mixins"><span class="std std-ref">Using mixins and abstract superclasses</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9350">#9350</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.8-6"><span class="target" id="change-ea0610028422fe0a4a07f60ce8defc1b"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ea0610028422fe0a4a07f60ce8defc1b">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.BindParameter.render_literal_execute" title="sqlalchemy.sql.expression.BindParameter.render_literal_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BindParameter.render_literal_execute()</span></code></a>
method would fail when called on a parameter that also had ORM annotations
associated with it. In practice, this would be observed as a failure of SQL
compilation when using some combinations of a dialect that uses “FETCH
FIRST” such as Oracle along with a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> construct that uses
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.limit" title="sqlalchemy.sql.expression.Select.limit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.limit()</span></code></a>, within some ORM contexts, including if the
statement were embedded within a relationship primaryjoin expression.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9526">#9526</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.8-7"><span class="target" id="change-06cc3bb5bc86dfc4d2bc18517859c193"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-06cc3bb5bc86dfc4d2bc18517859c193">¶</a></span><p>Towards maintaining consistency with unit-of-work changes made for
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5984">#5984</a> and <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8862">#8862</a>, both of which disable “lazy=’raise’”
handling within <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> processes that aren’t triggered by
attribute access, the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.delete" title="sqlalchemy.orm.Session.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.delete()</span></code></a> method will now also
disable “lazy=’raise’” handling when it traverses relationship paths in
order to process the “delete” and “delete-orphan” cascade rules.
Previously, there was no easy way to generically call
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.delete" title="sqlalchemy.orm.Session.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.delete()</span></code></a> on an object that had “lazy=’raise’” set up
such that only the necessary relationships would be loaded. As
“lazy=’raise’” is primarily intended to catch SQL loading that emits on
attribute access, <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.delete" title="sqlalchemy.orm.Session.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.delete()</span></code></a> is now made to behave like
other <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> methods including <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.merge" title="sqlalchemy.orm.Session.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.merge()</span></code></a> as
well as <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.flush" title="sqlalchemy.orm.Session.flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.flush()</span></code></a> along with autoflush.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9549">#9549</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.8-8"><span class="target" id="change-90e3dbfcb9fd8f5e31bd7663240e3e22"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-90e3dbfcb9fd8f5e31bd7663240e3e22">¶</a></span><p>Fixed issue where an annotation-only <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> directive could
not be used in a Declarative mixin class, without that attribute attempting
to take effect for single- or joined-inheritance subclasses of mapped
classes that had already mapped that attribute on a superclass, producing
conflicting column errors and/or warnings.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9564">#9564</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.8-9"><span class="target" id="change-e3cab981ec86307bb701e832f75e4811"><strong>[orm] [bug] [typing]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e3cab981ec86307bb701e832f75e4811">¶</a></span><p>Properly type <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.from_select.params.names" title="sqlalchemy.sql.expression.Insert.from_select"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.from_select.names</span></code></a> to accept
a list of string or columns or mapped attributes.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9514">#9514</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.8-examples">
<h3>examples<a class="headerlink" href="#change-2.0.8-examples" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.8-10"><span class="target" id="change-c786883aae622674aa83876dcf098e2d"><strong>[examples] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c786883aae622674aa83876dcf098e2d">¶</a></span><p>Fixed issue in “versioned history” example where using a declarative base
that is derived from <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase" title="sqlalchemy.orm.DeclarativeBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeBase</span></code></a> would fail to be mapped.
Additionally, repaired the given test suite so that the documented
instructions for running the example using Python unittest now work again.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.8-typing">
<h3>typing<a class="headerlink" href="#change-2.0.8-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.8-11"><span class="target" id="change-8ce00bdf49b2c8c368caff6d61702d77"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8ce00bdf49b2c8c368caff6d61702d77">¶</a></span><p>Fixed typing for <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> and <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a>
to work correctly with 2.0 style mappings.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9536">#9536</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.8-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.8-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.8-12"><span class="target" id="change-9cfbfaeb532aa9eee370ade624279601"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9cfbfaeb532aa9eee370ade624279601">¶</a></span><p>Fixed critical regression in PostgreSQL dialects such as asyncpg which rely
upon explicit casts in SQL in order for datatypes to be passed to the
driver correctly, where a <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a> datatype would be cast along
with the exact column length being compared, leading to implicit truncation
when comparing a <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> of a smaller length to a string of greater
length regardless of operator in use (e.g. LIKE, MATCH, etc.). The
PostgreSQL dialect now omits the length from <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> when rendering
these casts.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9511">#9511</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.8-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.8-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.8-13"><span class="target" id="change-af32a404a255f197912c225823939f48"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-af32a404a255f197912c225823939f48">¶</a></span><p>Fixed issue where string datatypes such as <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.CHAR" title="sqlalchemy.types.CHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CHAR</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.VARCHAR" title="sqlalchemy.types.VARCHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">VARCHAR</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">TEXT</span></code></a>, as well as binary
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BLOB" title="sqlalchemy.types.BLOB"><code class="xref py py-class docutils literal notranslate"><span class="pre">BLOB</span></code></a>, could not be produced with an explicit length of
zero, which has special meaning for MySQL. Pull request courtesy J. Nick
Koston.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9544">#9544</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.8-misc">
<h3>misc<a class="headerlink" href="#change-2.0.8-misc" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.8-14"><span class="target" id="change-31e4551199a26e54c72cc641db95c1e4"><strong>[bug] [util]</strong> <a class="changelog-reference headerlink reference internal" href="#change-31e4551199a26e54c72cc641db95c1e4">¶</a></span><p>Implemented missing methods <code class="docutils literal notranslate"><span class="pre">copy</span></code> and <code class="docutils literal notranslate"><span class="pre">pop</span></code> in
OrderedSet class.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9487">#9487</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.7">
<h2 class="release-version">2.0.7<a class="headerlink" href="#change-2.0.7" title="Link to this heading">¶</a></h2>
Released: March 18, 2023<section id="change-2.0.7-typing">
<h3>typing<a class="headerlink" href="#change-2.0.7-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.7-0"><span class="target" id="change-51023f4ad85191be3bb7378c9efbc2b6"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-51023f4ad85191be3bb7378c9efbc2b6">¶</a></span><p>Fixed typing issue where <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-func docutils literal notranslate"><span class="pre">composite()</span></code></a> would not allow an
arbitrary callable as the source of the composite class.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9502">#9502</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.7-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.7-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.7-1"><span class="target" id="change-19b534cb7a798c61620e0bf459ca2974"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-19b534cb7a798c61620e0bf459ca2974">¶</a></span><p>Added new PostgreSQL type <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.CITEXT" title="sqlalchemy.dialects.postgresql.CITEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">CITEXT</span></code></a>. Pull request
courtesy Julian David Rath.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9416">#9416</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.7-2"><span class="target" id="change-66762d3d49adef0c5f5a264e74cd3f10"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-66762d3d49adef0c5f5a264e74cd3f10">¶</a></span><p>Modifications to the base PostgreSQL dialect to allow for better integration with the
sqlalchemy-redshift third party dialect for SQLAlchemy 2.0. Pull request courtesy
matthewgdv.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9442">#9442</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.6">
<h2 class="release-version">2.0.6<a class="headerlink" href="#change-2.0.6" title="Link to this heading">¶</a></h2>
Released: March 13, 2023<section id="change-2.0.6-orm">
<h3>orm<a class="headerlink" href="#change-2.0.6-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.6-0"><span class="target" id="change-3c044c0cc20cf1dd3883e11bb5c9cda8"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3c044c0cc20cf1dd3883e11bb5c9cda8">¶</a></span><p>Fixed bug where the “active history” feature was not fully
implemented for composite attributes, making it impossible to receive
events that included the “old” value.   This seems to have been the case
with older SQLAlchemy versions as well, where “active_history” would
be propagated to the underlying column-based attributes, but an event
handler listening to the composite attribute itself would not be given
the “old” value being replaced, even if the composite() were set up
with active_history=True.</p>
<p>Additionally, fixed a regression that’s local to 2.0 which disallowed
active_history on composite from being assigned to the impl with
<code class="docutils literal notranslate"><span class="pre">attr.impl.active_history=True</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9460">#9460</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.6-1"><span class="target" id="change-9ced2804f499614045ccb95889d02347"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9ced2804f499614045ccb95889d02347">¶</a></span><p>Fixed regression involving pickling of Python rows between the cython and
pure Python implementations of <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>, which occurred as part of
refactoring code for version 2.0 with typing. A particular constant were
turned into a string based <code class="docutils literal notranslate"><span class="pre">Enum</span></code> for the pure Python version of
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> whereas the cython version continued to use an integer
constant, leading to deserialization failures.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9418">#9418</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.6-sql">
<h3>sql<a class="headerlink" href="#change-2.0.6-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.6-2"><span class="target" id="change-bed9f8ca83fdb442593eeace08fd00d3"><strong>[sql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bed9f8ca83fdb442593eeace08fd00d3">¶</a></span><p>Fixed regression where the fix for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8098">#8098</a>, which was released in
the 1.4 series and provided a layer of concurrency-safe checks for the
lambda SQL API, included additional fixes in the patch that failed to be
applied to the main branch. These additional fixes have been applied.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9461">#9461</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.6-3"><span class="target" id="change-c5b3416c216d3dd38558f2aa089b40ac"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c5b3416c216d3dd38558f2aa089b40ac">¶</a></span><p>Fixed regression where the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct would not be able
to render if it were given no columns and then used in the context of an
EXISTS, raising an internal exception instead. While an empty “SELECT” is
not typically valid SQL, in the context of EXISTS databases such as
PostgreSQL allow it, and in any case the condition now no longer raises
an internal exception.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9440">#9440</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.6-typing">
<h3>typing<a class="headerlink" href="#change-2.0.6-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.6-4"><span class="target" id="change-39bd55b3fa0d433518d37ea215d9528b"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-39bd55b3fa0d433518d37ea215d9528b">¶</a></span><p>Fixed typing issue where <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.cast" title="sqlalchemy.sql.expression.ColumnElement.cast"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.cast()</span></code></a> did not allow a
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code></a> argument independent of the type of the
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnElement</span></code></a> itself, which is the purpose of
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.cast" title="sqlalchemy.sql.expression.ColumnElement.cast"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.cast()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9451">#9451</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.6-5"><span class="target" id="change-4946b16f8f0c76dac378bbd5b962240b"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4946b16f8f0c76dac378bbd5b962240b">¶</a></span><p>Fixed issues to allow typing tests to pass under Mypy 1.1.1.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.6-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.6-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.6-6"><span class="target" id="change-7c30ecc4f40fe27b5a479c4bd2033873"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7c30ecc4f40fe27b5a479c4bd2033873">¶</a></span><p>Fixed reflection bug where Oracle “name normalize” would not work correctly
for reflection of symbols that are in the “PUBLIC” schema, such as
synonyms, meaning the PUBLIC name could not be indicated as lower case on
the Python side for the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.schema" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.schema</span></code></a> argument. Using
uppercase “PUBLIC” would work, but would then lead to awkward SQL queries
including a quoted <code class="docutils literal notranslate"><span class="pre">&quot;PUBLIC&quot;</span></code> name as well as indexing the table under
uppercase “PUBLIC”, which was inconsistent.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9459">#9459</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.5.post1">
<h2 class="release-version">2.0.5.post1<a class="headerlink" href="#change-2.0.5.post1" title="Link to this heading">¶</a></h2>
Released: March 5, 2023<section id="change-2.0.5.post1-orm">
<h3>orm<a class="headerlink" href="#change-2.0.5.post1-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-0"><span class="target" id="change-2dd633d2eac25277d4dd639b4d0c957e"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2dd633d2eac25277d4dd639b4d0c957e">¶</a></span><p>Added constructor arguments to the built-in mapping collection types
including <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.KeyFuncDict" title="sqlalchemy.orm.KeyFuncDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">KeyFuncDict</span></code></a>, <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_keyed_dict" title="sqlalchemy.orm.attribute_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_keyed_dict()</span></code></a>,
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_keyed_dict" title="sqlalchemy.orm.column_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_keyed_dict()</span></code></a> so that these dictionary types may be
constructed in place given the data up front; this provides further
compatibility with tools such as Python dataclasses <code class="docutils literal notranslate"><span class="pre">.asdict()</span></code> which
relies upon invoking these classes directly as ordinary dictionary classes.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9418">#9418</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-1"><span class="target" id="change-86fcd6a7f11c4112e4fdd425f507659c"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-86fcd6a7f11c4112e4fdd425f507659c">¶</a></span><p>Fixed multiple regressions due to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8372">#8372</a>, involving
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_mapped_collection" title="sqlalchemy.orm.attribute_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_mapped_collection()</span></code></a> (now called
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_keyed_dict" title="sqlalchemy.orm.attribute_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_keyed_dict()</span></code></a>).</p>
<p>First, the collection was no longer usable with “key” attributes that were
not themselves ordinary mapped attributes; attributes linked to descriptors
and/or association proxy attributes have been fixed.</p>
<p>Second, if an event or other operation needed access to the “key” in order
to populate the dictionary from an mapped attribute that was not
loaded, this also would raise an error inappropriately, rather than
trying to load the attribute as was the behavior in 1.4.  This is also
fixed.</p>
<p>For both cases, the behavior of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8372">#8372</a> has been expanded.
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8372">#8372</a> introduced an error that raises when the derived key that
would be used as a mapped dictionary key is effectively unassigned. In this
change, a warning only is emitted if the effective value of the “.key”
attribute is <code class="docutils literal notranslate"><span class="pre">None</span></code>, where it cannot be unambiguously determined if this
<code class="docutils literal notranslate"><span class="pre">None</span></code> was intentional or not. <code class="docutils literal notranslate"><span class="pre">None</span></code> will be not supported as mapped
collection dictionary keys going forward (as it typically refers to NULL
which means “unknown”). Setting
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_keyed_dict.params.ignore_unpopulated_attribute" title="sqlalchemy.orm.attribute_keyed_dict"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">attribute_keyed_dict.ignore_unpopulated_attribute</span></code></a> will now
cause such <code class="docutils literal notranslate"><span class="pre">None</span></code> keys to be ignored as well.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9424">#9424</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-2"><span class="target" id="change-a90c1e83bb08667f8376e420663d7382"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a90c1e83bb08667f8376e420663d7382">¶</a></span><p>Identified that the <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> and <code class="docutils literal notranslate"><span class="pre">mssql+pyodbc</span></code> dialects are now
compatible with the SQLAlchemy ORM’s “versioned rows” feature, since
SQLAlchemy now computes rowcount for a RETURNING statement in this specific
case by counting the rows returned, rather than relying upon
<code class="docutils literal notranslate"><span class="pre">cursor.rowcount</span></code>.  In particular, the ORM versioned rows use case
(documented at <a class="reference internal" href="../orm/versioning.html#mapper-version-counter"><span class="std std-ref">Configuring a Version Counter</span></a>) should now be fully
supported with the SQL Server pyodbc dialect.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-3"><span class="target" id="change-1ddd0e3386794ae10958a0ad3abb9a09"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1ddd0e3386794ae10958a0ad3abb9a09">¶</a></span><p>Added support for the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.polymorphic_load" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_load</span></code></a> parameter to
be applied to each mapper in an inheritance hierarchy more than one level
deep, allowing columns to load for all classes in the hierarchy that
indicate <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code> using a single statement, rather than ignoring
elements on those intermediary classes that nonetheless indicate they also
would participate in <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code> loading and were not part of the
base-most SELECT statement.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9373">#9373</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-4"><span class="target" id="change-10b9b2eefe08cf30bc0c1a68477a2ec9"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-10b9b2eefe08cf30bc0c1a68477a2ec9">¶</a></span><p>Continued the fix for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8853">#8853</a>, allowing the <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a>
name to be fully qualified regardless of whether or not
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__annotations__</span> <span class="pre">import</span> <span class="pre">future</span></code> were present. This issue first fixed
in 2.0.0b3 confirmed that this case worked via the test suite, however the
test suite apparently was not testing the behavior for the name
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> not being locally present at all; string resolution
has been updated to ensure the <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> symbol is locatable as
applies to how the ORM uses these functions.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8853">#8853</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9335">#9335</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-orm-declarative">
<h3>orm declarative<a class="headerlink" href="#change-2.0.5.post1-orm-declarative" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-5"><span class="target" id="change-75d478b3c5baa695ab2033a69441a4b9"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-75d478b3c5baa695ab2033a69441a4b9">¶</a></span><p>Fixed issue where new <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.use_existing_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.use_existing_column</span></code></a>
feature would not work if the two same-named columns were mapped under
attribute names that were differently-named from an explicit name given to
the column itself. The attribute names can now be differently named when
using this parameter.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9332">#9332</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-engine">
<h3>engine<a class="headerlink" href="#change-2.0.5.post1-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-6"><span class="target" id="change-f34a43489fab28eb9f26bc8b4b6c9b7c"><strong>[engine] [performance]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f34a43489fab28eb9f26bc8b4b6c9b7c">¶</a></span><p>A small optimization to the Cython implementation of <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>
using a cdef for a particular int value to avoid Python overhead. Pull
request courtesy Matus Valo.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9343">#9343</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-7"><span class="target" id="change-3d580855c03eccd58d1c551a120813c5"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3d580855c03eccd58d1c551a120813c5">¶</a></span><p>Fixed bug where <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects could not be reliably unpickled
across processes due to an accidental reliance on an unstable hash value.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9423">#9423</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-sql">
<h3>sql<a class="headerlink" href="#change-2.0.5.post1-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-8"><span class="target" id="change-7d4e931e56526d499c0c50d807cf2be8"><strong>[sql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7d4e931e56526d499c0c50d807cf2be8">¶</a></span><p>Restore the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.nullslast" title="sqlalchemy.sql.expression.nullslast"><code class="xref py py-func docutils literal notranslate"><span class="pre">nullslast()</span></code></a> and <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.nullsfirst" title="sqlalchemy.sql.expression.nullsfirst"><code class="xref py py-func docutils literal notranslate"><span class="pre">nullsfirst()</span></code></a> legacy functions
into the <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> import namespace. Previously, the newer
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.nulls_last" title="sqlalchemy.sql.expression.nulls_last"><code class="xref py py-func docutils literal notranslate"><span class="pre">nulls_last()</span></code></a> and <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.nulls_first" title="sqlalchemy.sql.expression.nulls_first"><code class="xref py py-func docutils literal notranslate"><span class="pre">nulls_first()</span></code></a> functions were available, but
the legacy ones were inadvertently removed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9390">#9390</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-schema">
<h3>schema<a class="headerlink" href="#change-2.0.5.post1-schema" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-9"><span class="target" id="change-acf4354f24b5e81593f394daea11adf2"><strong>[schema]</strong> <a class="changelog-reference headerlink reference internal" href="#change-acf4354f24b5e81593f394daea11adf2">¶</a></span><p>Validate that when provided the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.params.schema" title="sqlalchemy.schema.MetaData"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">MetaData.schema</span></code></a>
argument of <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> is a string.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-typing">
<h3>typing<a class="headerlink" href="#change-2.0.5.post1-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-10"><span class="target" id="change-25d0fcf526871cefab4888b5e1dddd45"><strong>[typing] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-25d0fcf526871cefab4888b5e1dddd45">¶</a></span><p>Exported the type returned by
<a class="reference internal" href="../orm/contextual.html#sqlalchemy.orm.scoped_session.query_property" title="sqlalchemy.orm.scoped_session.query_property"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.query_property()</span></code></a> using a new public type
<a class="reference internal" href="../orm/contextual.html#sqlalchemy.orm.QueryPropertyDescriptor" title="sqlalchemy.orm.QueryPropertyDescriptor"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryPropertyDescriptor</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9338">#9338</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-11"><span class="target" id="change-f659a468e8f6fd83a8777305dae2267e"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f659a468e8f6fd83a8777305dae2267e">¶</a></span><p>Fixed bug where the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.scalars" title="sqlalchemy.engine.Connection.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.scalars()</span></code></a> method was not typed
as allowing a multiple-parameters list, which is now supported using
insertmanyvalues operations.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-12"><span class="target" id="change-236a1a2fbde082d963407617fde7d012"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-236a1a2fbde082d963407617fde7d012">¶</a></span><p>Improved typing for the mapping passed to <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> and
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update.values" title="sqlalchemy.sql.expression.Update.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Update.values()</span></code></a> to be more open-ended about collection type, by
indicating read-only <code class="docutils literal notranslate"><span class="pre">Mapping</span></code> instead of writeable <code class="docutils literal notranslate"><span class="pre">Dict</span></code> which would
error out on too limited of a key type.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9376">#9376</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-13"><span class="target" id="change-6646c308dc6ab37e0f701eea307da347"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6646c308dc6ab37e0f701eea307da347">¶</a></span><p>Added missing init overload to the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a> type object so
that pep-484 type checkers may properly resolve the complete type, deriving
from the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric.params.asdecimal" title="sqlalchemy.types.Numeric"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Numeric.asdecimal</span></code></a> parameter whether <code class="docutils literal notranslate"><span class="pre">Decimal</span></code>
or <code class="docutils literal notranslate"><span class="pre">float</span></code> objects will be represented.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9391">#9391</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-14"><span class="target" id="change-eb61c22205786e973f753d35f40c9a1f"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-eb61c22205786e973f753d35f40c9a1f">¶</a></span><p>Fixed typing bug where <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.from_statement" title="sqlalchemy.sql.expression.Select.from_statement"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.from_statement()</span></code></a> would not accept
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a> or <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TextualSelect" title="sqlalchemy.sql.expression.TextualSelect"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextualSelect</span></code></a> objects as a valid type.
Additionally repaired the <code class="xref py py-class docutils literal notranslate"><span class="pre">columns</span></code> method to have a
return type, which was missing.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9398">#9398</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-15"><span class="target" id="change-5d748f549f69331f99d47a79649531b3"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5d748f549f69331f99d47a79649531b3">¶</a></span><p>Fixed typing issue where <a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> would not
record the class type correctly.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9340">#9340</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.5.post1-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-16"><span class="target" id="change-ec832d5057b9d776d81dbe0573eb49ca"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ec832d5057b9d776d81dbe0573eb49ca">¶</a></span><p>Fixed issue in PostgreSQL <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> where
literal values were being compiled as bound parameters and not direct
inline values as is required for DDL.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9349">#9349</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-17"><span class="target" id="change-f1742cf247c6d0ca2f87686513f1a9ef"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f1742cf247c6d0ca2f87686513f1a9ef">¶</a></span><p>Fixed issue where the PostgreSQL <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a>
construct would not be copyable within operations such as
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.to_metadata" title="sqlalchemy.schema.Table.to_metadata"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Table.to_metadata()</span></code></a> as well as within some Alembic scenarios,
if the constraint contained textual expression elements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9401">#9401</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.5.post1-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-18"><span class="target" id="change-1d435de1d4b134a1fa30b3d9e0aa539e"><strong>[mysql] [bug] [postgresql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1d435de1d4b134a1fa30b3d9e0aa539e">¶</a></span><p>The support for pool ping listeners to receive exception events via the
<a class="reference internal" href="../core/events.html#sqlalchemy.events.DialectEvents.handle_error" title="sqlalchemy.events.DialectEvents.handle_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DialectEvents.handle_error()</span></code></a> event added in 2.0.0b1 for
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5648">#5648</a> failed to take into account dialect-specific ping routines
such as that of MySQL and PostgreSQL. The dialect feature has been reworked
so that all dialects participate within event handling.   Additionally,
a new boolean element <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.ExceptionContext.is_pre_ping" title="sqlalchemy.engine.ExceptionContext.is_pre_ping"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ExceptionContext.is_pre_ping</span></code></a> is added
which identifies if this operation is occurring within the pre-ping
operation.</p>
<p>For this release, third party dialects which implement a custom
<a class="reference internal" href="../core/internals.html#sqlalchemy.engine.Dialect.do_ping" title="sqlalchemy.engine.Dialect.do_ping"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Dialect.do_ping()</span></code></a> method can opt in to the newly improved
behavior by having their method no longer catch exceptions or check
exceptions for “is_disconnect”, instead just propagating all exceptions
outwards. Checking the exception for “is_disconnect” is now done by an
enclosing method on the default dialect, which ensures that the event hook
is invoked for all exception scenarios before testing the exception as a
“disconnect” exception. If an existing <code class="docutils literal notranslate"><span class="pre">do_ping()</span></code> method continues to
catch exceptions and check “is_disconnect”, it will continue to work as it
did previously, but <code class="docutils literal notranslate"><span class="pre">handle_error</span></code> hooks will not have access to the
exception if it isn’t propagated outwards.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5648">#5648</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-sqlite">
<h3>sqlite<a class="headerlink" href="#change-2.0.5.post1-sqlite" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-19"><span class="target" id="change-21532ee4a9b2786857d83f0141416730"><strong>[sqlite] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-21532ee4a9b2786857d83f0141416730">¶</a></span><p>Fixed regression for SQLite connections where use of the <code class="docutils literal notranslate"><span class="pre">deterministic</span></code>
parameter when establishing database functions would fail for older SQLite
versions, those prior to version 3.8.3. The version checking logic has been
improved to accommodate for this case.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9379">#9379</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.5.post1-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-20"><span class="target" id="change-08e1506a65aece70e58ede5cef7fb632"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-08e1506a65aece70e58ede5cef7fb632">¶</a></span><p>Fixed issue in the new <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype which prevented it from
working with the pymssql driver. As pymssql seems to be maintained again,
restored testing support for pymssql.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9414">#9414</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-21"><span class="target" id="change-62e5ff4844ab349133419c551ccae674"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-62e5ff4844ab349133419c551ccae674">¶</a></span><p>Tweaked the pymssql dialect to take better advantage of
RETURNING for INSERT statements in order to retrieve last inserted primary
key values, in the same way as occurs for the mssql+pyodbc dialect right
now.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.5.post1-misc">
<h3>misc<a class="headerlink" href="#change-2.0.5.post1-misc" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.5.post1-22"><span class="target" id="change-518db9ea97667014a82f062d93da0e7b"><strong>[bug] [ext]</strong> <a class="changelog-reference headerlink reference internal" href="#change-518db9ea97667014a82f062d93da0e7b">¶</a></span><p>Fixed issue in automap where calling <a class="reference internal" href="../orm/extensions/automap.html#sqlalchemy.ext.automap.AutomapBase.prepare" title="sqlalchemy.ext.automap.AutomapBase.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AutomapBase.prepare()</span></code></a>
from a specific mapped class, rather than from the
<a class="reference internal" href="../orm/extensions/automap.html#sqlalchemy.ext.automap.AutomapBase" title="sqlalchemy.ext.automap.AutomapBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutomapBase</span></code></a> directly, would not use the correct base
class when automap detected new tables, instead using the given class,
leading to mappers trying to configure inheritance. While one should
normally call <a class="reference internal" href="../orm/extensions/automap.html#sqlalchemy.ext.automap.AutomapBase.prepare" title="sqlalchemy.ext.automap.AutomapBase.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AutomapBase.prepare()</span></code></a> from the base in any
case, it shouldn’t misbehave that badly when called from a subclass.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9367">#9367</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.5.post1-23"><span class="target" id="change-016036b57e0555b2d584c9134e5bb374"><strong>[bug] [ext] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-016036b57e0555b2d584c9134e5bb374">¶</a></span><p>Fixed regression caused by typing added to <code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.mutable</span></code> for
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8667">#8667</a>, where the semantics of the <code class="docutils literal notranslate"><span class="pre">.pop()</span></code> method changed such
that the method was non-working. Pull request courtesy Nils Philippsen.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9380">#9380</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.4">
<h2 class="release-version">2.0.4<a class="headerlink" href="#change-2.0.4" title="Link to this heading">¶</a></h2>
Released: February 17, 2023<section id="change-2.0.4-orm">
<h3>orm<a class="headerlink" href="#change-2.0.4-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.4-0"><span class="target" id="change-5b162b7b616c7a6a29fb9e09d3a15cf4"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5b162b7b616c7a6a29fb9e09d3a15cf4">¶</a></span><p>To accommodate a change in column ordering used by ORM Declarative in
SQLAlchemy 2.0, a new parameter <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.sort_order" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.sort_order</span></code></a>
has been added that can be used to control the order of the columns defined
in the table by the ORM, for common use cases such as mixins with primary
key columns that should appear first in tables. The change notes at
<a class="reference internal" href="whatsnew_20.html#change-9297"><span class="std std-ref">ORM Declarative Applies Column Orders Differently; Control behavior using sort_order</span></a> illustrate the default change in ordering behavior
(which is part of all SQLAlchemy 2.0 releases) as well as use of the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.sort_order" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.sort_order</span></code></a> to control column ordering when
using mixins and multiple classes (new in 2.0.4).</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-9297"><span class="std std-ref">ORM Declarative Applies Column Orders Differently; Control behavior using sort_order</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9297">#9297</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.4-1"><span class="target" id="change-06f47a1bde2bdbafefe58d9307b20007"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-06f47a1bde2bdbafefe58d9307b20007">¶</a></span><p>The <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></a> method will now immediately load a
relationship-bound attribute that is explicitly named within the
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh.params.attribute_names" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.refresh.attribute_names</span></code></a> collection even if it is
currently linked to the “select” loader, which normally is a “lazy” loader
that does not fire off during a refresh. The “lazy loader” strategy will
now detect that the operation is specifically a user-initiated
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></a> operation which named this attribute
explicitly, and will then call upon the “immediateload” strategy to
actually emit SQL to load the attribute. This should be helpful in
particular for some asyncio situations where the loading of an unloaded
lazy-loaded attribute must be forced, without using the actual lazy-loading
attribute pattern not supported in asyncio.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9298">#9298</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.4-2"><span class="target" id="change-72d33795f00a083b7ff546e658671b15"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-72d33795f00a083b7ff546e658671b15">¶</a></span><p>Fixed regression introduced in version 2.0.2 due to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9217">#9217</a> where
using DML RETURNING statements, as well as
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.from_statement" title="sqlalchemy.sql.expression.Select.from_statement"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.from_statement()</span></code></a> constructs as was “fixed” in
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9217">#9217</a>, in conjunction with ORM mapped classes that used
expressions such as with <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>, would lead to an
internal error within Core where it would attempt to match the expression
by name. The fix repairs the Core issue, and also adjusts the fix in
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9217">#9217</a> to not take effect for the DML RETURNING use case, where it
adds unnecessary overhead.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9273">#9273</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.4-3"><span class="target" id="change-e8e6c8321bf5c34152c8497689df7ba8"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e8e6c8321bf5c34152c8497689df7ba8">¶</a></span><p>Marked the internal <code class="docutils literal notranslate"><span class="pre">EvaluatorCompiler</span></code> module as private to the ORM, and
renamed it to <code class="docutils literal notranslate"><span class="pre">_EvaluatorCompiler</span></code>. For users that may have been relying
upon this, the name <code class="docutils literal notranslate"><span class="pre">EvaluatorCompiler</span></code> is still present, however this
use is not supported and will be removed in a future release.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.4-orm-declarative">
<h3>orm declarative<a class="headerlink" href="#change-2.0.4-orm-declarative" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.4-4"><span class="target" id="change-d39de34f724bc8c7ce7037ec5531bca3"><strong>[usecase] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d39de34f724bc8c7ce7037ec5531bca3">¶</a></span><p>Added new parameter <code class="docutils literal notranslate"><span class="pre">dataclasses_callable</span></code> to both the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> class as well as the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.mapped_as_dataclass" title="sqlalchemy.orm.registry.mapped_as_dataclass"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.mapped_as_dataclass()</span></code></a> method which allows an
alternative callable to Python <code class="docutils literal notranslate"><span class="pre">dataclasses.dataclass</span></code> to be used in
order to produce dataclasses. The use case here is to drop in Pydantic’s
dataclass function instead. Adjustments have been made to the mixin support
added for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9179">#9179</a> in version 2.0.1 so that the <code class="docutils literal notranslate"><span class="pre">__annotations__</span></code>
collection of the mixin is rewritten to not include the
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> container, in the same way as occurs with mapped
classes, so that the Pydantic dataclasses constructor is not exposed to
unknown types.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/dataclasses.html#dataclasses-pydantic"><span class="std std-ref">Integrating with Alternate Dataclass Providers such as Pydantic</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9266">#9266</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.4-sql">
<h3>sql<a class="headerlink" href="#change-2.0.4-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.4-5"><span class="target" id="change-358ed7ed8249fdc8bb0bdbbdd8b1bf98"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-358ed7ed8249fdc8bb0bdbbdd8b1bf98">¶</a></span><p>Fixed issue where element types of a tuple value would be hardcoded to take
on the types from a compared-to tuple, when the comparison were using the
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.in_" title="sqlalchemy.sql.expression.ColumnOperators.in_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.in_()</span></code></a> operator. This was inconsistent with the usual
way that types are determined for a binary expression, which is that the
actual element type on the right side is considered first before applying
the left-hand-side type.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9313">#9313</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.4-6"><span class="target" id="change-6372f4bf4c12dc6bb79588efb73d933a"><strong>[sql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6372f4bf4c12dc6bb79588efb73d933a">¶</a></span><p>Added public property <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.autoincrement_column" title="sqlalchemy.schema.Table.autoincrement_column"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.autoincrement_column</span></code></a> that
returns the column identified as autoincrementing in the column.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9277">#9277</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.4-typing">
<h3>typing<a class="headerlink" href="#change-2.0.4-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.4-7"><span class="target" id="change-202f39958b58362098e346325a12bb53"><strong>[typing] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-202f39958b58362098e346325a12bb53">¶</a></span><p>Improved the typing support for the <a class="reference internal" href="../orm/extensions/hybrid.html"><span class="std std-ref">Hybrid Attributes</span></a>
extension, updated all documentation to use ORM Annotated Declarative
mappings, and added a new modifier called <a class="reference internal" href="../orm/extensions/hybrid.html#sqlalchemy.ext.hybrid.hybrid_property.inplace" title="sqlalchemy.ext.hybrid.hybrid_property.inplace"><code class="xref py py-attr docutils literal notranslate"><span class="pre">hybrid_property.inplace</span></code></a>.
This modifier provides a way to alter the state of a <a class="reference internal" href="../orm/extensions/hybrid.html#sqlalchemy.ext.hybrid.hybrid_property" title="sqlalchemy.ext.hybrid.hybrid_property"><code class="xref py py-class docutils literal notranslate"><span class="pre">hybrid_property</span></code></a>
<strong>in place</strong>, which is essentially what very early versions of hybrids
did, before SQLAlchemy version 1.2.0 <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/3912">#3912</a> changed this to
remove in-place mutation.  This in-place mutation is now restored on an
<strong>opt-in</strong> basis to allow a single hybrid to have multiple methods
set up, without the need to name all the methods the same and without the
need to carefully “chain” differently-named methods in order to maintain
the composition.  Typing tools such as Mypy and Pyright do not allow
same-named methods on a class, so with this change a succinct method
of setting up hybrids with typing support is restored.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/extensions/hybrid.html#hybrid-pep484-naming"><span class="std std-ref">Using inplace to create pep-484 compliant hybrid properties</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9321">#9321</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.4-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.4-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.4-8"><span class="target" id="change-e77bc0af3717d1651ac501371a6cb3a7"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e77bc0af3717d1651ac501371a6cb3a7">¶</a></span><p>Adjusted the behavior of the <code class="docutils literal notranslate"><span class="pre">thick_mode</span></code> parameter for the
<a class="reference internal" href="../dialects/oracle.html#oracledb"><span class="std std-ref">python-oracledb</span></a> dialect to correctly accept <code class="docutils literal notranslate"><span class="pre">False</span></code> as a value.
Previously, only <code class="docutils literal notranslate"><span class="pre">None</span></code> would indicate that thick mode should be
disabled.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9295">#9295</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.3">
<h2 class="release-version">2.0.3<a class="headerlink" href="#change-2.0.3" title="Link to this heading">¶</a></h2>
Released: February 9, 2023<section id="change-2.0.3-sql">
<h3>sql<a class="headerlink" href="#change-2.0.3-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.3-0"><span class="target" id="change-f139b1a4ca4b3b494c0ae4a66d893353"><strong>[sql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f139b1a4ca4b3b494c0ae4a66d893353">¶</a></span><p>Fixed critical regression in SQL expression formulation in the 2.0 series
due to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7744">#7744</a> which improved support for SQL expressions that
contained many elements against the same operator repeatedly; parenthesis
grouping would be lost with expression elements beyond the first two
elements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9271">#9271</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.3-typing">
<h3>typing<a class="headerlink" href="#change-2.0.3-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.3-1"><span class="target" id="change-9e2226616518d49d9afad335df23d0f5"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9e2226616518d49d9afad335df23d0f5">¶</a></span><p>Remove <code class="docutils literal notranslate"><span class="pre">typing.Self</span></code> workaround, now using <span class="target" id="index-4"></span><a class="pep reference external" href="https://peps.python.org/pep-0673/"><strong>PEP 673</strong></a> for most methods
that return <code class="docutils literal notranslate"><span class="pre">Self</span></code>. As a consequence of this change <code class="docutils literal notranslate"><span class="pre">mypy&gt;=1.0.0</span></code> is
now required to type check SQLAlchemy code.
Pull request courtesy Yurii Karabas.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9254">#9254</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.2">
<h2 class="release-version">2.0.2<a class="headerlink" href="#change-2.0.2" title="Link to this heading">¶</a></h2>
Released: February 6, 2023<section id="change-2.0.2-orm">
<h3>orm<a class="headerlink" href="#change-2.0.2-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.2-0"><span class="target" id="change-4084d0c52bf425233da4709753dd7d04"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4084d0c52bf425233da4709753dd7d04">¶</a></span><p>Added new event hook <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.MapperEvents.after_mapper_constructed" title="sqlalchemy.orm.MapperEvents.after_mapper_constructed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_mapper_constructed()</span></code></a>,
which supplies an event hook to take place right as the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> object has been fully constructed, but before the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.configure" title="sqlalchemy.orm.registry.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.configure()</span></code></a> call has been called. This allows code that
can create additional mappings and table structures based on the initial
configuration of a <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>, which also integrates within
Declarative configuration. Previously, when using Declarative, where the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> object is created within the class creation process,
there was no documented means of running code at this point.  The change
is to immediately benefit custom mapping schemes such as that
of the <a class="reference internal" href="../orm/examples.html#examples-versioned-history"><span class="std std-ref">Versioning with a History Table</span></a> example, which generate additional
mappers and tables in response to the creation of mapped classes.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9220">#9220</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.2-1"><span class="target" id="change-45fe5664c88893d899c991ca3675142c"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-45fe5664c88893d899c991ca3675142c">¶</a></span><p>The infrequently used <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.iterate_properties" title="sqlalchemy.orm.Mapper.iterate_properties"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Mapper.iterate_properties</span></code></a> attribute and
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.get_property" title="sqlalchemy.orm.Mapper.get_property"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Mapper.get_property()</span></code></a> method, which are primarily used
internally, no longer implicitly invoke the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.configure" title="sqlalchemy.orm.registry.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.configure()</span></code></a>
process. Public access to these methods is extremely rare and the only
benefit to having <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.configure" title="sqlalchemy.orm.registry.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.configure()</span></code></a> would have been allowing
“backref” properties be present in these collections. In order to support
the new <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.MapperEvents.after_mapper_constructed" title="sqlalchemy.orm.MapperEvents.after_mapper_constructed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_mapper_constructed()</span></code></a> event, iteration
and access to the internal <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.MapperProperty" title="sqlalchemy.orm.MapperProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">MapperProperty</span></code></a> objects is now
possible without triggering an implicit configure of the mapper itself.</p>
<p>The more-public facing route to iteration of all mapper attributes, the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.attrs" title="sqlalchemy.orm.Mapper.attrs"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Mapper.attrs</span></code></a> collection and similar, will still implicitly
invoke the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.configure" title="sqlalchemy.orm.registry.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.configure()</span></code></a> step thus making backref
attributes available.</p>
<p>In all cases, the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.configure" title="sqlalchemy.orm.registry.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.configure()</span></code></a> is always available to
be called directly.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9220">#9220</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.2-2"><span class="target" id="change-b7f015babd1e7ffdbe70fd5aca46a708"><strong>[orm] [bug] [ression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b7f015babd1e7ffdbe70fd5aca46a708">¶</a></span><p>Fixed obscure ORM inheritance issue caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8705">#8705</a> where some
scenarios of inheriting mappers that indicated groups of columns from the
local table and the inheriting table together under a
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a> would nonetheless warn that properties of the
same name were being combined implicitly.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9232">#9232</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.2-3"><span class="target" id="change-b0232d356a786e65d803f99a1483fbf7"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b0232d356a786e65d803f99a1483fbf7">¶</a></span><p>Fixed regression where using the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.version_id_col" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.version_id_col</span></code></a>
feature with a regular Python-side incrementing column would fail to work
for SQLite and other databases that don’t support “rowcount” with
“RETURNING”, as “RETURNING” would be assumed for such columns even though
that’s not what actually takes place.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9228">#9228</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.2-4"><span class="target" id="change-c767888bc21f8a5bf732c807cefe9311"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c767888bc21f8a5bf732c807cefe9311">¶</a></span><p>Fixed regression when using <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.from_statement" title="sqlalchemy.sql.expression.Select.from_statement"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.from_statement()</span></code></a> in an ORM
context, where matching of columns to SQL labels based on name alone was
disabled for ORM-statements that weren’t fully textual. This would prevent
arbitrary SQL expressions with column-name labels from matching up to the
entity to be loaded, which previously would work within the 1.4
and previous series, so the previous behavior has been restored.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9217">#9217</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.2-orm-declarative">
<h3>orm declarative<a class="headerlink" href="#change-2.0.2-orm-declarative" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.2-5"><span class="target" id="change-62dcace2a3e835757cb30749e00836ed"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-62dcace2a3e835757cb30749e00836ed">¶</a></span><p>Fixed regression caused by the fix for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9171">#9171</a>, which itself was
fixing a regression, involving the mechanics of <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> on classes
that extend from <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase" title="sqlalchemy.orm.DeclarativeBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeBase</span></code></a>. The change made it such
that <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> was applied to the user-defined base if there were no
<code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method directly on the class. This has been adjusted so that
<code class="docutils literal notranslate"><span class="pre">__init__()</span></code> is applied only if no other class in the hierarchy of the
user-defined base has an <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method. This again allows
user-defined base classes based on <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase" title="sqlalchemy.orm.DeclarativeBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeBase</span></code></a> to include
mixins that themselves include a custom <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9249">#9249</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.2-6"><span class="target" id="change-b4897bc9f7a27fb69bd2f406f6a26f5e"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b4897bc9f7a27fb69bd2f406f6a26f5e">¶</a></span><p>Fixed issue in ORM Declarative Dataclass mappings related to newly added
support for mixins added in 2.0.1 via <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9179">#9179</a>, where a combination
of using mixins plus ORM inheritance would mis-classify fields in some
cases leading to field-level dataclass arguments such as <code class="docutils literal notranslate"><span class="pre">init=False</span></code> being
lost.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9226">#9226</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.2-7"><span class="target" id="change-ec37e8b32aca828b26a8989c0f01719e"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ec37e8b32aca828b26a8989c0f01719e">¶</a></span><p>Repaired ORM Declarative mappings to allow for the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.primary_key" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.primary_key</span></code></a> parameter to be specified within
<code class="docutils literal notranslate"><span class="pre">__mapper_args__</span></code> when using <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>. Despite this
usage being directly in the 2.0 documentation, the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> was
not accepting the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct in this context. Ths
feature was already working for the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.version_id_col" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.version_id_col</span></code></a>
and <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.polymorphic_on" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_on</span></code></a> parameters.</p>
<p>As part of this change, the <code class="docutils literal notranslate"><span class="pre">__mapper_args__</span></code> attribute may be specified
without using <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr" title="sqlalchemy.orm.declared_attr"><code class="xref py py-func docutils literal notranslate"><span class="pre">declared_attr()</span></code></a> on a non-mapped mixin class,
including a <code class="docutils literal notranslate"><span class="pre">&quot;primary_key&quot;</span></code> entry that refers to <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
or <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> objects locally present on the mixin;
Declarative will also translate these columns into the correct ones for a
particular mapped class. This again was working already for the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.version_id_col" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.version_id_col</span></code></a> and
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.polymorphic_on" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_on</span></code></a> parameters.  Additionally,
elements within <code class="docutils literal notranslate"><span class="pre">&quot;primary_key&quot;</span></code> may be indicated as string names of
existing mapped properties.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9240">#9240</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.2-8"><span class="target" id="change-b1075d5ccf4721497a7bc9c62e139086"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b1075d5ccf4721497a7bc9c62e139086">¶</a></span><p>An explicit error is raised if a mapping attempts to mix the use of
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> with
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.mapped_as_dataclass" title="sqlalchemy.orm.registry.mapped_as_dataclass"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.mapped_as_dataclass()</span></code></a> within the same class hierarchy,
as this produces issues with the dataclass function being applied at the
wrong time to the mapped class, leading to errors during the mapping
process.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9211">#9211</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.2-examples">
<h3>examples<a class="headerlink" href="#change-2.0.2-examples" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.2-9"><span class="target" id="change-dd1c7e87bc85230ddc5c72b167384763"><strong>[examples] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-dd1c7e87bc85230ddc5c72b167384763">¶</a></span><p>Reworked the <a class="reference internal" href="../orm/examples.html#examples-versioned-history"><span class="std std-ref">Versioning with a History Table</span></a> to work with
version 2.0, while at the same time improving the overall working of
this example to use newer APIs, including a newly added hook
<a class="reference internal" href="../orm/events.html#sqlalchemy.orm.MapperEvents.after_mapper_constructed" title="sqlalchemy.orm.MapperEvents.after_mapper_constructed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_mapper_constructed()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9220">#9220</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.2-sql">
<h3>sql<a class="headerlink" href="#change-2.0.2-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.2-10"><span class="target" id="change-2157b4c9cb72d6816c347c11dcd47103"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2157b4c9cb72d6816c347c11dcd47103">¶</a></span><p>Added a full suite of new SQL bitwise operators, for performing
database-side bitwise expressions on appropriate data values such as
integers, bit-strings, and similar. Pull request courtesy Yegor Statkevich.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/operators.html#operators-bitwise"><span class="std std-ref">Bitwise Operators</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8780">#8780</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.2-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.2-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.2-11"><span class="target" id="change-72bab6f6b9eb1662c0f5c5030a44f184"><strong>[asyncio] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-72bab6f6b9eb1662c0f5c5030a44f184">¶</a></span><p>Repaired a regression caused by the fix for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8419">#8419</a> which caused
asyncpg connections to be reset (i.e. transaction <code class="docutils literal notranslate"><span class="pre">rollback()</span></code> called)
and returned to the pool normally in the case that the connection were not
explicitly returned to the connection pool and was instead being
intercepted by Python garbage collection, which would fail if the garbage
collection operation were being called outside of the asyncio event loop,
leading to a large amount of stack trace activity dumped into logging
and standard output.</p>
<p>The correct behavior is restored, which is that all asyncio connections
that are garbage collected due to not being explicitly returned to the
connection pool are detached from the pool and discarded, along with a
warning, rather than being returned the pool, as they cannot be reliably
reset. In the case of asyncpg connections, the asyncpg-specific
<code class="docutils literal notranslate"><span class="pre">terminate()</span></code> method will be used to end the connection more gracefully
within this process as opposed to just dropping it.</p>
<p>This change includes a small behavioral change that is hoped to be useful
for debugging asyncio applications, where the warning that’s emitted in the
case of asyncio connections being unexpectedly garbage collected has been
made slightly more aggressive by moving it outside of a <code class="docutils literal notranslate"><span class="pre">try/except</span></code>
block and into a <code class="docutils literal notranslate"><span class="pre">finally:</span></code> block, where it will emit unconditionally
regardless of whether the detach/termination operation succeeded or not. It
will also have the effect that applications or test suites which promote
Python warnings to exceptions will see this as a full exception raise,
whereas previously it was not possible for this warning to actually
propagate as an exception. Applications and test suites which need to
tolerate this warning in the interim should adjust the Python warnings
filter to allow these warnings to not raise.</p>
<p>The behavior for traditional sync connections remains unchanged, that
garbage collected connections continue to be returned to the pool normally
without emitting a warning. This will likely be changed in a future major
release to at least emit a similar warning as is emitted for asyncio
drivers, as it is a usage error for pooled connections to be intercepted by
garbage collection without being properly returned to the pool.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9237">#9237</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.2-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.2-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.2-12"><span class="target" id="change-6c00635dfe2531057e549c75e82f8f38"><strong>[mysql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6c00635dfe2531057e549c75e82f8f38">¶</a></span><p>Fixed regression caused by issue <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9058">#9058</a> which adjusted the MySQL
dialect’s <code class="docutils literal notranslate"><span class="pre">has_table()</span></code> to again use “DESCRIBE”, where the specific error
code raised by MySQL version 8 when using a non-existent schema name was
unexpected and failed to be interpreted as a boolean result.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9251">#9251</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.2-13"><span class="target" id="change-0d5c92a2cc411989e183f0e63afc3716"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0d5c92a2cc411989e183f0e63afc3716">¶</a></span><p>Added support for MySQL 8’s new <code class="docutils literal notranslate"><span class="pre">AS</span> <span class="pre">&lt;name&gt;</span> <span class="pre">ON</span> <span class="pre">DUPLICATE</span> <span class="pre">KEY</span></code> syntax when
using <a class="reference internal" href="../dialects/mysql.html#sqlalchemy.dialects.mysql.Insert.on_duplicate_key_update" title="sqlalchemy.dialects.mysql.Insert.on_duplicate_key_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_duplicate_key_update()</span></code></a>, which is required for
newer versions of MySQL 8 as the previous syntax using <code class="docutils literal notranslate"><span class="pre">VALUES()</span></code> now
emits a deprecation warning with those versions. Server version detection
is employed to determine if traditional MariaDB / MySQL &lt; 8 <code class="docutils literal notranslate"><span class="pre">VALUES()</span></code>
syntax should be used, vs. the newer MySQL 8 required syntax. Pull request
courtesy Caspar Wylie.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8626">#8626</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.2-sqlite">
<h3>sqlite<a class="headerlink" href="#change-2.0.2-sqlite" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.2-14"><span class="target" id="change-0c85663ce0190ca644249c74de8dd611"><strong>[sqlite] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0c85663ce0190ca644249c74de8dd611">¶</a></span><p>Fixed the SQLite dialect’s <code class="docutils literal notranslate"><span class="pre">has_table()</span></code> function to correctly report
False for queries that include a non-None schema name for a schema that
doesn’t exist; previously, a database error was raised.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9251">#9251</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.1">
<h2 class="release-version">2.0.1<a class="headerlink" href="#change-2.0.1" title="Link to this heading">¶</a></h2>
Released: February 1, 2023<section id="change-2.0.1-orm">
<h3>orm<a class="headerlink" href="#change-2.0.1-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.1-0"><span class="target" id="change-3873250d5eb3a20ad636393f2a7e93cd"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3873250d5eb3a20ad636393f2a7e93cd">¶</a></span><p>Fixed regression where ORM models that used joined table inheritance with a
composite foreign key would encounter an internal error in the mapper
internals.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9164">#9164</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-1"><span class="target" id="change-59a75cfad96dfb183e2457a702e17855"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-59a75cfad96dfb183e2457a702e17855">¶</a></span><p>Improved the error reporting when linking strategy options from a base
class to another attribute that’s off a subclass, where <code class="docutils literal notranslate"><span class="pre">of_type()</span></code>
should be used. Previously, when <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.Load.options" title="sqlalchemy.orm.Load.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.options()</span></code></a> is used, the message
would lack informative detail that <code class="docutils literal notranslate"><span class="pre">of_type()</span></code> should be used, which was
not the case when linking the options directly. The informative detail now
emits even if <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.Load.options" title="sqlalchemy.orm.Load.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.options()</span></code></a> is used.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9182">#9182</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.1-orm-declarative">
<h3>orm declarative<a class="headerlink" href="#change-2.0.1-orm-declarative" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.1-2"><span class="target" id="change-2546e3140f9b16ea9b19496d996accbe"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2546e3140f9b16ea9b19496d996accbe">¶</a></span><p>Added support for <span class="target" id="index-5"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> <code class="docutils literal notranslate"><span class="pre">NewType</span></code> to be used in the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a> as well as within
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> constructs. These types will behave in the same way as
custom subclasses of types right now; they must appear explicitly within
the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a> to be mapped.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9175">#9175</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-3"><span class="target" id="change-c35566767e596bb56954f885049a247d"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c35566767e596bb56954f885049a247d">¶</a></span><p>When using the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> superclass, all classes within
the hierarchy that are subclasses of this class will now be run through the
<code class="docutils literal notranslate"><span class="pre">&#64;dataclasses.dataclass</span></code> function whether or not they are actually
mapped, so that non-ORM fields declared on non-mapped classes within the
hierarchy will be used when mapped subclasses are turned into dataclasses.
This behavior applies both to intermediary classes mapped with
<code class="docutils literal notranslate"><span class="pre">__abstract__</span> <span class="pre">=</span> <span class="pre">True</span></code> as well as to the user-defined declarative base
itself, assuming <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> is present as a superclass for
these classes.</p>
<p>This allows non-mapped attributes such as <code class="docutils literal notranslate"><span class="pre">InitVar</span></code> declarations on
superclasses to be used, without the need to run the
<code class="docutils literal notranslate"><span class="pre">&#64;dataclasses.dataclass</span></code> decorator explicitly on each non-mapped class.
The new behavior is considered as correct as this is what the <span class="target" id="index-6"></span><a class="pep reference external" href="https://peps.python.org/pep-0681/"><strong>PEP 681</strong></a>
implementation expects when using a superclass to indicate dataclass
behavior.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9179">#9179</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-4"><span class="target" id="change-e3154c90227b902fdabaac44e7c590f7"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e3154c90227b902fdabaac44e7c590f7">¶</a></span><p>Added support for <span class="target" id="index-7"></span><a class="pep reference external" href="https://peps.python.org/pep-0586/"><strong>PEP 586</strong></a> <code class="docutils literal notranslate"><span class="pre">Literal[]</span></code> to be used in the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a> as well as within
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> constructs. To use custom types such as these, they must
appear explicitly within the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a>
to be mapped.  Pull request courtesy Frederik Aalund.</p>
<p>As part of this change, the support for <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.sql.sqltypes.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> in the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a> has been expanded to include
support for <code class="docutils literal notranslate"><span class="pre">Literal[]</span></code> types consisting of string values to be used,
in addition to <code class="docutils literal notranslate"><span class="pre">enum.Enum</span></code> datatypes.    If a <code class="docutils literal notranslate"><span class="pre">Literal[]</span></code> datatype
is used within <code class="docutils literal notranslate"><span class="pre">Mapped[]</span></code> that is not linked in
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a> to a specific datatype,
a <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.sql.sqltypes.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> will be used by default.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/declarative_tables.html#orm-declarative-mapped-column-enums"><span class="std std-ref">Using Python Enum or pep-586 Literal types in the type map</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9187">#9187</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-5"><span class="target" id="change-57b4fc6a3b0e28347ce9a314bee99805"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-57b4fc6a3b0e28347ce9a314bee99805">¶</a></span><p>Fixed issue involving the use of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.sql.sqltypes.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> within the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a> where the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.native_enum" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.native_enum</span></code></a> parameter would not be correctly
copied to the mapped column datatype, if it were overridden
as stated in the documentation to set this parameter to False.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9200">#9200</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-6"><span class="target" id="change-e6567d7ddef8d694381f64ea6b077485"><strong>[bug] [orm declarative] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e6567d7ddef8d694381f64ea6b077485">¶</a></span><p>Fixed regression in <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase" title="sqlalchemy.orm.DeclarativeBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeBase</span></code></a> class where the registry’s
default constructor would not be applied to the base itself, which is
different from how the previous <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declarative_base" title="sqlalchemy.orm.declarative_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">declarative_base()</span></code></a> construct
works. This would prevent a mapped class with its own <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method
from calling <code class="docutils literal notranslate"><span class="pre">super().__init__()</span></code> in order to access the registry’s
default constructor and automatically populate attributes, instead hitting
<code class="docutils literal notranslate"><span class="pre">object.__init__()</span></code> which would raise a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> on any arguments.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9171">#9171</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-7"><span class="target" id="change-9f9dc84f7de6da79efbf57d5c6a45b4e"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9f9dc84f7de6da79efbf57d5c6a45b4e">¶</a></span><p>Improved the ruleset used to interpret <span class="target" id="index-8"></span><a class="pep reference external" href="https://peps.python.org/pep-0593/"><strong>PEP 593</strong></a> <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> types when
used with Annotated Declarative mapping, the inner type will be checked for
“Optional” in all cases which will be added to the criteria by which the
column is set as “nullable” or not; if the type within the <code class="docutils literal notranslate"><span class="pre">Annotated</span></code>
container is optional (or unioned with <code class="docutils literal notranslate"><span class="pre">None</span></code>), the column will be
considered nullable if there are no explicit
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.nullable" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.nullable</span></code></a> parameters overriding it.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9177">#9177</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.1-sql">
<h3>sql<a class="headerlink" href="#change-2.0.1-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.1-8"><span class="target" id="change-420ebc4c98125181feb7831ac4423185"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-420ebc4c98125181feb7831ac4423185">¶</a></span><p>Corrected the fix for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7664">#7664</a>, released in version 2.0.0, to also
include <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropSchema" title="sqlalchemy.schema.DropSchema"><code class="xref py py-class docutils literal notranslate"><span class="pre">DropSchema</span></code></a> which was inadvertently missed in this fix,
allowing stringification without a dialect. The fixes for both constructs
is backported to the 1.4 series as of 1.4.47.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7664">#7664</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-9"><span class="target" id="change-22732c6b5b36b515ae76a03642d5e681"><strong>[sql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-22732c6b5b36b515ae76a03642d5e681">¶</a></span><p>Fixed regression related to the implementation for the new
“insertmanyvalues” feature where an internal <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> would occur in
arrangements where a <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> would be referenced inside
of another <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> via a CTE; made additional repairs for this
use case for positional dialects such as asyncpg when using
“insertmanyvalues”.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9173">#9173</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.1-typing">
<h3>typing<a class="headerlink" href="#change-2.0.1-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.1-10"><span class="target" id="change-d6e72948cc4381733a6e967a4b00003b"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d6e72948cc4381733a6e967a4b00003b">¶</a></span><p>Opened up typing on <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.with_for_update.params.of" title="sqlalchemy.sql.expression.Select.with_for_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Select.with_for_update.of</span></code></a> to also accept
table and mapped class arguments, as seems to be available for the MySQL
dialect.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9174">#9174</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-11"><span class="target" id="change-a515324bf64c856e053590c422c51dd4"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a515324bf64c856e053590c422c51dd4">¶</a></span><p>Fixed typing for limit/offset methods including <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.limit" title="sqlalchemy.sql.expression.Select.limit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.limit()</span></code></a>,
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.offset" title="sqlalchemy.sql.expression.Select.offset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.offset()</span></code></a>, <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.limit" title="sqlalchemy.orm.Query.limit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.limit()</span></code></a>, <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.offset" title="sqlalchemy.orm.Query.offset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.offset()</span></code></a>
to allow <code class="docutils literal notranslate"><span class="pre">None</span></code>, which is the documented API to “cancel” the current
limit/offset.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9183">#9183</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-12"><span class="target" id="change-d58d9ec84cf89cda7833406a7e0bbbf5"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d58d9ec84cf89cda7833406a7e0bbbf5">¶</a></span><p>Fixed typing issue where <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> objects typed as
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> wouldn’t be accepted in schema constraints such as
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a>, <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a> or
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9170">#9170</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.1-13"><span class="target" id="change-863f1539860bf1441183ee64e435b5ad"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-863f1539860bf1441183ee64e435b5ad">¶</a></span><p>Fixed typing for <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.cast" title="sqlalchemy.sql.expression.ColumnElement.cast"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.cast()</span></code></a> to accept
both <code class="docutils literal notranslate"><span class="pre">Type[TypeEngine[T]]</span></code> and <code class="docutils literal notranslate"><span class="pre">TypeEngine[T]</span></code>; previously
only <code class="docutils literal notranslate"><span class="pre">TypeEngine[T]</span></code> was accepted.  Pull request courtesy Yurii Karabas.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9156">#9156</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.0">
<h2 class="release-version">2.0.0<a class="headerlink" href="#change-2.0.0" title="Link to this heading">¶</a></h2>
Released: January 26, 2023<section id="change-2.0.0-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0-0"><span class="target" id="change-4df19b15fd69f063d92e37ab979dd793"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4df19b15fd69f063d92e37ab979dd793">¶</a></span><p>Improved the notification of warnings that are emitted within the configure
mappers or flush process, which are often invoked as part of a different
operation, to add additional context to the message that indicates one of
these operations as the source of the warning within operations that may
not be obviously related.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7305">#7305</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0-orm-extensions">
<h3>orm extensions<a class="headerlink" href="#change-2.0.0-orm-extensions" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0-1"><span class="target" id="change-57920e608b183ae1efdf4589c0e2ea90"><strong>[feature] [orm extensions]</strong> <a class="changelog-reference headerlink reference internal" href="#change-57920e608b183ae1efdf4589c0e2ea90">¶</a></span><p>Added new option to horizontal sharding API
<a class="reference internal" href="../orm/extensions/horizontal_shard.html#sqlalchemy.ext.horizontal_shard.set_shard_id" title="sqlalchemy.ext.horizontal_shard.set_shard_id"><code class="xref py py-class docutils literal notranslate"><span class="pre">set_shard_id</span></code></a> which sets the effective shard identifier
to query against, for both the primary query as well as for all secondary
loaders including relationship eager loaders as well as relationship and
column lazy loaders.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7226">#7226</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0-2"><span class="target" id="change-2764d1de0487d1967b6e9eaf3e4c34d6"><strong>[usecase] [orm extensions]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2764d1de0487d1967b6e9eaf3e4c34d6">¶</a></span><p>Added new feature to <a class="reference internal" href="../orm/extensions/automap.html#sqlalchemy.ext.automap.AutomapBase" title="sqlalchemy.ext.automap.AutomapBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutomapBase</span></code></a> for autoload of classes across
multiple schemas which may have overlapping names, by providing a
<a class="reference internal" href="../orm/extensions/automap.html#sqlalchemy.ext.automap.AutomapBase.prepare.params.modulename_for_table" title="sqlalchemy.ext.automap.AutomapBase.prepare"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AutomapBase.prepare.modulename_for_table</span></code></a> parameter which
allows customization of the <code class="docutils literal notranslate"><span class="pre">__module__</span></code> attribute of newly generated
classes, as well as a new collection <a class="reference internal" href="../orm/extensions/automap.html#sqlalchemy.ext.automap.AutomapBase.by_module" title="sqlalchemy.ext.automap.AutomapBase.by_module"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AutomapBase.by_module</span></code></a>, which
stores a dot-separated namespace of module names linked to classes based on
the <code class="docutils literal notranslate"><span class="pre">__module__</span></code> attribute.</p>
<p>Additionally, the <a class="reference internal" href="../orm/extensions/automap.html#sqlalchemy.ext.automap.AutomapBase.prepare" title="sqlalchemy.ext.automap.AutomapBase.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AutomapBase.prepare()</span></code></a> method may now be invoked
any number of times, with or without reflection enabled; only newly
added tables that were not previously mapped will be processed on each
call.   Previously, the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.reflect" title="sqlalchemy.schema.MetaData.reflect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.reflect()</span></code></a> method would need to be
called explicitly each time.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/extensions/automap.html#automap-by-module"><span class="std std-ref">Generating Mappings from Multiple Schemas</span></a> - illustrates use of both techniques at once.</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5145">#5145</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0-sql">
<h3>sql<a class="headerlink" href="#change-2.0.0-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0-3"><span class="target" id="change-f2ca3ff46c651dccd4fd080db1656ca1"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f2ca3ff46c651dccd4fd080db1656ca1">¶</a></span><p>Fixed stringify for a the <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.CreateSchema" title="sqlalchemy.schema.CreateSchema"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateSchema</span></code></a> DDL construct, which
would fail with an <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code> when stringified without a
dialect. Update: Note this fix failed to accommodate for
<a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropSchema" title="sqlalchemy.schema.DropSchema"><code class="xref py py-class docutils literal notranslate"><span class="pre">DropSchema</span></code></a>; a followup fix in version 2.0.1 repairs this
case. The fix for both elements is backported to 1.4.47.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7664">#7664</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0-4"><span class="target" id="change-f0f3384a1446f6f6ef270c36a9129dff"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f0f3384a1446f6f6ef270c36a9129dff">¶</a></span><p>Added typing for the built-in generic functions that are available from the
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal notranslate"><span class="pre">func</span></code></a> namespace, which accept a particular set of arguments and
return a particular type, such as for <code class="xref py py-class docutils literal notranslate"><span class="pre">count</span></code>,
<code class="xref py py-class docutils literal notranslate"><span class="pre">current_timestamp</span></code>, etc.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9129">#9129</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0-5"><span class="target" id="change-33b31d0adfbc49022840f1bf7c56a3e8"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-33b31d0adfbc49022840f1bf7c56a3e8">¶</a></span><p>Corrected the type passed for “lambda statements” so that a plain lambda is
accepted by mypy, pyright, others without any errors about argument types.
Additionally implemented typing for more of the public API for lambda
statements and ensured <a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.expression.StatementLambdaElement" title="sqlalchemy.sql.expression.StatementLambdaElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">StatementLambdaElement</span></code></a> is part of the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executable</span></code></a> hierarchy so it’s typed as accepted by
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9120">#9120</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0-6"><span class="target" id="change-faa1c519ee312c310d582efdfa0d0a6d"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-faa1c519ee312c310d582efdfa0d0a6d">¶</a></span><p>The <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.in_" title="sqlalchemy.sql.expression.ColumnOperators.in_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.in_()</span></code></a> and
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.not_in" title="sqlalchemy.sql.expression.ColumnOperators.not_in"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.not_in()</span></code></a> methods are typed to include
<code class="docutils literal notranslate"><span class="pre">Iterable[Any]</span></code> rather than <code class="docutils literal notranslate"><span class="pre">Sequence[Any]</span></code> for more flexibility in
argument type.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9122">#9122</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0-7"><span class="target" id="change-82224435ac391a3431c3f83ea15a41a6"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-82224435ac391a3431c3f83ea15a41a6">¶</a></span><p>The <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.or_" title="sqlalchemy.sql.expression.or_"><code class="xref py py-func docutils literal notranslate"><span class="pre">or_()</span></code></a> and <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.and_" title="sqlalchemy.sql.expression.and_"><code class="xref py py-func docutils literal notranslate"><span class="pre">and_()</span></code></a> from a typing perspective
require the first argument to be present, however these functions still
accept zero arguments which will emit a deprecation warning at runtime.
Typing is also added to support sending the fixed literal <code class="docutils literal notranslate"><span class="pre">False</span></code> for
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.or_" title="sqlalchemy.sql.expression.or_"><code class="xref py py-func docutils literal notranslate"><span class="pre">or_()</span></code></a> and <code class="docutils literal notranslate"><span class="pre">True</span></code> for <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.and_" title="sqlalchemy.sql.expression.and_"><code class="xref py py-func docutils literal notranslate"><span class="pre">and_()</span></code></a> as the first argument
only, however the documentation now indicates sending the
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.false" title="sqlalchemy.sql.expression.false"><code class="xref py py-func docutils literal notranslate"><span class="pre">false()</span></code></a> and <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.true" title="sqlalchemy.sql.expression.true"><code class="xref py py-func docutils literal notranslate"><span class="pre">true()</span></code></a> constructs in these cases as a
more explicit approach.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9123">#9123</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0-8"><span class="target" id="change-20a1840e04c8a161004acb6aa0025035"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-20a1840e04c8a161004acb6aa0025035">¶</a></span><p>Fixed typing issue where iterating over a <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object
was not correctly typed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9125">#9125</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0-9"><span class="target" id="change-015cbc18c5b14221b8097d026b9e0fb4"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-015cbc18c5b14221b8097d026b9e0fb4">¶</a></span><p>Fixed typing issue where the object type when using <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>
as a context manager were not preserved, indicating <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>
in all cases rather than the specific <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> sub-type.
Pull request courtesy Martin Baláž.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9136">#9136</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0-10"><span class="target" id="change-a8c6943d929a4808c25640cd5bfa193f"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a8c6943d929a4808c25640cd5bfa193f">¶</a></span><p>Fixed issue where using the <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.remote_side" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.remote_side</span></code></a>
and similar parameters, passing an annotated declarative object typed as
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a>, would not be accepted by the type checker.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9150">#9150</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0-11"><span class="target" id="change-4335815b5924d60f05cb4b6675824aaa"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4335815b5924d60f05cb4b6675824aaa">¶</a></span><p>Added typing to legacy operators such as <code class="docutils literal notranslate"><span class="pre">isnot()</span></code>, <code class="docutils literal notranslate"><span class="pre">notin_()</span></code>, etc.
which previously were referencing the newer operators but were not
themselves typed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9148">#9148</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.0-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0-12"><span class="target" id="change-2bb2d471352623bba3025915fc2e60e3"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2bb2d471352623bba3025915fc2e60e3">¶</a></span><p>Added support to the asyncpg dialect to return the <code class="docutils literal notranslate"><span class="pre">cursor.rowcount</span></code>
value for SELECT statements when available. While this is not a typical use
for <code class="docutils literal notranslate"><span class="pre">cursor.rowcount</span></code>, the other PostgreSQL dialects generally provide
this value. Pull request courtesy Michael Gorven.</p>
<p>This change is also <strong>backported</strong> to: 1.4.47</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9048">#9048</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.0-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0-13"><span class="target" id="change-7f756c403be73acb79d02d0c004ff568"><strong>[mysql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7f756c403be73acb79d02d0c004ff568">¶</a></span><p>Added support to MySQL index reflection to correctly reflect the
<code class="docutils literal notranslate"><span class="pre">mysql_length</span></code> dictionary, which previously was being ignored.</p>
<p>This change is also <strong>backported</strong> to: 1.4.47</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9047">#9047</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.0-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0-14"><span class="target" id="change-40596d8d5f9756f416b98f2ed2dfe2b4"><strong>[mssql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-40596d8d5f9756f416b98f2ed2dfe2b4">¶</a></span><p>The newly added comment reflection and rendering capability of the MSSQL
dialect, added in <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7844">#7844</a>, will now be disabled by default if it
cannot be determined that an unsupported backend such as Azure Synapse may
be in use; this backend does not support table and column comments and does
not support the SQL Server routines in use to generate them as well as to
reflect them. A new parameter <code class="docutils literal notranslate"><span class="pre">supports_comments</span></code> is added to the dialect
which defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, indicating that comment support should be
auto-detected. When set to <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>, the comment support is
either enabled or disabled unconditionally.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/mssql.html#mssql-comment-support"><span class="std std-ref">DDL Comment Support</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9142">#9142</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.0rc3">
<h2 class="release-version">2.0.0rc3<a class="headerlink" href="#change-2.0.0rc3" title="Link to this heading">¶</a></h2>
Released: January 18, 2023<section id="change-2.0.0rc3-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0rc3-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc3-0"><span class="target" id="change-737bfda55a6eac5997bd3bf9ebb42b65"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-737bfda55a6eac5997bd3bf9ebb42b65">¶</a></span><p>Added a new parameter to <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> called
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.polymorphic_abstract" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_abstract</span></code></a>. The purpose of this directive
is so that the ORM will not consider the class to be instantiated or loaded
directly, only subclasses. The actual effect is that the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> will prevent direct instantiation of instances
of the class and will expect that the class does not have a distinct
polymorphic identity configured.</p>
<p>In practice, the class that is mapped with
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.polymorphic_abstract" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_abstract</span></code></a> can be used as the target of a
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> as well as be used in queries; subclasses must of
course include polymorphic identities in their mappings.</p>
<p>The new parameter is automatically applied to classes that subclass
the <a class="reference internal" href="../orm/extensions/declarative/index.html#sqlalchemy.ext.declarative.AbstractConcreteBase" title="sqlalchemy.ext.declarative.AbstractConcreteBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractConcreteBase</span></code></a> class, as this class is not intended
to be instantiated.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/inheritance.html#orm-inheritance-abstract-poly"><span class="std std-ref">Building Deeper Hierarchies with polymorphic_abstract</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9060">#9060</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc3-1"><span class="target" id="change-f02418c7ad1f8c62259f4c448ba35403"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f02418c7ad1f8c62259f4c448ba35403">¶</a></span><p>Fixed issue where using a pep-593 <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type in the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a> which itself contained a
generic plain container or <code class="docutils literal notranslate"><span class="pre">collections.abc</span></code> type (e.g. <code class="docutils literal notranslate"><span class="pre">list</span></code>,
<code class="docutils literal notranslate"><span class="pre">dict</span></code>, <code class="docutils literal notranslate"><span class="pre">collections.abc.Sequence</span></code>, etc. ) as the target type would
produce an internal error when the ORM were trying to interpret the
<code class="docutils literal notranslate"><span class="pre">Annotated</span></code> instance.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9099">#9099</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc3-2"><span class="target" id="change-9dffb1dfd488e29a36c2a408ba954c30"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9dffb1dfd488e29a36c2a408ba954c30">¶</a></span><p>Added an error message when a <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> is mapped against
an abstract container type, such as <code class="docutils literal notranslate"><span class="pre">Mapped[Sequence[B]]</span></code>, without
providing the <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.container_class" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.container_class</span></code></a> parameter which
is necessary when the type is abstract. Previously the abstract
container would attempt to be instantiated at a later step and fail.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9100">#9100</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc3-sql">
<h3>sql<a class="headerlink" href="#change-2.0.0rc3-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc3-3"><span class="target" id="change-9b0081aeda9b260af31da811d5a8335a"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9b0081aeda9b260af31da811d5a8335a">¶</a></span><p>Fixed bug / regression where using <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal notranslate"><span class="pre">bindparam()</span></code></a> with the same name
as a column in the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update.values" title="sqlalchemy.sql.expression.Update.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Update.values()</span></code></a> method of <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a>, as
well as the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> method of <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> in 2.0 only,
would in some cases silently fail to honor the SQL expression in which the
parameter were presented, replacing the expression with a new parameter of
the same name and discarding any other elements of the SQL expression, such
as SQL functions, etc. The specific case would be statements that were
constructed against ORM entities rather than plain <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
instances, but would occur if the statement were invoked with a
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> or a <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
<p><a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> part of the issue was present in both 2.0 and 1.4 and is
backported to 1.4.</p>
<p>This change is also <strong>backported</strong> to: 1.4.47</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9075">#9075</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc3-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0rc3-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc3-4"><span class="target" id="change-c92886367db75f29f5935450d41da0ca"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c92886367db75f29f5935450d41da0ca">¶</a></span><p>Fixes to the annotations within the <code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.hybrid</span></code> extension for
more effective typing of user-defined methods. The typing now uses
<span class="target" id="index-9"></span><a class="pep reference external" href="https://peps.python.org/pep-0612/"><strong>PEP 612</strong></a> features, now supported by recent versions of Mypy, to maintain
argument signatures for <a class="reference internal" href="../orm/extensions/hybrid.html#sqlalchemy.ext.hybrid.hybrid_method" title="sqlalchemy.ext.hybrid.hybrid_method"><code class="xref py py-class docutils literal notranslate"><span class="pre">hybrid_method</span></code></a>. Return values for hybrid
methods are accepted as SQL expressions in contexts such as
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.where" title="sqlalchemy.sql.expression.Select.where"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.where()</span></code></a> while still supporting SQL methods.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9096">#9096</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc3-mypy">
<h3>mypy<a class="headerlink" href="#change-2.0.0rc3-mypy" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc3-5"><span class="target" id="change-72facd808b66a703e2deb28e444ccace"><strong>[mypy] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-72facd808b66a703e2deb28e444ccace">¶</a></span><p>Adjustments made to the mypy plugin to accommodate for some potential
changes being made for issue #236 sqlalchemy2-stubs when using SQLAlchemy
1.4. These changes are being kept in sync within SQLAlchemy 2.0.
The changes are also backwards compatible with older versions of
sqlalchemy2-stubs.</p>
<p>This change is also <strong>backported</strong> to: 1.4.47</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc3-6"><span class="target" id="change-78d64ce9fcdfdb4d10a59fdc68484af1"><strong>[mypy] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-78d64ce9fcdfdb4d10a59fdc68484af1">¶</a></span><p>Fixed crash in mypy plugin which could occur on both 1.4 and 2.0 versions
if a decorator for the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.mapped" title="sqlalchemy.orm.registry.mapped"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped()</span></code></a> decorator were used
that was referenced in an expression with more than two components (e.g.
<code class="docutils literal notranslate"><span class="pre">&#64;Backend.mapper_registry.mapped</span></code>). This scenario is now ignored; when
using the plugin, the decorator expression needs to be two components (i.e.
<code class="docutils literal notranslate"><span class="pre">&#64;reg.mapped</span></code>).</p>
<p>This change is also <strong>backported</strong> to: 1.4.47</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9102">#9102</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc3-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.0rc3-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc3-7"><span class="target" id="change-dd60f871b14afb9744d2526154d2ee5f"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-dd60f871b14afb9744d2526154d2ee5f">¶</a></span><p>Fixed regression where psycopg3 changed an API call as of version 3.1.8 to
expect a specific object type that was previously not enforced, breaking
connectivity for the psycopg3 dialect.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9106">#9106</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc3-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.0rc3-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc3-8"><span class="target" id="change-75c74f039bcb71849c5a1c6243bde7e4"><strong>[oracle] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-75c74f039bcb71849c5a1c6243bde7e4">¶</a></span><p>Added support for the Oracle SQL type <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span> <span class="pre">WITH</span> <span class="pre">LOCAL</span> <span class="pre">TIME</span> <span class="pre">ZONE</span></code>,
using a newly added Oracle-specific <a class="reference internal" href="../dialects/oracle.html#sqlalchemy.dialects.oracle.TIMESTAMP" title="sqlalchemy.dialects.oracle.TIMESTAMP"><code class="xref py py-class docutils literal notranslate"><span class="pre">TIMESTAMP</span></code></a> datatype.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9086">#9086</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.0rc2">
<h2 class="release-version">2.0.0rc2<a class="headerlink" href="#change-2.0.0rc2" title="Link to this heading">¶</a></h2>
Released: January 9, 2023<section id="change-2.0.0rc2-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0rc2-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc2-0"><span class="target" id="change-bacb0451900d8136d384fbac1c43a13a"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bacb0451900d8136d384fbac1c43a13a">¶</a></span><p>Fixed issue where an overly restrictive ORM mapping rule were added in 2.0
which prevented mappings against <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TableClause" title="sqlalchemy.sql.expression.TableClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">TableClause</span></code></a> objects, such as
those used in the view recipe on the wiki.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9071">#9071</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc2-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0rc2-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc2-1"><span class="target" id="change-e11c2b7afeb01fbcf7fbb2b282c5c6ce"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e11c2b7afeb01fbcf7fbb2b282c5c6ce">¶</a></span><p>The Data Class Transforms argument <code class="docutils literal notranslate"><span class="pre">field_descriptors</span></code> was renamed
to <code class="docutils literal notranslate"><span class="pre">field_specifiers</span></code> in the accepted version of PEP 681.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9067">#9067</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc2-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.0rc2-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc2-2"><span class="target" id="change-62cce8f13c78b922562bc74b1957b007"><strong>[postgresql] [json]</strong> <a class="changelog-reference headerlink reference internal" href="#change-62cce8f13c78b922562bc74b1957b007">¶</a></span><p>Implemented missing <code class="docutils literal notranslate"><span class="pre">JSONB</span></code> operations:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> using <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_match" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.path_match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.path_match()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;?</span></code> using <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_exists" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.path_exists"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.path_exists()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#-</span></code> using <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONB.Comparator.delete_path" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.delete_path"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.delete_path()</span></code></a></p></li>
</ul>
<p>Pull request courtesy of Guilherme Martins Crocetti.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7147">#7147</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc2-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.0rc2-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc2-3"><span class="target" id="change-44699c13ed6dbd572a1a4cfa1a67a347"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-44699c13ed6dbd572a1a4cfa1a67a347">¶</a></span><p>Restored the behavior of <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_table" title="sqlalchemy.engine.reflection.Inspector.has_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code></a> to report on
temporary tables for MySQL / MariaDB. This is currently the behavior for
all other included dialects, but was removed for MySQL in 1.4 due to no
longer using the DESCRIBE command; there was no documented support for temp
tables being reported by the <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_table" title="sqlalchemy.engine.reflection.Inspector.has_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code></a> method in this
version or on any previous version, so the previous behavior was undefined.</p>
<p>As SQLAlchemy 2.0 has added formal support for temp table status via
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_table" title="sqlalchemy.engine.reflection.Inspector.has_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code></a>, the MySQL /MariaDB dialect has been reverted
to use the “DESCRIBE” statement as it did in the SQLAlchemy 1.3 series and
previously, and test support is added to include MySQL / MariaDB for
this behavior.   The previous issues with ROLLBACK being emitted which
1.4 sought to improve upon don’t apply in SQLAlchemy 2.0 due to
simplifications in how <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> handles transactions.</p>
<p>DESCRIBE is necessary as MariaDB in particular has no consistently
available public information schema of any kind in order to report on temp
tables other than DESCRIBE/SHOW COLUMNS, which rely on throwing an error
in order to report no results.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9058">#9058</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc2-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.0rc2-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc2-4"><span class="target" id="change-6d016e518156d4d4379cf9e889207307"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6d016e518156d4d4379cf9e889207307">¶</a></span><p>Supported use case for foreign key constraints where the local column is
marked as “invisible”. The errors normally generated when a
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyConstraint</span></code></a> is created that check for the target column
are disabled when reflecting, and the constraint is skipped with a warning
in the same way which already occurs for an <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> with a similar
issue.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9059">#9059</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.0rc1">
<h2 class="release-version">2.0.0rc1<a class="headerlink" href="#change-2.0.0rc1" title="Link to this heading">¶</a></h2>
Released: December 28, 2022<section id="change-2.0.0rc1-general">
<h3>general<a class="headerlink" href="#change-2.0.0rc1-general" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-0"><span class="target" id="change-f668f6010d9d29c4bc2acd7c859d5d15"><strong>[general] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f668f6010d9d29c4bc2acd7c859d5d15">¶</a></span><p>Fixed regression where the base compat module was calling upon
<code class="docutils literal notranslate"><span class="pre">platform.architecture()</span></code> in order to detect some system properties,
which results in an over-broad system call against the system-level
<code class="docutils literal notranslate"><span class="pre">file</span></code> call that is unavailable under some circumstances, including
within some secure environment configurations.</p>
<p>This change is also <strong>backported</strong> to: 1.4.46</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8995">#8995</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc1-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0rc1-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-1"><span class="target" id="change-846039e02a2a5d4e1fa950c4458b6e26"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-846039e02a2a5d4e1fa950c4458b6e26">¶</a></span><p>Added a new default value for the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.eager_defaults" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.eager_defaults</span></code></a>
parameter “auto”, which will automatically fetch table default values
during a unit of work flush, if the dialect supports RETURNING for the
INSERT being run, as well as
<a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">insertmanyvalues</span></a> available. Eager fetches
for server-side UPDATE defaults, which are very uncommon, continue to only
take place if <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.eager_defaults" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.eager_defaults</span></code></a> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, as
there is no batch-RETURNING form for UPDATE statements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8889">#8889</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-2"><span class="target" id="change-c64fdcd0e8e0530d83857030651aaa5a"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c64fdcd0e8e0530d83857030651aaa5a">¶</a></span><p>Adjustments to the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> in terms of extensibility,
as well as updates to the <a class="reference internal" href="../orm/extensions/horizontal_shard.html#sqlalchemy.ext.horizontal_shard.ShardedSession" title="sqlalchemy.ext.horizontal_shard.ShardedSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShardedSession</span></code></a> extension:</p>
<ul>
<li><p><a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get" title="sqlalchemy.orm.Session.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code></a> now accepts
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get.params.bind_arguments" title="sqlalchemy.orm.Session.get"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.get.bind_arguments</span></code></a>, which in particular may be
useful when using the horizontal sharding extension.</p></li>
<li><p><a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get_bind" title="sqlalchemy.orm.Session.get_bind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get_bind()</span></code></a> accepts arbitrary kw arguments, which
assists in developing code that uses a <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> class which
overrides this method with additional arguments.</p></li>
<li><p>Added a new ORM execution option <code class="docutils literal notranslate"><span class="pre">identity_token</span></code> which may be used
to directly affect the “identity token” that will be associated with
newly loaded ORM objects.  This token is how sharding approaches
(namely the <a class="reference internal" href="../orm/extensions/horizontal_shard.html#sqlalchemy.ext.horizontal_shard.ShardedSession" title="sqlalchemy.ext.horizontal_shard.ShardedSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShardedSession</span></code></a>, but can be used in other cases
as well) separate object identities across different “shards”.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/queryguide/api.html#queryguide-identity-token"><span class="std std-ref">Identity Token</span></a></p>
</div>
</li>
<li><p>The <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> event hook may now be used
to affect all ORM-related options, including <code class="docutils literal notranslate"><span class="pre">autoflush</span></code>,
<code class="docutils literal notranslate"><span class="pre">populate_existing</span></code>, and <code class="docutils literal notranslate"><span class="pre">yield_per</span></code>; these options are re-consumed
subsequent to event hooks being invoked before they are acted upon.
Previously, options like <code class="docutils literal notranslate"><span class="pre">autoflush</span></code> would have been already evaluated
at this point. The new <code class="docutils literal notranslate"><span class="pre">identity_token</span></code> option is also supported in
this mode and is now used by the horizontal sharding extension.</p></li>
<li><p>The <a class="reference internal" href="../orm/extensions/horizontal_shard.html#sqlalchemy.ext.horizontal_shard.ShardedSession" title="sqlalchemy.ext.horizontal_shard.ShardedSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShardedSession</span></code></a> class replaces the
<a class="reference internal" href="../orm/extensions/horizontal_shard.html#sqlalchemy.ext.horizontal_shard.ShardedSession.params.id_chooser" title="sqlalchemy.ext.horizontal_shard.ShardedSession"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ShardedSession.id_chooser</span></code></a> hook with a new hook
<a class="reference internal" href="../orm/extensions/horizontal_shard.html#sqlalchemy.ext.horizontal_shard.ShardedSession.params.identity_chooser" title="sqlalchemy.ext.horizontal_shard.ShardedSession"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ShardedSession.identity_chooser</span></code></a>, which no longer relies upon
the legacy <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object.
<a class="reference internal" href="../orm/extensions/horizontal_shard.html#sqlalchemy.ext.horizontal_shard.ShardedSession.params.id_chooser" title="sqlalchemy.ext.horizontal_shard.ShardedSession"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ShardedSession.id_chooser</span></code></a> is still accepted in place of
<a class="reference internal" href="../orm/extensions/horizontal_shard.html#sqlalchemy.ext.horizontal_shard.ShardedSession.params.identity_chooser" title="sqlalchemy.ext.horizontal_shard.ShardedSession"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ShardedSession.identity_chooser</span></code></a> with a deprecation warning.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7837">#7837</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-3"><span class="target" id="change-ecd8154bc76c02e7214b123d678c82a6"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ecd8154bc76c02e7214b123d678c82a6">¶</a></span><p>The behavior of “joining an external transaction into a Session” has been
revised and improved, allowing explicit control over how the
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> will accommodate an incoming
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> that already has a transaction and possibly a
savepoint already established. The new parameter
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.join_transaction_mode" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.join_transaction_mode</span></code></a> includes a series of option
values which can accommodate the existing transaction in several ways, most
importantly allowing a <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> to operate in a fully
transactional style using savepoints exclusively, while leaving the
externally initiated transaction non-committed and active under all
circumstances, allowing test suites to rollback all changes that take place
within tests.</p>
<p>Additionally, revised the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.close" title="sqlalchemy.orm.Session.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code></a> method to fully close
out savepoints that may still be present, which also allows the
“external transaction” recipe to proceed without warnings if the
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> did not explicitly end its own SAVEPOINT
transactions.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-9015"><span class="std std-ref">New transaction join modes for Session</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9015">#9015</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-4"><span class="target" id="change-ba66fea024412683efdfffe8f431ddc6"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ba66fea024412683efdfffe8f431ddc6">¶</a></span><p>Removed the requirement that the <code class="docutils literal notranslate"><span class="pre">__allow_unmapped__</span></code> attribute be used
on Declarative Dataclass Mapped class when non-<code class="docutils literal notranslate"><span class="pre">Mapped[]</span></code> annotations are
detected; previously, an error message that was intended to support legacy
ORM typed mappings would be raised, which additionally did not mention
correct patterns to use with Dataclasses specifically. This error message
is now no longer raised if <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.mapped_as_dataclass" title="sqlalchemy.orm.registry.mapped_as_dataclass"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.mapped_as_dataclass()</span></code></a> or
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> is used.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/dataclasses.html#orm-declarative-native-dataclasses-non-mapped-fields"><span class="std std-ref">Using Non-Mapped Dataclass Fields</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8973">#8973</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-5"><span class="target" id="change-eb4e62f1dc8196eac5ca4d343e75d46b"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-eb4e62f1dc8196eac5ca4d343e75d46b">¶</a></span><p>Fixed issue in the internal SQL traversal for DML statements like
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> and <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.expression.Delete"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delete</span></code></a> which would cause among other
potential issues, a specific issue using lambda statements with the ORM
update/delete feature.</p>
<p>This change is also <strong>backported</strong> to: 1.4.46</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9033">#9033</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-6"><span class="target" id="change-7a6424f43150e8ab943b86cd9a12c1e4"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7a6424f43150e8ab943b86cd9a12c1e4">¶</a></span><p>Fixed bug where <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.merge" title="sqlalchemy.orm.Session.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.merge()</span></code></a> would fail to preserve the
current loaded contents of relationship attributes that were indicated with
the <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.viewonly" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.viewonly</span></code></a> parameter, thus defeating
strategies that use <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.merge" title="sqlalchemy.orm.Session.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.merge()</span></code></a> to pull fully loaded objects
from caches and other similar techniques. In a related change, fixed issue
where an object that contains a loaded relationship that was nonetheless
configured as <code class="docutils literal notranslate"><span class="pre">lazy='raise'</span></code> on the mapping would fail when passed to
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.merge" title="sqlalchemy.orm.Session.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.merge()</span></code></a>; checks for “raise” are now suspended within
the merge process assuming the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.merge.params.load" title="sqlalchemy.orm.Session.merge"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.merge.load</span></code></a>
parameter remains at its default of <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>Overall, this is a behavioral adjustment to a change introduced in the 1.4
series as of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4994">#4994</a>, which took “merge” out of the set of cascades
applied by default to “viewonly” relationships. As “viewonly” relationships
aren’t persisted under any circumstances, allowing their contents to
transfer during “merge” does not impact the persistence behavior of the
target object. This allows <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.merge" title="sqlalchemy.orm.Session.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.merge()</span></code></a> to correctly suit one
of its use cases, that of adding objects to a <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> that were
loaded elsewhere, often for the purposes of restoring from a cache.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8862">#8862</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-7"><span class="target" id="change-8ad143c7e53f17938c7aec14e1114259"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8ad143c7e53f17938c7aec14e1114259">¶</a></span><p>Fixed issues in <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> where expressions that were
composed of columns that were referenced from the enclosing SELECT would
not render correct SQL in some contexts, in the case where the expression
had a label name that matched the attribute which used
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a>, even when <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> had
no default expression. For the moment, if the <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a>
does have a default expression, that label name is still used for that
default, and an additional label with the same name will continue to be
ignored. Overall, this case is pretty thorny so further adjustments might
be warranted.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8881">#8881</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-8"><span class="target" id="change-4e4f1fe44c5986452b06316e80fc1429"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4e4f1fe44c5986452b06316e80fc1429">¶</a></span><p>A warning is emitted if a backref name used in <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>
names an attribute on the target class which already has a method or
attribute assigned to that name, as the backref declaration will replace
that attribute.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4629">#4629</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-9"><span class="target" id="change-b58310d7558f78d57171e8df4c4c3aae"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b58310d7558f78d57171e8df4c4c3aae">¶</a></span><p>A series of changes and improvements regarding
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></a>. The overall change is that primary key
attributes for an object are now included in a refresh operation
unconditionally when relationship-bound attributes are to be refreshed,
even if not expired and even if not specified in the refresh.</p>
<ul>
<li><p>Improved <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></a> so that if autoflush is enabled
(as is the default for <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>), the autoflush takes place
at an earlier part of the refresh process so that pending primary key
changes are applied without errors being raised.  Previously, this
autoflush took place too late in the process and the SELECT statement
would not use the correct key to locate the row and an
<a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> would be raised.</p></li>
<li><p>When the above condition is present, that is, unflushed primary key
changes are present on the object, but autoflush is not enabled,
the refresh() method now explicitly disallows the operation to proceed,
and an informative <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> is raised asking that
the pending primary key changes be flushed first.  Previously,
this use case was simply broken and <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a>
would be raised anyway. This restriction is so that it’s safe for the
primary key attributes to be refreshed, as is necessary for the case of
being able to refresh the object with relationship-bound secondary
eagerloaders also being emitted. This rule applies in all cases to keep
API behavior consistent regardless of whether or not the PK cols are
actually needed in the refresh, as it is unusual to be refreshing
some attributes on an object while keeping other attributes “pending”
in any case.</p></li>
<li><p>The <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></a> method has been enhanced such that
attributes which are <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>-bound and linked to an
eager loader, either at mapping time or via last-used loader options,
will be refreshed in all cases even when a list of attributes is passed
that does not include any columns on the parent row. This builds upon the
feature first implemented for non-column attributes as part of
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/1763">#1763</a> fixed in 1.4 allowing eagerly-loaded relationship-bound
attributes to participate in the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></a> operation.
If the refresh operation does not indicate any columns on the parent row
to be refreshed, the primary key columns will nonetheless be included
in the refresh operation, which allows the load to proceed into the
secondary relationship loaders indicated as it does normally.
Previously an <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> error would be raised
for this condition (<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8703">#8703</a>)</p></li>
<li><p>Fixed issue where an unnecessary additional SELECT would be emitted in
the case where <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></a> were called with a
combination of expired attributes, as well as an eager loader such as
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> that emits a “secondary” query, if the primary
key attributes were also in an expired state.  As the primary key
attributes are now included in the refresh automatically, there is no
additional load for these attributes when a relationship loader
goes to select for them (<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8997">#8997</a>)</p></li>
<li><p>Fixed regression caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8126">#8126</a> released in 2.0.0b1 where the
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.refresh" title="sqlalchemy.orm.Session.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></a> method would fail with an
<code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>, if passed both an expired column name as well as the
name of a relationship-bound attribute that was linked to a “secondary”
eagerloader such as the <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> eager loader
(<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8996">#8996</a>)</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8703">#8703</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8996">#8996</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8997">#8997</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-10"><span class="target" id="change-4ba6c2f4d43f7418e96b3b93e1a6fd3d"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4ba6c2f4d43f7418e96b3b93e1a6fd3d">¶</a></span><p>Improved a fix first made in version 1.4 for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8456">#8456</a> which scaled
back the usage of internal “polymorphic adapters”, that are used to render
ORM queries when the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.with_polymorphic" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.with_polymorphic</span></code></a> parameter is
used. These adapters, which are very complex and error prone, are now used
only in those cases where an explicit user-supplied subquery is used for
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.with_polymorphic" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.with_polymorphic</span></code></a>, which includes only the use case
of concrete inheritance mappings that use the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.polymorphic_union" title="sqlalchemy.orm.polymorphic_union"><code class="xref py py-func docutils literal notranslate"><span class="pre">polymorphic_union()</span></code></a> helper, as well as the legacy use case of
using an aliased subquery for joined inheritance mappings, which is not
needed in modern use.</p>
<p>For the most common case of joined inheritance mappings that use the
built-in polymorphic loading scheme, which includes those which make use of
the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.polymorphic_load" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_load</span></code></a> parameter set to <code class="docutils literal notranslate"><span class="pre">inline</span></code>,
polymorphic adapters are now no longer used. This has both a positive
performance impact on the construction of queries as well as a
substantial simplification of the internal query rendering process.</p>
<p>The specific issue targeted was to allow a <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>
to refer to joined-inheritance classes within a scalar subquery, which now
works as intuitively as is feasible.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8168">#8168</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc1-engine">
<h3>engine<a class="headerlink" href="#change-2.0.0rc1-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-11"><span class="target" id="change-3ecdca690d3b00e47a7f7e7a3f5ab808"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3ecdca690d3b00e47a7f7e7a3f5ab808">¶</a></span><p>Fixed a long-standing race condition in the connection pool which could
occur under eventlet/gevent monkeypatching schemes in conjunction with the
use of eventlet/gevent <code class="docutils literal notranslate"><span class="pre">Timeout</span></code> conditions, where a connection pool
checkout that’s interrupted due to the timeout would fail to clean up the
failed state, causing the underlying connection record and sometimes the
database connection itself to “leak”, leaving the pool in an invalid state
with unreachable entries. This issue was first identified and fixed in
SQLAlchemy 1.2 for <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4225">#4225</a>, however the failure modes detected in
that fix failed to accommodate for <code class="docutils literal notranslate"><span class="pre">BaseException</span></code>, rather than
<code class="docutils literal notranslate"><span class="pre">Exception</span></code>, which prevented eventlet/gevent <code class="docutils literal notranslate"><span class="pre">Timeout</span></code> from being
caught. In addition, a block within initial pool connect has also been
identified and hardened with a <code class="docutils literal notranslate"><span class="pre">BaseException</span></code> -&gt; “clean failed connect”
block to accommodate for the same condition in this location.
Big thanks to Github user &#64;niklaus for their tenacious efforts in
identifying and describing this intricate issue.</p>
<p>This change is also <strong>backported</strong> to: 1.4.46</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8974">#8974</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-12"><span class="target" id="change-6918ca09abd3ce8aded82b9089818d81"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6918ca09abd3ce8aded82b9089818d81">¶</a></span><p>Fixed issue where <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.freeze" title="sqlalchemy.engine.Result.freeze"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.freeze()</span></code></a> method would not work for
textual SQL using either <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a> or
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.exec_driver_sql" title="sqlalchemy.engine.Connection.exec_driver_sql"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.exec_driver_sql()</span></code></a>.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8963">#8963</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc1-sql">
<h3>sql<a class="headerlink" href="#change-2.0.0rc1-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-13"><span class="target" id="change-4041d3dd8880502d12d2cc63de190688"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4041d3dd8880502d12d2cc63de190688">¶</a></span><p>An informative re-raise is now thrown in the case where any “literal
bindparam” render operation fails, indicating the value itself and
the datatype in use, to assist in debugging when literal params
are being rendered in a statement.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8800">#8800</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-14"><span class="target" id="change-237b167d601e6c96f4d1bb88a5c7e02a"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-237b167d601e6c96f4d1bb88a5c7e02a">¶</a></span><p>Fixed issue in lambda SQL feature where the calculated type of a literal
value would not take into account the type coercion rules of the “compared
to type”, leading to a lack of typing information for SQL expressions, such
as comparisons to <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> elements and similar.</p>
<p>This change is also <strong>backported</strong> to: 1.4.46</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9029">#9029</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-15"><span class="target" id="change-4db94213c9b38c8ec0439cd38d440017"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4db94213c9b38c8ec0439cd38d440017">¶</a></span><p>Fixed a series of issues regarding the position and sometimes the identity
of rendered bound parameters, such as those used for SQLite, asyncpg,
MySQL, Oracle and others. Some compiled forms would not maintain the order
of parameters correctly, such as the PostgreSQL <code class="docutils literal notranslate"><span class="pre">regexp_replace()</span></code>
function, the “nesting” feature of the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.CTE" title="sqlalchemy.sql.expression.CTE"><code class="xref py py-class docutils literal notranslate"><span class="pre">CTE</span></code></a> construct first
introduced in <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4123">#4123</a>, and selectable tables formed by using the
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.column_valued" title="sqlalchemy.sql.functions.FunctionElement.column_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.column_valued()</span></code></a> method with Oracle.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8827">#8827</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-16"><span class="target" id="change-0a2cd213f1663ed0114493155b2bb191"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0a2cd213f1663ed0114493155b2bb191">¶</a></span><p>Added test support to ensure that all compiler <code class="docutils literal notranslate"><span class="pre">visit_xyz()</span></code> methods
across all <code class="xref py py-class docutils literal notranslate"><span class="pre">Compiler</span></code> implementations in SQLAlchemy accept a
<code class="docutils literal notranslate"><span class="pre">**kw</span></code> parameter, so that all compilers accept additional keyword
arguments under all circumstances.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8988">#8988</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-17"><span class="target" id="change-18736d6a0ac89a23fcf36ef3e13494d0"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-18736d6a0ac89a23fcf36ef3e13494d0">¶</a></span><p>The <a class="reference internal" href="../core/internals.html#sqlalchemy.sql.compiler.SQLCompiler.construct_params" title="sqlalchemy.sql.compiler.SQLCompiler.construct_params"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SQLCompiler.construct_params()</span></code></a> method, as well as the
<a class="reference internal" href="../core/internals.html#sqlalchemy.sql.compiler.SQLCompiler.params" title="sqlalchemy.sql.compiler.SQLCompiler.params"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SQLCompiler.params</span></code></a> accessor, will now return the
exact parameters that correspond to a compiled statement that used
the <code class="docutils literal notranslate"><span class="pre">render_postcompile</span></code> parameter to compile.   Previously,
the method returned a parameter structure that by itself didn’t correspond
to either the original parameters or the expanded ones.</p>
<p>Passing a new dictionary of parameters to
<a class="reference internal" href="../core/internals.html#sqlalchemy.sql.compiler.SQLCompiler.construct_params" title="sqlalchemy.sql.compiler.SQLCompiler.construct_params"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SQLCompiler.construct_params()</span></code></a> for a <a class="reference internal" href="../core/internals.html#sqlalchemy.sql.compiler.SQLCompiler" title="sqlalchemy.sql.compiler.SQLCompiler"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLCompiler</span></code></a> that was
constructed with <code class="docutils literal notranslate"><span class="pre">render_postcompile</span></code> is now disallowed; instead, to make
a new SQL string and parameter set for an alternate set of parameters, a
new method <a class="reference internal" href="../core/internals.html#sqlalchemy.sql.compiler.SQLCompiler.construct_expanded_state" title="sqlalchemy.sql.compiler.SQLCompiler.construct_expanded_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SQLCompiler.construct_expanded_state()</span></code></a> is added which
will produce a new expanded form for the given parameter set, using the
<a class="reference internal" href="../core/internals.html#sqlalchemy.sql.compiler.ExpandedState" title="sqlalchemy.sql.compiler.ExpandedState"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpandedState</span></code></a> container which includes a new SQL statement
and new parameter dictionary, as well as a positional parameter tuple.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6114">#6114</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-18"><span class="target" id="change-255add3c1e9d5a5a7136dd92682ded28"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-255add3c1e9d5a5a7136dd92682ded28">¶</a></span><p>To accommodate for third party dialects with different character escaping
needs regarding bound parameters, the system by which SQLAlchemy “escapes”
(i.e., replaces with another character in its place) special characters in
bound parameter names has been made extensible for third party dialects,
using the <code class="xref py py-attr docutils literal notranslate"><span class="pre">SQLCompiler.bindname_escape_chars</span></code> dictionary which can
be overridden at the class declaration level on any <a class="reference internal" href="../core/internals.html#sqlalchemy.sql.compiler.SQLCompiler" title="sqlalchemy.sql.compiler.SQLCompiler"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLCompiler</span></code></a>
subclass. As part of this change, also added the dot <code class="docutils literal notranslate"><span class="pre">&quot;.&quot;</span></code> as a default
“escaped” character.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8994">#8994</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc1-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0rc1-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-19"><span class="target" id="change-4614b1e400eeb61601e69674f89c8d89"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4614b1e400eeb61601e69674f89c8d89">¶</a></span><p>pep-484 typing has been completed for the
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.horizontal_shard</span></code> extension as well as the
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.events</span></code> module. Thanks to Gleb Kisenkov for their
efforts.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6810">#6810</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9025">#9025</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc1-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.0.0rc1-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-20"><span class="target" id="change-7eccceb4eaef1de277e7ee05e6c557f5"><strong>[asyncio] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7eccceb4eaef1de277e7ee05e6c557f5">¶</a></span><p>Removed non-functional <code class="docutils literal notranslate"><span class="pre">merge()</span></code> method from
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncResult" title="sqlalchemy.ext.asyncio.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncResult</span></code></a>.  This method has never worked and was
included with <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncResult" title="sqlalchemy.ext.asyncio.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncResult</span></code></a> in error.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8952">#8952</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc1-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.0rc1-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-21"><span class="target" id="change-46f9ba2bb477c130ed47173c29cc132b"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-46f9ba2bb477c130ed47173c29cc132b">¶</a></span><p>Fixed bug where the PostgreSQL
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.constraint" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.constraint</span></code></a> parameter
would accept an <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> object, however would not expand this index
out into its individual index expressions, instead rendering its name in an
ON CONFLICT ON CONSTRAINT clause, which is not accepted by PostgreSQL; the
“constraint name” form only accepts unique or exclude constraint names. The
parameter continues to accept the index but now expands it out into its
component expressions for the render.</p>
<p>This change is also <strong>backported</strong> to: 1.4.46</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9023">#9023</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-22"><span class="target" id="change-38102340db8da8493e3ee55e0ce29ba6"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-38102340db8da8493e3ee55e0ce29ba6">¶</a></span><p>Made an adjustment to how the PostgreSQL dialect considers column types
when it reflects columns from a table, to accommodate for alternative
backends which may return NULL from the PG <code class="docutils literal notranslate"><span class="pre">format_type()</span></code> function.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8748">#8748</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-23"><span class="target" id="change-a3746cb19ccb9e894e9089582ac3ba4d"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a3746cb19ccb9e894e9089582ac3ba4d">¶</a></span><p>Added support for explicit use of PG full text functions with asyncpg and
psycopg (SQLAlchemy 2.0 only), with regards to the <code class="docutils literal notranslate"><span class="pre">REGCONFIG</span></code> type cast
for the first argument, which previously would be incorrectly cast to a
VARCHAR, causing failures on these dialects that rely upon explicit type
casts. This includes support for <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.to_tsvector" title="sqlalchemy.dialects.postgresql.to_tsvector"><code class="xref py py-class docutils literal notranslate"><span class="pre">to_tsvector</span></code></a>,
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.to_tsquery" title="sqlalchemy.dialects.postgresql.to_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">to_tsquery</span></code></a>, <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.plainto_tsquery" title="sqlalchemy.dialects.postgresql.plainto_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">plainto_tsquery</span></code></a>,
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.phraseto_tsquery" title="sqlalchemy.dialects.postgresql.phraseto_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">phraseto_tsquery</span></code></a>,
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.websearch_to_tsquery" title="sqlalchemy.dialects.postgresql.websearch_to_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">websearch_to_tsquery</span></code></a>,
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ts_headline" title="sqlalchemy.dialects.postgresql.ts_headline"><code class="xref py py-class docutils literal notranslate"><span class="pre">ts_headline</span></code></a>, each of which will determine based on
number of arguments passed if the first string argument should be
interpreted as a PostgreSQL “REGCONFIG” value; if so, the argument is typed
using a newly added type object <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.REGCONFIG" title="sqlalchemy.dialects.postgresql.REGCONFIG"><code class="xref py py-class docutils literal notranslate"><span class="pre">REGCONFIG</span></code></a> which is
then explicitly cast in the SQL expression.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8977">#8977</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-24"><span class="target" id="change-46e487a4a2b4fe245d101c044e3efe5c"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-46e487a4a2b4fe245d101c044e3efe5c">¶</a></span><p>Fixed regression where newly revised PostgreSQL range types such as
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.INT4RANGE" title="sqlalchemy.dialects.postgresql.INT4RANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">INT4RANGE</span></code></a> could not be set up as the impl of a
<a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code></a> custom type, instead raising a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9020">#9020</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-25"><span class="target" id="change-0427d248dffab9318227f61c4158aaf9"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0427d248dffab9318227f61c4158aaf9">¶</a></span><p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Range.__eq___()</span></code> will now return <code class="docutils literal notranslate"><span class="pre">NotImplemented</span></code>
when comparing with an instance of a different class, instead of raising
an <code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code> exception.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8984">#8984</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc1-sqlite">
<h3>sqlite<a class="headerlink" href="#change-2.0.0rc1-sqlite" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-26"><span class="target" id="change-3d57fd460ca15c397eb5c0ad694fd521"><strong>[sqlite] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3d57fd460ca15c397eb5c0ad694fd521">¶</a></span><p>Added support for the SQLite backend to reflect the “DEFERRABLE” and
“INITIALLY” keywords which may be present on a foreign key construct. Pull
request courtesy Michael Gorven.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8903">#8903</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-27"><span class="target" id="change-5c56f87e037dc1bc4896054b6ccccf7c"><strong>[sqlite] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5c56f87e037dc1bc4896054b6ccccf7c">¶</a></span><p>Added support for reflection of expression-oriented WHERE criteria included
in indexes on the SQLite dialect, in a manner similar to that of the
PostgreSQL dialect. Pull request courtesy Tobias Pfeiffer.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8804">#8804</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc1-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.0rc1-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-28"><span class="target" id="change-289e4803cb5ea260486b7d8a48636390"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-289e4803cb5ea260486b7d8a48636390">¶</a></span><p>Fixed issue in Oracle compiler where the syntax for
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.column_valued" title="sqlalchemy.sql.functions.FunctionElement.column_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.column_valued()</span></code></a> was incorrect, rendering the name
<code class="docutils literal notranslate"><span class="pre">COLUMN_VALUE</span></code> without qualifying the source table correctly.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8945">#8945</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0rc1-tests">
<h3>tests<a class="headerlink" href="#change-2.0.0rc1-tests" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0rc1-29"><span class="target" id="change-526ee88841e6ed386ce77a81eee26324"><strong>[tests] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-526ee88841e6ed386ce77a81eee26324">¶</a></span><p>Fixed issue in tox.ini file where changes in the tox 4.0 series to the
format of “passenv” caused tox to not function correctly, in particular
raising an error as of tox 4.0.6.</p>
<p>This change is also <strong>backported</strong> to: 1.4.46</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0rc1-30"><span class="target" id="change-2054e6f655a236dc1e2efee1b07bdbe1"><strong>[tests] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2054e6f655a236dc1e2efee1b07bdbe1">¶</a></span><p>Added new exclusion rule for third party dialects called
<code class="docutils literal notranslate"><span class="pre">unusual_column_name_characters</span></code>, which can be “closed” for third party
dialects that don’t support column names with unusual characters such as
dots, slashes, or percent signs in them, even if the name is properly
quoted.</p>
<p>This change is also <strong>backported</strong> to: 1.4.46</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9002">#9002</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.0b4">
<h2 class="release-version">2.0.0b4<a class="headerlink" href="#change-2.0.0b4" title="Link to this heading">¶</a></h2>
Released: December 5, 2022<section id="change-2.0.0b4-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0b4-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b4-0"><span class="target" id="change-7f9ee42d6f7749db74039360b37968bf"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7f9ee42d6f7749db74039360b37968bf">¶</a></span><p>Added a new parameter <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.use_existing_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.use_existing_column</span></code></a> to
accommodate the use case of a single-table inheritance mapping that uses
the pattern of more than one subclass indicating the same column to take
place on the superclass. This pattern was previously possible by using
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr" title="sqlalchemy.orm.declared_attr"><code class="xref py py-func docutils literal notranslate"><span class="pre">declared_attr()</span></code></a> in conjunction with locating the existing column
in the <code class="docutils literal notranslate"><span class="pre">.__table__</span></code> of the superclass, however is now updated to work
with <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> as well as with pep-484 typing, in a
simple and succinct way.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/inheritance.html#orm-inheritance-column-conflicts"><span class="std std-ref">Resolving Column Conflicts with use_existing_column</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8822">#8822</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-1"><span class="target" id="change-b2f432d919acc932b9cb03fec86a3554"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b2f432d919acc932b9cb03fec86a3554">¶</a></span><p>Added support custom user-defined types which extend the Python
<code class="docutils literal notranslate"><span class="pre">enum.Enum</span></code> base class to be resolved automatically
to SQLAlchemy <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> SQL types, when using the Annotated
Declarative Table feature.  The feature is made possible through new
lookup features added to the ORM type map feature, and includes support
for changing the arguments of the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> that’s generated by
default as well as setting up specific <code class="docutils literal notranslate"><span class="pre">enum.Enum</span></code> types within
the map with specific arguments.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/declarative_tables.html#orm-declarative-mapped-column-enums"><span class="std std-ref">Using Python Enum or pep-586 Literal types in the type map</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8859">#8859</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-2"><span class="target" id="change-2941dd456edafda10359affa42772260"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2941dd456edafda10359affa42772260">¶</a></span><p>Added <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.compare" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.compare</span></code></a> parameter to relevant ORM
attribute constructs including <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>,
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> etc. to provide for the Python dataclasses
<code class="docutils literal notranslate"><span class="pre">compare</span></code> parameter on <code class="docutils literal notranslate"><span class="pre">field()</span></code>, when using the
<a class="reference internal" href="../orm/dataclasses.html#orm-declarative-native-dataclasses"><span class="std std-ref">Declarative Dataclass Mapping</span></a> feature. Pull request courtesy
Simon Schiele.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8905">#8905</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-3"><span class="target" id="change-07f17a72e4306f956d2c45a0a711d34c"><strong>[orm] [performance] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-07f17a72e4306f956d2c45a0a711d34c">¶</a></span><p>Additional performance enhancements within ORM-enabled SQL statements,
specifically targeting callcounts within the construction of ORM
statements, using combinations of <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> with
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.union" title="sqlalchemy.sql.expression.union"><code class="xref py py-func docutils literal notranslate"><span class="pre">union()</span></code></a> and similar “compound” constructs, in addition to direct
performance improvements to the <code class="docutils literal notranslate"><span class="pre">corresponding_column()</span></code> internal method
that is used heavily by the ORM by constructs like <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> and
similar.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8796">#8796</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-4"><span class="target" id="change-36bb3ef310ce109a6974abb1f01249b5"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-36bb3ef310ce109a6974abb1f01249b5">¶</a></span><p>Fixed issue where use of an unknown datatype within a <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a>
annotation for a column-based attribute would silently fail to map the
attribute, rather than reporting an exception; an informative exception
message is now raised.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8888">#8888</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-5"><span class="target" id="change-8f97eef21ad80d54b13f789e3be204fc"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8f97eef21ad80d54b13f789e3be204fc">¶</a></span><p>Fixed a suite of issues involving <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> use with dictionary
types, such as <code class="docutils literal notranslate"><span class="pre">Mapped[Dict[str,</span> <span class="pre">str]</span> <span class="pre">|</span> <span class="pre">None]</span></code>, would not be correctly
interpreted in Declarative ORM mappings. Support to correctly
“de-optionalize” this type including for lookup in <code class="docutils literal notranslate"><span class="pre">type_annotation_map</span></code>
has been fixed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8777">#8777</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-6"><span class="target" id="change-e02cade6952e8afe79edf480a3932a25"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e02cade6952e8afe79edf480a3932a25">¶</a></span><p>Fixed bug in <a class="reference internal" href="../orm/dataclasses.html#orm-declarative-native-dataclasses"><span class="std std-ref">Declarative Dataclass Mapping</span></a> feature where using
plain dataclass fields with the <code class="docutils literal notranslate"><span class="pre">__allow_unmapped__</span></code> directive in a
mapping would not create a dataclass with the correct class-level state for
those fields, copying the raw <code class="docutils literal notranslate"><span class="pre">Field</span></code> object to the class inappropriately
after dataclasses itself had replaced the <code class="docutils literal notranslate"><span class="pre">Field</span></code> object with the
class-level default value.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8880">#8880</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-7"><span class="target" id="change-35a6f31f058c316556b77d59961375da"><strong>[orm] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-35a6f31f058c316556b77d59961375da">¶</a></span><p>Fixed regression where flushing a mapped class that’s mapped against a
subquery, such as a direct mapping or some forms of concrete table
inheritance, would fail if the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.eager_defaults" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.eager_defaults</span></code></a>
parameter were used.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8812">#8812</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-8"><span class="target" id="change-505525db48545a4258d828b9e056cf81"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-505525db48545a4258d828b9e056cf81">¶</a></span><p>Fixed regression in 2.0.0b3 caused by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8759">#8759</a> where indicating the
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> name using a qualified name such as
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Mapped</span></code> would fail to be recognized by Declarative as
indicating the <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> construct.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8853">#8853</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b4-orm-extensions">
<h3>orm extensions<a class="headerlink" href="#change-2.0.0b4-orm-extensions" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b4-9"><span class="target" id="change-f385abf755cac7727ecb3eb714440881"><strong>[usecase] [orm extensions]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f385abf755cac7727ecb3eb714440881">¶</a></span><p>Added support for the <a class="reference internal" href="../orm/extensions/associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal notranslate"><span class="pre">association_proxy()</span></code></a> extension function to
take part within Python <code class="docutils literal notranslate"><span class="pre">dataclasses</span></code> configuration, when using
the native dataclasses feature described at
<a class="reference internal" href="../orm/dataclasses.html#orm-declarative-native-dataclasses"><span class="std std-ref">Declarative Dataclass Mapping</span></a>.  Included are attribute-level
arguments including <a class="reference internal" href="../orm/extensions/associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy.params.init" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">association_proxy.init</span></code></a> and
<a class="reference internal" href="../orm/extensions/associationproxy.html#sqlalchemy.ext.associationproxy.association_proxy.params.default_factory" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">association_proxy.default_factory</span></code></a>.</p>
<p>Documentation for association proxy has also been updated to use
“Annotated Declarative Table” forms within examples, including type
annotations used for <code class="xref py py-class docutils literal notranslate"><span class="pre">AssocationProxy</span></code> itself.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8878">#8878</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b4-sql">
<h3>sql<a class="headerlink" href="#change-2.0.0b4-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b4-10"><span class="target" id="change-d9d99c9bb037334c8243a718a368009e"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d9d99c9bb037334c8243a718a368009e">¶</a></span><p>Added <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.ScalarValues" title="sqlalchemy.sql.expression.ScalarValues"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarValues</span></code></a> that can be used as a column
element allowing using <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Values" title="sqlalchemy.sql.expression.Values"><code class="xref py py-class docutils literal notranslate"><span class="pre">Values</span></code></a> inside <code class="docutils literal notranslate"><span class="pre">IN</span></code> clauses
or in conjunction with <code class="docutils literal notranslate"><span class="pre">ANY</span></code> or <code class="docutils literal notranslate"><span class="pre">ALL</span></code> collection aggregates.
This new class is generated using the method
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Values.scalar_values" title="sqlalchemy.sql.expression.Values.scalar_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Values.scalar_values()</span></code></a>.
The <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Values" title="sqlalchemy.sql.expression.Values"><code class="xref py py-class docutils literal notranslate"><span class="pre">Values</span></code></a> instance is now coerced to a
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.ScalarValues" title="sqlalchemy.sql.expression.ScalarValues"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarValues</span></code></a> when used in a <code class="docutils literal notranslate"><span class="pre">IN</span></code> or <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">IN</span></code>
operation.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6289">#6289</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-11"><span class="target" id="change-77ba1388c36fb6501a05497a720cd625"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-77ba1388c36fb6501a05497a720cd625">¶</a></span><p>Fixed critical memory issue identified in cache key generation, where for
very large and complex ORM statements that make use of lots of ORM aliases
with subqueries, cache key generation could produce excessively large keys
that were orders of magnitude bigger than the statement itself. Much thanks
to Rollo Konig Brock for their very patient, long term help in finally
identifying this issue.</p>
<p>This change is also <strong>backported</strong> to: 1.4.44</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8790">#8790</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-12"><span class="target" id="change-70d000620145498afde83122570554b3"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-70d000620145498afde83122570554b3">¶</a></span><p>The approach to the <code class="docutils literal notranslate"><span class="pre">numeric</span></code> pep-249 paramstyle has been rewritten, and
is now fully supported, including by features such as “expanding IN” and
“insertmanyvalues”. Parameter names may also be repeated in the source SQL
construct which will be correctly represented within the numeric format
using a single parameter. Introduced an additional numeric paramstyle
called <code class="docutils literal notranslate"><span class="pre">numeric_dollar</span></code>, which is specifically what’s used by the asyncpg
dialect; the paramstyle is equivalent to <code class="docutils literal notranslate"><span class="pre">numeric</span></code> except numeric
indicators are indicated by a dollar-sign rather than a colon. The asyncpg
dialect now uses <code class="docutils literal notranslate"><span class="pre">numeric_dollar</span></code> paramstyle directly, rather than
compiling to <code class="docutils literal notranslate"><span class="pre">format</span></code> style first.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">numeric</span></code> and <code class="docutils literal notranslate"><span class="pre">numeric_dollar</span></code> paramstyles assume that the target
backend is capable of receiving the numeric parameters in any order,
and will match the given parameter values to the statement based on
matching their position (1-based) to the numeric indicator.  This is the
normal behavior of “numeric” paramstyles, although it was observed that
the SQLite DBAPI implements a not-used “numeric” style that does not honor
parameter ordering.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8849">#8849</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-13"><span class="target" id="change-13642215809676f9dcb63e0c48aff9cb"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-13642215809676f9dcb63e0c48aff9cb">¶</a></span><p>Adjusted the rendering of <code class="docutils literal notranslate"><span class="pre">RETURNING</span></code>, in particular when using
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a>, such that it now renders columns using the same logic
as that of the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> construct to generate labels, which will
include disambiguating labels, as well as that a SQL function surrounding a
named column will be labeled using the column name itself. This establishes
better cross-compatibility when selecting rows from either <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a>
constructs or from DML statements that use <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.UpdateBase.returning" title="sqlalchemy.sql.expression.UpdateBase.returning"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UpdateBase.returning()</span></code></a>. A
narrower scale change was also made for the 1.4 series that adjusted the
function label issue only.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8770">#8770</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b4-schema">
<h3>schema<a class="headerlink" href="#change-2.0.0b4-schema" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b4-14"><span class="target" id="change-bb3c2d8d22b2ae5238d60b03c24dc8cf"><strong>[schema] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bb3c2d8d22b2ae5238d60b03c24dc8cf">¶</a></span><p>Stricter rules are in place for appending of <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects to
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> objects, both moving some previous deprecation warnings to
exceptions, and preventing some previous scenarios that would cause
duplicate columns to appear in tables, when
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.extend_existing" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.extend_existing</span></code></a> were set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, for both
programmatic <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> construction as well as during reflection
operations.</p>
<p>See <a class="reference internal" href="whatsnew_20.html#change-8925"><span class="std std-ref">Stricter rules for replacement of Columns in Table objects with same-names, keys</span></a> for a rundown of these changes.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-8925"><span class="std std-ref">Stricter rules for replacement of Columns in Table objects with same-names, keys</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8925">#8925</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b4-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0b4-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b4-15"><span class="target" id="change-094cdb3b4af8e550fde19f33dcc6df58"><strong>[typing] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-094cdb3b4af8e550fde19f33dcc6df58">¶</a></span><p>Added a new type <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.SQLColumnExpression" title="sqlalchemy.sql.expression.SQLColumnExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLColumnExpression</span></code></a> which may be indicated in
user code to represent any SQL column oriented expression, including both
those based on <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnElement</span></code></a> as well as on ORM
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.QueryableAttribute"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryableAttribute</span></code></a>. This type is a real class, not an alias, so
can also be used as the foundation for other objects.  An additional
ORM-specific subclass <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.SQLORMExpression" title="sqlalchemy.orm.SQLORMExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLORMExpression</span></code></a> is also included.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8847">#8847</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-16"><span class="target" id="change-52e2c43ec106188701e7510162b031e6"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-52e2c43ec106188701e7510162b031e6">¶</a></span><p>Adjusted internal use of the Python <code class="docutils literal notranslate"><span class="pre">enum.IntFlag</span></code> class which changed
its behavioral contract in Python 3.11. This was not causing runtime
failures however caused typing runs to fail under Python 3.11.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8783">#8783</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-17"><span class="target" id="change-4f4f130c474b0d422ded925d8f42a006"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4f4f130c474b0d422ded925d8f42a006">¶</a></span><p>The <code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.mutable</span></code> extension and <code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.automap</span></code>
extensions are now fully pep-484 typed. Huge thanks to Gleb Kisenkov for
their efforts on this.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6810">#6810</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8667">#8667</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-18"><span class="target" id="change-4d398013d506393bb01eea2d63b76ee9"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4d398013d506393bb01eea2d63b76ee9">¶</a></span><p>Corrected typing support for the <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.secondary</span></code></a>
argument which may also accept a callable (lambda) that returns a
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a>.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-19"><span class="target" id="change-c3ebedb1d50b2527ae2e8a77ddae2d4e"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c3ebedb1d50b2527ae2e8a77ddae2d4e">¶</a></span><p>Improved the typing for <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.sessionmaker" title="sqlalchemy.orm.sessionmaker"><code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code></a> and
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.async_sessionmaker" title="sqlalchemy.ext.asyncio.async_sessionmaker"><code class="xref py py-class docutils literal notranslate"><span class="pre">async_sessionmaker</span></code></a>, so that the default type of their return value
will be <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> or <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a>, without the need to
type this explicitly. Previously, Mypy would not automaticaly infer these
return types from its generic base.</p>
<p>As part of this change, arguments for <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>,
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a>, <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.sessionmaker" title="sqlalchemy.orm.sessionmaker"><code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code></a> and
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.async_sessionmaker" title="sqlalchemy.ext.asyncio.async_sessionmaker"><code class="xref py py-class docutils literal notranslate"><span class="pre">async_sessionmaker</span></code></a> beyond the initial “bind” argument have been
made keyword-only, which includes parameters that have always been
documented as keyword arguments, such as <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.autoflush" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.autoflush</span></code></a>,
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.class_" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.class_</span></code></a>, etc.</p>
<p>Pull request courtesy Sam Bull.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8842">#8842</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-20"><span class="target" id="change-af3612aaf37b148f3f549913ee105679"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-af3612aaf37b148f3f549913ee105679">¶</a></span><p>Fixed issue where passing a callbale function returning an iterable
of column elements to <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.order_by" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.order_by</span></code></a> was
flagged as an error in type checkers.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8776">#8776</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b4-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.0b4-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b4-21"><span class="target" id="change-d25be3133d220976bf9d842f7619f860"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d25be3133d220976bf9d842f7619f860">¶</a></span><p>Complementing <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8690">#8690</a>, new comparison methods such as
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range.adjacent_to" title="sqlalchemy.dialects.postgresql.Range.adjacent_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Range.adjacent_to()</span></code></a>,
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range.difference" title="sqlalchemy.dialects.postgresql.Range.difference"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Range.difference()</span></code></a>, <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range.union" title="sqlalchemy.dialects.postgresql.Range.union"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Range.union()</span></code></a>,
etc., were added to the PG-specific range objects, bringing them in par
with the standard operators implemented by the underlying
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory" title="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory</span></code></a>.</p>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">__bool__()</span></code> method of the class has been corrected to
be consistent with the common Python containers behavior as well as how
other popular PostgreSQL drivers do: it now tells whether the range
instance is <em>not</em> empty, rather than the other way around.</p>
<p>Pull request courtesy Lele Gaifax.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8765">#8765</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-22"><span class="target" id="change-407949fc9f7e73d86478fa503799eec9"><strong>[postgresql] [change] [asyncpg]</strong> <a class="changelog-reference headerlink reference internal" href="#change-407949fc9f7e73d86478fa503799eec9">¶</a></span><p>Changed the paramstyle used by asyncpg from <code class="docutils literal notranslate"><span class="pre">format</span></code> to
<code class="docutils literal notranslate"><span class="pre">numeric_dollar</span></code>. This has two main benefits since it does not require
additional processing of the statement and allows for duplicate parameters
to be present in the statements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8926">#8926</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-23"><span class="target" id="change-71e62d7df335601f82604a364cd6b97e"><strong>[postgresql] [bug] [mssql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-71e62d7df335601f82604a364cd6b97e">¶</a></span><p>For the PostgreSQL and SQL Server dialects only, adjusted the compiler so
that when rendering column expressions in the RETURNING clause, the “non
anon” label that’s used in SELECT statements is suggested for SQL
expression elements that generate a label; the primary example is a SQL
function that may be emitting as part of the column’s type, where the label
name should match the column’s name by default. This restores a not-well
defined behavior that had changed in version 1.4.21 due to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6718">#6718</a>,
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6710">#6710</a>. The Oracle dialect has a different RETURNING implementation
and was not affected by this issue. Version 2.0 features an across the
board change for its widely expanded support of RETURNING on other
backends.</p>
<p>This change is also <strong>backported</strong> to: 1.4.44</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8770">#8770</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b4-24"><span class="target" id="change-53a752e262ca93a1ec0b95f442e5a2e1"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-53a752e262ca93a1ec0b95f442e5a2e1">¶</a></span><p>Added additional type-detection for the new PostgreSQL
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> type, where previous cases that allowed the
psycopg2-native range objects to be received directly by the DBAPI without
SQLAlchemy intercepting them stopped working, as we now have our own value
object. The <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> object has been enhanced such that
SQLAlchemy Core detects it in otherwise ambiguous situations (such as
comparison to dates) and applies appropriate bind handlers. Pull request
courtesy Lele Gaifax.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8884">#8884</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b4-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.0b4-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b4-25"><span class="target" id="change-d51a793293d30acf5e3f823f42696790"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d51a793293d30acf5e3f823f42696790">¶</a></span><p>Fixed regression caused by the combination of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8177">#8177</a>, re-enable
setinputsizes for SQL server unless fast_executemany + DBAPI executemany is
used for a statement, along with <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6047">#6047</a>, implement
“insertmanyvalues”, which bypasses DBAPI executemany in place of a custom
DBAPI execute for INSERT statements. setinputsizes would incorrectly not be
used for a multiple parameter-set INSERT statement that used
“insertmanyvalues” if fast_executemany were turned on, as the check would
incorrectly assume this is a DBAPI executemany call.  The “regression”
would then be that the “insertmanyvalues” statement format is apparently
slightly more sensitive to multiple rows that don’t use the same types
for each row, so in such a case setinputsizes is especially needed.</p>
<p>The fix repairs the fast_executemany check so that it only disables
setinputsizes if true DBAPI executemany is to be used.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8917">#8917</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b4-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.0b4-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b4-26"><span class="target" id="change-9cd56d2445982014ce9f40c9c8d805c9"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9cd56d2445982014ce9f40c9c8d805c9">¶</a></span><p>Continued fixes for Oracle fix <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8708">#8708</a> released in 1.4.43 where
bound parameter names that start with underscores, which are disallowed by
Oracle, were still not being properly escaped in all circumstances.</p>
<p>This change is also <strong>backported</strong> to: 1.4.45</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8708">#8708</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b4-tests">
<h3>tests<a class="headerlink" href="#change-2.0.0b4-tests" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b4-27"><span class="target" id="change-c3e9c4d66fefe8f6554bf693d8aedd1b"><strong>[tests] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c3e9c4d66fefe8f6554bf693d8aedd1b">¶</a></span><p>Fixed issue where the <code class="docutils literal notranslate"><span class="pre">--disable-asyncio</span></code> parameter to the test suite
would fail to not actually run greenlet tests and would also not prevent
the suite from using a “wrapping” greenlet for the whole suite. This
parameter now ensures that no greenlet or asyncio use will occur within the
entire run when set.</p>
<p>This change is also <strong>backported</strong> to: 1.4.44</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8793">#8793</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.0b3">
<h2 class="release-version">2.0.0b3<a class="headerlink" href="#change-2.0.0b3" title="Link to this heading">¶</a></h2>
Released: November 4, 2022<section id="change-2.0.0b3-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0b3-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b3-0"><span class="target" id="change-9aad8e41ebf2ee76752717e768235e71"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9aad8e41ebf2ee76752717e768235e71">¶</a></span><p>Fixed issue in joined eager loading where an assertion fail would occur
with a particular combination of outer/inner joined eager loads, when
eager loading across three mappers where the middle mapper was
an inherited subclass mapper.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8738">#8738</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-1"><span class="target" id="change-266e1f27d66e649b1ca2e3aa851b30cf"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-266e1f27d66e649b1ca2e3aa851b30cf">¶</a></span><p>Fixed bug involving <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> constructs, where combinations of
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a> with <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a>, as well as when
using <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.join_from" title="sqlalchemy.sql.expression.Select.join_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join_from()</span></code></a>, would cause the
<a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> feature as well as the IN criteria needed
for single-table inheritance queries to not render, in cases where the
columns clause of the query did not explicitly include the left-hand side
entity of the JOIN. The correct entity is now transferred to the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Join" title="sqlalchemy.sql.expression.Join"><code class="xref py py-class docutils literal notranslate"><span class="pre">Join</span></code></a> object that’s generated internally, so that the criteria
against the left side entity is correctly added.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8721">#8721</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-2"><span class="target" id="change-071017871bf0a677e25d17f9e2e65451"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-071017871bf0a677e25d17f9e2e65451">¶</a></span><p>An informative exception is now raised when the
<a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> option is used as a loader option added
to a specific “loader path”, such as when using it within
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.Load.options" title="sqlalchemy.orm.Load.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.options()</span></code></a>. This use is not supported as
<a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> is only intended to be used as a top
level loader option. Previously, an internal error would be generated.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8711">#8711</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-3"><span class="target" id="change-8bc65dab9b27dfb190e02214d7af162b"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8bc65dab9b27dfb190e02214d7af162b">¶</a></span><p>Improved “dictionary mode” for <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get" title="sqlalchemy.orm.Session.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code></a> so that synonym
names which refer to primary key attribute names may be indicated in the
named dictionary.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8753">#8753</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-4"><span class="target" id="change-ff424702b762d3a53f3449c8235aa8fa"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ff424702b762d3a53f3449c8235aa8fa">¶</a></span><p>Fixed issue where “selectin_polymorphic” loading for inheritance mappers
would not function correctly if the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.polymorphic_on" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_on</span></code></a>
parameter referred to a SQL expression that was not directly mapped on the
class.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8704">#8704</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-5"><span class="target" id="change-8ca501a1715be1e9f504aa6d1159e1a7"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8ca501a1715be1e9f504aa6d1159e1a7">¶</a></span><p>Fixed issue where the underlying DBAPI cursor would not be closed when
using the <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object as an iterator, if a user-defined exception
case were raised within the iteration process, thereby causing the iterator
to be closed by the Python interpreter.  When using
<a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.yield_per" title="sqlalchemy.orm.Query.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.yield_per()</span></code></a> to create server-side cursors, this would lead
to the usual MySQL-related issues with server side cursors out of sync,
and without direct access to the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object, end-user code
could not access the cursor in order to close it.</p>
<p>To resolve, a catch for <code class="docutils literal notranslate"><span class="pre">GeneratorExit</span></code> is applied within the iterator
method, which will close the result object in those cases when the
iterator were interrupted, and by definition will be closed by the
Python interpreter.</p>
<p>As part of this change as implemented for the 1.4 series, ensured that
<code class="docutils literal notranslate"><span class="pre">.close()</span></code> methods are available on all <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> implementations
including <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a>, <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a>.  The 2.0
version of this change also includes new context manager patterns for use
with <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> classes.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8710">#8710</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b3-orm-declarative">
<h3>orm declarative<a class="headerlink" href="#change-2.0.0b3-orm-declarative" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b3-6"><span class="target" id="change-377c1adb9aa86ded0d6196a26a2cacdd"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-377c1adb9aa86ded0d6196a26a2cacdd">¶</a></span><p>Added support in ORM declarative annotations for class names specified for
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>, as well as the name of the <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a>
symbol itself, to be different names than their direct class name, to
support scenarios such as where <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> is imported as
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sqlalchemy.orm</span> <span class="pre">import</span> <span class="pre">Mapped</span> <span class="pre">as</span> <span class="pre">M</span></code>, or where related class names
are imported with an alternate name in a similar fashion. Additionally, a
target class name given as the lead argument for <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>
will always supersede the name given in the left hand annotation, so that
otherwise un-importable names that also don’t match the class name can
still be used in annotations.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8759">#8759</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-7"><span class="target" id="change-cb88211fa146c1004537d6a5143a133f"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-cb88211fa146c1004537d6a5143a133f">¶</a></span><p>Improved support for legacy 1.4 mappings that use annotations which don’t
include <code class="docutils literal notranslate"><span class="pre">Mapped[]</span></code>, by ensuring the <code class="docutils literal notranslate"><span class="pre">__allow_unmapped__</span></code> attribute can
be used to allow such legacy annotations to pass through Annotated
Declarative without raising an error and without being interpreted in an
ORM runtime context. Additionally improved the error message generated when
this condition is detected, and added more documentation for how this
situation should be handled. Unfortunately the 1.4 WARN_SQLALCHEMY_20
migration warning cannot detect this particular configurational issue at
runtime with its current architecture.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8692">#8692</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-8"><span class="target" id="change-834b617be98017a77cdc2da0b9e471e9"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-834b617be98017a77cdc2da0b9e471e9">¶</a></span><p>Changed a fundamental configuration behavior of <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>, where
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects that are explicitly present in the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.properties" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.properties</span></code></a> dictionary, either directly or enclosed
within a mapper property object, will now be mapped within the order of how
they appear within the mapped <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> (or other selectable) itself
(assuming they are in fact part of that table’s list of columns), thereby
maintaining the same order of columns in the mapped selectable as is
instrumented on the mapped class, as well as what renders in an ORM SELECT
statement for that mapper. Previously (where “previously” means since
version 0.0.1), <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects in the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.properties" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.properties</span></code></a> dictionary would always be mapped first,
ahead of when the other columns in the mapped <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> would be
mapped, causing a discrepancy in the order in which the mapper would
assign attributes to the mapped class as well as the order in which they
would render in statements.</p>
<p>The change most prominently takes place in the way that Declarative
assigns declared columns to the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>, specifically how
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> (or <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>) objects are handled
when they have a DDL name that is explicitly different from the mapped
attribute name, as well as when constructs such as <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a>
etc. are used.   The new behavior will see the column ordering within
the mapped <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> being the same order in which the attributes
are mapped onto the class, assigned within the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> itself,
and rendered in ORM statements such as SELECT statements, independent
of how the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> was configured against the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8705">#8705</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-9"><span class="target" id="change-f6ed5e34a73d49985f2525b727bd8514"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f6ed5e34a73d49985f2525b727bd8514">¶</a></span><p>Fixed issue in new dataclass mapping feature where a column declared on the
decalrative base / abstract base / mixin would leak into the constructor
for an inheriting subclass under some circumstances.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8718">#8718</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-10"><span class="target" id="change-9070c1eaeb7a87fc425605347ff4129f"><strong>[bug] [orm declarative]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9070c1eaeb7a87fc425605347ff4129f">¶</a></span><p>Fixed issues within the declarative typing resolver (i.e. which resolves
<code class="docutils literal notranslate"><span class="pre">ForwardRef</span></code> objects) where types that were declared for columns in one
particular source file would raise <code class="docutils literal notranslate"><span class="pre">NameError</span></code> when the ultimate mapped
class were in another source file.  The types are now resolved in terms
of the module for each class in which the types are used.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8742">#8742</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b3-engine">
<h3>engine<a class="headerlink" href="#change-2.0.0b3-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b3-11"><span class="target" id="change-f482a719f54b3ec52ed5d15a4f9678a2"><strong>[engine] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f482a719f54b3ec52ed5d15a4f9678a2">¶</a></span><p>To better support the use case of iterating <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> and
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncResult" title="sqlalchemy.ext.asyncio.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncResult</span></code></a> objects where user-defined exceptions may interrupt
the iteration, both objects as well as variants such as
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a>, <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a>,
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncScalarResult" title="sqlalchemy.ext.asyncio.AsyncScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncScalarResult</span></code></a>, <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncMappingResult" title="sqlalchemy.ext.asyncio.AsyncMappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncMappingResult</span></code></a> now support
context manager usage, where the result will be closed at the end of
the context manager block.</p>
<p>In addition, ensured that all the above
mentioned <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> objects include a <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.close" title="sqlalchemy.engine.Result.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.close()</span></code></a> method
as well as <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.closed" title="sqlalchemy.engine.Result.closed"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Result.closed</span></code></a> accessors, including
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a> which previously did
not have a <code class="docutils literal notranslate"><span class="pre">.close()</span></code> method.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-8710"><span class="std std-ref">Context Manager Support for Result, AsyncResult</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8710">#8710</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-12"><span class="target" id="change-174b751d5561a19b13e8c6df441e0ec5"><strong>[engine] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-174b751d5561a19b13e8c6df441e0ec5">¶</a></span><p>Added new parameter <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.reset.params.reset_state" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">PoolEvents.reset.reset_state</span></code></a> parameter to
the <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a> event, with deprecation logic in place that
will continue to accept event hooks using the previous set of arguments.
This indicates various state information about how the reset is taking
place and is used to allow custom reset schemes to take place with full
context given.</p>
<p>Within this change a fix that’s also backported to 1.4 is included which
re-enables the <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a> event to continue to take place
under all circumstances, including when <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> has already
“reset” the connection.</p>
<p>The two changes together allow custom reset schemes to be implemented using
the <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a> event, instead of the
<a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.checkin" title="sqlalchemy.events.PoolEvents.checkin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.checkin()</span></code></a> event (which continues to function as it always
has).</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8717">#8717</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-13"><span class="target" id="change-5f0ca5bc75ca0c1979a1010e4adbb38c"><strong>[engine] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5f0ca5bc75ca0c1979a1010e4adbb38c">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a> event hook would not be be
called in all cases when a <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> were closed and was
in the process of returning its DBAPI connection to the connection pool.</p>
<p>The scenario was when the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> had already emitted
<code class="docutils literal notranslate"><span class="pre">.rollback()</span></code> on its DBAPI connection within the process of returning
the connection to the pool, where it would then instruct the connection
pool to forego doing its own “reset” to save on the additional method
call.  However, this prevented custom pool reset schemes from being
used within this hook, as such hooks by definition are doing more than
just calling <code class="docutils literal notranslate"><span class="pre">.rollback()</span></code>, and need to be invoked under all
circumstances.  This was a regression that appeared in version 1.4.</p>
<p>For version 1.4, the <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.checkin" title="sqlalchemy.events.PoolEvents.checkin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.checkin()</span></code></a> remains viable as an
alternate event hook to use for custom “reset” implementations. Version 2.0
will feature an improved version of <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a> which is
called for additional scenarios such as termination of asyncio connections,
and is also passed contextual information about the reset, to allow for
“custom connection reset” schemes which can respond to different reset
scenarios in different ways.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8717">#8717</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b3-sql">
<h3>sql<a class="headerlink" href="#change-2.0.0b3-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b3-14"><span class="target" id="change-1dcbf7d474b9f242c161913a762c4f52"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1dcbf7d474b9f242c161913a762c4f52">¶</a></span><p>Fixed issue which prevented the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.literal_column" title="sqlalchemy.sql.expression.literal_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">literal_column()</span></code></a> construct from
working properly within the context of a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> construct as well
as other potential places where “anonymized labels” might be generated, if
the literal expression contained characters which could interfere with
format strings, such as open parenthesis, due to an implementation detail
of the “anonymous label” structure.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8724">#8724</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b3-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0b3-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b3-15"><span class="target" id="change-d760877158be45cab95062325e4b47d6"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d760877158be45cab95062325e4b47d6">¶</a></span><p>Corrected various typing issues within the engine and async engine
packages.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b3-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.0b3-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b3-16"><span class="target" id="change-43b09519561256cc24fbb3e56b23f3ac"><strong>[postgresql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-43b09519561256cc24fbb3e56b23f3ac">¶</a></span><p>Added new methods <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range.contains" title="sqlalchemy.dialects.postgresql.Range.contains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Range.contains()</span></code></a> and
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range.contained_by" title="sqlalchemy.dialects.postgresql.Range.contained_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Range.contained_by()</span></code></a> to the new <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> data
object, which mirror the behavior of the PostgreSQL <code class="docutils literal notranslate"><span class="pre">&#64;&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;&#64;</span></code>
operators, as well as the
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contains" title="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">comparator_factory.contains()</span></code></a> and
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contained_by" title="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contained_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">comparator_factory.contained_by()</span></code></a> SQL
operator methods. Pull request courtesy Lele Gaifax.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8706">#8706</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-17"><span class="target" id="change-b5e9317bc427958b2aa3db3770fc515e"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b5e9317bc427958b2aa3db3770fc515e">¶</a></span><p>Refined the new approach to range objects described at <a class="reference internal" href="whatsnew_20.html#change-7156"><span class="std std-ref">New RANGE / MULTIRANGE support and changes for PostgreSQL backends</span></a>
to accommodate driver-specific range and multirange objects, to better
accommodate both legacy code as well as when passing results from raw SQL
result sets back into new range or multirange expressions.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8690">#8690</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b3-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.0b3-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b3-18"><span class="target" id="change-b52caf53ab41dc915ee7e1d2b1b226a1"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b52caf53ab41dc915ee7e1d2b1b226a1">¶</a></span><p>Fixed issue with <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_table" title="sqlalchemy.engine.reflection.Inspector.has_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code></a>, which when used against a
temporary table with the SQL Server dialect would fail on some Azure
variants, due to an unnecessary information schema query that is not
supported on those server versions. Pull request courtesy Mike Barry.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8714">#8714</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-19"><span class="target" id="change-eb166cd892a09d5f365ff9209d4fd749"><strong>[mssql] [bug] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-eb166cd892a09d5f365ff9209d4fd749">¶</a></span><p>Fixed issue with <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_table" title="sqlalchemy.engine.reflection.Inspector.has_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code></a>, which when used against a
view with the SQL Server dialect would erroneously return <code class="docutils literal notranslate"><span class="pre">False</span></code>, due to
a regression in the 1.4 series which removed support for this on SQL
Server. The issue is not present in the 2.0 series which uses a different
reflection architecture. Test support is added to ensure <code class="docutils literal notranslate"><span class="pre">has_table()</span></code>
remains working per spec re: views.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8700">#8700</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b3-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.0b3-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b3-20"><span class="target" id="change-19f4b4baea054857cf5ab7148e94af9f"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-19f4b4baea054857cf5ab7148e94af9f">¶</a></span><p>Fixed issue where bound parameter names, including those automatically
derived from similarly-named database columns, which contained characters
that normally require quoting with Oracle would not be escaped when using
“expanding parameters” with the Oracle dialect, causing execution errors.
The usual “quoting” for bound parameters used by the Oracle dialect is not
used with the “expanding parameters” architecture, so escaping for a large
range of characters is used instead, now using a list of characters/escapes
that are specific to Oracle.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8708">#8708</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b3-21"><span class="target" id="change-58d7e02ac323c5f47899c70f52bdf2f7"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-58d7e02ac323c5f47899c70f52bdf2f7">¶</a></span><p>Fixed issue where the <code class="docutils literal notranslate"><span class="pre">nls_session_parameters</span></code> view queried on first
connect in order to get the default decimal point character may not be
available depending on Oracle connection modes, and would therefore raise
an error.  The approach to detecting decimal char has been simplified to
test a decimal value directly, instead of reading system views, which
works on any backend / driver.</p>
<p>This change is also <strong>backported</strong> to: 1.4.43</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8744">#8744</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.0b2">
<h2 class="release-version">2.0.0b2<a class="headerlink" href="#change-2.0.0b2" title="Link to this heading">¶</a></h2>
Released: October 20, 2022<section id="change-2.0.0b2-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0b2-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-0"><span class="target" id="change-61e17d30f696859f761f6e77d0830efd"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-61e17d30f696859f761f6e77d0830efd">¶</a></span><p>Removed the warning that emits when using ORM-enabled update/delete
regarding evaluation of columns by name, first added in <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4073">#4073</a>;
this warning actually covers up a scenario that otherwise could populate
the wrong Python value for an ORM mapped attribute depending on what the
actual column is, so this deprecated case is removed. In 2.0, ORM enabled
update/delete uses “auto” for “synchronize_session”, which should do the
right thing automatically for any given UPDATE expression.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8656">#8656</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b2-orm-declarative">
<h3>orm declarative<a class="headerlink" href="#change-2.0.0b2-orm-declarative" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-1"><span class="target" id="change-df54ee51146a6453004f20ddc378fd4f"><strong>[orm] [declarative] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-df54ee51146a6453004f20ddc378fd4f">¶</a></span><p>Added support for mapped classes that are also <code class="docutils literal notranslate"><span class="pre">Generic</span></code> subclasses,
to be specified as a <code class="docutils literal notranslate"><span class="pre">GenericAlias</span></code> object (e.g. <code class="docutils literal notranslate"><span class="pre">MyClass[str]</span></code>)
within statements and calls to <a class="reference internal" href="../core/inspection.html#sqlalchemy.inspect" title="sqlalchemy.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8665">#8665</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-2"><span class="target" id="change-f337b60caf3808ff5627b5913d7a3394"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f337b60caf3808ff5627b5913d7a3394">¶</a></span><p>Improved the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase" title="sqlalchemy.orm.DeclarativeBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeBase</span></code></a> class so that when combined with
other mixins like <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a>, the order of the classes may
be in either order.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8665">#8665</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-3"><span class="target" id="change-3b9e5b143d9382865b1e0dc317bb4326"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3b9e5b143d9382865b1e0dc317bb4326">¶</a></span><p>Fixed bug in new ORM typed declarative mappings where the ability
to use <code class="docutils literal notranslate"><span class="pre">Optional[MyClass]</span></code> or similar forms such as <code class="docutils literal notranslate"><span class="pre">MyClass</span> <span class="pre">|</span> <span class="pre">None</span></code>
in the type annotation for a many-to-one relationship was not implemented,
leading to errors.   Documentation has also been added for this use
case to the relationship configuration documentation.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8668">#8668</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-4"><span class="target" id="change-4b0a7639e6298e796e977489add9fd1f"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4b0a7639e6298e796e977489add9fd1f">¶</a></span><p>Fixed issue with new dataclass mapping feature where arguments passed to
the dataclasses API could sometimes be mis-ordered when dealing with mixins
that override <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> declarations, leading to
initializer problems.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8688">#8688</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b2-sql">
<h3>sql<a class="headerlink" href="#change-2.0.0b2-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-5"><span class="target" id="change-bde0bffffdcd582dbcba03460b29c172"><strong>[sql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bde0bffffdcd582dbcba03460b29c172">¶</a></span><p>Fixed bug in new “insertmanyvalues” feature where INSERT that included a
subquery with <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal notranslate"><span class="pre">bindparam()</span></code></a> inside of it would fail to render
correctly in “insertmanyvalues” format. This affected psycopg2 most
directly as “insertmanyvalues” is used unconditionally with this driver.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8639">#8639</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b2-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0b2-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-6"><span class="target" id="change-4e9c1adabeacc4566f5b82d2ea29734b"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4e9c1adabeacc4566f5b82d2ea29734b">¶</a></span><p>Fixed typing issue where pylance strict mode would report “instance
variable overrides class variable” when using a method to define
<code class="docutils literal notranslate"><span class="pre">__tablename__</span></code>, <code class="docutils literal notranslate"><span class="pre">__mapper_args__</span></code> or <code class="docutils literal notranslate"><span class="pre">__table_args__</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8645">#8645</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-7"><span class="target" id="change-646cd41d331eac6081609752021fc0bf"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-646cd41d331eac6081609752021fc0bf">¶</a></span><p>Fixed typing issue where pylance strict mode would report “partially
unknown” datatype for the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8644">#8644</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b2-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.0b2-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-8"><span class="target" id="change-058f12296f87b8e24427ea647806d4a7"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-058f12296f87b8e24427ea647806d4a7">¶</a></span><p>Fixed regression caused by SQL Server pyodbc change <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8177">#8177</a> where we
now use <code class="docutils literal notranslate"><span class="pre">setinputsizes()</span></code> by default; for VARCHAR, this fails if the
character size is greater than 4000 (or 2000, depending on data) characters
as the incoming datatype is NVARCHAR, which has a limit of 4000 characters,
despite the fact that VARCHAR can handle unlimited characters. Additional
pyodbc-specific typing information is now passed to <code class="docutils literal notranslate"><span class="pre">setinputsizes()</span></code>
when the datatype’s size is &gt; 2000 characters. The change is also applied
to the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> type which was also impacted by this issue for large
JSON serializations.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8661">#8661</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-9"><span class="target" id="change-64d74c994eed139fc9c9111c98431a16"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-64d74c994eed139fc9c9111c98431a16">¶</a></span><p>The <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> construct restores itself to the DDL behavior it
had prior to the 1.4 series, where creating a <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> with
no additional arguments will emit a simple <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">SEQUENCE</span></code> instruction
<strong>without</strong> any additional parameters for “start value”.   For most backends,
this is how things worked previously in any case; <strong>however</strong>, for
MS SQL Server, the default value on this database is
<code class="docutils literal notranslate"><span class="pre">-2**63</span></code>; to prevent this generally impractical default
from taking effect on SQL Server, the <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence.params.start" title="sqlalchemy.schema.Sequence"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Sequence.start</span></code></a> parameter
should be provided.   As usage of <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> is unusual
for SQL Server which for many years has standardized on <code class="docutils literal notranslate"><span class="pre">IDENTITY</span></code>,
it is hoped that this change has minimal impact.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7211"><span class="std std-ref">The Sequence construct reverts to not having any explicit default “start” value; impacts MS SQL Server</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7211">#7211</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.0b1">
<h2 class="release-version">2.0.0b1<a class="headerlink" href="#change-2.0.0b1" title="Link to this heading">¶</a></h2>
Released: October 13, 2022<section id="change-2.0.0b1-general">
<h3>general<a class="headerlink" href="#change-2.0.0b1-general" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-0"><span class="target" id="change-c4886b74af98b72892877aefa7d6a6a4"><strong>[general] [changed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c4886b74af98b72892877aefa7d6a6a4">¶</a></span><p>Migrated the codebase to remove all pre-2.0 behaviors and architectures
that were previously noted as deprecated for removal in 2.0, including,
but not limited to:</p>
<ul>
<li><p>removal of all Python 2 code, minimum version is now Python 3.7</p></li>
<li><p><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> now use the
new 2.0 style of working, which includes “autobegin”, library level
autocommit removed, subtransactions and “branched” connections
removed</p></li>
<li><p>Result objects use 2.0-style behaviors; <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> is fully
a named tuple without “mapping” behavior, use <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a>
for “mapping” behavior</p></li>
<li><p>All Unicode encoding/decoding architecture has been removed from
SQLAlchemy.  All modern DBAPI implementations support Unicode
transparently thanks to Python 3, so the <code class="docutils literal notranslate"><span class="pre">convert_unicode</span></code> feature
as well as related mechanisms to look for bytestrings in
DBAPI <code class="docutils literal notranslate"><span class="pre">cursor.description</span></code> etc. have been removed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">.bind</span></code> attribute and parameter from <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a>,
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>, and from all DDL/DML/DQL elements that previously could
refer to a “bound engine”</p></li>
<li><p>The standalone <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.mapper()</span></code> function is removed; all
classical mapping should be done through the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.map_imperatively" title="sqlalchemy.orm.registry.map_imperatively"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.map_imperatively()</span></code></a> method of <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry" title="sqlalchemy.orm.registry"><code class="xref py py-class docutils literal notranslate"><span class="pre">registry</span></code></a>.</p></li>
<li><p>The <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a> method no longer accepts strings for
relationship names; the long-documented approach of using
<code class="docutils literal notranslate"><span class="pre">Class.attrname</span></code> for join targets is now standard.</p></li>
<li><p><a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a> no longer accepts the “aliased” and
“from_joinpoint” arguments</p></li>
<li><p><a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a> no longer accepts chains of multiple join
targets in one method call.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Query.from_self()</span></code>, <code class="docutils literal notranslate"><span class="pre">Query.select_entity_from()</span></code> and
<code class="docutils literal notranslate"><span class="pre">Query.with_polymorphic()</span></code> are removed.</p></li>
<li><p>The <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.cascade_backrefs" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.cascade_backrefs</span></code></a> parameter must now
remain at its new default of <code class="docutils literal notranslate"><span class="pre">False</span></code>; the <code class="docutils literal notranslate"><span class="pre">save-update</span></code> cascade
no longer cascades along a backref.</p></li>
<li><p>the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.future" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.future</span></code></a> parameter must always be set to
<code class="docutils literal notranslate"><span class="pre">True</span></code>.  2.0-style transactional patterns for <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
are now always in effect.</p></li>
<li><p>Loader options no longer accept strings for attribute names.  The
long-documented approach of using <code class="docutils literal notranslate"><span class="pre">Class.attrname</span></code> for loader option
targets is now standard.</p></li>
<li><p>Legacy forms of <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> removed, including
<code class="docutils literal notranslate"><span class="pre">select([cols])</span></code>, the “whereclause” and keyword parameters of
<code class="docutils literal notranslate"><span class="pre">some_table.select()</span></code>.</p></li>
<li><p>Legacy “in-place mutator” methods on <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> such as
<code class="docutils literal notranslate"><span class="pre">append_whereclause()</span></code>, <code class="docutils literal notranslate"><span class="pre">append_order_by()</span></code> etc are removed.</p></li>
<li><p>Removed the very old “dbapi_proxy” module, which in very early
SQLAlchemy releases was used to provide a transparent connection pool
over a raw DBAPI connection.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7257">#7257</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-1"><span class="target" id="change-27a555b2407a0a7fb6c97ed9490b0078"><strong>[general] [changed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-27a555b2407a0a7fb6c97ed9490b0078">¶</a></span><p>The <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.instances" title="sqlalchemy.orm.Query.instances"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.instances()</span></code></a> method is deprecated.  The behavioral
contract of this method, which is that it can iterate objects through
arbitrary result sets, is long obsolete and no longer tested.
Arbitrary statements can return objects by using constructs such
as :meth`.Select.from_statement` or <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a>.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-platform">
<h3>platform<a class="headerlink" href="#change-2.0.0b1-platform" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-2"><span class="target" id="change-2f9f17ad539804610815f3faf3adcd4c"><strong>[platform] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2f9f17ad539804610815f3faf3adcd4c">¶</a></span><p>The SQLAlchemy C extensions have been replaced with all new implementations
written in Cython.  Like the C extensions before, pre-built wheel files
for a wide range of platforms are available on pypi so that building
is not an issue for common platforms.  For custom builds, <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build_ext</span></code>
works as before, needing only the additional Cython install.  <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>
is also part of the source now which will establish the proper build dependencies
when using pip.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7256"><span class="std std-ref">C Extensions now ported to Cython</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7256">#7256</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-3"><span class="target" id="change-6eb4219c6e02e4693782ee2f7eb02ceb"><strong>[platform] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6eb4219c6e02e4693782ee2f7eb02ceb">¶</a></span><p>SQLAlchemy’s source build and installation now includes a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file
for full <span class="target" id="index-10"></span><a class="pep reference external" href="https://peps.python.org/pep-0517/"><strong>PEP 517</strong></a> support.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7311"><span class="std std-ref">Installation is now fully pep-517 enabled</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7311">#7311</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0b1-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-4"><span class="target" id="change-f12558924108e03cb08f6bbe45eb824c"><strong>[orm] [feature] [sql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f12558924108e03cb08f6bbe45eb824c">¶</a></span><p>Added new feature to all included dialects that support RETURNING
called “insertmanyvalues”.  This is a generalization of the
“fast executemany” feature first introduced for the psycopg2 driver
in 1.4 at <a class="reference internal" href="migration_14.html#change-5263"><span class="std std-ref">ORM Batch inserts with psycopg2 now batch statements with RETURNING in most cases</span></a>, which allows the ORM to batch INSERT
statements into a much more efficient SQL structure while still being
able to fetch newly generated primary key and SQL default values
using RETURNING.</p>
<p>The feature now applies to the many dialects that support RETURNING along
with multiple VALUES constructs for INSERT, including all PostgreSQL
drivers, SQLite, MariaDB, MS SQL Server. Separately, the Oracle dialect
also gains the same capability using native cx_Oracle or OracleDB features.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6047">#6047</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-5"><span class="target" id="change-74303da55dd244d5d559530a765ca3f5"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-74303da55dd244d5d559530a765ca3f5">¶</a></span><p>Added new parameter <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a>, which
will include the dictionary or list key for operations such as
<code class="docutils literal notranslate"><span class="pre">__setitem__()</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">obj[key]</span> <span class="pre">=</span> <span class="pre">value</span></code>) and <code class="docutils literal notranslate"><span class="pre">__delitem__()</span></code> (e.g.
<code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">obj[key]</span></code>), using a new keyword parameter “key” or “keys”, depending
on event, e.g. <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.AttributeEvents.append.params.key" title="sqlalchemy.orm.AttributeEvents.append"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.append.key</span></code></a>,
<a class="reference internal" href="../orm/events.html#sqlalchemy.orm.AttributeEvents.bulk_replace.params.keys" title="sqlalchemy.orm.AttributeEvents.bulk_replace"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.bulk_replace.keys</span></code></a>. This allows event
handlers to take into account the key that was passed to the operation and
is of particular importance for dictionary operations working with
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.MappedCollection" title="sqlalchemy.orm.MappedCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedCollection</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8375">#8375</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-6"><span class="target" id="change-1fa7cc08ed5ba8b5efd57d4844447b6b"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1fa7cc08ed5ba8b5efd57d4844447b6b">¶</a></span><p>Added new parameter <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.op.params.python_impl" title="sqlalchemy.sql.expression.Operators.op"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Operators.op.python_impl</span></code></a>, available
from <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.op" title="sqlalchemy.sql.expression.Operators.op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.op()</span></code></a> and also when using the
<code class="xref py py-class docutils literal notranslate"><span class="pre">custom_op</span></code> constructor directly, which allows an
in-Python evaluation function to be provided along with the custom SQL
operator. This evaluation function becomes the implementation used when the
operator object is used given plain Python objects as operands on both
sides, and in particular is compatible with the
<code class="docutils literal notranslate"><span class="pre">synchronize_session='evaluate'</span></code> option used with
<a class="reference internal" href="../orm/queryguide/dml.html#orm-expression-update-delete"><span class="std std-ref">ORM-Enabled INSERT, UPDATE, and DELETE statements</span></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/3162">#3162</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-7"><span class="target" id="change-7dd1eb09c9bb980d33c286dda4a38121"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7dd1eb09c9bb980d33c286dda4a38121">¶</a></span><p>The <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> (and by extension <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a>) now has
new state-tracking functionality that will proactively trap any unexpected
state changes which occur as a particular transactional method proceeds.
This is to allow situations where the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> is being used
in a thread-unsafe manner, where event hooks or similar may be calling
unexpected methods within operations, as well as potentially under other
concurrency situations such as asyncio or gevent to raise an informative
message when the illegal access first occurs, rather than passing silently
leading to secondary failures due to the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> being in an
invalid state.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7433"><span class="std std-ref">Session raises proactively when illegal concurrent or reentrant access is detected</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7433">#7433</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-8"><span class="target" id="change-b6ba8eb8ec6162c5ac960b4f753d012d"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b6ba8eb8ec6162c5ac960b4f753d012d">¶</a></span><p>The <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-func docutils literal notranslate"><span class="pre">composite()</span></code></a> mapping construct now supports automatic
resolution of values when used with a Python <code class="docutils literal notranslate"><span class="pre">dataclass</span></code>; the
<code class="docutils literal notranslate"><span class="pre">__composite_values__()</span></code> method no longer needs to be implemented as this
method is derived from inspection of the dataclass.</p>
<p>Additionally, classes mapped by <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-class docutils literal notranslate"><span class="pre">composite</span></code></a> now support
ordering comparison operations, e.g. <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, etc.</p>
<p>See the new documentation at <a class="reference internal" href="../orm/composites.html#mapper-composite"><span class="std std-ref">Composite Column Types</span></a> for examples.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-9"><span class="target" id="change-99d129e8d8b273e33b33f6a1b0476c75"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-99d129e8d8b273e33b33f6a1b0476c75">¶</a></span><p>Added very experimental feature to the <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> and
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a> loader options called
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload.params.recursion_depth" title="sqlalchemy.orm.selectinload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">selectinload.recursion_depth</span></code></a> /
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.immediateload.params.recursion_depth" title="sqlalchemy.orm.immediateload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">immediateload.recursion_depth</span></code></a> , which allows a single
loader option to automatically recurse into self-referential relationships.
Is set to an integer indicating depth, and may also be set to -1 to
indicate to continue loading until no more levels deep are found.
Major internal changes to <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> and
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a> allow this feature to work while continuing
to make correct use of the compilation cache, as well as not using
arbitrary recursion, so any level of depth is supported (though would
emit that many queries).  This may be useful for
self-referential structures that must be loaded fully eagerly, such as when
using asyncio.</p>
<p>A warning is also emitted when loader options are connected together with
arbitrary lengths (that is, without using the new <code class="docutils literal notranslate"><span class="pre">recursion_depth</span></code>
option) when excessive recursion depth is detected in related object
loading. This operation continues to use huge amounts of memory and
performs extremely poorly; the cache is disabled when this condition is
detected to protect the cache from being flooded with arbitrary statements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8126">#8126</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-10"><span class="target" id="change-145691f7df81b956c74d61fd78e686d0"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-145691f7df81b956c74d61fd78e686d0">¶</a></span><p>Added new parameter <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.autobegin" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.autobegin</span></code></a>, which when set to
<code class="docutils literal notranslate"><span class="pre">False</span></code> will prevent the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> from beginning a
transaction implicitly. The <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.begin" title="sqlalchemy.orm.Session.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.begin()</span></code></a> method must be
called explicitly first in order to proceed with operations, otherwise an
error is raised whenever any operation would otherwise have begun
automatically. This option can be used to create a “safe”
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> that won’t implicitly start new transactions.</p>
<p>As part of this change, also added a new status variable
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.SessionTransaction.origin" title="sqlalchemy.orm.SessionTransaction.origin"><code class="xref py py-class docutils literal notranslate"><span class="pre">origin</span></code></a> which may be useful for event
handling code to be aware of the origin of a particular
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6928">#6928</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-11"><span class="target" id="change-74ed78137559052bea03bee665199a75"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-74ed78137559052bea03bee665199a75">¶</a></span><p>Declarative mixins which use <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects that contain
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> references no longer need to use
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr" title="sqlalchemy.orm.declared_attr"><code class="xref py py-func docutils literal notranslate"><span class="pre">declared_attr()</span></code></a> to achieve this mapping; the
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> object is copied along with the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> itself when the column is applied to the declared
mapping.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-12"><span class="target" id="change-306405301540860fb6efa2da3761049a"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-306405301540860fb6efa2da3761049a">¶</a></span><p>Added <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.load_only.params.raiseload" title="sqlalchemy.orm.load_only"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">load_only.raiseload</span></code></a> parameter to the
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> loader option, so that the unloaded attributes may
have “raise” behavior rather than lazy loading. Previously there wasn’t
really a way to do this with the <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> option directly.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-13"><span class="target" id="change-8201ae6068dd0b6b37e8869afcb4ad24"><strong>[orm] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8201ae6068dd0b6b37e8869afcb4ad24">¶</a></span><p>To better accommodate explicit typing, the names of some ORM constructs
that are typically constructed internally, but nonetheless are sometimes
visible in messaging as well as typing, have been changed to more succinct
names which also match the name of their constructing function (with
different casing), in all cases maintaining aliases to the old names for
the forseeable future:</p>
<ul>
<li><p><a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.RelationshipProperty" title="sqlalchemy.orm.RelationshipProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">RelationshipProperty</span></code></a> becomes an alias for the primary name
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Relationship" title="sqlalchemy.orm.Relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">Relationship</span></code></a>, which is constructed as always from the
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> function</p></li>
<li><p><a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.SynonymProperty" title="sqlalchemy.orm.SynonymProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">SynonymProperty</span></code></a> becomes an alias for the primary name
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Synonym" title="sqlalchemy.orm.Synonym"><code class="xref py py-class docutils literal notranslate"><span class="pre">Synonym</span></code></a>, constructed as always from the
<a class="reference internal" href="../orm/mapped_attributes.html#sqlalchemy.orm.synonym" title="sqlalchemy.orm.synonym"><code class="xref py py-func docutils literal notranslate"><span class="pre">synonym()</span></code></a> function</p></li>
<li><p><a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.CompositeProperty" title="sqlalchemy.orm.CompositeProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeProperty</span></code></a> becomes an alias for the primary name
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Composite" title="sqlalchemy.orm.Composite"><code class="xref py py-class docutils literal notranslate"><span class="pre">Composite</span></code></a>, constructed as always from the
<a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-func docutils literal notranslate"><span class="pre">composite()</span></code></a> function</p></li>
</ul>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-14"><span class="target" id="change-5620cb287386007c5480691a3c29bdba"><strong>[orm] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5620cb287386007c5480691a3c29bdba">¶</a></span><p>For consistency with the prominent ORM concept <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a>, the
names of the dictionary-oriented collections,
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_mapped_collection" title="sqlalchemy.orm.attribute_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_mapped_collection()</span></code></a>,
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_mapped_collection" title="sqlalchemy.orm.column_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_mapped_collection()</span></code></a>, and <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.MappedCollection" title="sqlalchemy.orm.MappedCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedCollection</span></code></a>,
are changed to <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_keyed_dict" title="sqlalchemy.orm.attribute_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_keyed_dict()</span></code></a>,
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_keyed_dict" title="sqlalchemy.orm.column_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_keyed_dict()</span></code></a> and <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.KeyFuncDict" title="sqlalchemy.orm.KeyFuncDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">KeyFuncDict</span></code></a>, using the
phrase “dict” to minimize any confusion against the term “mapped”. The old
names will remain indefinitely with no schedule for removal.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8608">#8608</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-15"><span class="target" id="change-62773006f0ddae317b9617f6e6d4ca7a"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-62773006f0ddae317b9617f6e6d4ca7a">¶</a></span><p>All <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> objects will now consistently raise
<a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.ResourceClosedError" title="sqlalchemy.exc.ResourceClosedError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceClosedError</span></code></a> if they are used after a hard close,
which includes the “hard close” that occurs after calling “single row or
value” methods like <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a> and
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.scalar" title="sqlalchemy.engine.Result.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar()</span></code></a>. This was already the behavior of the most
common class of result objects returned for Core statement executions, i.e.
those based on <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>, so this behavior is not new.
However, the change has been extended to properly accommodate for the ORM
“filtering” result objects returned when using 2.0 style ORM queries,
which would previously behave in “soft closed” style of returning empty
results, or wouldn’t actually “soft close” at all and would continue
yielding from the underlying cursor.</p>
<p>As part of this change, also added <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.close" title="sqlalchemy.engine.Result.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.close()</span></code></a> to the base
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> class and implemented it for the filtered result
implementations that are used by the ORM, so that it is possible to call
the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.close" title="sqlalchemy.engine.CursorResult.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.close()</span></code></a> method on the underlying
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> when the <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> execution option
is in use to close a server side cursor before remaining ORM results have
been fetched. This was again already available for Core result sets but the
change makes it available for 2.0 style ORM results as well.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7274">#7274</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-16"><span class="target" id="change-34f8ec00ad680e4945a026e839cd4cfc"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-34f8ec00ad680e4945a026e839cd4cfc">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.map_declaratively" title="sqlalchemy.orm.registry.map_declaratively"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.map_declaratively()</span></code></a> method
would return an internal “mapper config” object and not the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> object as stated in the API documentation.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-17"><span class="target" id="change-16c8efc6edc6e885e01d9382f2958ce3"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-16c8efc6edc6e885e01d9382f2958ce3">¶</a></span><p>Fixed performance regression which appeared at least in version 1.3 if not
earlier (sometime after 1.0) where the loading of deferred columns, those
explicitly mapped with <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> as opposed to non-deferred
columns that were expired, from a joined inheritance subclass would not use
the “optimized” query which only queried the immediate table that contains
the unloaded columns, instead running a full ORM query which would emit a
JOIN for all base tables, which is not necessary when only loading columns
from the subclass.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7463">#7463</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-18"><span class="target" id="change-a649d1a52507c3b98192e976e8b7bfe0"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a649d1a52507c3b98192e976e8b7bfe0">¶</a></span><p>The internals for the <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object and related loader strategy
patterns have been mostly rewritten, to take advantage of the fact that
only attribute-bound paths, not strings, are now supported. The rewrite
hopes to make it more straightforward to address new use cases and subtle
issues within the loader strategy system going forward.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6986">#6986</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-19"><span class="target" id="change-3ec032c454c7b0f0ee1e87a7f40d309d"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3ec032c454c7b0f0ee1e87a7f40d309d">¶</a></span><p>Made an improvement to the “deferred” / “load_only” set of strategy options
where if a certain object is loaded from two different logical paths within
one query, attributes that have been configured by at least one of the
options to be populated will be populated in all cases, even if other load
paths for that same object did not set this option. previously, it was
based on randomness as to which “path” addressed the object first.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8166">#8166</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-20"><span class="target" id="change-a170eeb59a50296543df7a3d21250990"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a170eeb59a50296543df7a3d21250990">¶</a></span><p>Fixed issue in ORM enabled UPDATE when the statement is created against a
joined-inheritance subclass, updating only local table columns, where the
“fetch” synchronization strategy would not render the correct RETURNING
clause for databases that use RETURNING for fetch synchronization.
Also adjusts the strategy used for RETURNING in UPDATE FROM and
DELETE FROM statements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8344">#8344</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-21"><span class="target" id="change-f365fd5f1a02db3fae69fa0a1307d804"><strong>[orm] [bug] [asyncio]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f365fd5f1a02db3fae69fa0a1307d804">¶</a></span><p>Removed the unused <code class="docutils literal notranslate"><span class="pre">**kw</span></code> arguments from
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession.begin" title="sqlalchemy.ext.asyncio.AsyncSession.begin"><code class="xref py py-class docutils literal notranslate"><span class="pre">begin</span></code></a> and
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession.begin_nested" title="sqlalchemy.ext.asyncio.AsyncSession.begin_nested"><code class="xref py py-class docutils literal notranslate"><span class="pre">begin_nested</span></code></a>. These kw aren’t used and
appear to have been added to the API in error.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7703">#7703</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-22"><span class="target" id="change-fc9610d74ec6092d71575df798c3af48"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-fc9610d74ec6092d71575df798c3af48">¶</a></span><p>Changed the attribute access method used by
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_mapped_collection" title="sqlalchemy.orm.attribute_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_mapped_collection()</span></code></a> and
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_mapped_collection" title="sqlalchemy.orm.column_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_mapped_collection()</span></code></a> (now called
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_keyed_dict" title="sqlalchemy.orm.attribute_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_keyed_dict()</span></code></a> and <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_keyed_dict" title="sqlalchemy.orm.column_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_keyed_dict()</span></code></a>) ,
used when populating the dictionary, to assert that the data value on
the object to be used as the dictionary key is actually present, and is
not instead using “None” due to the attribute never being actually
assigned. This is used to prevent a mis-population of None for a key
when assigning via a backref where the “key” attribute on the object is
not yet assigned.</p>
<p>As the failure mode here is a transitory condition that is not typically
persisted to the database, and is easy to produce via the constructor of
the class based on the order in which parameters are assigned, it is very
possible that many applications include this behavior already which is
silently passed over. To accommodate for applications where this error is
now raised, a new parameter
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_keyed_dict.params.ignore_unpopulated_attribute" title="sqlalchemy.orm.attribute_keyed_dict"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">attribute_keyed_dict.ignore_unpopulated_attribute</span></code></a>
is also added to both <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_keyed_dict" title="sqlalchemy.orm.attribute_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_keyed_dict()</span></code></a> and
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_keyed_dict" title="sqlalchemy.orm.column_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_keyed_dict()</span></code></a> that instead causes the erroneous
backref assignment to be skipped.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8372">#8372</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-23"><span class="target" id="change-c3d5ce55b624c195cc9aa4b2004d0d26"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c3d5ce55b624c195cc9aa4b2004d0d26">¶</a></span><p>Added new parameter <a class="reference internal" href="../orm/extensions/declarative/index.html#sqlalchemy.ext.declarative.AbstractConcreteBase.params.strict_attrs" title="sqlalchemy.ext.declarative.AbstractConcreteBase"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AbstractConcreteBase.strict_attrs</span></code></a> to the
<a class="reference internal" href="../orm/extensions/declarative/index.html#sqlalchemy.ext.declarative.AbstractConcreteBase" title="sqlalchemy.ext.declarative.AbstractConcreteBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractConcreteBase</span></code></a> declarative mixin class. The effect of this
parameter is that the scope of attributes on subclasses is correctly
limited to the subclass in which each attribute is declared, rather than
the previous behavior where all attributes of the entire hierarchy are
applied to the base “abstract” class. This produces a cleaner, more correct
mapping where subclasses no longer have non-useful attributes on them which
are only relevant to sibling classes. The default for this parameter is
False, which leaves the previous behavior unchanged; this is to support
existing code that makes explicit use of these attributes in queries.
To migrate to the newer approach, apply explicit attributes to the abstract
base class as needed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8403">#8403</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-24"><span class="target" id="change-e23f0630585f2d9857b5f63c83e5e3a3"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e23f0630585f2d9857b5f63c83e5e3a3">¶</a></span><p>The behavior of <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> regarding primary key and “polymorphic
discriminator” columns is revised such that these columns are no longer
deferrable, either explicitly or when using a wildcard such as
<code class="docutils literal notranslate"><span class="pre">defer('*')</span></code>. Previously, a wildcard deferral would not load
PK/polymorphic columns which led to errors in all cases, as the ORM relies
upon these columns to produce object identities. The behavior of explicit
deferral of primary key columns is unchanged as these deferrals already
were implicitly ignored.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7495">#7495</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-25"><span class="target" id="change-b84ab5fa6b62da92ab8670fcf26666de"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b84ab5fa6b62da92ab8670fcf26666de">¶</a></span><p>Fixed bug in the behavior of the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.eager_defaults" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.eager_defaults</span></code></a>
parameter such that client-side SQL default or onupdate expressions in the
table definition alone will trigger a fetch operation using RETURNING or
SELECT when the ORM emits an INSERT or UPDATE for the row. Previously, only
server side defaults established as part of table DDL and/or server-side
onupdate expressions would trigger this fetch, even though client-side SQL
expressions would be included when the fetch was rendered.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7438">#7438</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-engine">
<h3>engine<a class="headerlink" href="#change-2.0.0b1-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-26"><span class="target" id="change-2fe37eaf2295cebd3bb4ee8e5b8c575c"><strong>[engine] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2fe37eaf2295cebd3bb4ee8e5b8c575c">¶</a></span><p>The <a class="reference internal" href="../core/events.html#sqlalchemy.events.DialectEvents.handle_error" title="sqlalchemy.events.DialectEvents.handle_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DialectEvents.handle_error()</span></code></a> event is now moved to the
<a class="reference internal" href="../core/events.html#sqlalchemy.events.DialectEvents" title="sqlalchemy.events.DialectEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">DialectEvents</span></code></a> suite from the <code class="xref py py-class docutils literal notranslate"><span class="pre">EngineEvents</span></code> suite, and
now participates in the connection pool “pre ping” event for those dialects
that make use of disconnect codes in order to detect if the database is
live. This allows end-user code to alter the state of “pre ping”. Note that
this does not include dialects which contain a native “ping” method such as
that of psycopg2 or most MySQL dialects.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5648">#5648</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-27"><span class="target" id="change-308292b1788f61e43b0907325cf55f03"><strong>[engine] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-308292b1788f61e43b0907325cf55f03">¶</a></span><p>The <a class="reference internal" href="../core/events.html#sqlalchemy.events.ConnectionEvents.set_connection_execution_options" title="sqlalchemy.events.ConnectionEvents.set_connection_execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.set_connection_execution_options()</span></code></a>
and <a class="reference internal" href="../core/events.html#sqlalchemy.events.ConnectionEvents.set_engine_execution_options" title="sqlalchemy.events.ConnectionEvents.set_engine_execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.set_engine_execution_options()</span></code></a>
event hooks now allow the given options dictionary to be modified
in-place, where the new contents will be received as the ultimate
execution options to be acted upon. Previously, in-place modifications to
the dictionary were not supported.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-28"><span class="target" id="change-59d106e3128ca16355d58d59056a7656"><strong>[engine] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-59d106e3128ca16355d58d59056a7656">¶</a></span><p>Generalized the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code></a> parameter to
the base dialect so that it is no longer dependent on individual dialects
to be present. This parameter sets up the “isolation level” setting to
occur for all new database connections as soon as they are created by the
connection pool, where the value then stays set without being reset on
every checkin.</p>
<p>The <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code></a> parameter is essentially
equivalent in functionality to using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine.execution_options.params.isolation_level" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Engine.execution_options.isolation_level</span></code></a> parameter via
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a> for an engine-wide setting. The
difference is in that the former setting assigns the isolation level just
once when a connection is created, the latter sets and resets the given
level on each connection checkout.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6342">#6342</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-29"><span class="target" id="change-e3fae2f008eeb9fd384e7b4264731713"><strong>[engine] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e3fae2f008eeb9fd384e7b4264731713">¶</a></span><p>Some small API changes regarding engines and dialects:</p>
<ul>
<li><p>The <a class="reference internal" href="../core/internals.html#sqlalchemy.engine.Dialect.set_isolation_level" title="sqlalchemy.engine.Dialect.set_isolation_level"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Dialect.set_isolation_level()</span></code></a>, <a class="reference internal" href="../core/internals.html#sqlalchemy.engine.Dialect.get_isolation_level" title="sqlalchemy.engine.Dialect.get_isolation_level"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Dialect.get_isolation_level()</span></code></a>,
:meth:
dialect methods will always be passed the raw DBAPI connection</p></li>
<li><p>The <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> classes no longer share a base
<code class="docutils literal notranslate"><span class="pre">Connectable</span></code> superclass, which has been removed.</p></li>
<li><p>Added a new interface class <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> - this is the
public facing interface for the familiar <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool._ConnectionFairy" title="sqlalchemy.pool._ConnectionFairy"><code class="xref py py-class docutils literal notranslate"><span class="pre">_ConnectionFairy</span></code></a>
class which is nonetheless a private class.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7122">#7122</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-30"><span class="target" id="change-a7295d94c49db7ecfd488d88ebda3b4b"><strong>[engine] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a7295d94c49db7ecfd488d88ebda3b4b">¶</a></span><p>Fixed regression where the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.fetchmany" title="sqlalchemy.engine.CursorResult.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.fetchmany()</span></code></a> method
would fail to autoclose a server-side cursor (i.e. when <code class="docutils literal notranslate"><span class="pre">stream_results</span></code>
or <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> is in use, either Core or ORM oriented results) when the
results were fully exhausted.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7274">#7274</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-31"><span class="target" id="change-a1432a653dd105f22367bf8d37bc26f4"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a1432a653dd105f22367bf8d37bc26f4">¶</a></span><p>Fixed issue in future <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> where calling upon
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine.begin" title="sqlalchemy.engine.Engine.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.begin()</span></code></a> and entering the context manager would not
close the connection if the actual BEGIN operation failed for some reason,
such as an event handler raising an exception; this use case failed to be
tested for the future version of the engine. Note that the “future” context
managers which handle <code class="docutils literal notranslate"><span class="pre">begin()</span></code> blocks in Core and ORM don’t actually run
the “BEGIN” operation until the context managers are actually entered. This
is different from the legacy version which runs the “BEGIN” operation up
front.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7272">#7272</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-32"><span class="target" id="change-97d91929f22f292e9c0066e3ce128dd2"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-97d91929f22f292e9c0066e3ce128dd2">¶</a></span><p>The <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> now ignores <code class="docutils literal notranslate"><span class="pre">max_overflow</span></code> when
<code class="docutils literal notranslate"><span class="pre">pool_size=0</span></code>, properly making the pool unlimited in all cases.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8523">#8523</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-33"><span class="target" id="change-a050cd97c80008db66b86adba0d87aaf"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a050cd97c80008db66b86adba0d87aaf">¶</a></span><p>For improved security, the <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL" title="sqlalchemy.engine.URL"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> object will now use password
obfuscation by default when <code class="docutils literal notranslate"><span class="pre">str(url)</span></code> is called. To stringify a URL with
cleartext password, the <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL.render_as_string" title="sqlalchemy.engine.URL.render_as_string"><code class="xref py py-meth docutils literal notranslate"><span class="pre">URL.render_as_string()</span></code></a> may be used,
passing the <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL.render_as_string.params.hide_password" title="sqlalchemy.engine.URL.render_as_string"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">URL.render_as_string.hide_password</span></code></a> parameter
as <code class="docutils literal notranslate"><span class="pre">False</span></code>. Thanks to our contributors for this pull request.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-8567"><span class="std std-ref">str(engine.url) will obfuscate the password by default</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8567">#8567</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-34"><span class="target" id="change-110ae4e152d8ccde03e47984e46e3a59"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-110ae4e152d8ccde03e47984e46e3a59">¶</a></span><p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code> method will now consistently check
for views of the given name as well as tables. Previously this behavior was
dialect dependent, with PostgreSQL, MySQL/MariaDB and SQLite supporting it,
and Oracle and SQL Server not supporting it. Third party dialects should
also seek to ensure their <code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code> method
searches for views as well as tables for the given name.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7161">#7161</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-35"><span class="target" id="change-d3c8ea884a50866a59532420df9574e5"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d3c8ea884a50866a59532420df9574e5">¶</a></span><p>Fixed issue in <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> method where calling upon
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> with a single index could in some cases,
particularly ORM result object cases, cause the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> to yield
scalar objects rather than <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects, as though the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> method had been called. In SQLAlchemy 1.4, this
scenario emits a warning that the behavior will change in SQLAlchemy 2.0.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7953">#7953</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-36"><span class="target" id="change-68a0a4f1bc675d02f5d125af87ed2d8c"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-68a0a4f1bc675d02f5d125af87ed2d8c">¶</a></span><p>Passing a <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.DefaultGenerator" title="sqlalchemy.schema.DefaultGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultGenerator</span></code></a> object such as a <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> to
the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a> method is deprecated, as this method is
typed as returning a <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> object, and not a plain scalar
value. The <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.scalar" title="sqlalchemy.engine.Connection.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.scalar()</span></code></a> method should be used instead, which
has been reworked with new internal codepaths to suit invoking a SELECT for
default generation objects without going through the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a> method.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-37"><span class="target" id="change-d3c558ad9e8f445302079e0e27c37e2a"><strong>[engine] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d3c558ad9e8f445302079e0e27c37e2a">¶</a></span><p>Removed the previously deprecated <code class="docutils literal notranslate"><span class="pre">case_sensitive</span></code> parameter from
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>, which would impact only the lookup of string
column names in Core-only result set rows; it had no effect on the behavior
of the ORM. The effective behavior of what <code class="docutils literal notranslate"><span class="pre">case_sensitive</span></code> refers
towards remains at its default value of <code class="docutils literal notranslate"><span class="pre">True</span></code>, meaning that string names
looked up in <code class="docutils literal notranslate"><span class="pre">row._mapping</span></code> will match case-sensitively, just like any
other Python mapping.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">case_sensitive</span></code> parameter was not in any way related to
the general subject of case sensitivity control, quoting, and “name
normalization” (i.e. converting for databases that consider all uppercase
words to be case insensitive) for DDL identifier names, which remains a
normal core feature of SQLAlchemy.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-38"><span class="target" id="change-a62d45bbda835c4784d947263d0013d9"><strong>[engine] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a62d45bbda835c4784d947263d0013d9">¶</a></span><p>Removed legacy and deprecated package <code class="docutils literal notranslate"><span class="pre">sqlalchemy.databases</span></code>.
Please use <code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects</span></code> instead.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-39"><span class="target" id="change-a68415ac51247dd9cdf35760d11f09c0"><strong>[engine] [deprecations]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a68415ac51247dd9cdf35760d11f09c0">¶</a></span><p>The <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.implicit_returning" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.implicit_returning</span></code></a> parameter is
deprecated on the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> function only; the parameter
remains available on the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object. This parameter was
originally intended to enable the “implicit returning” feature of
SQLAlchemy when it was first developed and was not enabled by default.
Under modern use, there’s no reason this parameter should be disabled, and
it has been observed to cause confusion as it degrades performance and
makes it more difficult for the ORM to retrieve recently inserted server
defaults. The parameter remains available on <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> to
specifically suit database-level edge cases which make RETURNING
infeasible, the sole example currently being SQL Server’s limitation that
INSERT RETURNING may not be used on a table that has INSERT triggers on it.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6962">#6962</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-sql">
<h3>sql<a class="headerlink" href="#change-2.0.0b1-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-40"><span class="target" id="change-22fe9fadf6dd1bf4c2d29a4cfd5db4d9"><strong>[sql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-22fe9fadf6dd1bf4c2d29a4cfd5db4d9">¶</a></span><blockquote>
<div><p>Added long-requested case-insensitive string operators
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.icontains" title="sqlalchemy.sql.expression.ColumnOperators.icontains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.icontains()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.istartswith" title="sqlalchemy.sql.expression.ColumnOperators.istartswith"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.istartswith()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.iendswith" title="sqlalchemy.sql.expression.ColumnOperators.iendswith"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.iendswith()</span></code></a>, which produce case-insensitive
LIKE compositions (using ILIKE on PostgreSQL, and the LOWER() function on
all other backends) to complement the existing LIKE composition operators
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.contains" title="sqlalchemy.sql.expression.ColumnOperators.contains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.contains()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.startswith" title="sqlalchemy.sql.expression.ColumnOperators.startswith"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.startswith()</span></code></a>, etc. Huge thanks to Matias
Martinez Rebori for their meticulous and complete efforts in implementing
these new methods.</p>
</div></blockquote>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/3482">#3482</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-41"><span class="target" id="change-c2afa6591cbe398ba0d096588c60b1a7"><strong>[sql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c2afa6591cbe398ba0d096588c60b1a7">¶</a></span><p>Added new syntax to the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause.c" title="sqlalchemy.sql.expression.FromClause.c"><code class="xref py py-attr docutils literal notranslate"><span class="pre">FromClause.c</span></code></a> collection on all
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a> objects allowing tuples of keys to be passed to
<code class="docutils literal notranslate"><span class="pre">__getitem__()</span></code>, along with support for the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct
to handle the resulting tuple-like collection directly, allowing the syntax
<code class="docutils literal notranslate"><span class="pre">select(table.c['a',</span> <span class="pre">'b',</span> <span class="pre">'c'])</span></code> to be possible. The sub-collection
returned is itself a <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a> which is also directly
consumable by <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> and similar now.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/data_select.html#tutorial-selecting-columns"><span class="std std-ref">Setting the COLUMNS and FROM clause</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8285">#8285</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-42"><span class="target" id="change-e673d427c771a23e933070c033f8353a"><strong>[sql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e673d427c771a23e933070c033f8353a">¶</a></span><p>Added new backend-agnostic <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype generalized from
the PostgreSQL dialects to now be a core type, as well as migrated
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UUID" title="sqlalchemy.types.UUID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUID</span></code></a> from the PostgreSQL dialect. The SQL Server
<a class="reference internal" href="../dialects/mssql.html#sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER" title="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER"><code class="xref py py-class docutils literal notranslate"><span class="pre">UNIQUEIDENTIFIER</span></code></a> datatype also becomes a UUID-handling
datatype. Thanks to Trevor Gross for the help on this.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7212">#7212</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-43"><span class="target" id="change-656cb5d4ea4573032efb0c829fcc7369"><strong>[sql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-656cb5d4ea4573032efb0c829fcc7369">¶</a></span><p>Added <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DOUBLE" title="sqlalchemy.types.DOUBLE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOUBLE</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DOUBLE_PRECISION" title="sqlalchemy.types.DOUBLE_PRECISION"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOUBLE_PRECISION</span></code></a>
datatypes to the base <code class="docutils literal notranslate"><span class="pre">sqlalchemy.</span></code> module namespace, for explicit use of
double/double precision as well as generic “double” datatypes. Use
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a> for generic support that will resolve to DOUBLE/DOUBLE
PRECISION/FLOAT as needed for different backends.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5465">#5465</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-44"><span class="target" id="change-170b21974f5a801bafb679dcd6a1cb81"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-170b21974f5a801bafb679dcd6a1cb81">¶</a></span><p>Altered the compilation mechanics of the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> construct
such that the “autoincrement primary key” column value will be fetched via
<code class="docutils literal notranslate"><span class="pre">cursor.lastrowid</span></code> or RETURNING even if present in the parameter set or
within the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> method as a plain bound value, for
single-row INSERT statements on specific backends that are known to
generate autoincrementing values even when explicit NULL is passed. This
restores a behavior that was in the 1.3 series for both the use case of
separate parameter set as well as <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a>. In 1.4, the
parameter set behavior unintentionally changed to no longer do this, but
the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> method would still fetch autoincrement
values up until 1.4.21 where <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6770">#6770</a> changed the behavior yet again
again unintentionally as this use case was never covered.</p>
<p>The behavior is now defined as “working” to suit the case where databases
such as SQLite, MySQL and MariaDB will ignore an explicit NULL primary key
value and nonetheless invoke an autoincrement generator.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7998">#7998</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-45"><span class="target" id="change-206ec1f2af3a0c93785758c723ba356f"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-206ec1f2af3a0c93785758c723ba356f">¶</a></span><p>Added modified ISO-8601 rendering (i.e. ISO-8601 with the T converted to a
space) when using <code class="docutils literal notranslate"><span class="pre">literal_binds</span></code> with the SQL compilers provided by the
PostgreSQL, MySQL, MariaDB, MSSQL, Oracle dialects. For Oracle, the ISO
format is wrapped inside of an appropriate TO_DATE() function call.
Previously this rendering was not implemented for dialect-specific
compilation.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-5052"><span class="std std-ref">DATE, TIME, DATETIME datatypes now support literal rendering on all backends</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5052">#5052</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-46"><span class="target" id="change-d147fd94fb29d392cc08a7a1cd1e70a6"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d147fd94fb29d392cc08a7a1cd1e70a6">¶</a></span><p>Added new parameter <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.HasCTE.add_cte.params.nest_here" title="sqlalchemy.sql.expression.HasCTE.add_cte"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">HasCTE.add_cte.nest_here</span></code></a> to
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.HasCTE.add_cte" title="sqlalchemy.sql.expression.HasCTE.add_cte"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HasCTE.add_cte()</span></code></a> which will “nest” a given <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.CTE" title="sqlalchemy.sql.expression.CTE"><code class="xref py py-class docutils literal notranslate"><span class="pre">CTE</span></code></a> at the
level of the parent statement. This parameter is equivalent to using the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.HasCTE.cte.params.nesting" title="sqlalchemy.sql.expression.HasCTE.cte"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">HasCTE.cte.nesting</span></code></a> parameter, but may be more intuitive in
some scenarios as it allows the nesting attribute to be set simultaneously
along with the explicit level of the CTE.</p>
<p>The <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.HasCTE.add_cte" title="sqlalchemy.sql.expression.HasCTE.add_cte"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HasCTE.add_cte()</span></code></a> method also accepts multiple CTE objects.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7759">#7759</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-47"><span class="target" id="change-6a63059a1761aa1b0d74827adc9422a2"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6a63059a1761aa1b0d74827adc9422a2">¶</a></span><p>The FROM clauses that are established on a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct
when using the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a> method will now render first
in the FROM clause of the rendered SELECT, which serves to maintain the
ordering of clauses as was passed to the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a>
method itself without being affected by the presence of those clauses also
being mentioned in other parts of the query. If other elements of the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> also generate FROM clauses, such as the columns clause
or WHERE clause, these will render after the clauses delivered by
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a> assuming they were not explictly passed to
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a> also. This improvement is useful in those
cases where a particular database generates a desirable query plan based on
a particular ordering of FROM clauses and allows full control over the
ordering of FROM clauses.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7888">#7888</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-48"><span class="target" id="change-87aa36a0518bccb608ef16ceaf60b890"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-87aa36a0518bccb608ef16ceaf60b890">¶</a></span><p>The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.length" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.length</span></code></a> parameter, which sets the length of the
<code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> column for non-native enumeration types, is now used
unconditionally when emitting DDL for the <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> datatype, including
when the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.native_enum" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.native_enum</span></code></a> parameter is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> for
target backends that continue to use <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code>. Previously the parameter
would be erroneously ignored in this case. The warning previously emitted
for this case is now removed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7791">#7791</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-49"><span class="target" id="change-e91ecefb983298aca355b0a33a87d1a9"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e91ecefb983298aca355b0a33a87d1a9">¶</a></span><p>The in-place type detection for Python integers, as occurs with an
expression such as <code class="docutils literal notranslate"><span class="pre">literal(25)</span></code>, will now apply value-based adaption as
well to accommodate Python large integers, where the datatype determined
will be <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigInteger</span></code></a> rather than <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Integer</span></code></a>. This
accommodates for dialects such as that of asyncpg which both sends implicit
typing information to the driver as well as is sensitive to numeric scale.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7909">#7909</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-50"><span class="target" id="change-905fba8337fac314efdf51d2ba475661"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-905fba8337fac314efdf51d2ba475661">¶</a></span><p>Added <code class="docutils literal notranslate"><span class="pre">if_exists</span></code> and <code class="docutils literal notranslate"><span class="pre">if_not_exists</span></code> parameters for all “Create” /
“Drop” constructs including <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.CreateSequence" title="sqlalchemy.schema.CreateSequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateSequence</span></code></a>,
<a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropSequence" title="sqlalchemy.schema.DropSequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">DropSequence</span></code></a>, <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.CreateIndex" title="sqlalchemy.schema.CreateIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateIndex</span></code></a>, <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropIndex" title="sqlalchemy.schema.DropIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DropIndex</span></code></a>, etc.
allowing generic “IF EXISTS” / “IF NOT EXISTS” phrases to be rendered
within DDL. Pull request courtesy Jesse Bakker.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7354">#7354</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-51"><span class="target" id="change-816ba1e2d278370824c287ddc4b1715e"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-816ba1e2d278370824c287ddc4b1715e">¶</a></span><p>Improved the construction of SQL binary expressions to allow for very long
expressions against the same associative operator without special steps
needed in order to avoid high memory use and excess recursion depth. A
particular binary operation <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">op</span> <span class="pre">B</span></code> can now be joined against another
element <code class="docutils literal notranslate"><span class="pre">op</span> <span class="pre">C</span></code> and the resulting structure will be “flattened” so that
the representation as well as SQL compilation does not require recursion.</p>
<p>One effect of this change is that string concatenation expressions which
use SQL functions come out as “flat”, e.g. MySQL will now render
<code class="docutils literal notranslate"><span class="pre">concat('x',</span> <span class="pre">'y',</span> <span class="pre">'z',</span> <span class="pre">...)`</span></code> rather than nesting together two-element
functions like <code class="docutils literal notranslate"><span class="pre">concat(concat('x',</span> <span class="pre">'y'),</span> <span class="pre">'z')</span></code>.  Third-party dialects
which override the string concatenation operator will need to implement
a new method <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">visit_concat_op_expression_clauselist()</span></code> to
accompany the existing <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">visit_concat_op_binary()</span></code> method.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7744">#7744</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-52"><span class="target" id="change-c890bd8c6ede5004dfc1027d531dbcda"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c890bd8c6ede5004dfc1027d531dbcda">¶</a></span><p>Implemented full support for “truediv” and “floordiv” using the
“/” and “//” operators.  A “truediv” operation between two expressions
using <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Integer</span></code></a> now considers the result to be
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a>, and the dialect-level compilation will cast
the right operand to a numeric type on a dialect-specific basis to ensure
truediv is achieved.  For floordiv, conversion is also added for those
databases that don’t already do floordiv by default (MySQL, Oracle) and
the <code class="docutils literal notranslate"><span class="pre">FLOOR()</span></code> function is rendered in this case, as well as for
cases where the right operand is not an integer (needed for PostgreSQL,
others).</p>
<p>The change resolves issues both with inconsistent behavior of the
division operator on different backends and also fixes an issue where
integer division on Oracle would fail to be able to fetch a result due
to inappropriate outputtypehandlers.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-4926"><span class="std std-ref">Python division operator performs true division for all backends; added floor division</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4926">#4926</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-53"><span class="target" id="change-bac33401bdbf98e367cce7f8621f1cb2"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bac33401bdbf98e367cce7f8621f1cb2">¶</a></span><p>Added an additional lookup step to the compiler which will track all FROM
clauses which are tables, that may have the same name shared in multiple
schemas where one of the schemas is the implicit “default” schema; in this
case, the table name when referring to that name without a schema
qualification will be rendered with an anonymous alias name at the compiler
level in order to disambiguate the two (or more) names. The approach of
schema-qualifying the normally unqualified name with the server-detected
“default schema name” value was also considered, however this approach
doesn’t apply to Oracle nor is it accepted by SQL Server, nor would it work
with multiple entries in the PostgreSQL search path. The name collision
issue resolved here has been identified as affecting at least Oracle,
PostgreSQL, SQL Server, MySQL and MariaDB.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7471">#7471</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-54"><span class="target" id="change-4fed778e4634104080875dc4591f302b"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4fed778e4634104080875dc4591f302b">¶</a></span><p>Python string values for which a SQL type is determined from the type of
the value, mainly when using <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.literal" title="sqlalchemy.sql.expression.literal"><code class="xref py py-func docutils literal notranslate"><span class="pre">literal()</span></code></a>, will now apply the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a> type, rather than the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a>
datatype, for Python string values that test as “ascii only” using Python
<code class="docutils literal notranslate"><span class="pre">str.isascii()</span></code>. If the string is not <code class="docutils literal notranslate"><span class="pre">isascii()</span></code>, the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> datatype will be bound instead, which was used in
all string detection previously. This behavior <strong>only applies to in-place
detection of datatypes when using ``literal()`` or other contexts that have
no existing datatype</strong>, which is not usually the case under normal
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> comparison operations, where the type of the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> being compared always takes precedence.</p>
<p>Use of the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> datatype can determine literal string
formatting on backends such as SQL Server, where a literal value (i.e.
using <code class="docutils literal notranslate"><span class="pre">literal_binds</span></code>) will be rendered as <code class="docutils literal notranslate"><span class="pre">N'&lt;value&gt;'</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">'value'</span></code>. For normal bound value handling, the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a>
datatype also may have implications for passing values to the DBAPI, again
in the case of SQL Server, the pyodbc driver supports the use of
<a class="reference internal" href="../dialects/mssql.html#mssql-pyodbc-setinputsizes"><span class="std std-ref">setinputsizes mode</span></a> which will handle
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a> versus <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> differently.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7551">#7551</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-55"><span class="target" id="change-18c21fd7ebd6b296cd7bc3e08a7454da"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-18c21fd7ebd6b296cd7bc3e08a7454da">¶</a></span><p>The <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.array_agg" title="sqlalchemy.sql.functions.array_agg"><code class="xref py py-class docutils literal notranslate"><span class="pre">array_agg</span></code></a> will now set the array dimensions to 1.
Improved <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> processing to accept <code class="docutils literal notranslate"><span class="pre">None</span></code> values as
value of a multi-array.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7083">#7083</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-schema">
<h3>schema<a class="headerlink" href="#change-2.0.0b1-schema" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-56"><span class="target" id="change-4ecc460683a3c2c6822f77f06592c17e"><strong>[schema] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4ecc460683a3c2c6822f77f06592c17e">¶</a></span><p>Expanded on the “conditional DDL” system implemented by the
<a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.ExecutableDDLElement" title="sqlalchemy.schema.ExecutableDDLElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutableDDLElement</span></code></a> class (renamed from
<code class="xref py py-class docutils literal notranslate"><span class="pre">DDLElement</span></code>) to be directly available on
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.SchemaItem" title="sqlalchemy.schema.SchemaItem"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchemaItem</span></code></a> constructs such as <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>,
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyConstraint</span></code></a>, etc. such that the conditional logic
for generating these elements is included within the default DDL emitting
process. This system can also be accommodated by a future release of
Alembic to support conditional DDL elements within all schema-management
systems.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#ticket-7631"><span class="std std-ref">New Conditional DDL for Constraints and Indexes</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7631">#7631</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-57"><span class="target" id="change-1ea0dc71b73cdbb72cc4179667304cb5"><strong>[schema] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1ea0dc71b73cdbb72cc4179667304cb5">¶</a></span><p>Added parameter <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropConstraint.params.if_exists" title="sqlalchemy.schema.DropConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">DropConstraint.if_exists</span></code></a> to the
<a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropConstraint" title="sqlalchemy.schema.DropConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">DropConstraint</span></code></a> construct which result in “IF EXISTS” DDL
being added to the DROP statement.
This phrase is not accepted by all databases and the operation will fail
on a database that does not support it as there is no similarly compatible
fallback within the scope of a single DDL statement.
Pull request courtesy Mike Fiedler.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8141">#8141</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-58"><span class="target" id="change-f7546711184fa129ae3bde373df46f58"><strong>[schema] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f7546711184fa129ae3bde373df46f58">¶</a></span><p>Implemented the DDL event hooks <a class="reference internal" href="../core/events.html#sqlalchemy.events.DDLEvents.before_create" title="sqlalchemy.events.DDLEvents.before_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DDLEvents.before_create()</span></code></a>,
<a class="reference internal" href="../core/events.html#sqlalchemy.events.DDLEvents.after_create" title="sqlalchemy.events.DDLEvents.after_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DDLEvents.after_create()</span></code></a>, <a class="reference internal" href="../core/events.html#sqlalchemy.events.DDLEvents.before_drop" title="sqlalchemy.events.DDLEvents.before_drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DDLEvents.before_drop()</span></code></a>,
<a class="reference internal" href="../core/events.html#sqlalchemy.events.DDLEvents.after_drop" title="sqlalchemy.events.DDLEvents.after_drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DDLEvents.after_drop()</span></code></a> for all <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.SchemaItem" title="sqlalchemy.schema.SchemaItem"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchemaItem</span></code></a> objects that
include a distinct CREATE or DROP step, when that step is invoked as a
distinct SQL statement, including for <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyConstraint</span></code></a>,
<a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a>, <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>, and PostgreSQL’s
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8394">#8394</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-59"><span class="target" id="change-ab32132db96a6758f6d2db87c0902726"><strong>[schema] [performance]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ab32132db96a6758f6d2db87c0902726">¶</a></span><p>Rearchitected the schema reflection API to allow participating dialects to
make use of high performing batch queries to reflect the schemas of many
tables at once using fewer queries by an order of magnitude. The
new performance features are targeted first at the PostgreSQL and Oracle
backends, and may be applied to any dialect that makes use of SELECT
queries against system catalog tables to reflect tables. The change also
includes new API features and behavioral improvements to the
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code></a> object, including consistent, cached behavior of
methods like <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_table" title="sqlalchemy.engine.reflection.Inspector.has_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code></a>,
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_table_names" title="sqlalchemy.engine.reflection.Inspector.get_table_names"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_table_names()</span></code></a> and new methods
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_schema" title="sqlalchemy.engine.reflection.Inspector.has_schema"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_schema()</span></code></a> and <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_index" title="sqlalchemy.engine.reflection.Inspector.has_index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_index()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-4379"><span class="std std-ref">Major Architectural, Performance and API Enhancements for Database Reflection</span></a> - full background</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4379">#4379</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-60"><span class="target" id="change-ca40f9f7c90e511acfdc4955ea3c04ab"><strong>[schema] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ca40f9f7c90e511acfdc4955ea3c04ab">¶</a></span><p>The warnings that are emitted regarding reflection of indexes or unique
constraints, when the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.include_columns" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.include_columns</span></code></a> parameter is used
to exclude columns that are then found to be part of those constraints,
have been removed. When the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.include_columns" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.include_columns</span></code></a> parameter is
used it should be expected that the resulting <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> construct
will not include constraints that rely upon omitted columns. This change
was made in response to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8100">#8100</a> which repaired
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.include_columns" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.include_columns</span></code></a> in conjunction with foreign key
constraints that rely upon omitted columns, where the use case became
clear that omitting such constraints should be expected.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8102">#8102</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-61"><span class="target" id="change-66d1e7a853724670dc6797707dd59014"><strong>[schema] [postgresql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-66d1e7a853724670dc6797707dd59014">¶</a></span><p>Added support for comments on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Constraint" title="sqlalchemy.schema.Constraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Constraint</span></code></a> objects, including
DDL and reflection; the field is added to the base <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Constraint" title="sqlalchemy.schema.Constraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Constraint</span></code></a>
class and corresponding constructors, however PostgreSQL is the only
included backend to support the feature right now.
See parameters such as <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint.params.comment" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ForeignKeyConstraint.comment</span></code></a>,
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint.params.comment" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">UniqueConstraint.comment</span></code></a> or
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.CheckConstraint.params.comment" title="sqlalchemy.schema.CheckConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">CheckConstraint.comment</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5677">#5677</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-62"><span class="target" id="change-47550d59426f7b27d2e5c4970c46845b"><strong>[schema] [mariadb] [mysql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-47550d59426f7b27d2e5c4970c46845b">¶</a></span><p>Add support for Partitioning and Sample pages on MySQL and MariaDB
reflected options.
The options are stored in the table dialect options dictionary, so
the following keyword need to be prefixed with <code class="docutils literal notranslate"><span class="pre">mysql_</span></code> or <code class="docutils literal notranslate"><span class="pre">mariadb_</span></code>
depending on the backend.
Supported options are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">stats_sample_pages</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">partition_by</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">partitions</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subpartition_by</span></code></p></li>
</ul>
<p>These options are also reflected when loading a table from database,
and will populate the table <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.dialect_options" title="sqlalchemy.schema.Table.dialect_options"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.dialect_options</span></code></a>.
Pull request courtesy of Ramon Will.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4038">#4038</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0b1-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-63"><span class="target" id="change-1d1e0e4eafc37d5f908f7f2b5b97f898"><strong>[typing] [improvement]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1d1e0e4eafc37d5f908f7f2b5b97f898">¶</a></span><p>The <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a> method now returns a copy of
the original <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code></a> object, rather than wrapping it
inside the <code class="docutils literal notranslate"><span class="pre">Variant</span></code> class, which is effectively removed (the import
symbol remains for backwards compatibility with code that may be testing
for this symbol). While the previous approach maintained in-Python
behaviors, maintaining the original type allows for clearer type checking
and debugging.</p>
<p><a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a> also accepts multiple dialect
names per call as well, in particular this is helpful for related
backend names such as <code class="docutils literal notranslate"><span class="pre">&quot;mysql&quot;,</span> <span class="pre">&quot;mariadb&quot;</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-6980"><span class="std std-ref">“with_variant()” clones the original TypeEngine rather than changing the type</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6980">#6980</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.0b1-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-64"><span class="target" id="change-90e9d6d909128fe3d124c12c6b8e7564"><strong>[postgresql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-90e9d6d909128fe3d124c12c6b8e7564">¶</a></span><p>Added a new PostgreSQL <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.DOMAIN" title="sqlalchemy.dialects.postgresql.DOMAIN"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOMAIN</span></code></a> datatype, which follows
the same CREATE TYPE / DROP TYPE behaviors as that of PostgreSQL
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>. Much thanks to David Baumgold for the efforts on
this.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.DOMAIN" title="sqlalchemy.dialects.postgresql.DOMAIN"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOMAIN</span></code></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7316">#7316</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-65"><span class="target" id="change-92afe9a33cee323308a5e37813c0dcfa"><strong>[postgresql] [usecase] [asyncpg]</strong> <a class="changelog-reference headerlink reference internal" href="#change-92afe9a33cee323308a5e37813c0dcfa">¶</a></span><p>Added overridable methods <code class="docutils literal notranslate"><span class="pre">PGDialect_asyncpg.setup_asyncpg_json_codec</span></code>
and <code class="docutils literal notranslate"><span class="pre">PGDialect_asyncpg.setup_asyncpg_jsonb_codec</span></code> codec, which handle the
required task of registering JSON/JSONB codecs for these datatypes when
using asyncpg. The change is that methods are broken out as individual,
overridable methods to support third party dialects that need to alter or
disable how these particular codecs are set up.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7284">#7284</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-66"><span class="target" id="change-9b64c9d04c4c812f6c4486ed669673df"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9b64c9d04c4c812f6c4486ed669673df">¶</a></span><p>Added literal type rendering for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> and
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> datatypes. The generic stringify will render
using brackets, e.g. <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> and the PostgreSQL specific will use the
ARRAY literal e.g. <code class="docutils literal notranslate"><span class="pre">ARRAY[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>.   Multiple dimensions and quoting
are also taken into account.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8138">#8138</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-67"><span class="target" id="change-73e6bb02bd07660d73a82d779b57a185"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-73e6bb02bd07660d73a82d779b57a185">¶</a></span><p>Adds support for PostgreSQL multirange types, introduced in PostgreSQL 14.
Support for PostgreSQL ranges and multiranges has now been generalized to
the psycopg3, psycopg2 and asyncpg backends, with room for further dialect
support, using a backend-agnostic <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> data object
that’s constructor-compatible with the previously used psycopg2 object. See
the new documentation for usage patterns.</p>
<p>In addition, range type handling has been enhanced so that it automatically
renders type casts, so that in-place round trips for statements that don’t
provide the database with any context don’t require the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.cast" title="sqlalchemy.sql.expression.cast"><code class="xref py py-func docutils literal notranslate"><span class="pre">cast()</span></code></a>
construct to be explicit for the database to know the desired type
(discussed at <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8540">#8540</a>).</p>
<p>Thanks very much to &#64;zeeeeeb for the pull request implementing and testing
the new datatypes and psycopg support.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7156"><span class="std std-ref">New RANGE / MULTIRANGE support and changes for PostgreSQL backends</span></a></p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-ranges"><span class="std std-ref">Range and Multirange Types</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7156">#7156</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8540">#8540</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-68"><span class="target" id="change-1b0ea2017fff13b414df34e6dcd9ccb6"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1b0ea2017fff13b414df34e6dcd9ccb6">¶</a></span><p>The “ping” query emitted when configuring
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.pool_pre_ping" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_pre_ping</span></code></a> for psycopg, asyncpg and
pg8000, but not for psycopg2, has been changed to be an empty query (<code class="docutils literal notranslate"><span class="pre">;</span></code>)
instead of <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">1</span></code>; additionally, for the asyncpg driver, the
unnecessary use of a prepared statement for this query has been fixed.
Rationale is to eliminate the need for PostgreSQL to produce a query plan
when the ping is emitted. The operation is not currently supported by the
<code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> driver which continues to use <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">1</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8491">#8491</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-69"><span class="target" id="change-96ad4d2fbdb1de804021ed77109bb9f2"><strong>[postgresql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-96ad4d2fbdb1de804021ed77109bb9f2">¶</a></span><p>SQLAlchemy now requires PostgreSQL version 9 or greater.
Older versions may still work in some limited use cases.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-70"><span class="target" id="change-b7ea5c77ccc1196e5a318ac94461998c"><strong>[postgresql] [change] [mssql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b7ea5c77ccc1196e5a318ac94461998c">¶</a></span><p>The parameter <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UUID.params.as_uuid" title="sqlalchemy.types.UUID"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">UUID.as_uuid</span></code></a> of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UUID" title="sqlalchemy.types.UUID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUID</span></code></a>,
previously specific to the PostgreSQL dialect but now generalized for Core
(along with a new backend-agnostic <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype) now
defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>, indicating that Python <code class="docutils literal notranslate"><span class="pre">UUID</span></code> objects are accepted
by this datatype by default. Additionally, the SQL Server
<a class="reference internal" href="../dialects/mssql.html#sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER" title="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER"><code class="xref py py-class docutils literal notranslate"><span class="pre">UNIQUEIDENTIFIER</span></code></a> datatype has been converted to be a
UUID-receiving type; for legacy code that makes use of
<a class="reference internal" href="../dialects/mssql.html#sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER" title="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER"><code class="xref py py-class docutils literal notranslate"><span class="pre">UNIQUEIDENTIFIER</span></code></a> using string values, set the
<a class="reference internal" href="../dialects/mssql.html#sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER.params.as_uuid" title="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">UNIQUEIDENTIFIER.as_uuid</span></code></a> parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7225">#7225</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-71"><span class="target" id="change-33d6e94995b466fd7fb148087a706367"><strong>[postgresql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-33d6e94995b466fd7fb148087a706367">¶</a></span><p>The <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM.params.name" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ENUM.name</span></code></a> parameter for the PostgreSQL-specific
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> datatype is now a required keyword argument. The
“name” is necessary in any case in order for the <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>
to be usable as an error would be raised at SQL/DDL render time if “name”
were not present.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-72"><span class="target" id="change-04dc36cb52d0fa4ff70bd26876572252"><strong>[postgresql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-04dc36cb52d0fa4ff70bd26876572252">¶</a></span><p>In support of new PostgreSQL features including the psycopg3 dialect as
well as extended “fast insertmany” support, the system by which typing
information for bound parameters is passed to the PostgreSQL database has
been redesigned to use inline casts emitted by the SQL compiler, and is now
applied to all PostgreSQL dialects. This is in contrast to the previous
approach which would rely upon the DBAPI in use to render these casts
itself, which in cases such as that of pg8000 and the adapted asyncpg
driver, would use the pep-249 <code class="docutils literal notranslate"><span class="pre">setinputsizes()</span></code> method, or with the
psycopg2 driver would rely on the driver itself in most cases, with some
special exceptions made for ARRAY.</p>
<p>The new approach now has all PostgreSQL dialects rendering these casts as
needed using PostgreSQL double-colon style within the compiler, and the use
of <code class="docutils literal notranslate"><span class="pre">setinputsizes()</span></code> is removed for PostgreSQL dialects, as this was not
generally part of these DBAPIs in any case (pg8000 being the only
exception, which added the method at the request of SQLAlchemy developers).</p>
<p>Advantages to this approach include per-statement performance, as no second
pass over the compiled statement is required at execution time, better
support for all DBAPIs, as there is now one consistent system of applying
typing information, and improved transparency, as the SQL logging output,
as well as the string output of a compiled statement, will show these casts
present in the statement directly, whereas previously these casts were not
visible in logging output as they would occur after the statement were
logged.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-73"><span class="target" id="change-935bb8389d1b929fd1194a0e0894b206"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-935bb8389d1b929fd1194a0e0894b206">¶</a></span><p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.match()</span></code> operator now uses <code class="docutils literal notranslate"><span class="pre">plainto_tsquery()</span></code> for
PostgreSQL full text search, rather than <code class="docutils literal notranslate"><span class="pre">to_tsquery()</span></code>. The rationale
for this change is to provide better cross-compatibility with match on
other database backends.    Full support for all PostgreSQL full text
functions remains available through the use of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal notranslate"><span class="pre">func</span></code></a> in
conjunction with <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.bool_op" title="sqlalchemy.sql.expression.Operators.bool_op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.bool_op()</span></code></a> (an improved version of
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.op" title="sqlalchemy.sql.expression.Operators.op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.op()</span></code></a> for boolean operators).</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7086"><span class="std std-ref">match() operator on PostgreSQL uses plainto_tsquery() rather than to_tsquery()</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7086">#7086</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-74"><span class="target" id="change-bbfdedcb8620389a1371af67d62f0954"><strong>[postgresql] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bbfdedcb8620389a1371af67d62f0954">¶</a></span><p>Removed support for multiple deprecated drivers:</p>
<blockquote>
<div><ul>
<li><p>pypostgresql for PostgreSQL. This is available as an
external driver at <a class="reference external" href="https://github.com/PyGreSQL">https://github.com/PyGreSQL</a></p></li>
<li><p>pygresql for PostgreSQL.</p></li>
</ul>
</div></blockquote>
<p>Please switch to one of the supported drivers or to the external
version of the same driver.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-75"><span class="target" id="change-32b6d7cf0016c874c53d1b3d7cb20f3a"><strong>[postgresql] [dialect]</strong> <a class="changelog-reference headerlink reference internal" href="#change-32b6d7cf0016c874c53d1b3d7cb20f3a">¶</a></span><p>Added support for <code class="docutils literal notranslate"><span class="pre">psycopg</span></code> dialect supporting both sync and async
execution. This dialect is available under the <code class="docutils literal notranslate"><span class="pre">postgresql+psycopg</span></code> name
for both the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> and
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a> engine-creation functions.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#ticket-6842"><span class="std std-ref">Dialect support for psycopg 3 (a.k.a. “psycopg”)</span></a></p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-psycopg"><span class="std std-ref">psycopg</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6842">#6842</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-76"><span class="target" id="change-02657081e3c39ff6edc04c60443ec994"><strong>[postgresql] [psycopg2]</strong> <a class="changelog-reference headerlink reference internal" href="#change-02657081e3c39ff6edc04c60443ec994">¶</a></span><p>Update psycopg2 dialect to use the DBAPI interface to execute
two phase transactions. Previously SQL commands were execute
to handle this kind of transactions.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7238">#7238</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-77"><span class="target" id="change-8d63a225521d1c06855c09abbcb13c1f"><strong>[postgresql] [schema]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8d63a225521d1c06855c09abbcb13c1f">¶</a></span><p>Introduced the type <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONPATH" title="sqlalchemy.dialects.postgresql.JSONPATH"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONPATH</span></code></a> that can be used
in cast expressions. This is required by some PostgreSQL dialects
when using functions such as <code class="docutils literal notranslate"><span class="pre">jsonb_path_exists</span></code> or
<code class="docutils literal notranslate"><span class="pre">jsonb_path_match</span></code> that accept a <code class="docutils literal notranslate"><span class="pre">jsonpath</span></code> as input.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-json-types"><span class="std std-ref">JSON Types</span></a> - PostgreSQL JSON types.</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8216">#8216</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-78"><span class="target" id="change-a57ec164e48c082df4b4e93bbc39e6b8"><strong>[postgresql] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a57ec164e48c082df4b4e93bbc39e6b8">¶</a></span><p>The PostgreSQL dialect now supports reflection of expression based indexes.
The reflection is supported both when using
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_indexes()</span></code> and when reflecting a
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.autoload_with" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.autoload_with</span></code></a>.
Thanks to immerrr and Aidan Kane for the help on this ticket.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7442">#7442</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.0b1-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-79"><span class="target" id="change-bd993480a092e17b40c0956cf33dd14e"><strong>[mysql] [usecase] [mariadb]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bd993480a092e17b40c0956cf33dd14e">¶</a></span><p>The <code class="docutils literal notranslate"><span class="pre">ROLLUP</span></code> function will now correctly render <code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">ROLLUP</span></code> on
MySql and MariaDB, allowing the use of group by rollup with these
backend.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8503">#8503</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-80"><span class="target" id="change-29aac863e814dec89b052e95418cae2b"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-29aac863e814dec89b052e95418cae2b">¶</a></span><p>Fixed issue in MySQL <a class="reference internal" href="../dialects/mysql.html#sqlalchemy.dialects.mysql.Insert.on_duplicate_key_update" title="sqlalchemy.dialects.mysql.Insert.on_duplicate_key_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_duplicate_key_update()</span></code></a> which
would render the wrong column name when an expression were used in a VALUES
expression. Pull request courtesy Cristian Sabaila.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7281">#7281</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-81"><span class="target" id="change-8051254beb1fa9b4191885a3b1f1f45e"><strong>[mysql] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8051254beb1fa9b4191885a3b1f1f45e">¶</a></span><p>Removed support for the OurSQL driver for MySQL and MariaDB, as this
driver does not seem to be maintained.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-mariadb">
<h3>mariadb<a class="headerlink" href="#change-2.0.0b1-mariadb" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-82"><span class="target" id="change-e238107544d812ca9f9e1cde4f1b1b49"><strong>[mariadb] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e238107544d812ca9f9e1cde4f1b1b49">¶</a></span><p>Added a new execution option <code class="docutils literal notranslate"><span class="pre">is_delete_using=True</span></code>, which is consumed
by the ORM when using an ORM-enabled DELETE statement in conjunction with
the “fetch” synchronization strategy; this option indicates that the
DELETE statement is expected to use multiple tables, which on MariaDB
is the DELETE..USING syntax.   The option then indicates that
RETURNING (newly implemented in SQLAlchemy 2.0 for MariaDB
for  <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7011">#7011</a>) should not be used for databases that are known
to not support “DELETE..USING..RETURNING” syntax, even though they
support “DELETE..USING”, which is MariaDB’s current capability.</p>
<p>The rationale for this option is that the current workings of ORM-enabled
DELETE doesn’t know up front if a DELETE statement is against multiple
tables or not until compilation occurs, which is cached in any case, yet it
needs to be known so that a SELECT for the to-be-deleted row can be emitted
up front. Instead of applying an across-the-board performance penalty for
all DELETE statements by proactively checking them all for this
relatively unusual SQL pattern, the <code class="docutils literal notranslate"><span class="pre">is_delete_using=True</span></code> execution
option is requested via a new exception message that is raised
within the compilation step.  This exception message is specifically
(and only) raised when:   the statement is an ORM-enabled DELETE where
the “fetch” synchronization strategy has been requested; the
backend is MariaDB or other backend with this specific limitation;
the statement has been detected within the initial compilation
that it would otherwise emit “DELETE..USING..RETURNING”.   By applying
the execution option, the ORM knows to run a SELECT upfront instead.
A similar option is implemented for ORM-enabled UPDATE but there is not
currently a backend where it is needed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8344">#8344</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-83"><span class="target" id="change-3c2ebb8ae7a5d8f29ed93050a7ffe259"><strong>[mariadb] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3c2ebb8ae7a5d8f29ed93050a7ffe259">¶</a></span><p>Added INSERT..RETURNING and DELETE..RETURNING support for the MariaDB
dialect.  UPDATE..RETURNING is not yet supported by MariaDB.  MariaDB
supports INSERT..RETURNING as of 10.5.0 and DELETE..RETURNING as of
10.0.5.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7011">#7011</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-sqlite">
<h3>sqlite<a class="headerlink" href="#change-2.0.0b1-sqlite" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-84"><span class="target" id="change-87ba0af63bdd0179a542b2fa63035be3"><strong>[sqlite] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-87ba0af63bdd0179a542b2fa63035be3">¶</a></span><p>Added new parameter to SQLite for reflection methods called
<code class="docutils literal notranslate"><span class="pre">sqlite_include_internal=True</span></code>; when omitted, local tables that start
with the prefix <code class="docutils literal notranslate"><span class="pre">sqlite_</span></code>, which per SQLite documentation are noted as
“internal schema” tables such as the <code class="docutils literal notranslate"><span class="pre">sqlite_sequence</span></code> table generated to
support “AUTOINCREMENT” columns, will not be included in reflection methods
that return lists of local objects. This prevents issues for example when
using Alembic autogenerate, which previously would consider these
SQLite-generated tables as being remove from the model.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/sqlite.html#sqlite-include-internal"><span class="std std-ref">Reflecting internal schema tables</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8234">#8234</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-85"><span class="target" id="change-0a487b939ab3ad7ca93ee291b91eb410"><strong>[sqlite] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0a487b939ab3ad7ca93ee291b91eb410">¶</a></span><p>Added RETURNING support for the SQLite dialect.  SQLite supports RETURNING
since version 3.35.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6195">#6195</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-86"><span class="target" id="change-74fee584f531c832d0d97ea94be754b8"><strong>[sqlite] [usecase] [performance]</strong> <a class="changelog-reference headerlink reference internal" href="#change-74fee584f531c832d0d97ea94be754b8">¶</a></span><p>SQLite datetime, date, and time datatypes now use Python standard lib
<code class="docutils literal notranslate"><span class="pre">fromisoformat()</span></code> methods in order to parse incoming datetime, date, and
time string values. This improves performance vs. the previous regular
expression-based approach, and also automatically accommodates for datetime
and time formats that contain either a six-digit “microseconds” format or a
three-digit “milliseconds” format.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7029">#7029</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-87"><span class="target" id="change-ef6ce799a34b30832a9c8115e2afa920"><strong>[sqlite] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ef6ce799a34b30832a9c8115e2afa920">¶</a></span><p>The SQLite dialect now supports UPDATE..FROM syntax, for UPDATE statements
that may refer to additional tables within the WHERE criteria of the
statement without the need to use subqueries. This syntax is invoked
automatically when using the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> construct when more than
one table or other entity or selectable is used.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7185">#7185</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-88"><span class="target" id="change-aba109875059299e0eb82359b5825416"><strong>[sqlite] [performance] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-aba109875059299e0eb82359b5825416">¶</a></span><p>The SQLite dialect now defaults to <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> when a file
based database is used. This is set along with setting the
<code class="docutils literal notranslate"><span class="pre">check_same_thread</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code>. It has been observed that the
previous approach of defaulting to <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a>, which does not
hold onto database connections after they are released, did in fact have a
measurable negative performance impact. As always, the pool class is
customizable via the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.poolclass" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.poolclass</span></code></a> parameter.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7490"><span class="std std-ref">The SQLite dialect uses QueuePool for file-based databases</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7490">#7490</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-89"><span class="target" id="change-b11607250a6e056103e2b2d1205be1a8"><strong>[sqlite] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b11607250a6e056103e2b2d1205be1a8">¶</a></span><p>Removed the warning that emits from the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a> type about
DBAPIs not supporting Decimal values natively. This warning was oriented
towards SQLite, which does not have any real way without additional
extensions or workarounds of handling precision numeric values more than 15
significant digits as it only uses floating point math to represent
numbers. As this is a known and documented limitation in SQLite itself, and
not a quirk of the pysqlite driver, there’s no need for SQLAlchemy to warn
for this. The change does not otherwise modify how precision numerics are
handled. Values can continue to be handled as <code class="docutils literal notranslate"><span class="pre">Decimal()</span></code> or <code class="docutils literal notranslate"><span class="pre">float()</span></code>
as configured with the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> , and
related datatypes, just without the ability to maintain precision beyond 15
significant digits when using SQLite, unless alternate representations such
as strings are used.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7299">#7299</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.0b1-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-90"><span class="target" id="change-eb828295f913893a52666f05ba211af0"><strong>[mssql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-eb828295f913893a52666f05ba211af0">¶</a></span><p>Implemented reflection of the “clustered index” flag <code class="docutils literal notranslate"><span class="pre">mssql_clustered</span></code>
for the SQL Server dialect. Pull request courtesy John Lennox.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8288">#8288</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-91"><span class="target" id="change-5381b6da8f1e1e87292d63c7a815282c"><strong>[mssql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5381b6da8f1e1e87292d63c7a815282c">¶</a></span><p>Added support table and column comments on MSSQL when
creating a table. Added support for reflecting table comments.
Thanks to Daniel Hall for the help in this pull request.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7844">#7844</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-92"><span class="target" id="change-66bddfbbce3c9e37214e8c5864ab1fad"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-66bddfbbce3c9e37214e8c5864ab1fad">¶</a></span><p>The <code class="docutils literal notranslate"><span class="pre">use_setinputsizes</span></code> parameter for the <code class="docutils literal notranslate"><span class="pre">mssql+pyodbc</span></code> dialect now
defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>; this is so that non-unicode string comparisons are
bound by pyodbc to pyodbc.SQL_VARCHAR rather than pyodbc.SQL_WVARCHAR,
allowing indexes against VARCHAR columns to take effect. In order for the
<code class="docutils literal notranslate"><span class="pre">fast_executemany=True</span></code> parameter to continue functioning, the
<code class="docutils literal notranslate"><span class="pre">use_setinputsizes</span></code> mode now skips the <code class="docutils literal notranslate"><span class="pre">cursor.setinputsizes()</span></code> call
specifically when <code class="docutils literal notranslate"><span class="pre">fast_executemany</span></code> is True and the specific method in
use is <code class="docutils literal notranslate"><span class="pre">cursor.executemany()</span></code>, which doesn’t support setinputsizes. The
change also adds appropriate pyodbc DBAPI typing to values that are typed
as <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> or <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UnicodeText" title="sqlalchemy.types.UnicodeText"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnicodeText</span></code></a>, as well as
altered the base <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> datatype to consider JSON string
values as <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> rather than <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8177">#8177</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-93"><span class="target" id="change-331585cb105c7ac765402fada93eb145"><strong>[mssql] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-331585cb105c7ac765402fada93eb145">¶</a></span><p>Removed support for the mxodbc driver due to lack of testing support. ODBC
users may use the pyodbc dialect which is fully supported.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.0b1-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-94"><span class="target" id="change-eeb03c160d031aaae00f66021f36b12d"><strong>[oracle] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-eeb03c160d031aaae00f66021f36b12d">¶</a></span><p>Add support for the new oracle driver <code class="docutils literal notranslate"><span class="pre">oracledb</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#ticket-8054"><span class="std std-ref">Dialect support for oracledb</span></a></p>
<p><a class="reference internal" href="../dialects/oracle.html#oracledb"><span class="std std-ref">python-oracledb</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8054">#8054</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-95"><span class="target" id="change-ca0562a665f538b7272e2ebac618db47"><strong>[oracle] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ca0562a665f538b7272e2ebac618db47">¶</a></span><p>Implemented DDL and reflection support for <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> datatypes which
include an explicit “binary_precision” value. Using the Oracle-specific
<a class="reference internal" href="../dialects/oracle.html#sqlalchemy.dialects.oracle.FLOAT" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a> datatype, the new parameter
<a class="reference internal" href="../dialects/oracle.html#sqlalchemy.dialects.oracle.FLOAT.params.binary_precision" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">FLOAT.binary_precision</span></code></a> may be specified which will
render Oracle’s precision for floating point types directly. This value is
interpreted during reflection. Upon reflecting back a <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> datatype,
the datatype returned is one of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DOUBLE_PRECISION" title="sqlalchemy.types.DOUBLE_PRECISION"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOUBLE_PRECISION</span></code></a> for a
<code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> for a precision of 126 (this is also Oracle’s default precision
for <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>), <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">REAL</span></code></a> for a precision of 63, and
<a class="reference internal" href="../dialects/oracle.html#sqlalchemy.dialects.oracle.FLOAT" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a> for a custom precision, as per Oracle documentation.</p>
<p>As part of this change, the generic <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float.params.precision" title="sqlalchemy.types.Float"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Float.precision</span></code></a>
value is explicitly rejected when generating DDL for Oracle, as this
precision cannot be accurately converted to “binary precision”; instead, an
error message encourages the use of
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a> so that Oracle’s specific form of
precision may be chosen exactly. This is a backwards-incompatible change in
behavior, as the previous “precision” value was silently ignored for
Oracle.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-5465-oracle"><span class="std std-ref">New Oracle FLOAT type with binary precision; decimal precision not accepted directly</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5465">#5465</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-96"><span class="target" id="change-bf1925eed418d2e2bb63286942a2aa62"><strong>[oracle] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bf1925eed418d2e2bb63286942a2aa62">¶</a></span><p>Full “RETURNING” support is implemented for the cx_Oracle dialect, covering
two individual types of functionality:</p>
<ul>
<li><p>multi-row RETURNING is implemented, meaning multiple RETURNING rows are
now received for DML statements that produce more than one row for
RETURNING.</p></li>
<li><p>”executemany RETURNING” is also implemented - this allows RETURNING to
yield row-per statement when <code class="docutils literal notranslate"><span class="pre">cursor.executemany()</span></code> is used.
The implementation of this part of the feature delivers dramatic
performance improvements to ORM inserts, in the same way as was
added for psycopg2 in the SQLAlchemy 1.4 change <a class="reference internal" href="migration_14.html#change-5263"><span class="std std-ref">ORM Batch inserts with psycopg2 now batch statements with RETURNING in most cases</span></a>.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6245">#6245</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-97"><span class="target" id="change-56152629724a193afda447f03f7d1ad0"><strong>[oracle] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-56152629724a193afda447f03f7d1ad0">¶</a></span><p>Oracle will now use FETCH FIRST N ROWS / OFFSET syntax for limit/offset
support by default for Oracle 12c and above. This syntax was already
available when <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.fetch" title="sqlalchemy.sql.expression.Select.fetch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.fetch()</span></code></a> were used directly, it’s now
implied for <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.limit" title="sqlalchemy.sql.expression.Select.limit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.limit()</span></code></a> and <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.offset" title="sqlalchemy.sql.expression.Select.offset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.offset()</span></code></a> as
well.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8221">#8221</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-98"><span class="target" id="change-0a5938bbfa46c3426a247288c3469167"><strong>[oracle] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0a5938bbfa46c3426a247288c3469167">¶</a></span><p>Materialized views on oracle are now reflected as views.
On previous versions of SQLAlchemy the views were returned among
the table names, not among the view names. As a side effect of
this change they are not reflected by default by
<code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.reflect()</span></code>, unless <code class="docutils literal notranslate"><span class="pre">views=True</span></code> is set.
To get a list of materialized views, use the new
inspection method <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_materialized_view_names" title="sqlalchemy.engine.reflection.Inspector.get_materialized_view_names"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_materialized_view_names()</span></code></a>.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-99"><span class="target" id="change-b1f8435d162a2820dbaca029aa53bb5f"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b1f8435d162a2820dbaca029aa53bb5f">¶</a></span><p>Adjustments made to the BLOB / CLOB / NCLOB datatypes in the cx_Oracle and
oracledb dialects, to improve performance based on recommendations from
Oracle developers.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7494">#7494</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-100"><span class="target" id="change-7ec56a4929a89c1bb8f6751cfaf84753"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7ec56a4929a89c1bb8f6751cfaf84753">¶</a></span><p>Related to the deprecation for
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.implicit_returning" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.implicit_returning</span></code></a>, the “implicit_returning”
feature is now enabled for the Oracle dialect in all cases; previously, the
feature would be turned off when an Oracle 8/8i version were detected,
however online documentation indicates both versions support the same
RETURNING syntax as modern versions.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6962">#6962</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-101"><span class="target" id="change-68ceca590251d75fbd16df1f236e1123"><strong>[oracle]</strong> <a class="changelog-reference headerlink reference internal" href="#change-68ceca590251d75fbd16df1f236e1123">¶</a></span><p>cx_Oracle 7 is now the minimum version for cx_Oracle.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-misc">
<h3>misc<a class="headerlink" href="#change-2.0.0b1-misc" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-102"><span class="target" id="change-ea7e18a4d46eb028c8467f86baf23c3e"><strong>[removed] [sybase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ea7e18a4d46eb028c8467f86baf23c3e">¶</a></span><p>Removed the “sybase” internal dialect that was deprecated in previous
SQLAlchemy versions.  Third party dialect support is available.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/index.html"><span class="std std-ref">External Dialects</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-103"><span class="target" id="change-6bc74df6de169a4e220964fe38583665"><strong>[removed] [firebird]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6bc74df6de169a4e220964fe38583665">¶</a></span><p>Removed the “firebird” internal dialect that was deprecated in previous
SQLAlchemy versions.  Third party dialect support is available.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/index.html"><span class="std std-ref">External Dialects</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
</ul>
</section>
</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="whatsnew_20.html" title="previous chapter">What’s New in SQLAlchemy 2.0?</a>
        Next:
        <a href="changelog_14.html" title="next chapter">1.4 Changelog</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2024, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.2.6.

    Documentation last generated: Mon Aug  5 19:31:00 2024 JST

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      document.documentElement.dataset.content_root = '../';

    </script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


